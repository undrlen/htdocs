<?php
 class umiDirectory implements iUmiDirectory, IteratorAggregate {protected $path = '';protected $is_broken = false;protected $arr_files = [];protected $arr_dirs = [];protected $arr_objs = [];protected $is_readed = false;protected $isReadable = false;protected $isWritable = false;private static $cache = [];private $parentPath;public function __construct($vd6fe1d0be6347b8ef2427fa629c04485) {try {$this->setPath($vd6fe1d0be6347b8ef2427fa629c04485);}catch (Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {umiExceptionHandler::report($v42552b1f133f9f8eb406d4f306ea9fd1);}$this->refresh();}public function refresh() {$vd6fe1d0be6347b8ef2427fa629c04485 = $this->getPath();if (is_dir($vd6fe1d0be6347b8ef2427fa629c04485)) {$this->setReadable(     is_readable($vd6fe1d0be6347b8ef2427fa629c04485)    );$this->setWritable(     is_writable($vd6fe1d0be6347b8ef2427fa629c04485)    );$this->is_broken = false;return $this;}$this->setReadable(false);$this->setWritable(false);$this->is_broken = true;return $this;}public function getPath() {return $this->path;}public function getName() {$vecc36294ab8c5c533b35f3e32182f913 = explode('/', $this->path);return array_pop($vecc36294ab8c5c533b35f3e32182f913);}public function getIterator() {$this->read();return new umiDirectoryIterator($this->arr_objs);}private function read() {if ($this->is_readed) {return false;}$this->is_readed = true;$this->arr_files = [];$this->arr_dirs = [];$v0fea6a13c52b4d4725368f24b045ca84 = self::cache($this->path);if ($v0fea6a13c52b4d4725368f24b045ca84) {list($this->arr_files, $this->arr_dirs, $this->arr_objs) = $v0fea6a13c52b4d4725368f24b045ca84;return;}if (is_dir($this->path) && is_readable($this->path)) {$vf6822f7a2c7f67642432cae7c6e16f11 = opendir($this->path);if ($vf6822f7a2c7f67642432cae7c6e16f11) {while (($ve7f75a362d2d248bbabd5abbdbb8ab25 = readdir($vf6822f7a2c7f67642432cae7c6e16f11)) !== false) {if (isDemoMode()) {if ($ve7f75a362d2d248bbabd5abbdbb8ab25 == 'demo') {continue;}}$vf6fe2202aaa5491a9c7a9fef46f44483 = $this->path . '/' . $ve7f75a362d2d248bbabd5abbdbb8ab25;if (is_file($vf6fe2202aaa5491a9c7a9fef46f44483)) {$this->arr_files[$ve7f75a362d2d248bbabd5abbdbb8ab25] = $vf6fe2202aaa5491a9c7a9fef46f44483;$this->arr_objs[] = $vf6fe2202aaa5491a9c7a9fef46f44483;}elseif (is_dir($vf6fe2202aaa5491a9c7a9fef46f44483) && $ve7f75a362d2d248bbabd5abbdbb8ab25 != '..' && $ve7f75a362d2d248bbabd5abbdbb8ab25 != '.') {$this->arr_dirs[$ve7f75a362d2d248bbabd5abbdbb8ab25] = $vf6fe2202aaa5491a9c7a9fef46f44483;$this->arr_objs[] = $vf6fe2202aaa5491a9c7a9fef46f44483;}}closedir($vf6822f7a2c7f67642432cae7c6e16f11);}}self::cache($this->path, [$this->arr_files, $this->arr_dirs, $this->arr_objs]);}public function getIsBroken() {return (bool) $this->is_broken;}public function isExists() {return !$this->getIsBroken();}public function isReadable() {return (bool) $this->isReadable;}public function isWritable() {return (bool) $this->isWritable;}public function getList($v240bf022e685b0ee30ad9fe9e1fb5d5b) {$v240bf022e685b0ee30ad9fe9e1fb5d5b = sprintf('%s/%s', $this->getPath(), ltrim($v240bf022e685b0ee30ad9fe9e1fb5d5b, '/'));$v10ae9fc7d453b0dd525d0edf2ede7961 = glob($v240bf022e685b0ee30ad9fe9e1fb5d5b);return is_array($v10ae9fc7d453b0dd525d0edf2ede7961) ? $v10ae9fc7d453b0dd525d0edf2ede7961 : [];}public function getFSObjects($vd1c23eb6cdb82a62e26a8b358943d104 = 0, $v680c0a11687c0b2cf6554086431e2d31 = '', $v17fa2d7e21098f98c5ecf28224bd9e90 = false) {$this->read();$v7dc5291b1ee158186937dced87c5cdbd = [];switch ($vd1c23eb6cdb82a62e26a8b358943d104) {case 1:                                    $v563a5461acd4cf632a113d5b105e817e = $this->arr_files;break;case 2:                                    $v563a5461acd4cf632a113d5b105e817e = $this->arr_dirs;break;default:     $v563a5461acd4cf632a113d5b105e817e = array_merge($this->arr_dirs, $this->arr_files);}$v680c0a11687c0b2cf6554086431e2d31 = (string) $v680c0a11687c0b2cf6554086431e2d31;foreach ($v563a5461acd4cf632a113d5b105e817e as $v378a57caf83c2685b4ec1da99037a754 => $vf6fe2202aaa5491a9c7a9fef46f44483) {if ((!$v17fa2d7e21098f98c5ecf28224bd9e90 || is_readable($vf6fe2202aaa5491a9c7a9fef46f44483)) && ($v680c0a11687c0b2cf6554086431e2d31 === '') ||     preg_match('/' . $v680c0a11687c0b2cf6554086431e2d31 . '/i', $v378a57caf83c2685b4ec1da99037a754)) {$v7dc5291b1ee158186937dced87c5cdbd[$v378a57caf83c2685b4ec1da99037a754] = $vf6fe2202aaa5491a9c7a9fef46f44483;}}ksort($v7dc5291b1ee158186937dced87c5cdbd);return $v7dc5291b1ee158186937dced87c5cdbd;}public function getFiles($v680c0a11687c0b2cf6554086431e2d31 = '', $v17fa2d7e21098f98c5ecf28224bd9e90 = false) {return $this->getFSObjects(1, $v680c0a11687c0b2cf6554086431e2d31, $v17fa2d7e21098f98c5ecf28224bd9e90);}public function getDirectories($v680c0a11687c0b2cf6554086431e2d31 = '', $v17fa2d7e21098f98c5ecf28224bd9e90 = false) {return $this->getFSObjects(2, $v680c0a11687c0b2cf6554086431e2d31, $v17fa2d7e21098f98c5ecf28224bd9e90);}public function getAllFiles($vd1c23eb6cdb82a62e26a8b358943d104 = 0, $v680c0a11687c0b2cf6554086431e2d31 = '', $v17fa2d7e21098f98c5ecf28224bd9e90 = false) {$v45b963397aa40d4a0063e0d85e4fe7a1 = $this->getFSObjects($vd1c23eb6cdb82a62e26a8b358943d104, $v680c0a11687c0b2cf6554086431e2d31, $v17fa2d7e21098f98c5ecf28224bd9e90);$result = array_flip($v45b963397aa40d4a0063e0d85e4fe7a1);$v33030abc929f083da5f6c3f755b46034 = $this->getFSObjects(2, $v680c0a11687c0b2cf6554086431e2d31, $v17fa2d7e21098f98c5ecf28224bd9e90);foreach ($v33030abc929f083da5f6c3f755b46034 as $v736007832d2167baaae763fd3a3f3cf1) {$v736007832d2167baaae763fd3a3f3cf1 = new umiDirectory($v736007832d2167baaae763fd3a3f3cf1);$v61bc14cb8b5ad53713391fa68d17e48c = $v736007832d2167baaae763fd3a3f3cf1->getAllFiles($vd1c23eb6cdb82a62e26a8b358943d104, $v680c0a11687c0b2cf6554086431e2d31 = '', $v17fa2d7e21098f98c5ecf28224bd9e90);foreach ($v61bc14cb8b5ad53713391fa68d17e48c as $vd6fe1d0be6347b8ef2427fa629c04485 => $vb068931cc450442b63f5b3d276ea4297) {$result[$vd6fe1d0be6347b8ef2427fa629c04485] = $vb068931cc450442b63f5b3d276ea4297;}}return $result;}public function deleteRecursively() {return $this->delete(true);}public function delete($v5d73b4771afcd61a46c64ab9591c44bd = false) {if (!is_writable($this->path)) {return false;}$vf09050126852fa55ae489cbcb192b88d = true;if ($v5d73b4771afcd61a46c64ab9591c44bd) {$vf09050126852fa55ae489cbcb192b88d = $this->deleteContent();}return $vf09050126852fa55ae489cbcb192b88d && @rmdir($this->path);}public function deleteContent() {self::deleteCache();foreach ($this as $v447b7147e84be512208dcc0995d67ebc) {$va18b1057c4327b9cc46abc9fcf952bd8 = false;if ($v447b7147e84be512208dcc0995d67ebc instanceof iUmiDirectory) {$va18b1057c4327b9cc46abc9fcf952bd8 = $v447b7147e84be512208dcc0995d67ebc->deleteRecursively();}elseif ($v447b7147e84be512208dcc0995d67ebc instanceof iUmiFile) {$va18b1057c4327b9cc46abc9fcf952bd8 = $v447b7147e84be512208dcc0995d67ebc->delete();}if (!$va18b1057c4327b9cc46abc9fcf952bd8) {return false;}}return true;}public function deleteFilesByPattern($v240bf022e685b0ee30ad9fe9e1fb5d5b = '/(.*temp$)/') {if ($this->getIsBroken()) {return;}foreach ($this as $v447b7147e84be512208dcc0995d67ebc) {if ($v447b7147e84be512208dcc0995d67ebc instanceof self) {$v447b7147e84be512208dcc0995d67ebc->deleteFilesByPattern($v240bf022e685b0ee30ad9fe9e1fb5d5b);}if ($v447b7147e84be512208dcc0995d67ebc instanceof umiFile && preg_match($v240bf022e685b0ee30ad9fe9e1fb5d5b, $v447b7147e84be512208dcc0995d67ebc->getFilePath())) {$v447b7147e84be512208dcc0995d67ebc->delete();}}}public function deleteEmptyDirectory() {$vfda53a9121e1ef28ac01017c2d18182d = false;return $this->delete($vfda53a9121e1ef28ac01017c2d18182d);}public function getParentPath() {return $this->parentPath;}public static function requireFolder($v851148b4fd8fd7ae74bd9100c5c0c898, $v2d5ec04ac614a2ce7db2e49fce18670c = '') {if (!$v851148b4fd8fd7ae74bd9100c5c0c898) {return false;}if (!is_dir($v851148b4fd8fd7ae74bd9100c5c0c898)) {mkdir($v851148b4fd8fd7ae74bd9100c5c0c898, 0777, true);}$vf1717c0d3bb9106455d837859192864e = realpath($v851148b4fd8fd7ae74bd9100c5c0c898);$v2d5ec04ac614a2ce7db2e49fce18670c = realpath($v2d5ec04ac614a2ce7db2e49fce18670c);return (mb_substr($vf1717c0d3bb9106455d837859192864e, 0, mb_strlen($v2d5ec04ac614a2ce7db2e49fce18670c)) == $v2d5ec04ac614a2ce7db2e49fce18670c);}public static function getDirectorySize($v06f0066e65410a0a1c9f39991a3f3b01) {return getDirSize($v06f0066e65410a0a1c9f39991a3f3b01);}public function __toString() {return "umiDirectory::{$this->path}";}protected function setPath($vd6fe1d0be6347b8ef2427fa629c04485) {if (!is_string($vd6fe1d0be6347b8ef2427fa629c04485) || empty($vd6fe1d0be6347b8ef2427fa629c04485)) {throw new Exception('Wrong path given');}$vd6fe1d0be6347b8ef2427fa629c04485 = rtrim($vd6fe1d0be6347b8ef2427fa629c04485, '/');if (empty($vd6fe1d0be6347b8ef2427fa629c04485)) {throw new Exception('Wrong path given');}$this->path = $vd6fe1d0be6347b8ef2427fa629c04485;return $this->loadParentPath();}protected static function cache($v3c6e0b8a9c15224a8228b9a98ca1531d, $v2063c1608d6e0baf80249c42e2be5804 = null) {if ($v2063c1608d6e0baf80249c42e2be5804) {return self::$cache[$v3c6e0b8a9c15224a8228b9a98ca1531d] = $v2063c1608d6e0baf80249c42e2be5804;}if (isset(self::$cache[$v3c6e0b8a9c15224a8228b9a98ca1531d])) {return self::$cache[$v3c6e0b8a9c15224a8228b9a98ca1531d];}return null;}protected static function deleteCache() {self::$cache = [];}protected function setReadable($v327a6c4304ad5938eaf0efb6cc3e53dc = true) {$this->isReadable = (bool) $v327a6c4304ad5938eaf0efb6cc3e53dc;return $this;}protected function setWritable($v327a6c4304ad5938eaf0efb6cc3e53dc = true) {$this->isWritable = (bool) $v327a6c4304ad5938eaf0efb6cc3e53dc;return $this;}private function loadParentPath() {$ve9a95f404b4c843d111ee88f48b2d8d4 = pathinfo($this->getPath());$v2405a5d61f2f462a1371b33338295c09 = isset($ve9a95f404b4c843d111ee88f48b2d8d4['dirname']) ? $ve9a95f404b4c843d111ee88f48b2d8d4['dirname'] : '';return $this->setParentPath($v2405a5d61f2f462a1371b33338295c09);}private function setParentPath($vd6fe1d0be6347b8ef2427fa629c04485) {$this->parentPath = $vd6fe1d0be6347b8ef2427fa629c04485;return $this;}}