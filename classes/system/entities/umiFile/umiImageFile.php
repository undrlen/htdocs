<?php
 use UmiCms\Classes\System\Utils\Watermark\Settings\iSettings;use UmiCms\Service;class umiImageFile extends umiFile implements iUmiImageFile {const IMAGE_TYPE_GIF = 'GIF';const IMAGE_TYPE_JPG = 'JPG';const IMAGE_TYPE_JPEG = 'JPEG';const IMAGE_TYPE_PNG = 'PNG';const IMAGE_TYPE_WBMP = 'WBMP';const IMAGE_TYPE_BMP = 'BMP';const IMAGE_TYPE_SWF = 'SWF';const IMAGE_TYPE_XBM = 'XBM';const IMAGE_TYPE_SVG = 'SVG';const IMAGE_TYPE_ICO = 'ICO';private static $aSupportedTypes;private static $useWatermark = false;private static $CurrentBit = 0;private $sImageType;private $iImageWidth;private $iImageHeight;private $alt;private $title;public function __construct($v47826cacc65c665212b821e6ff80b9b0) {parent::__construct($v47826cacc65c665212b821e6ff80b9b0);if (!$this->is_broken) {$this->is_broken = !(self::getIsImage($this->name) && is_readable($this->filepath));}if ($this->getIsBroken()) {return;}if ($this->isSvg()) {return $this->loadSvgParams();}$v14b626809ea481d1490034025d1edd8b = @getimagesize($this->filepath);$this->iImageWidth = $v14b626809ea481d1490034025d1edd8b[0];$this->iImageHeight = $v14b626809ea481d1490034025d1edd8b[1];switch ($v14b626809ea481d1490034025d1edd8b['mime']) {case 'image/gif': {$this->sImageType = self::IMAGE_TYPE_GIF;break;}case 'image/jpg': {$this->sImageType = self::IMAGE_TYPE_JPG;break;}case 'image/jpeg': {$this->sImageType = self::IMAGE_TYPE_JPEG;break;}case 'image/png': {$this->sImageType = self::IMAGE_TYPE_PNG;break;}case 'image/vnd.wap.wbmp': {$this->sImageType = self::IMAGE_TYPE_WBMP;break;}case 'image/bmp': {$this->sImageType = self::IMAGE_TYPE_BMP;break;}case 'application/x-shockwave-flash': {$this->sImageType = self::IMAGE_TYPE_SWF;break;}}}public function getMimeType() {switch (strtoupper($this->getExt())) {case self::IMAGE_TYPE_GIF : {return 'image/gif';}case self::IMAGE_TYPE_JPEG : {return 'image/jpeg';}case self::IMAGE_TYPE_JPG : {return 'image/jpg';}case self::IMAGE_TYPE_PNG : {return 'image/png';}case self::IMAGE_TYPE_BMP : {return 'image/bmp';}case self::IMAGE_TYPE_SWF : {return 'application/x-shockwave-flash';}case self::IMAGE_TYPE_SVG : {return 'image/svg+xml';}case self::IMAGE_TYPE_ICO : {return 'image/x-icon';}default : {throw new ErrorException(sprintf('Unexpected type "%s"', $this->getExt()));}}}private function isSvg() {return $this->getExt() === mb_strtolower(self::IMAGE_TYPE_SVG);}private function loadSvgParams() {$v0f635d0e0f3874fff8b581c132e6c7a7 = simplexml_load_file($this->getFilePath());$v6dd047148d685270458ecc44ee128a4d = $v0f635d0e0f3874fff8b581c132e6c7a7->attributes();$this->iImageWidth = (int) $v6dd047148d685270458ecc44ee128a4d->width;$this->iImageHeight = (int) $v6dd047148d685270458ecc44ee128a4d->height;$this->sImageType = self::IMAGE_TYPE_SVG;}public static function getSupportedImageTypes() {if (self::$aSupportedTypes === null) {self::$aSupportedTypes = [];self::$aSupportedTypes[] = self::IMAGE_TYPE_GIF;self::$aSupportedTypes[] = self::IMAGE_TYPE_JPG;self::$aSupportedTypes[] = self::IMAGE_TYPE_JPEG;self::$aSupportedTypes[] = self::IMAGE_TYPE_PNG;self::$aSupportedTypes[] = self::IMAGE_TYPE_WBMP;self::$aSupportedTypes[] = self::IMAGE_TYPE_BMP;self::$aSupportedTypes[] = self::IMAGE_TYPE_SWF;self::$aSupportedTypes[] = self::IMAGE_TYPE_SVG;self::$aSupportedTypes[] = self::IMAGE_TYPE_ICO;}return self::$aSupportedTypes;}public static function setWatermarkOn() {self::$useWatermark = true;}public static function setWatermarkOff() {self::$useWatermark = false;}public static function upload($va2b861d0e7719d9108522aacfd4181bc, $v51746fc9cfaaf892e94c2d56d7508b37, $v207e5b7e7d2b07f6b19066e8d62f4b1d, $vb80bb7740288fda1f201890375a60c8f = false) {self::$class_name = __CLASS__;$v8c7dd922ad47494fc02c388e12c00eac = parent::upload($va2b861d0e7719d9108522aacfd4181bc, $v51746fc9cfaaf892e94c2d56d7508b37, $v207e5b7e7d2b07f6b19066e8d62f4b1d, $vb80bb7740288fda1f201890375a60c8f);$vb1444fb0c07653567ad325aa25d4e37a = Service::Registry();$ve6a7ab42343e8bc9131d89646abcb773 = (int) $vb1444fb0c07653567ad325aa25d4e37a->get('//settings/max_img_filesize');$v79001f389eb5f5185f6945430cb57be1 = (int) ini_get('upload_max_filesize');$ve6a7ab42343e8bc9131d89646abcb773 = ($ve6a7ab42343e8bc9131d89646abcb773 < $v79001f389eb5f5185f6945430cb57be1) ? $ve6a7ab42343e8bc9131d89646abcb773 : $v79001f389eb5f5185f6945430cb57be1;$v11b4278c7e5a79003db77272c1ed2cf5 = (int) filesize('.' . $v8c7dd922ad47494fc02c388e12c00eac);$ve6a7ab42343e8bc9131d89646abcb773 = $ve6a7ab42343e8bc9131d89646abcb773 * 1024 * 1024;if ($ve6a7ab42343e8bc9131d89646abcb773 > 0) {if ($ve6a7ab42343e8bc9131d89646abcb773 < $v11b4278c7e5a79003db77272c1ed2cf5) {unlink('.' . $v8c7dd922ad47494fc02c388e12c00eac);return false;}}$vf9a3266ad8c9b1c7135d1e0d787fe91b = (bool) mainConfiguration::getInstance()->get('kernel', 'jpg-through-gd');if ($vf9a3266ad8c9b1c7135d1e0d787fe91b) {$v41fce2005fa27bdf619a257961c4f9c4 = imageUtils::getImageProcessor();$v41fce2005fa27bdf619a257961c4f9c4->optimize('.' . $v8c7dd922ad47494fc02c388e12c00eac, IMAGE_COMPRESSION_LEVEL);}if (self::$useWatermark) {self::addWatermark('./' . $v8c7dd922ad47494fc02c388e12c00eac);}self::setWatermarkOff();return $v8c7dd922ad47494fc02c388e12c00eac;}public static function getIsImage($v47826cacc65c665212b821e6ff80b9b0) {$v566bbee0f961ad71b54c3c2fd36db053 = self::getFileExtension($v47826cacc65c665212b821e6ff80b9b0);$v224efda5b9c5a1f3a8accaa89b5b5168 = mb_convert_case($v566bbee0f961ad71b54c3c2fd36db053, MB_CASE_UPPER);return in_array($v224efda5b9c5a1f3a8accaa89b5b5168, self::getSupportedImageTypes());}public function getAlt() {return $this->alt;}public function setAlt($v34823136d0dd91d0f5d22db740f7679c) {$this->alt = (string) $v34823136d0dd91d0f5d22db740f7679c;return $this;}public function getTitle() {return $this->title;}public function setTitle($vd5d3db1765287eef77d7927cc956f50a) {$this->title = (string) $vd5d3db1765287eef77d7927cc956f50a;return $this;}public function getWidth() {return $this->iImageWidth;}public function getHeight() {return $this->iImageHeight;}public function getType() {return $this->sImageType;}public static function addWatermark($v47826cacc65c665212b821e6ff80b9b0) {if (!empty($_REQUEST['disable_watermark'])) {return false;}$v2e5d8aa3dfa8ef34ca5131d20f9dad51 = self::getCurrentWatermarkSettings();$v9234d6561fcbf96ed0c3f0ee5794032d = $v2e5d8aa3dfa8ef34ca5131d20f9dad51->getImagePath();$v8fa8b46b17731c7c9c882faede387741 = $v2e5d8aa3dfa8ef34ca5131d20f9dad51->getAlpha();$v379da31305f1eba200307fcdf9cf0ca0 = $v2e5d8aa3dfa8ef34ca5131d20f9dad51->getVerticalAlign();$vb1c37415e373f67b34bfbdeac8a8338f = $v2e5d8aa3dfa8ef34ca5131d20f9dad51->getHorizontalAlign();if (!file_exists($v9234d6561fcbf96ed0c3f0ee5794032d)) {return false;}if (!$v8fa8b46b17731c7c9c882faede387741) {$v8fa8b46b17731c7c9c882faede387741 = 100;}if (!$v379da31305f1eba200307fcdf9cf0ca0) {$v379da31305f1eba200307fcdf9cf0ca0 = 'bottom';}if (!$vb1c37415e373f67b34bfbdeac8a8338f) {$vb1c37415e373f67b34bfbdeac8a8338f = 'right';}$vfc1eb20506413fbbdc753afe5117cff0 = self::createImage($v9234d6561fcbf96ed0c3f0ee5794032d);$v6226ba4abbac63dbd2114cb5966b1bf8 = self::createImage($v47826cacc65c665212b821e6ff80b9b0);$vfcf76116d23aa625909b9eb0e709b276 = getPathInfo($v47826cacc65c665212b821e6ff80b9b0);if (!$vfc1eb20506413fbbdc753afe5117cff0 || !$v6226ba4abbac63dbd2114cb5966b1bf8) {return false;}$v6382f6cf920a5e1f12258b86b3fcac3b = 0;$v44ef37a80954a70dc24d955310d80967 = 0;switch ($vb1c37415e373f67b34bfbdeac8a8338f) {case 'center' : {$v6382f6cf920a5e1f12258b86b3fcac3b = floor(($v6226ba4abbac63dbd2114cb5966b1bf8['width'] - $vfc1eb20506413fbbdc753afe5117cff0['width']) / 2);break;}case 'right' : {$v6382f6cf920a5e1f12258b86b3fcac3b = $v6226ba4abbac63dbd2114cb5966b1bf8['width'] - $vfc1eb20506413fbbdc753afe5117cff0['width'];}}switch ($v379da31305f1eba200307fcdf9cf0ca0) {case 'center' : {$v44ef37a80954a70dc24d955310d80967 = floor(($v6226ba4abbac63dbd2114cb5966b1bf8['height'] - $vfc1eb20506413fbbdc753afe5117cff0['height']) / 2);break;}case 'bottom' : {$v44ef37a80954a70dc24d955310d80967 = $v6226ba4abbac63dbd2114cb5966b1bf8['height'] - $vfc1eb20506413fbbdc753afe5117cff0['height'];}}$vfa816edb83e95bf0c8da580bdfd491ef = $vfc1eb20506413fbbdc753afe5117cff0['im'];$vfe47aa7c733c490d36e80508d5dc4019 = imagecreatetruecolor($vfc1eb20506413fbbdc753afe5117cff0['width'], $vfc1eb20506413fbbdc753afe5117cff0['height']);imagecopy(    $vfe47aa7c733c490d36e80508d5dc4019,    $v6226ba4abbac63dbd2114cb5966b1bf8['im'],    0,    0,    $v6382f6cf920a5e1f12258b86b3fcac3b,    $v44ef37a80954a70dc24d955310d80967,    $vfc1eb20506413fbbdc753afe5117cff0['width'],    $vfc1eb20506413fbbdc753afe5117cff0['height']   );imagecopy(    $vfe47aa7c733c490d36e80508d5dc4019,    $vfa816edb83e95bf0c8da580bdfd491ef,    0,    0,    0,    0,    $vfc1eb20506413fbbdc753afe5117cff0['width'],    $vfc1eb20506413fbbdc753afe5117cff0['height']   );imagecopymerge(    $v6226ba4abbac63dbd2114cb5966b1bf8['im'],    $vfe47aa7c733c490d36e80508d5dc4019,    $v6382f6cf920a5e1f12258b86b3fcac3b,    $v44ef37a80954a70dc24d955310d80967,    0,    0,    $vfc1eb20506413fbbdc753afe5117cff0['width'],    $vfc1eb20506413fbbdc753afe5117cff0['height'],    $v8fa8b46b17731c7c9c882faede387741   );switch ($vfcf76116d23aa625909b9eb0e709b276['extension']) {case 'jpeg' :    case 'jpg'  :    case 'JPEG' :    case 'JPG'  : {imagejpeg($v6226ba4abbac63dbd2114cb5966b1bf8['im'], $v47826cacc65c665212b821e6ff80b9b0, 90);break;}case 'png' :    case 'PNG' : {imagepng($v6226ba4abbac63dbd2114cb5966b1bf8['im'], $v47826cacc65c665212b821e6ff80b9b0);break;}case 'gif' :    case 'GIF' : {imagegif($v6226ba4abbac63dbd2114cb5966b1bf8['im'], $v47826cacc65c665212b821e6ff80b9b0);break;}case 'bmp' :    case 'BMP' :     imagewbmp($v6226ba4abbac63dbd2114cb5966b1bf8['im'], $v47826cacc65c665212b821e6ff80b9b0);break;}imagedestroy($v6226ba4abbac63dbd2114cb5966b1bf8['im']);imagedestroy($vfc1eb20506413fbbdc753afe5117cff0['im']);}private static function getCurrentWatermarkSettings() {$v9549dd6065d019211460c59a86dd6536 = Service::WatermarkSettingsFactory();$v2e5d8aa3dfa8ef34ca5131d20f9dad51 = $v9549dd6065d019211460c59a86dd6536->createCustom();if ($v2e5d8aa3dfa8ef34ca5131d20f9dad51->shouldUseCustomSettings()) {return $v2e5d8aa3dfa8ef34ca5131d20f9dad51;}return $v9549dd6065d019211460c59a86dd6536->createCommon();}public static function createImage($vfdc0a99c383c1558bed83c633f57a836) {$v6af5367d717800f80af73dee87484863 = $vfdc0a99c383c1558bed83c633f57a836;$vfdc0a99c383c1558bed83c633f57a836 = str_replace(CURRENT_WORKING_DIR, '', $vfdc0a99c383c1558bed83c633f57a836);$v931072b8630108758003074932646789 = 0;$va93b85dcfbb9969f5bb3c6be71737ed5 = parse_url($vfdc0a99c383c1558bed83c633f57a836);$vfdc0a99c383c1558bed83c633f57a836 = (mb_substr($va93b85dcfbb9969f5bb3c6be71737ed5['path'], 0, 1) == '/')    ? mb_substr($va93b85dcfbb9969f5bb3c6be71737ed5['path'], 1)    : $va93b85dcfbb9969f5bb3c6be71737ed5['path'];if (!file_exists($vfdc0a99c383c1558bed83c633f57a836)) {$vfdc0a99c383c1558bed83c633f57a836 = $v6af5367d717800f80af73dee87484863;}list ($veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81, $v599dcce2998a6b40b1e38e8c6006cb0a, $v815be97df65d6c4b510cd07189c5347a) = getimagesize($vfdc0a99c383c1558bed83c633f57a836);$vd14a8022b085f9ef19d479cbdd581127 = [    'GIF' => '1',    'JPG' => '2',    'PNG' => '3',    'BMP' => '6',    'WBMP' => '15',    'XBM' => '16'   ];switch ($v599dcce2998a6b40b1e38e8c6006cb0a) {case $vd14a8022b085f9ef19d479cbdd581127['GIF'] : {$v931072b8630108758003074932646789 = imagecreatefromgif($vfdc0a99c383c1558bed83c633f57a836);break;}case $vd14a8022b085f9ef19d479cbdd581127['JPG'] : {$v931072b8630108758003074932646789 = imagecreatefromjpeg($vfdc0a99c383c1558bed83c633f57a836);break;}case $vd14a8022b085f9ef19d479cbdd581127['PNG'] : {$v931072b8630108758003074932646789 = imagecreatefrompng($vfdc0a99c383c1558bed83c633f57a836);break;}case $vd14a8022b085f9ef19d479cbdd581127['BMP'] : {$v931072b8630108758003074932646789 = self::imagecreatefrombmp($vfdc0a99c383c1558bed83c633f57a836);break;}case $vd14a8022b085f9ef19d479cbdd581127['WBMP'] : {$v931072b8630108758003074932646789 = imagecreatefromwbmp($vfdc0a99c383c1558bed83c633f57a836);break;}case $vd14a8022b085f9ef19d479cbdd581127['XBM']: {$v931072b8630108758003074932646789 = imagecreatefromxbm($vfdc0a99c383c1558bed83c633f57a836);}}if (!$v931072b8630108758003074932646789) {return false;}return [    'im' => $v931072b8630108758003074932646789,    'width' => $veaae26a6fb20ed3ef54fb23bfa0b1fcc,    'height' => $vb435e227d5dd201e1768b2bcb2e0aa81   ];}private static function imagecreatefrombmp($v8c7dd922ad47494fc02c388e12c00eac) {$v8fa14cdd754f91cc6554c9e71929cce7 = fopen($v8c7dd922ad47494fc02c388e12c00eac, 'r');$vbf50d5e661106d0abe925af3c2e6f7e7 = fread($v8fa14cdd754f91cc6554c9e71929cce7, 2);if ($vbf50d5e661106d0abe925af3c2e6f7e7 == 'BM') {$v6f6cb72d544962fa333e2e34ce64f719 = self::freaddword($v8fa14cdd754f91cc6554c9e71929cce7);$v93876cb309016fa725517b046474c44b = self::freadword($v8fa14cdd754f91cc6554c9e71929cce7);$vd783eb173ee49cc2a004bc1ca1313615 = self::freadword($v8fa14cdd754f91cc6554c9e71929cce7);$v056a0c9991d04d9beff38e2b57cbd664 = self::freaddword($v8fa14cdd754f91cc6554c9e71929cce7);$va4351f8f1ec9ca5a4c6ed7c410fcb257 = self::freaddword($v8fa14cdd754f91cc6554c9e71929cce7);$v32954654ac8fe66a1d09be19001de2d4 = self::freaddword($v8fa14cdd754f91cc6554c9e71929cce7);$veec6c4bdbd339edf8cbea68becb85244 = self::freaddword($v8fa14cdd754f91cc6554c9e71929cce7);$v28b87ac4afa53ae10c311ab1f61a1e9e = self::freadword($v8fa14cdd754f91cc6554c9e71929cce7);$v136df92ca0fb8b357d993db54745c0b8 = self::freadword($v8fa14cdd754f91cc6554c9e71929cce7);$vcc57d9dd82c4fd748040b0c307fd7549 = self::freaddword($v8fa14cdd754f91cc6554c9e71929cce7);$v29b01310a538d19ce6d5f31b5778a184 = self::freaddword($v8fa14cdd754f91cc6554c9e71929cce7);$vc1a9d41a7da069f13dceea59fe3ad5b2 = self::freaddword($v8fa14cdd754f91cc6554c9e71929cce7);$vf2abe942bf77f78c928161aaaaa16e64 = self::freaddword($v8fa14cdd754f91cc6554c9e71929cce7);$v5d79cce22329cceb25e3acdbf49968f2 = self::freaddword($v8fa14cdd754f91cc6554c9e71929cce7);$v50a66c470ac0166a9669fc3e03e3c6fb = self::freaddword($v8fa14cdd754f91cc6554c9e71929cce7);if ($v136df92ca0fb8b357d993db54745c0b8 < 24) {$vb798abe6e1b1318ee36b0dcb3fb9e4d3 = imagecreate($v32954654ac8fe66a1d09be19001de2d4, $veec6c4bdbd339edf8cbea68becb85244);$v5d50889672f6f860d14f502de3de1957 = pow(2, $v136df92ca0fb8b357d993db54745c0b8);for ($v83878c91171338902e0fe0fb97a8c47a = 0;$v83878c91171338902e0fe0fb97a8c47a < $v5d50889672f6f860d14f502de3de1957;$v83878c91171338902e0fe0fb97a8c47a++) {$v9d5ed678fe57bcca610140957afab571 = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$vdfcf28d0734569a6a693bc8194de62bf = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$ve1e1d3d40573127e9ee0480caf1283d6 = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$v942d4e37dd5607ab68e54755540d4a47 = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$v278f9a3d3077c522e71022e302b9e0e4[] = imagecolorallocate($vb798abe6e1b1318ee36b0dcb3fb9e4d3, $ve1e1d3d40573127e9ee0480caf1283d6, $vdfcf28d0734569a6a693bc8194de62bf, $v9d5ed678fe57bcca610140957afab571);}if ($vcc57d9dd82c4fd748040b0c307fd7549 == 0) {$vf9071030634dc9ba61220c00f43154ec = (4 - ceil($v32954654ac8fe66a1d09be19001de2d4 / (8 / $v136df92ca0fb8b357d993db54745c0b8)) % 4) % 4;for ($v415290769594460e2e485922904f345d = $veec6c4bdbd339edf8cbea68becb85244 - 1;$v415290769594460e2e485922904f345d >= 0;$v415290769594460e2e485922904f345d--) {$v66d797234bd5226a7f693148bdba711d = 0;for ($v9dd4e461268c8034f5c8564e155c67a6 = 0;$v9dd4e461268c8034f5c8564e155c67a6 < $v32954654ac8fe66a1d09be19001de2d4;$v9dd4e461268c8034f5c8564e155c67a6++) {$v0d61f8370cad1d412f80b84d143e1257 = self::freadbits($v8fa14cdd754f91cc6554c9e71929cce7, $v136df92ca0fb8b357d993db54745c0b8);imagesetpixel($vb798abe6e1b1318ee36b0dcb3fb9e4d3, $v9dd4e461268c8034f5c8564e155c67a6, $v415290769594460e2e485922904f345d, $v278f9a3d3077c522e71022e302b9e0e4[$v0d61f8370cad1d412f80b84d143e1257]);}if ($v66d797234bd5226a7f693148bdba711d != 0) {self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);}for ($vb2f5ff47436671b6e533d8dc3614845d = 0;$vb2f5ff47436671b6e533d8dc3614845d < $vf9071030634dc9ba61220c00f43154ec;$vb2f5ff47436671b6e533d8dc3614845d++) {self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);}}}}if ($vcc57d9dd82c4fd748040b0c307fd7549 == 1) {$v415290769594460e2e485922904f345d = $veec6c4bdbd339edf8cbea68becb85244;$v274613660d6f553d0240876b0fbf6260 = 0;while (true) {$v415290769594460e2e485922904f345d--;$v851f5ac9941d720844d143ed9cfcf60a = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$v4ec1b477cd0232b832c1899905ec51a4 = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$v274613660d6f553d0240876b0fbf6260 += 2;$vedb344e177b15d313695ebb69ede7f74 = false;if ($vedb344e177b15d313695ebb69ede7f74) {if (($v851f5ac9941d720844d143ed9cfcf60a == 0) && ($v4ec1b477cd0232b832c1899905ec51a4 == 1)) {break;}if (feof($v8fa14cdd754f91cc6554c9e71929cce7)) {break;}while (!(($v851f5ac9941d720844d143ed9cfcf60a == 0) and ($v4ec1b477cd0232b832c1899905ec51a4 == 0))) {if ($v851f5ac9941d720844d143ed9cfcf60a == 0) {$va99ef566140785e27eaf2d9d3fc45718 = $v4ec1b477cd0232b832c1899905ec51a4;$vf6068daa29dbb05a7ead1e3b5a48bbee .= fread($v8fa14cdd754f91cc6554c9e71929cce7, $va99ef566140785e27eaf2d9d3fc45718);$v274613660d6f553d0240876b0fbf6260 += $va99ef566140785e27eaf2d9d3fc45718;if ($v274613660d6f553d0240876b0fbf6260 % 2 == 1) {self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$v274613660d6f553d0240876b0fbf6260++;}}if ($v851f5ac9941d720844d143ed9cfcf60a > 0) {$va99ef566140785e27eaf2d9d3fc45718 = $v851f5ac9941d720844d143ed9cfcf60a;for ($v4b43b0aee35624cd95b910189b3dc231 = 0;$v4b43b0aee35624cd95b910189b3dc231 < $va99ef566140785e27eaf2d9d3fc45718;$v4b43b0aee35624cd95b910189b3dc231++) {$vf6068daa29dbb05a7ead1e3b5a48bbee .= chr($v4ec1b477cd0232b832c1899905ec51a4);}}}$v851f5ac9941d720844d143ed9cfcf60a = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$v4ec1b477cd0232b832c1899905ec51a4 = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$v274613660d6f553d0240876b0fbf6260 += 2;}for ($v9dd4e461268c8034f5c8564e155c67a6 = 0;$v9dd4e461268c8034f5c8564e155c67a6 < mb_strlen($vf6068daa29dbb05a7ead1e3b5a48bbee);$v9dd4e461268c8034f5c8564e155c67a6++) {imagesetpixel($vb798abe6e1b1318ee36b0dcb3fb9e4d3, $v9dd4e461268c8034f5c8564e155c67a6, $v415290769594460e2e485922904f345d, $v278f9a3d3077c522e71022e302b9e0e4[ord($vf6068daa29dbb05a7ead1e3b5a48bbee[$v9dd4e461268c8034f5c8564e155c67a6])]);}$vf6068daa29dbb05a7ead1e3b5a48bbee = '';}}if ($vcc57d9dd82c4fd748040b0c307fd7549 == 2) {$v415290769594460e2e485922904f345d = $veec6c4bdbd339edf8cbea68becb85244;$v274613660d6f553d0240876b0fbf6260 = 0;while (true) {$v415290769594460e2e485922904f345d--;$v851f5ac9941d720844d143ed9cfcf60a = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$v4ec1b477cd0232b832c1899905ec51a4 = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$v274613660d6f553d0240876b0fbf6260 += 2;$vedb344e177b15d313695ebb69ede7f74 = false;if (($v851f5ac9941d720844d143ed9cfcf60a == 0) and ($v4ec1b477cd0232b832c1899905ec51a4 == 1)) {break;}if (feof($v8fa14cdd754f91cc6554c9e71929cce7)) {break;}while (!(($v851f5ac9941d720844d143ed9cfcf60a == 0) and ($v4ec1b477cd0232b832c1899905ec51a4 == 0))) {if ($v851f5ac9941d720844d143ed9cfcf60a == 0) {$va99ef566140785e27eaf2d9d3fc45718 = $v4ec1b477cd0232b832c1899905ec51a4;$v66d797234bd5226a7f693148bdba711d = 0;for ($v2510c39011c5be704182423e3a695e91 = 0;$v2510c39011c5be704182423e3a695e91 < $va99ef566140785e27eaf2d9d3fc45718;$v2510c39011c5be704182423e3a695e91++) {$vf6068daa29dbb05a7ead1e3b5a48bbee .= chr(self::freadbits($v8fa14cdd754f91cc6554c9e71929cce7, 4));}if ($v66d797234bd5226a7f693148bdba711d != 0) {self::freadbits($v8fa14cdd754f91cc6554c9e71929cce7, 4);}$v274613660d6f553d0240876b0fbf6260 += ceil($va99ef566140785e27eaf2d9d3fc45718 / 2);if ($v274613660d6f553d0240876b0fbf6260 % 2 == 1) {self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$v274613660d6f553d0240876b0fbf6260++;}}if ($v851f5ac9941d720844d143ed9cfcf60a > 0) {$va99ef566140785e27eaf2d9d3fc45718 = $v851f5ac9941d720844d143ed9cfcf60a;$v865c0c0b4ab0e063e5caa3387c1a8741 = 0;for ($v4b43b0aee35624cd95b910189b3dc231 = 0;$v4b43b0aee35624cd95b910189b3dc231 < $va99ef566140785e27eaf2d9d3fc45718;$v4b43b0aee35624cd95b910189b3dc231++) {if ($v865c0c0b4ab0e063e5caa3387c1a8741 % 2 == 0) {$vf6068daa29dbb05a7ead1e3b5a48bbee .= chr($v4ec1b477cd0232b832c1899905ec51a4 % 16);}else {$vf6068daa29dbb05a7ead1e3b5a48bbee .= chr(floor($v4ec1b477cd0232b832c1899905ec51a4 / 16));}$v865c0c0b4ab0e063e5caa3387c1a8741++;}}$v851f5ac9941d720844d143ed9cfcf60a = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$v4ec1b477cd0232b832c1899905ec51a4 = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$v274613660d6f553d0240876b0fbf6260 += 2;}for ($v9dd4e461268c8034f5c8564e155c67a6 = 0;$v9dd4e461268c8034f5c8564e155c67a6 < mb_strlen($vf6068daa29dbb05a7ead1e3b5a48bbee);$v9dd4e461268c8034f5c8564e155c67a6++) {imagesetpixel($vb798abe6e1b1318ee36b0dcb3fb9e4d3, $v9dd4e461268c8034f5c8564e155c67a6, $v415290769594460e2e485922904f345d, $v278f9a3d3077c522e71022e302b9e0e4[ord($vf6068daa29dbb05a7ead1e3b5a48bbee[$v9dd4e461268c8034f5c8564e155c67a6])]);}$vf6068daa29dbb05a7ead1e3b5a48bbee = '';}}if ($v136df92ca0fb8b357d993db54745c0b8 == 24) {$vb798abe6e1b1318ee36b0dcb3fb9e4d3 = imagecreatetruecolor($v32954654ac8fe66a1d09be19001de2d4, $veec6c4bdbd339edf8cbea68becb85244);$vf9071030634dc9ba61220c00f43154ec = $v32954654ac8fe66a1d09be19001de2d4 % 4;for ($v415290769594460e2e485922904f345d = $veec6c4bdbd339edf8cbea68becb85244 - 1;$v415290769594460e2e485922904f345d >= 0;$v415290769594460e2e485922904f345d--) {for ($v9dd4e461268c8034f5c8564e155c67a6 = 0;$v9dd4e461268c8034f5c8564e155c67a6 < $v32954654ac8fe66a1d09be19001de2d4;$v9dd4e461268c8034f5c8564e155c67a6++) {$v9d5ed678fe57bcca610140957afab571 = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$vdfcf28d0734569a6a693bc8194de62bf = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$ve1e1d3d40573127e9ee0480caf1283d6 = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$v70dda5dfb8053dc6d1c492574bce9bfd = imagecolorexact($vb798abe6e1b1318ee36b0dcb3fb9e4d3, $ve1e1d3d40573127e9ee0480caf1283d6, $vdfcf28d0734569a6a693bc8194de62bf, $v9d5ed678fe57bcca610140957afab571);if ($v70dda5dfb8053dc6d1c492574bce9bfd == -1) {$v70dda5dfb8053dc6d1c492574bce9bfd = imagecolorallocate($vb798abe6e1b1318ee36b0dcb3fb9e4d3, $ve1e1d3d40573127e9ee0480caf1283d6, $vdfcf28d0734569a6a693bc8194de62bf, $v9d5ed678fe57bcca610140957afab571);}imagesetpixel($vb798abe6e1b1318ee36b0dcb3fb9e4d3, $v9dd4e461268c8034f5c8564e155c67a6, $v415290769594460e2e485922904f345d, $v70dda5dfb8053dc6d1c492574bce9bfd);}for ($vfbade9e36a3f36d3d676c1b808451dd7 = 0;$vfbade9e36a3f36d3d676c1b808451dd7 < $vf9071030634dc9ba61220c00f43154ec;$vfbade9e36a3f36d3d676c1b808451dd7++) {self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);}}}fclose($v8fa14cdd754f91cc6554c9e71929cce7);return $vb798abe6e1b1318ee36b0dcb3fb9e4d3;}fclose($v8fa14cdd754f91cc6554c9e71929cce7);}private static function freaddword($v8fa14cdd754f91cc6554c9e71929cce7) {$vedbab45572c72a5d9440b40bcc0500c0 = self::freadword($v8fa14cdd754f91cc6554c9e71929cce7);$vfbfba2e45c2045dc5cab22a5afe83d9d = self::freadword($v8fa14cdd754f91cc6554c9e71929cce7);return $vfbfba2e45c2045dc5cab22a5afe83d9d * 65536 + $vedbab45572c72a5d9440b40bcc0500c0;}private static function freadword($v8fa14cdd754f91cc6554c9e71929cce7) {$vedbab45572c72a5d9440b40bcc0500c0 = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$vfbfba2e45c2045dc5cab22a5afe83d9d = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);return $vfbfba2e45c2045dc5cab22a5afe83d9d * 256 + $vedbab45572c72a5d9440b40bcc0500c0;}private static function freadbyte($v8fa14cdd754f91cc6554c9e71929cce7) {return ord(fread($v8fa14cdd754f91cc6554c9e71929cce7, 1));}private static function freadbits($v8fa14cdd754f91cc6554c9e71929cce7, $ve2942a04780e223b215eb8b663cf5353) {$va245c3230debe5c956484ecc6fa93877 = self::freadbyte($v8fa14cdd754f91cc6554c9e71929cce7);$ve30207aeed603884c54f309c609d6c06 = self::$CurrentBit;self::$CurrentBit += $ve2942a04780e223b215eb8b663cf5353;if (self::$CurrentBit == 8) {self::$CurrentBit = 0;}else {fseek($v8fa14cdd754f91cc6554c9e71929cce7, ftell($v8fa14cdd754f91cc6554c9e71929cce7) - 1);}return self::RetBits($va245c3230debe5c956484ecc6fa93877, $ve30207aeed603884c54f309c609d6c06, $ve2942a04780e223b215eb8b663cf5353);}private static function RetBits($v40ea57d3ee3c07bf1c102b466e1c3091, $vea2b2676c28c0db26d39331a336c6b92, $vf5a8e923f8cd24b56b3bab32358cc58a) {$vc1111bd512b29e821b120b86446026b8 = self::decbin8($v40ea57d3ee3c07bf1c102b466e1c3091);return bindec(mb_substr($vc1111bd512b29e821b120b86446026b8, $vea2b2676c28c0db26d39331a336c6b92, $vf5a8e923f8cd24b56b3bab32358cc58a));}private static function decbin8($v8277e0910d750195b448797616e091ad) {return self::decbinx($v8277e0910d750195b448797616e091ad, 8);}private static function decbinx($v8277e0910d750195b448797616e091ad, $v7b8b965ad4bca0e41ab51de7b31363a1) {$vc1111bd512b29e821b120b86446026b8 = decbin($v8277e0910d750195b448797616e091ad);$ve61c5d46c0763cd7a52e7d474dadfc16 = mb_strlen($vc1111bd512b29e821b120b86446026b8);for ($v363b122c528f54df4a0446b6bab05515 = 0;$v363b122c528f54df4a0446b6bab05515 < $v7b8b965ad4bca0e41ab51de7b31363a1 - $ve61c5d46c0763cd7a52e7d474dadfc16;$v363b122c528f54df4a0446b6bab05515++) {$vc1111bd512b29e821b120b86446026b8 = "0$vc1111bd512b29e821b120b86446026b8";}return $vc1111bd512b29e821b120b86446026b8;}private function saveFile($v57f1fe0c87b65e614245626aeea2a04e) {switch ($this->getType()) {case self::IMAGE_TYPE_GIF:     imagegif($v57f1fe0c87b65e614245626aeea2a04e, $this->getFilePath());break;case self::IMAGE_TYPE_JPEG:    case self::IMAGE_TYPE_JPG:     imagejpeg($v57f1fe0c87b65e614245626aeea2a04e, $this->getFilePath());break;case self::IMAGE_TYPE_PNG:     imagepng($v57f1fe0c87b65e614245626aeea2a04e, $this->getFilePath());break;case self::IMAGE_TYPE_WBMP:    case self::IMAGE_TYPE_BMP:     imagewbmp($v57f1fe0c87b65e614245626aeea2a04e, $this->getFilePath());break;case self::IMAGE_TYPE_XBM:     imagexbm($v57f1fe0c87b65e614245626aeea2a04e, $this->getFilePath());break;}$this->__construct($this->getFilePath());}private function getImageResource() {$v5c15edb4e54ca0933b526461d17393f3 = $this->createImage($this->getFilePath());if (!$v5c15edb4e54ca0933b526461d17393f3) {throw new coreException('Failed to load image');}return $v5c15edb4e54ca0933b526461d17393f3['im'];}public function rotate() {if ($this->isSvg()) {return false;}$va9ee1bf95fc30b0119d41ece16a4ef8a = $this->getImageResource();$v7a6a4e6acf4be0deee4d2ca3d5270443 = $this->rotate_cw_90deg($va9ee1bf95fc30b0119d41ece16a4ef8a);$this->saveFile($v7a6a4e6acf4be0deee4d2ca3d5270443);imagedestroy($va9ee1bf95fc30b0119d41ece16a4ef8a);imagedestroy($v7a6a4e6acf4be0deee4d2ca3d5270443);return true;}private function rotate_cw_90deg($v78805a221a988e79ef3f42d7c5bfd418) {$v27db346633b0e2d767950d1bd094acb2 = imagesx($v78805a221a988e79ef3f42d7c5bfd418);$v221f8f22ae36e81b0032c9f0a263780f = imagesy($v78805a221a988e79ef3f42d7c5bfd418);$v57f1fe0c87b65e614245626aeea2a04e = @imagecreatetruecolor($v221f8f22ae36e81b0032c9f0a263780f, $v27db346633b0e2d767950d1bd094acb2);$ve46ce6be1dd9fd2559e9e6e2d3197388 = 0;if ($this->getType() === self::IMAGE_TYPE_PNG) {imagealphablending($v57f1fe0c87b65e614245626aeea2a04e, false);imagesavealpha($v57f1fe0c87b65e614245626aeea2a04e, true);$ve46ce6be1dd9fd2559e9e6e2d3197388 = imagecolorallocatealpha($v57f1fe0c87b65e614245626aeea2a04e, 255, 255, 255, 127);imagefilledrectangle($v57f1fe0c87b65e614245626aeea2a04e, 0, 0, $v221f8f22ae36e81b0032c9f0a263780f, $v27db346633b0e2d767950d1bd094acb2, $ve46ce6be1dd9fd2559e9e6e2d3197388);}$vfa0d373b0592ddd352652108de5c4a85 = imagerotate($v78805a221a988e79ef3f42d7c5bfd418, 270, $ve46ce6be1dd9fd2559e9e6e2d3197388, true);if ($v57f1fe0c87b65e614245626aeea2a04e) {imagecopyresized(     $v57f1fe0c87b65e614245626aeea2a04e,     $vfa0d373b0592ddd352652108de5c4a85,     0,     0,     0,     0,     imagesx($v57f1fe0c87b65e614245626aeea2a04e),     imagesy($v57f1fe0c87b65e614245626aeea2a04e),     imagesx($vfa0d373b0592ddd352652108de5c4a85),     imagesy($vfa0d373b0592ddd352652108de5c4a85)    );return $v57f1fe0c87b65e614245626aeea2a04e;}return false;}public function crop($v489a001de516fc9519ca1d9cbde938c1, $v1ab9e24365b22cfa518467c707a23c74, $v23b3a8ca2b02b4bd0a80827019c33864, $vdafa201743ff091488cceeb6ae5992a8) {if ($this->isSvg()) {return false;}$va9ee1bf95fc30b0119d41ece16a4ef8a = $this->getImageResource();$v087df9a6573cf747f418cf9957ad244a = imagecreatetruecolor($v1ab9e24365b22cfa518467c707a23c74, $vdafa201743ff091488cceeb6ae5992a8);if ($this->getType() === self::IMAGE_TYPE_PNG) {imagealphablending($v087df9a6573cf747f418cf9957ad244a, false);imagesavealpha($v087df9a6573cf747f418cf9957ad244a, true);$ve46ce6be1dd9fd2559e9e6e2d3197388 = imagecolorallocatealpha($v087df9a6573cf747f418cf9957ad244a, 255, 255, 255, 127);imagefilledrectangle($v087df9a6573cf747f418cf9957ad244a, 0, 0, $v1ab9e24365b22cfa518467c707a23c74, $vdafa201743ff091488cceeb6ae5992a8, $ve46ce6be1dd9fd2559e9e6e2d3197388);}imagecopyresampled(    $v087df9a6573cf747f418cf9957ad244a,    $va9ee1bf95fc30b0119d41ece16a4ef8a,    0,    0,    $v489a001de516fc9519ca1d9cbde938c1,    $v23b3a8ca2b02b4bd0a80827019c33864,    $v1ab9e24365b22cfa518467c707a23c74,    $vdafa201743ff091488cceeb6ae5992a8,    $v1ab9e24365b22cfa518467c707a23c74,    $vdafa201743ff091488cceeb6ae5992a8   );$this->saveFile($v087df9a6573cf747f418cf9957ad244a);return true;}public function resize($vb7a7dc15c3ff7a97b50f42c6ad9cf034, $vc89a98164477a92660a9d30b8a899f2a) {if ($this->isSvg()) {return false;}$va9ee1bf95fc30b0119d41ece16a4ef8a = $this->getImageResource();$va464d254c26af6536657e681a5ee4ea5 = imagecreatetruecolor($vb7a7dc15c3ff7a97b50f42c6ad9cf034, $vc89a98164477a92660a9d30b8a899f2a);if ($this->getType() === self::IMAGE_TYPE_PNG) {imagealphablending($va464d254c26af6536657e681a5ee4ea5, false);imagesavealpha($va464d254c26af6536657e681a5ee4ea5, true);$ve46ce6be1dd9fd2559e9e6e2d3197388 = imagecolorallocatealpha($va464d254c26af6536657e681a5ee4ea5, 255, 255, 255, 127);imagefilledrectangle($va464d254c26af6536657e681a5ee4ea5, 0, 0, $vb7a7dc15c3ff7a97b50f42c6ad9cf034, $vc89a98164477a92660a9d30b8a899f2a, $ve46ce6be1dd9fd2559e9e6e2d3197388);}imagecopyresampled($va464d254c26af6536657e681a5ee4ea5, $va9ee1bf95fc30b0119d41ece16a4ef8a, 0, 0, 0, 0, $vb7a7dc15c3ff7a97b50f42c6ad9cf034, $vc89a98164477a92660a9d30b8a899f2a, $this->getWidth(), $this->getHeight());$this->saveFile($va464d254c26af6536657e681a5ee4ea5);return true;}public static function imageOptim($v36cd38f49b9afa08222c0dc9ebfe35eb, $vd66636b253cb346dbb6240e30def3618 = 75) {$v41fce2005fa27bdf619a257961c4f9c4 = imageUtils::getImageProcessor();$v41fce2005fa27bdf619a257961c4f9c4->optimize('.' . $v36cd38f49b9afa08222c0dc9ebfe35eb, $vd66636b253cb346dbb6240e30def3618);}}