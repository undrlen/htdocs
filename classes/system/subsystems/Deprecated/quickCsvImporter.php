<?php
 use UmiCms\Service;interface iQuickCsvImporter {public function __construct(umiFile $vb1e3840c73bd1d04e68740c009214532);public function importAsElements($vacf567c9c3d6cf7c6e2cc0ce108e0631 = false, $v72352a4d26581ef082a6d2243c5a6b88 = false);public function importAsObjects($v6301cee35ea764a1e241978f93f01069 = false);public function setEncoding($v84bea1f0fd2ce16f7e562a9f06ef03d3);public static function autoImport(selector $v8be74552df93e31bbdd6b36ed74bdb6a, $vb8c8ec69026adfe891bf5e618eabb17b = false);};class quickCsvImporter implements iQuickCsvImporter {private $encoding = 'windows-1251';private $delimiter = ';';protected $csvFile;protected $fileHandler;protected $mode = 'object';protected $fields = false;protected $forceObjectCreation = false;protected static $supportedEncodings = ['utf-8', 'windows-1251', 'cp1251'];protected static $supportedFieldTypes = [   'relation',   'tags',   'int',   'float',   'price',   'date',   'file',   'img_file',   'swf_file',   'string',   'text',   'wysiwyg',   'password',   'counter',   'color',   'link_to_object_type',   'boolean',   'domain_id',   'domain_id_list'  ];public $allowNewItemsCreation = true;public $forceHierarchy = false;public $errors = [];const VALUE_LIMITER = '"';const TARGET_ENCODING = 'utf-8';public function __construct(umiFile $vb1e3840c73bd1d04e68740c009214532) {if ($vb1e3840c73bd1d04e68740c009214532->getIsBroken()) {throw new coreException('CSV file doesn\'t exists: "' . $vb1e3840c73bd1d04e68740c009214532->getFilePath() . '"');}$this->forceObjectCreation = umiObjectProperty::$USE_FORCE_OBJECTS_CREATION;if (getRequest('ignore-id')) {umiObjectProperty::$USE_FORCE_OBJECTS_CREATION = true;}ini_set('mbstring.substitute_character', "none");$this->csvFile = $vb1e3840c73bd1d04e68740c009214532;$this->openFile();}public function setEncoding($v84bea1f0fd2ce16f7e562a9f06ef03d3) {if (in_array(mb_strtolower($v84bea1f0fd2ce16f7e562a9f06ef03d3), self::$supportedEncodings)) {$this->encoding = $v84bea1f0fd2ce16f7e562a9f06ef03d3;}else {throw new InvalidArgumentException("Encoding '${v84bea1f0fd2ce16f7e562a9f06ef03d3}' is not supported");}}public function __destruct() {umiObjectProperty::$USE_FORCE_OBJECTS_CREATION = $this->forceObjectCreation;$this->closeFile();}public function importAsElements($vacf567c9c3d6cf7c6e2cc0ce108e0631 = false, $v72352a4d26581ef082a6d2243c5a6b88 = false) {$this->mode = 'element';$v6301cee35ea764a1e241978f93f01069 = false;$v0e8133eb006c0f85ed9444ae07a60842 = umiObjectTypesCollection::getInstance();if ($v72352a4d26581ef082a6d2243c5a6b88) {$v6301cee35ea764a1e241978f93f01069 = umiHierarchy::getInstance()->getDominantTypeId($v72352a4d26581ef082a6d2243c5a6b88);}if (!$v6301cee35ea764a1e241978f93f01069) {$v6301cee35ea764a1e241978f93f01069 = $v0e8133eb006c0f85ed9444ae07a60842->getTypeIdByHierarchyTypeId($vacf567c9c3d6cf7c6e2cc0ce108e0631);}$v726e8e4809d4c1b28a6549d86436a124 = $v0e8133eb006c0f85ed9444ae07a60842->getType($v6301cee35ea764a1e241978f93f01069);if (!$vacf567c9c3d6cf7c6e2cc0ce108e0631) {$vacf567c9c3d6cf7c6e2cc0ce108e0631 = $v726e8e4809d4c1b28a6549d86436a124->getHierarchyTypeId();}$this->importElements($v726e8e4809d4c1b28a6549d86436a124, $vacf567c9c3d6cf7c6e2cc0ce108e0631, $v72352a4d26581ef082a6d2243c5a6b88);}public function importAsObjects($v726e8e4809d4c1b28a6549d86436a124 = false) {if (!$v726e8e4809d4c1b28a6549d86436a124 instanceof iUmiObjectType) {return self::releaseBuffer("alert('Cant detect object type id');");}$this->importObjects($v726e8e4809d4c1b28a6549d86436a124);}public static function autoImport(selector $v8be74552df93e31bbdd6b36ed74bdb6a, $vb8c8ec69026adfe891bf5e618eabb17b = false, $v84bea1f0fd2ce16f7e562a9f06ef03d3 = 'windows-1251') {if (!isset($_FILES['csv-file'])) {self::releaseBuffer("alert('File is not posted');");return false;}$v1ded0622d3320f26b47f514fabab54f1 = getArrayKey($_FILES, 'csv-file');$vb068931cc450442b63f5b3d276ea4297 = getArrayKey($v1ded0622d3320f26b47f514fabab54f1, 'name');$v656840677a2dbd5ab56a2202e415b293 = getArrayKey($v1ded0622d3320f26b47f514fabab54f1, 'tmp_name');$vcb5e100e5a9a3e7f6d1fd97512215282 = getArrayKey($v1ded0622d3320f26b47f514fabab54f1, 'error');$vf7bd60b75b29d79b660a2859395c1a24 = getArrayKey($v1ded0622d3320f26b47f514fabab54f1, 'size');if ($vcb5e100e5a9a3e7f6d1fd97512215282) {self::releaseBuffer("alert('Failed to upload file');");return false;}$v2245023265ae4cf87d02c8b6ba991139 = mainConfiguration::getInstance();$v8c7dd922ad47494fc02c388e12c00eac = umiFile::manualUpload($vb068931cc450442b63f5b3d276ea4297, $v656840677a2dbd5ab56a2202e415b293, $vf7bd60b75b29d79b660a2859395c1a24, $v2245023265ae4cf87d02c8b6ba991139->includeParam('system.runtime-cache'));if (!($v8c7dd922ad47494fc02c388e12c00eac instanceof iUmiFile) || $v8c7dd922ad47494fc02c388e12c00eac->getIsBroken()) {self::releaseBuffer("alert('Upload file is broken');");return false;}$v93473a7344419b15c4219cc2b6c64c6f = new quickCsvImporter($v8c7dd922ad47494fc02c388e12c00eac);$v93473a7344419b15c4219cc2b6c64c6f->setEncoding($v84bea1f0fd2ce16f7e562a9f06ef03d3);$v93473a7344419b15c4219cc2b6c64c6f->forceHierarchy = $vb8c8ec69026adfe891bf5e618eabb17b;$vec888c0633c49af1915dfe52f756aae6 = [];$v128d64ce7ec30d407f060c51ec2a944a = [];foreach ($v8be74552df93e31bbdd6b36ed74bdb6a->types as $v599dcce2998a6b40b1e38e8c6006cb0a) {if (null !== $v599dcce2998a6b40b1e38e8c6006cb0a->objectTypeIds) {foreach ($v599dcce2998a6b40b1e38e8c6006cb0a->objectTypeIds as $vb80bb7740288fda1f201890375a60c8f) {$vec888c0633c49af1915dfe52f756aae6[] = $vb80bb7740288fda1f201890375a60c8f;}}if (null !== $v599dcce2998a6b40b1e38e8c6006cb0a->hierarchyTypeIds) {foreach ($v599dcce2998a6b40b1e38e8c6006cb0a->hierarchyTypeIds as $vb80bb7740288fda1f201890375a60c8f) {$v128d64ce7ec30d407f060c51ec2a944a[] = $vb80bb7740288fda1f201890375a60c8f;}}}$vec888c0633c49af1915dfe52f756aae6 = array_unique($vec888c0633c49af1915dfe52f756aae6);$v128d64ce7ec30d407f060c51ec2a944a = array_unique($v128d64ce7ec30d407f060c51ec2a944a);$v862d60ca12675dcaaa09474ae371fba0 = true;if (!$vb8c8ec69026adfe891bf5e618eabb17b && umiCount($v8be74552df93e31bbdd6b36ed74bdb6a->hierarchy) == 0) {$v862d60ca12675dcaaa09474ae371fba0 = false;}$v726e8e4809d4c1b28a6549d86436a124 = null;$vacf567c9c3d6cf7c6e2cc0ce108e0631 = null;$v72352a4d26581ef082a6d2243c5a6b88 = null;try {if (!$v862d60ca12675dcaaa09474ae371fba0) {$v726e8e4809d4c1b28a6549d86436a124 = self::getObjectType($vec888c0633c49af1915dfe52f756aae6, $v128d64ce7ec30d407f060c51ec2a944a);if (!$v726e8e4809d4c1b28a6549d86436a124 instanceof umiObjectType) {throw new publicAdminException("alert('Cant detect object type id');");}}else {if (is_array($v8be74552df93e31bbdd6b36ed74bdb6a->hierarchy) && umiCount($v8be74552df93e31bbdd6b36ed74bdb6a->hierarchy) > 0) {$v72352a4d26581ef082a6d2243c5a6b88 = $v8be74552df93e31bbdd6b36ed74bdb6a->hierarchy[0]->elementId;}$vacf567c9c3d6cf7c6e2cc0ce108e0631 = self::getHierarchyTypeId($v128d64ce7ec30d407f060c51ec2a944a, $v72352a4d26581ef082a6d2243c5a6b88, $vec888c0633c49af1915dfe52f756aae6);if (!is_numeric($vacf567c9c3d6cf7c6e2cc0ce108e0631)) {throw new publicAdminException("alert('Cant detect hierarchy type id');");}}}catch (publicAdminException $ve1671797c52e15f763380b45e841ec32) {$v8c7dd922ad47494fc02c388e12c00eac->delete();self::releaseBuffer($ve1671797c52e15f763380b45e841ec32->getMessage());return false;}$v7f2db423a49b305459147332fb01cf87 = Service::Response()    ->getCurrentBuffer();$v7f2db423a49b305459147332fb01cf87->contentType('text/html');$v7f2db423a49b305459147332fb01cf87->push("<script type='text/javascript'>\n");if (!$v862d60ca12675dcaaa09474ae371fba0) {$v93473a7344419b15c4219cc2b6c64c6f->importAsObjects($v726e8e4809d4c1b28a6549d86436a124);}else {$v93473a7344419b15c4219cc2b6c64c6f->importAsElements($vacf567c9c3d6cf7c6e2cc0ce108e0631, $v72352a4d26581ef082a6d2243c5a6b88);}$v7f2db423a49b305459147332fb01cf87->push("//Upload completed\n");$v8c7dd922ad47494fc02c388e12c00eac->delete();$v7f2db423a49b305459147332fb01cf87->push("window.parent.csvQuickImportCallback();\n</script>\n");$v7f2db423a49b305459147332fb01cf87->end();return true;}private static function getHierarchyTypeId(array $v128d64ce7ec30d407f060c51ec2a944a, $v72352a4d26581ef082a6d2243c5a6b88, $vec888c0633c49af1915dfe52f756aae6) {$v8988aed53b6f4f4932b092de09f31980 = umiObjectTypesCollection::getInstance();$v3b456fa454c7082ea105317817db60eb = umiHierarchyTypesCollection::getInstance();$v4ed1934b53e02cba7b361c00bf660ba7 = $v3b456fa454c7082ea105317817db60eb->getTypeByName('comments', 'comment');$v0e9292c29834c503f695817879e138be = $v4ed1934b53e02cba7b361c00bf660ba7->getId();if (is_numeric($v72352a4d26581ef082a6d2243c5a6b88)) {$vfabf67ff39a368b3c0eae3c66d81cc5e = umiHierarchy::getInstance()->getDominantTypeId($v72352a4d26581ef082a6d2243c5a6b88);if ($vfabf67ff39a368b3c0eae3c66d81cc5e) {$v726e8e4809d4c1b28a6549d86436a124 = $v8988aed53b6f4f4932b092de09f31980->getType($vfabf67ff39a368b3c0eae3c66d81cc5e);if ($ve6d258c789c675bb2d39aa58e3bc6fb0 = $v726e8e4809d4c1b28a6549d86436a124->getHierarchyTypeId()) {return $ve6d258c789c675bb2d39aa58e3bc6fb0;}}}$v1d52febe7344943bb6e7992791c4ad69 = umiCount($v128d64ce7ec30d407f060c51ec2a944a);$vab44216dd731d0ffd79b7ecd168ebca1 = umiCount($vec888c0633c49af1915dfe52f756aae6);switch (true) {case $v1d52febe7344943bb6e7992791c4ad69 == 0 && $vab44216dd731d0ffd79b7ecd168ebca1 == 0: {return false;}case $v1d52febe7344943bb6e7992791c4ad69 == 0 && $vab44216dd731d0ffd79b7ecd168ebca1 > 0: {$v487d2d85d350c75d7231c0f8a3241dbc = (cmsController::getInstance()->getCurrentModule() == 'comments') ? false : true;foreach ($vec888c0633c49af1915dfe52f756aae6 as $v6301cee35ea764a1e241978f93f01069) {$v726e8e4809d4c1b28a6549d86436a124 = $v8988aed53b6f4f4932b092de09f31980->getType($v6301cee35ea764a1e241978f93f01069);if ($v487d2d85d350c75d7231c0f8a3241dbc) {if ($v726e8e4809d4c1b28a6549d86436a124->getHierarchyTypeId() !== $v0e9292c29834c503f695817879e138be) {$v128d64ce7ec30d407f060c51ec2a944a[] = $v726e8e4809d4c1b28a6549d86436a124->getHierarchyTypeId();}}else {$v128d64ce7ec30d407f060c51ec2a944a[] = $v726e8e4809d4c1b28a6549d86436a124->getHierarchyTypeId();}}return array_pop($v128d64ce7ec30d407f060c51ec2a944a);}case $v1d52febe7344943bb6e7992791c4ad69 > 1: {foreach ($v128d64ce7ec30d407f060c51ec2a944a as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {if ($v2063c1608d6e0baf80249c42e2be5804 == $v0e9292c29834c503f695817879e138be) {unset($v128d64ce7ec30d407f060c51ec2a944a[$v3c6e0b8a9c15224a8228b9a98ca1531d]);}}}}return array_shift($v128d64ce7ec30d407f060c51ec2a944a);}private static function getObjectType(array $vec888c0633c49af1915dfe52f756aae6, array $v128d64ce7ec30d407f060c51ec2a944a) {$v6301cee35ea764a1e241978f93f01069 = null;$v8988aed53b6f4f4932b092de09f31980 = umiObjectTypesCollection::getInstance();switch (true) {case umiCount($vec888c0633c49af1915dfe52f756aae6) > 0: {$v6301cee35ea764a1e241978f93f01069 = array_shift($vec888c0633c49af1915dfe52f756aae6);break;}case umiCount($v128d64ce7ec30d407f060c51ec2a944a) > 0: {$vacf567c9c3d6cf7c6e2cc0ce108e0631 = array_shift($v128d64ce7ec30d407f060c51ec2a944a);$v6301cee35ea764a1e241978f93f01069 = $v8988aed53b6f4f4932b092de09f31980->getTypeIdByHierarchyTypeId($vacf567c9c3d6cf7c6e2cc0ce108e0631);break;}}return $v8988aed53b6f4f4932b092de09f31980->getType($v6301cee35ea764a1e241978f93f01069);}private static function releaseBuffer($v78e731027d8fd50ed642340b7c9a63b3) {$v7f2db423a49b305459147332fb01cf87 = Service::Response()    ->getCurrentBuffer();$v7f2db423a49b305459147332fb01cf87->contentType('text/html');$v7f2db423a49b305459147332fb01cf87->push("<script type='text/javascript'>\n");$v7f2db423a49b305459147332fb01cf87->push("$v78e731027d8fd50ed642340b7c9a63b3\n");$v7f2db423a49b305459147332fb01cf87->push("window.parent.csvQuickImportCallback();\n</script>\n");$v7f2db423a49b305459147332fb01cf87->end();}protected function importElements(umiObjectType $v726e8e4809d4c1b28a6549d86436a124, $vacf567c9c3d6cf7c6e2cc0ce108e0631, $v72352a4d26581ef082a6d2243c5a6b88) {$v7f2db423a49b305459147332fb01cf87 = Service::Response()    ->getCurrentBuffer();$v4340fd73e75df7a9d9e45902a59ba3a4 = $this->readNextRow();$this->fields = umiCount($v4340fd73e75df7a9d9e45902a59ba3a4);$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$permissions = permissionsCollection::getInstance();def_module::$noRedirectOnPanic = true;$v76cf1d4ff412fd3cb644aa58a53c78dc = [];$v4340fd73e75df7a9d9e45902a59ba3a4 = $this->analyzeHeaders($v726e8e4809d4c1b28a6549d86436a124, $v4340fd73e75df7a9d9e45902a59ba3a4);$v7f2db423a49b305459147332fb01cf87->push(str_repeat(" ", 1024));$v7f2db423a49b305459147332fb01cf87->send();while ($v07d43db2a74336dcfbdaeeeffe6f7a19 = $this->readNextRow()) {$v07d43db2a74336dcfbdaeeeffe6f7a19 = $this->analyzeColumns($v4340fd73e75df7a9d9e45902a59ba3a4, $v07d43db2a74336dcfbdaeeeffe6f7a19);if (!isset($v07d43db2a74336dcfbdaeeeffe6f7a19['id'])) {continue;}$v7552cd149af7495ee7d8225974e50f80 = $v07d43db2a74336dcfbdaeeeffe6f7a19['id'];$vb068931cc450442b63f5b3d276ea4297 = (isset($v07d43db2a74336dcfbdaeeeffe6f7a19['name'])) ? $v07d43db2a74336dcfbdaeeeffe6f7a19['name'] : '';if ($v7552cd149af7495ee7d8225974e50f80) {$v53cc4db543d7a569e51c1d76ac6f278e = 'systemModifyElement';$v1c0600fd6342c3a498944309318b7689 = $v7552cd149af7495ee7d8225974e50f80;}else {if ($v72352a4d26581ef082a6d2243c5a6b88 && !$this->forceHierarchy) {$v53cc4db543d7a569e51c1d76ac6f278e = 'systemCreateElement';$v1c0600fd6342c3a498944309318b7689 = 'new';if (!$v07d43db2a74336dcfbdaeeeffe6f7a19['alt-name']) {$v07d43db2a74336dcfbdaeeeffe6f7a19['alt-name'] = $vb068931cc450442b63f5b3d276ea4297;}$v7552cd149af7495ee7d8225974e50f80 = $vb81ca7c0ccaa77e7aa91936ab0070695->addElement(       $v72352a4d26581ef082a6d2243c5a6b88,       $vacf567c9c3d6cf7c6e2cc0ce108e0631,       $vb068931cc450442b63f5b3d276ea4297,       $v07d43db2a74336dcfbdaeeeffe6f7a19['alt-name'],       $v726e8e4809d4c1b28a6549d86436a124->getId()      );$v7f2db423a49b305459147332fb01cf87->push('//Create new page "' . $vb068931cc450442b63f5b3d276ea4297 . '" of type ' . $vacf567c9c3d6cf7c6e2cc0ce108e0631 . ', id #' .       $v7552cd149af7495ee7d8225974e50f80 . "\n");$v07d43db2a74336dcfbdaeeeffe6f7a19['id'] = $v7552cd149af7495ee7d8225974e50f80;$permissions->setDefaultPermissions($v7552cd149af7495ee7d8225974e50f80);}else {continue;}}$v8e2dcfd7e7e24b1ca76c1193f645902b = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($v7552cd149af7495ee7d8225974e50f80, ($v7552cd149af7495ee7d8225974e50f80 == 'new'));if ($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof umiHierarchyElement == false) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = [      'id' => $v7552cd149af7495ee7d8225974e50f80,      'name' => $vb068931cc450442b63f5b3d276ea4297,      'error' => getLabel('csv-error-not-found')     ];continue;}if ($v1c0600fd6342c3a498944309318b7689 != 'new') {if ($v8e2dcfd7e7e24b1ca76c1193f645902b->getTypeId() != $vacf567c9c3d6cf7c6e2cc0ce108e0631) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = [       'id' => $v7552cd149af7495ee7d8225974e50f80,       'name' => $vb068931cc450442b63f5b3d276ea4297,       'error' => getLabel('csv-error-wrong-type')      ];continue;}}if ($vb068931cc450442b63f5b3d276ea4297 !== '') {$_REQUEST['name'] = $vb068931cc450442b63f5b3d276ea4297;}if (isset($v07d43db2a74336dcfbdaeeeffe6f7a19['alt-name'])) {$_REQUEST['alt_name'] = $v07d43db2a74336dcfbdaeeeffe6f7a19['alt-name'];}if (isset($v07d43db2a74336dcfbdaeeeffe6f7a19['is-active'])) {$_REQUEST['is_active'] = $v07d43db2a74336dcfbdaeeeffe6f7a19['is-active'];}foreach ($v07d43db2a74336dcfbdaeeeffe6f7a19 as $v972bf3f05d14ffbdb817bef60638ff00 => $v2063c1608d6e0baf80249c42e2be5804) {$_REQUEST['data'][$v1c0600fd6342c3a498944309318b7689][$v972bf3f05d14ffbdb817bef60638ff00] = $v2063c1608d6e0baf80249c42e2be5804;}try {$v4119639092e62c55ea8be348e4d9260d = new umiEventPoint($v53cc4db543d7a569e51c1d76ac6f278e);$v4119639092e62c55ea8be348e4d9260d->addRef('element', $v8e2dcfd7e7e24b1ca76c1193f645902b);$v4119639092e62c55ea8be348e4d9260d->setMode('before');$v4119639092e62c55ea8be348e4d9260d->call();}catch (errorPanicException $ve1671797c52e15f763380b45e841ec32) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = [      'id' => $v1c0600fd6342c3a498944309318b7689,      'error' => $ve1671797c52e15f763380b45e841ec32->getMessage(),      'name' => $vb068931cc450442b63f5b3d276ea4297     ];if ($v1c0600fd6342c3a498944309318b7689 == 'new') {$vb81ca7c0ccaa77e7aa91936ab0070695->delElement($v8e2dcfd7e7e24b1ca76c1193f645902b->getId());}continue;}if ($v1c0600fd6342c3a498944309318b7689 == 'new') {$v19fad0416b4b101ab72faccf4c323024 = ($v8e2dcfd7e7e24b1ca76c1193f645902b->getModule() == 'content');$v8e2dcfd7e7e24b1ca76c1193f645902b->setIsVisible($v19fad0416b4b101ab72faccf4c323024);}foreach ($v07d43db2a74336dcfbdaeeeffe6f7a19 as $v972bf3f05d14ffbdb817bef60638ff00 => $v2063c1608d6e0baf80249c42e2be5804) {switch ($v972bf3f05d14ffbdb817bef60638ff00) {case 'id': {continue;}case 'name': {$v8e2dcfd7e7e24b1ca76c1193f645902b->setName($v2063c1608d6e0baf80249c42e2be5804);break;}case 'alt-name': {$v8e2dcfd7e7e24b1ca76c1193f645902b->setAltName($v07d43db2a74336dcfbdaeeeffe6f7a19['alt-name']);break;}case 'is-active': {$v8e2dcfd7e7e24b1ca76c1193f645902b->setIsActive($v07d43db2a74336dcfbdaeeeffe6f7a19['is-active']);break;}default: {try {$this->modifyProperty($v8e2dcfd7e7e24b1ca76c1193f645902b, $v972bf3f05d14ffbdb817bef60638ff00, $v2063c1608d6e0baf80249c42e2be5804);}catch (fieldRestrictionException $ve1671797c52e15f763380b45e841ec32) {$ve1671797c52e15f763380b45e841ec32->unregister();$v76cf1d4ff412fd3cb644aa58a53c78dc[] = [         'id' => $v1c0600fd6342c3a498944309318b7689,         'error' => $ve1671797c52e15f763380b45e841ec32->getMessage(),         'name' => $v07d43db2a74336dcfbdaeeeffe6f7a19[$v972bf3f05d14ffbdb817bef60638ff00]        ];}break;}}}try {$v4119639092e62c55ea8be348e4d9260d->setMode('after');$v4119639092e62c55ea8be348e4d9260d->call();}catch (errorPanicException $ve1671797c52e15f763380b45e841ec32) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = [      'id' => $v1c0600fd6342c3a498944309318b7689,      'error' => $ve1671797c52e15f763380b45e841ec32->getMessage(),      'name' => $vb068931cc450442b63f5b3d276ea4297     ];if ($v1c0600fd6342c3a498944309318b7689 == 'new') {$vb81ca7c0ccaa77e7aa91936ab0070695->delElement($v7552cd149af7495ee7d8225974e50f80);}continue;}unset($_REQUEST['name']);unset($_REQUEST['alt_name']);unset($_REQUEST['is_active']);$_REQUEST['data'][$v1c0600fd6342c3a498944309318b7689];$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();unset($v8e2dcfd7e7e24b1ca76c1193f645902b);$this->clearMemoryCache();}def_module::$noRedirectOnPanic = true;if (umiCount($v76cf1d4ff412fd3cb644aa58a53c78dc)) {$v7f2db423a49b305459147332fb01cf87->push('var err = \'' . addslashes(getLabel('csv-error-import-list')) . "\\n';\n");foreach ($v76cf1d4ff412fd3cb644aa58a53c78dc as $v6b3e9cdfd9fd6b6f313d7dd4526c9ceb) {if ($v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['id'] == 'new') {$v7f2db423a49b305459147332fb01cf87->push(       'err += \'' .       addslashes($v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['name'] . ' (' . getLabel('csv-new-item') . ') - ' .        $v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['error']) .       "\\n';\n"      );}else {$v7f2db423a49b305459147332fb01cf87->push(       'err += \'' .       addslashes($v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['name'] . ' (#' . $v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['id'] . ') - ' . $v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['error']) .       "\\n';\n"      );}}$v7f2db423a49b305459147332fb01cf87->push("alert(err);\n\n");}}protected function importObjects(umiObjectType $v726e8e4809d4c1b28a6549d86436a124) {$v4340fd73e75df7a9d9e45902a59ba3a4 = $this->readNextRow();$this->fields = umiCount($v4340fd73e75df7a9d9e45902a59ba3a4);$v5891da2d64975cae48d175d1e001f5da = umiObjectsCollection::getInstance();$vd14a8022b085f9ef19d479cbdd581127 = umiObjectTypesCollection::getInstance();$v9367a975f19a06750b67f719f4f08ceb = false;if ($v726e8e4809d4c1b28a6549d86436a124->getId() == $vd14a8022b085f9ef19d479cbdd581127->getTypeIdByGUID('dispatches-subscriber')) {$v9367a975f19a06750b67f719f4f08ceb = true;}$v7f2db423a49b305459147332fb01cf87 = Service::Response()    ->getCurrentBuffer();def_module::$noRedirectOnPanic = true;$v4340fd73e75df7a9d9e45902a59ba3a4 = $this->analyzeHeaders($v726e8e4809d4c1b28a6549d86436a124, $v4340fd73e75df7a9d9e45902a59ba3a4);$v76cf1d4ff412fd3cb644aa58a53c78dc = [];$v7f2db423a49b305459147332fb01cf87->push(str_repeat(" ", 1024));$v7f2db423a49b305459147332fb01cf87->send();while ($v07d43db2a74336dcfbdaeeeffe6f7a19 = $this->readNextRow()) {$v07d43db2a74336dcfbdaeeeffe6f7a19 = $this->analyzeColumns($v4340fd73e75df7a9d9e45902a59ba3a4, $v07d43db2a74336dcfbdaeeeffe6f7a19);if (!isset($v07d43db2a74336dcfbdaeeeffe6f7a19['id'])) {continue;}$v16b2b26000987faccb260b9d39df1269 = $v07d43db2a74336dcfbdaeeeffe6f7a19['id'];$vb068931cc450442b63f5b3d276ea4297 = (isset($v07d43db2a74336dcfbdaeeeffe6f7a19['name'])) ? $v07d43db2a74336dcfbdaeeeffe6f7a19['name'] : '';if ($v9367a975f19a06750b67f719f4f08ceb && !$v16b2b26000987faccb260b9d39df1269) {$v8be74552df93e31bbdd6b36ed74bdb6a = new selector('objects');$v8be74552df93e31bbdd6b36ed74bdb6a->types('object-type')->name('dispatches', 'subscriber');$v8be74552df93e31bbdd6b36ed74bdb6a->where('name')->equals($vb068931cc450442b63f5b3d276ea4297);$v8be74552df93e31bbdd6b36ed74bdb6a->option('return')->value('id');$result = $v8be74552df93e31bbdd6b36ed74bdb6a->first;if (is_array($result) && umiCount($result)) {$v16b2b26000987faccb260b9d39df1269 = $result['id'];}}if ($v16b2b26000987faccb260b9d39df1269) {$vccae550f37edb4e56f3bf01df9953a6f = $v16b2b26000987faccb260b9d39df1269;$v53cc4db543d7a569e51c1d76ac6f278e = 'systemModifyObject';}else {$v53cc4db543d7a569e51c1d76ac6f278e = 'systemCreateObject';$v16b2b26000987faccb260b9d39df1269 = $v5891da2d64975cae48d175d1e001f5da->addObject('Temporary object name', $v726e8e4809d4c1b28a6549d86436a124->getId());$v7f2db423a49b305459147332fb01cf87->push(      '//Create new object "' . $vb068931cc450442b63f5b3d276ea4297 . '" of type ' . $v726e8e4809d4c1b28a6549d86436a124->getId() . ', id #' . $v16b2b26000987faccb260b9d39df1269 . "\n"     );$vccae550f37edb4e56f3bf01df9953a6f = 'new';}$va8cfde6331bd59eb2ac96f8911c4b666 = $v5891da2d64975cae48d175d1e001f5da->getObject($v16b2b26000987faccb260b9d39df1269);if ($va8cfde6331bd59eb2ac96f8911c4b666 instanceof umiObject == false) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = [      'id' => $v16b2b26000987faccb260b9d39df1269,      'error' => getLabel('csv-error-not-found'),      'name' => $vb068931cc450442b63f5b3d276ea4297     ];continue;}if ($va8cfde6331bd59eb2ac96f8911c4b666->getTypeId() != $v726e8e4809d4c1b28a6549d86436a124->getId()) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = [      'id' => $v16b2b26000987faccb260b9d39df1269,      'error' => getLabel('csv-error-wrong-type'),      'name' => $vb068931cc450442b63f5b3d276ea4297     ];continue;}$_REQUEST['data'][$vccae550f37edb4e56f3bf01df9953a6f] = [];foreach ($v4340fd73e75df7a9d9e45902a59ba3a4 as $v865c0c0b4ab0e063e5caa3387c1a8741 => $v46b9e6004c49d9cc040029c197cab278) {if ($v865c0c0b4ab0e063e5caa3387c1a8741 == 'id') {continue;}if ($v865c0c0b4ab0e063e5caa3387c1a8741 == 'name' && isset($v07d43db2a74336dcfbdaeeeffe6f7a19[$v865c0c0b4ab0e063e5caa3387c1a8741])) {$_REQUEST['name'] = $v07d43db2a74336dcfbdaeeeffe6f7a19[$v865c0c0b4ab0e063e5caa3387c1a8741];}if (isset($v07d43db2a74336dcfbdaeeeffe6f7a19[$v865c0c0b4ab0e063e5caa3387c1a8741])) {$_REQUEST['data'][$vccae550f37edb4e56f3bf01df9953a6f][$v865c0c0b4ab0e063e5caa3387c1a8741] = $v07d43db2a74336dcfbdaeeeffe6f7a19[$v865c0c0b4ab0e063e5caa3387c1a8741];}}if ($v726e8e4809d4c1b28a6549d86436a124->getMethod() == 'user') {$_REQUEST['data'][$vccae550f37edb4e56f3bf01df9953a6f]['password'][0] = 'dummyPassword';}try {$v4119639092e62c55ea8be348e4d9260d = new umiEventPoint($v53cc4db543d7a569e51c1d76ac6f278e);$v4119639092e62c55ea8be348e4d9260d->addRef("object", $va8cfde6331bd59eb2ac96f8911c4b666);$v4119639092e62c55ea8be348e4d9260d->setMode("before");$v4119639092e62c55ea8be348e4d9260d->call();}catch (errorPanicException $ve1671797c52e15f763380b45e841ec32) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = [      'id' => $vccae550f37edb4e56f3bf01df9953a6f,      'error' => $ve1671797c52e15f763380b45e841ec32->getMessage(),      'name' => $vb068931cc450442b63f5b3d276ea4297     ];if ($vccae550f37edb4e56f3bf01df9953a6f == 'new') {$v5891da2d64975cae48d175d1e001f5da->delObject($v16b2b26000987faccb260b9d39df1269);}continue 1;}foreach ($v07d43db2a74336dcfbdaeeeffe6f7a19 as $v972bf3f05d14ffbdb817bef60638ff00 => $v2063c1608d6e0baf80249c42e2be5804) {switch ($v972bf3f05d14ffbdb817bef60638ff00) {case 'id': {continue;}case 'name': {$va8cfde6331bd59eb2ac96f8911c4b666->setName($v2063c1608d6e0baf80249c42e2be5804);break;}default: {try {$this->modifyProperty($va8cfde6331bd59eb2ac96f8911c4b666, $v972bf3f05d14ffbdb817bef60638ff00, $v2063c1608d6e0baf80249c42e2be5804);}catch (fieldRestrictionException $ve1671797c52e15f763380b45e841ec32) {$ve1671797c52e15f763380b45e841ec32->unregister();$v76cf1d4ff412fd3cb644aa58a53c78dc[] = [         'id' => $vccae550f37edb4e56f3bf01df9953a6f,         'error' => $ve1671797c52e15f763380b45e841ec32->getMessage(),         'name' => $v07d43db2a74336dcfbdaeeeffe6f7a19[$v972bf3f05d14ffbdb817bef60638ff00]        ];}break;}}}$va8cfde6331bd59eb2ac96f8911c4b666->commit();try {$v4119639092e62c55ea8be348e4d9260d->setMode('after');$v4119639092e62c55ea8be348e4d9260d->call();}catch (errorPanicException $ve1671797c52e15f763380b45e841ec32) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = [      'id' => $vccae550f37edb4e56f3bf01df9953a6f,      'error' => $ve1671797c52e15f763380b45e841ec32->getMessage(),      'name' => $vb068931cc450442b63f5b3d276ea4297     ];if ($vccae550f37edb4e56f3bf01df9953a6f == 'new') {$v5891da2d64975cae48d175d1e001f5da->delObject($v16b2b26000987faccb260b9d39df1269);}continue 1;}unset($_REQUEST['data'][$vccae550f37edb4e56f3bf01df9953a6f]);unset($va8cfde6331bd59eb2ac96f8911c4b666);$this->clearMemoryCache();}def_module::$noRedirectOnPanic = false;if (umiCount($v76cf1d4ff412fd3cb644aa58a53c78dc)) {$v7f2db423a49b305459147332fb01cf87->push('var err = \'' . addslashes(getLabel('csv-error-import-list')) . "\\n';\n");foreach ($v76cf1d4ff412fd3cb644aa58a53c78dc as $v6b3e9cdfd9fd6b6f313d7dd4526c9ceb) {if ($v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['id'] == 'new') {$v7f2db423a49b305459147332fb01cf87->push(       'err += \'' .       addslashes($v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['name'] . ' (' . getLabel('csv-new-item') . ') - ' .        $v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['error']) .       "\\n';\n"      );}else {$v7f2db423a49b305459147332fb01cf87->push(       'err += \'' .       addslashes($v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['name'] . ' (#' . $v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['id'] . ') - ' . $v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['error']) .       "\\n';\n"      );}}$v7f2db423a49b305459147332fb01cf87->push("alert(err);\n\n");}}private function clearMemoryCache() {umiHierarchy::getInstance()->clearCache();umiPropertiesHelper::getInstance()->clearCache();umiLinksHelper::getInstance()->clearCache();umiTypesHelper::getInstance()->clearCache();umiObjectsCollection::getInstance()->clearCache();umiObjectTypesCollection::getInstance()->clearCache();permissionsCollection::getInstance()->clearCache();umiFieldsCollection::getInstance()->clearCache();umiObjectProperty::setCachedPropData([]);}protected function readNextRow() {$result = "";$vc1cbfe271a40788a00e8bf8574d94d4b = $this->getFileHandler();if (feof($vc1cbfe271a40788a00e8bf8574d94d4b)) {return false;}$vb45cffe084dd3d20d928bee85e7b0f21 = fgets($vc1cbfe271a40788a00e8bf8574d94d4b);if (!$vb45cffe084dd3d20d928bee85e7b0f21) {return $this->readNextRow();}if (mb_substr_count($vb45cffe084dd3d20d928bee85e7b0f21, self::VALUE_LIMITER) % 2 != 0) {$v132ae73e31f76d8b94f87fe5ccfe28c9 = false;while (!feof($vc1cbfe271a40788a00e8bf8574d94d4b) && !$v132ae73e31f76d8b94f87fe5ccfe28c9) {$vb45cffe084dd3d20d928bee85e7b0f21 .= fgets($vc1cbfe271a40788a00e8bf8574d94d4b);if (mb_substr_count($vb45cffe084dd3d20d928bee85e7b0f21, self::VALUE_LIMITER) % 2 == 0) {$v132ae73e31f76d8b94f87fe5ccfe28c9 = true;}}}$vb45cffe084dd3d20d928bee85e7b0f21 = html_entity_decode($vb45cffe084dd3d20d928bee85e7b0f21, ENT_QUOTES, $this->encoding);$vf1965a857bc285d26fe22023aa5ab50d =    preg_replace("/([^{$this->delimiter}])" . str_repeat(self::VALUE_LIMITER, 2) . "/s", "$1'*//*'", $vb45cffe084dd3d20d928bee85e7b0f21);preg_match_all("/" . self::VALUE_LIMITER . "(.*?)" . self::VALUE_LIMITER . "/s", $vf1965a857bc285d26fe22023aa5ab50d, $v9c28d32df234037773be184dbdafc274);foreach ($v9c28d32df234037773be184dbdafc274[0] as $v2150fd65034a9bcdb357943b3900a918) {$vcd98ed9d0c33939793e2a0fc9400fc2b = str_replace($this->delimiter, "'////'", $v2150fd65034a9bcdb357943b3900a918);$vf1965a857bc285d26fe22023aa5ab50d = str_replace($v2150fd65034a9bcdb357943b3900a918, $vcd98ed9d0c33939793e2a0fc9400fc2b, $vf1965a857bc285d26fe22023aa5ab50d);}$vf1965a857bc285d26fe22023aa5ab50d = preg_replace("/(.+)" . $this->delimiter . "$/s", "$1", trim($vf1965a857bc285d26fe22023aa5ab50d));$vf1965a857bc285d26fe22023aa5ab50d = explode($this->delimiter, $vf1965a857bc285d26fe22023aa5ab50d);foreach ($vf1965a857bc285d26fe22023aa5ab50d as &$v8d27600b0cae5308441ddf6d9bb3c74c) {$v8d27600b0cae5308441ddf6d9bb3c74c = mb_convert_encoding($v8d27600b0cae5308441ddf6d9bb3c74c, self::TARGET_ENCODING, $this->encoding);$v8d27600b0cae5308441ddf6d9bb3c74c = str_replace("'////'", $this->delimiter, $v8d27600b0cae5308441ddf6d9bb3c74c);$v8d27600b0cae5308441ddf6d9bb3c74c = str_replace("'*//*'", self::VALUE_LIMITER, $v8d27600b0cae5308441ddf6d9bb3c74c);$v8d27600b0cae5308441ddf6d9bb3c74c = preg_replace("/^" . self::VALUE_LIMITER . "(.*)" . self::VALUE_LIMITER . "$/s", "$1", $v8d27600b0cae5308441ddf6d9bb3c74c);$v8d27600b0cae5308441ddf6d9bb3c74c = trim($v8d27600b0cae5308441ddf6d9bb3c74c);}return $vf1965a857bc285d26fe22023aa5ab50d;}protected function splitRow($vbbd8471fbb71b98724406e29408dcdb0) {$v07d43db2a74336dcfbdaeeeffe6f7a19 = [];if (mb_substr($vbbd8471fbb71b98724406e29408dcdb0, -1) != $this->delimiter) {$vbbd8471fbb71b98724406e29408dcdb0 .= $this->delimiter;}$vf5a8e923f8cd24b56b3bab32358cc58a = mb_strlen($vbbd8471fbb71b98724406e29408dcdb0);$va87deb01c5f539e6bda34829c8ef2368 = '';$vb742f355c37e48e44c2817f798ee3f72 = '';$v7c7ec62e9b0800581f0ea493ababd3f0 = '';for ($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $vf5a8e923f8cd24b56b3bab32358cc58a;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$va87deb01c5f539e6bda34829c8ef2368 = mb_substr($vbbd8471fbb71b98724406e29408dcdb0, $v865c0c0b4ab0e063e5caa3387c1a8741, 1);switch ($va87deb01c5f539e6bda34829c8ef2368) {case ';': {if ($vb742f355c37e48e44c2817f798ee3f72 != '\\') {$v07d43db2a74336dcfbdaeeeffe6f7a19[] = $v7c7ec62e9b0800581f0ea493ababd3f0;$v7c7ec62e9b0800581f0ea493ababd3f0 = '';break;}$v7c7ec62e9b0800581f0ea493ababd3f0 = mb_substr($v7c7ec62e9b0800581f0ea493ababd3f0, 0, mb_strlen($v7c7ec62e9b0800581f0ea493ababd3f0) - 1) . $this->delimiter;break;}case self::VALUE_LIMITER: {if (mb_substr($vbbd8471fbb71b98724406e29408dcdb0, $v865c0c0b4ab0e063e5caa3387c1a8741, 2) != str_repeat(self::VALUE_LIMITER, 2)) {break;}if (mb_substr($vbbd8471fbb71b98724406e29408dcdb0, $v865c0c0b4ab0e063e5caa3387c1a8741, 3) != str_repeat(self::VALUE_LIMITER, 2) . $this->delimiter) {$v7c7ec62e9b0800581f0ea493ababd3f0 = $v7c7ec62e9b0800581f0ea493ababd3f0 . self::VALUE_LIMITER;}$v865c0c0b4ab0e063e5caa3387c1a8741++;break;}default: {$v7c7ec62e9b0800581f0ea493ababd3f0 .= $va87deb01c5f539e6bda34829c8ef2368;}}$vb742f355c37e48e44c2817f798ee3f72 = $va87deb01c5f539e6bda34829c8ef2368;}return $v07d43db2a74336dcfbdaeeeffe6f7a19;}protected function modifyProperty(umiEntinty $va8cfde6331bd59eb2ac96f8911c4b666, $v972bf3f05d14ffbdb817bef60638ff00, $v5b57ab60c984eec4bc98143f6d1e8775) {if ($va8cfde6331bd59eb2ac96f8911c4b666 instanceof umiObject) {$v6301cee35ea764a1e241978f93f01069 = $va8cfde6331bd59eb2ac96f8911c4b666->getTypeId();}else {$v6301cee35ea764a1e241978f93f01069 = $va8cfde6331bd59eb2ac96f8911c4b666->getObject()->getTypeId();}$v726e8e4809d4c1b28a6549d86436a124 = umiObjectTypesCollection::getInstance()->getType($v6301cee35ea764a1e241978f93f01069);if ($v726e8e4809d4c1b28a6549d86436a124 instanceof umiObjectType == false) {throw new coreException("Object type #{$v6301cee35ea764a1e241978f93f01069} not found");}$v945100186b119048837b9859c2c46410 = $v726e8e4809d4c1b28a6549d86436a124->getFieldId($v972bf3f05d14ffbdb817bef60638ff00);$v06e3d36fa30cea095545139854ad1fb9 = umiFieldsCollection::getInstance()->getField($v945100186b119048837b9859c2c46410);if ($v06e3d36fa30cea095545139854ad1fb9 instanceof umiField) {if (in_array($v06e3d36fa30cea095545139854ad1fb9->getDataType(), self::$supportedFieldTypes)) {$v2063c1608d6e0baf80249c42e2be5804 = $this->prepareValue($v06e3d36fa30cea095545139854ad1fb9, $v5b57ab60c984eec4bc98143f6d1e8775);return $va8cfde6331bd59eb2ac96f8911c4b666->setValue($v06e3d36fa30cea095545139854ad1fb9->getName(), $v2063c1608d6e0baf80249c42e2be5804);}}else {return false;}}protected function getFieldId(umiObjectType $v726e8e4809d4c1b28a6549d86436a124, $v46b9e6004c49d9cc040029c197cab278) {foreach ($v726e8e4809d4c1b28a6549d86436a124->getAllFields() as $v06e3d36fa30cea095545139854ad1fb9) {if ($v06e3d36fa30cea095545139854ad1fb9->getTitle() == $v46b9e6004c49d9cc040029c197cab278 || $v06e3d36fa30cea095545139854ad1fb9->getName() == $v46b9e6004c49d9cc040029c197cab278) {return $v06e3d36fa30cea095545139854ad1fb9->getId();}if ($this->getFieldAlias($v46b9e6004c49d9cc040029c197cab278)) {if ($this->getFieldAlias($v06e3d36fa30cea095545139854ad1fb9->getTitle()) == $this->getFieldAlias($v46b9e6004c49d9cc040029c197cab278)) {return $v06e3d36fa30cea095545139854ad1fb9->getId();}}}return false;}protected function getFieldAlias($v46b9e6004c49d9cc040029c197cab278) {$v46b9e6004c49d9cc040029c197cab278 = ulangStream::getI18n($v46b9e6004c49d9cc040029c197cab278);$v47c80780ab608cc046f2a6e6f071feb6 = ['photo' => ['field-photo', 'field-image', 'field-izobrazhenie', 'field-photo-s']];if (mb_substr($v46b9e6004c49d9cc040029c197cab278, 0, 6) == 'i18n::') {$v46b9e6004c49d9cc040029c197cab278 = mb_substr($v46b9e6004c49d9cc040029c197cab278, 6);}foreach ($v47c80780ab608cc046f2a6e6f071feb6 as $v865c0c0b4ab0e063e5caa3387c1a8741 => $v9e3669d19b675bd57058fd4664205d2a) {if (in_array($v46b9e6004c49d9cc040029c197cab278, $v9e3669d19b675bd57058fd4664205d2a)) {return $v865c0c0b4ab0e063e5caa3387c1a8741;}}return false;}protected function prepareValue(umiField $v06e3d36fa30cea095545139854ad1fb9, $v5b57ab60c984eec4bc98143f6d1e8775) {$v833750ac635fcc57dc33ecafe365f9a7 = $v06e3d36fa30cea095545139854ad1fb9->getFieldType();switch ($v833750ac635fcc57dc33ecafe365f9a7->getDataType()) {case 'relation': {$result = preg_split('/, ?/', $v5b57ab60c984eec4bc98143f6d1e8775);foreach ($result as $v865c0c0b4ab0e063e5caa3387c1a8741 => $v3a6d0284e743dc4a9b86f97d6dd1a3bf) {if ($v3a6d0284e743dc4a9b86f97d6dd1a3bf) {$i18n = ulangStream::getI18n($v3a6d0284e743dc4a9b86f97d6dd1a3bf);$result[$v865c0c0b4ab0e063e5caa3387c1a8741] = $i18n ?: $v3a6d0284e743dc4a9b86f97d6dd1a3bf;}}return $result;}case 'domain_id_list':    case 'tags': {return preg_split('/, ?/', $v5b57ab60c984eec4bc98143f6d1e8775);}case 'int': {return (int) $v5b57ab60c984eec4bc98143f6d1e8775;}case 'float':    case 'price': {$v5b57ab60c984eec4bc98143f6d1e8775 = str_replace(",", ".", $v5b57ab60c984eec4bc98143f6d1e8775);return (float) $v5b57ab60c984eec4bc98143f6d1e8775;break;}case 'date': {if ($v5b57ab60c984eec4bc98143f6d1e8775) {return umiDate::getTimeStamp($v5b57ab60c984eec4bc98143f6d1e8775);}return false;}case 'file':    case 'img_file': {if (preg_match('/[а-яА-Я ]/', $v5b57ab60c984eec4bc98143f6d1e8775)) {$vc94af6eb0fecb9a2c23fb0c0cc496a8a = iconv('UTF-8', 'CP1251//IGNORE', $v5b57ab60c984eec4bc98143f6d1e8775);$v826e8142e6baabe8af779f5f490cf5f5 = CURRENT_WORKING_DIR . $v5b57ab60c984eec4bc98143f6d1e8775;$v1c1c96fd2cf8330db0bfa936ce82f3b9 = CURRENT_WORKING_DIR . $vc94af6eb0fecb9a2c23fb0c0cc496a8a;$v8c7dd922ad47494fc02c388e12c00eac = false;if (file_exists($v826e8142e6baabe8af779f5f490cf5f5)) {$v8c7dd922ad47494fc02c388e12c00eac = $v5b57ab60c984eec4bc98143f6d1e8775;}elseif (file_exists($v1c1c96fd2cf8330db0bfa936ce82f3b9)) {$v8c7dd922ad47494fc02c388e12c00eac = $vc94af6eb0fecb9a2c23fb0c0cc496a8a;}if ($v8c7dd922ad47494fc02c388e12c00eac) {$v5b57ab60c984eec4bc98143f6d1e8775 = str_replace('\\', '/', $v5b57ab60c984eec4bc98143f6d1e8775);$v13872c0118a4316afd1e99295017d654 = explode('/', $v5b57ab60c984eec4bc98143f6d1e8775);$vf9c644ef64dd78d73149e1ab33366203 = [];if (umiCount($v13872c0118a4316afd1e99295017d654) > 1) {$v5b063e275d506f65ebf1b02d926f19a4 = $v13872c0118a4316afd1e99295017d654[umiCount($v13872c0118a4316afd1e99295017d654) - 1];unset($v13872c0118a4316afd1e99295017d654[umiCount($v13872c0118a4316afd1e99295017d654) - 1]);foreach ($v13872c0118a4316afd1e99295017d654 as $vf4c9385f1902f7334b00b9b4ecd164de) {if (preg_match('/[а-яА-Я]/', $vf4c9385f1902f7334b00b9b4ecd164de)) {$vf9c644ef64dd78d73149e1ab33366203[] = translit::convert($vf4c9385f1902f7334b00b9b4ecd164de);}else {$vf9c644ef64dd78d73149e1ab33366203[] = $vf4c9385f1902f7334b00b9b4ecd164de;}}}else {$v5b063e275d506f65ebf1b02d926f19a4 = $v13872c0118a4316afd1e99295017d654[0];}$vcdb08918f90fcb2287e075a5336a46e4 = explode('.', $v5b063e275d506f65ebf1b02d926f19a4);$vabf77184f55403d75b9d51d79162a7ca = $vcdb08918f90fcb2287e075a5336a46e4[umiCount($vcdb08918f90fcb2287e075a5336a46e4) - 1];unset($vcdb08918f90fcb2287e075a5336a46e4[umiCount($vcdb08918f90fcb2287e075a5336a46e4) - 1]);$vfa1954f632650a82482e1e712a853db0 = implode('.', $vcdb08918f90fcb2287e075a5336a46e4);if (preg_match('/[а-яА-Я]/', $vfa1954f632650a82482e1e712a853db0)) {$vfa1954f632650a82482e1e712a853db0 = translit::convert($vfa1954f632650a82482e1e712a853db0);}$vfa1954f632650a82482e1e712a853db0 .= '.' . $vabf77184f55403d75b9d51d79162a7ca;$vf9c644ef64dd78d73149e1ab33366203[] = $vfa1954f632650a82482e1e712a853db0;$v5b57ab60c984eec4bc98143f6d1e8775 = implode('/', $vf9c644ef64dd78d73149e1ab33366203);if (!(file_exists(dirname(CURRENT_WORKING_DIR . $v5b57ab60c984eec4bc98143f6d1e8775)) &&        is_dir(dirname(CURRENT_WORKING_DIR . $v5b57ab60c984eec4bc98143f6d1e8775)))) {mkdir(dirname(CURRENT_WORKING_DIR . $v5b57ab60c984eec4bc98143f6d1e8775), 0777, true);}rename(CURRENT_WORKING_DIR . $v8c7dd922ad47494fc02c388e12c00eac, CURRENT_WORKING_DIR . $v5b57ab60c984eec4bc98143f6d1e8775);}}if ($v5b57ab60c984eec4bc98143f6d1e8775 && mb_substr($v5b57ab60c984eec4bc98143f6d1e8775, 0, 1) == '/') {$v5b57ab60c984eec4bc98143f6d1e8775 = '.' . $v5b57ab60c984eec4bc98143f6d1e8775;}return $v5b57ab60c984eec4bc98143f6d1e8775;}case 'swf_file': {if ($v5b57ab60c984eec4bc98143f6d1e8775 && mb_substr($v5b57ab60c984eec4bc98143f6d1e8775, 0, 1) == '/') {$v5b57ab60c984eec4bc98143f6d1e8775 = '.' . $v5b57ab60c984eec4bc98143f6d1e8775;}return $v5b57ab60c984eec4bc98143f6d1e8775;}default: {return $v5b57ab60c984eec4bc98143f6d1e8775;}}}protected function openFile() {$this->fileHandler = fopen($this->csvFile->getFilePath(), 'r');}protected function getFileHandler() {return $this->fileHandler;}protected function closeFile() {if ($vc1cbfe271a40788a00e8bf8574d94d4b = $this->getFileHandler()) {fclose($vc1cbfe271a40788a00e8bf8574d94d4b);}if ($this->csvFile instanceof umiFile) {$this->csvFile->delete();}}protected function analyzeColumns($v4340fd73e75df7a9d9e45902a59ba3a4, $v07d43db2a74336dcfbdaeeeffe6f7a19) {$result = [];$v01ae5af0b0bdd5f727b2e7315c747739 = array_keys($v4340fd73e75df7a9d9e45902a59ba3a4);for ($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < umiCount($v01ae5af0b0bdd5f727b2e7315c747739);$v865c0c0b4ab0e063e5caa3387c1a8741++) {$result[$v01ae5af0b0bdd5f727b2e7315c747739[$v865c0c0b4ab0e063e5caa3387c1a8741]] = isset($v07d43db2a74336dcfbdaeeeffe6f7a19[$v865c0c0b4ab0e063e5caa3387c1a8741]) ? $v07d43db2a74336dcfbdaeeeffe6f7a19[$v865c0c0b4ab0e063e5caa3387c1a8741] : null;}return $result;}protected function analyzeHeaders(umiObjectType $v726e8e4809d4c1b28a6549d86436a124, $v4340fd73e75df7a9d9e45902a59ba3a4) {$result = [];$vc08b50415eb1a67928fe59c937252cde = umiFieldsCollection::getInstance();$v865c0c0b4ab0e063e5caa3387c1a8741 = 0;foreach ($v4340fd73e75df7a9d9e45902a59ba3a4 as $vd5d3db1765287eef77d7927cc956f50a) {switch (mb_strtolower($vd5d3db1765287eef77d7927cc956f50a)) {case 'id': {$result['id'] = $vd5d3db1765287eef77d7927cc956f50a;break;}case mb_strtolower(getLabel('label-name')): {$result['name'] = $vd5d3db1765287eef77d7927cc956f50a;break;}case mb_strtolower(getLabel('label-alt-name')): {if ($this->mode == 'element') {$result['alt-name'] = $vd5d3db1765287eef77d7927cc956f50a;}break;}case mb_strtolower(getLabel('field-is_active')): {if ($this->mode == 'element') {$result['is-active'] = $vd5d3db1765287eef77d7927cc956f50a;}break;}default: {$v945100186b119048837b9859c2c46410 = $this->getFieldId($v726e8e4809d4c1b28a6549d86436a124, $vd5d3db1765287eef77d7927cc956f50a);$v06e3d36fa30cea095545139854ad1fb9 = $vc08b50415eb1a67928fe59c937252cde->getField($v945100186b119048837b9859c2c46410);if ($v06e3d36fa30cea095545139854ad1fb9 instanceof umiField) {$result[$v06e3d36fa30cea095545139854ad1fb9->getName()] = $vd5d3db1765287eef77d7927cc956f50a;}else {$result['unkonwn-field-' . (++$v865c0c0b4ab0e063e5caa3387c1a8741)] = $vd5d3db1765287eef77d7927cc956f50a;}}}}return $result;}}