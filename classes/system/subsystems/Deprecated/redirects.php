<?php
 class redirects implements iRedirects {private $urlSuffix = '/';public static function getInstance() {static $v7123a699d77db6479a1d8ece2c4f1c16;if (is_null($v7123a699d77db6479a1d8ece2c4f1c16)) {$v7123a699d77db6479a1d8ece2c4f1c16 = new redirects;}return $v7123a699d77db6479a1d8ece2c4f1c16;}private function __construct() {$v2245023265ae4cf87d02c8b6ba991139 = mainConfiguration::getInstance();if ((bool) $v2245023265ae4cf87d02c8b6ba991139->get('seo', 'url-suffix.add')) {$this->urlSuffix = (string) $v2245023265ae4cf87d02c8b6ba991139->get('seo', 'url-suffix');}}public function add($v36cd38f49b9afa08222c0dc9ebfe35eb, $v42aefbae01d2dfd981f7da7d823d689e, $v9acb44549b41563697bb490144ec6258 = 301, $v6a1ceb246b9ea27f5ab29fbd0a01ca06 = false) {if ($v36cd38f49b9afa08222c0dc9ebfe35eb == $v42aefbae01d2dfd981f7da7d823d689e) {return;}$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$v36cd38f49b9afa08222c0dc9ebfe35eb = $v4717d53ebfdfea8477f780ec66151dcb->escape($this->parseUri($v36cd38f49b9afa08222c0dc9ebfe35eb));$v42aefbae01d2dfd981f7da7d823d689e = $v4717d53ebfdfea8477f780ec66151dcb->escape($this->parseUri($v42aefbae01d2dfd981f7da7d823d689e));$v9acb44549b41563697bb490144ec6258 = (int) $v9acb44549b41563697bb490144ec6258;$v6a1ceb246b9ea27f5ab29fbd0a01ca06 = (int) $v6a1ceb246b9ea27f5ab29fbd0a01ca06;$v4717d53ebfdfea8477f780ec66151dcb->startTransaction('Adding new redirect records');try {$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
INSERT INTO `cms3_redirects`
	(`source`, `target`, `status`, `made_by_user`)
	SELECT `source`, '{$v42aefbae01d2dfd981f7da7d823d689e}', '{$v9acb44549b41563697bb490144ec6258}', $v6a1ceb246b9ea27f5ab29fbd0a01ca06 FROM `cms3_redirects`
		WHERE `target` = '{$v36cd38f49b9afa08222c0dc9ebfe35eb}'
SQL;    $v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
DELETE FROM `cms3_redirects` WHERE `target` = '{$v36cd38f49b9afa08222c0dc9ebfe35eb}'
SQL;    $v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);$result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult(     "SELECT * FROM `cms3_redirects` WHERE `source` = '{$v36cd38f49b9afa08222c0dc9ebfe35eb}' AND `target` = '{$v42aefbae01d2dfd981f7da7d823d689e}'"    );if ($result->length() > 0) {$v4717d53ebfdfea8477f780ec66151dcb->rollbackTransaction();return;}$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
INSERT INTO `cms3_redirects`
	(`source`, `target`, `status`, `made_by_user`)
	VALUES
	('{$v36cd38f49b9afa08222c0dc9ebfe35eb}', '{$v42aefbae01d2dfd981f7da7d823d689e}', '{$v9acb44549b41563697bb490144ec6258}', $v6a1ceb246b9ea27f5ab29fbd0a01ca06)
SQL;    $v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);}catch (Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {$v4717d53ebfdfea8477f780ec66151dcb->rollbackTransaction();throw $v42552b1f133f9f8eb406d4f306ea9fd1;}$v4717d53ebfdfea8477f780ec66151dcb->commitTransaction();}public function getRedirectsIdBySource($v36cd38f49b9afa08222c0dc9ebfe35eb, $v6a1ceb246b9ea27f5ab29fbd0a01ca06 = false) {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$vc08b1ffecd5ba75362b821842b4f4505 = $this->parseUri($v36cd38f49b9afa08222c0dc9ebfe35eb);$v6a1ceb246b9ea27f5ab29fbd0a01ca06 = (int) $v6a1ceb246b9ea27f5ab29fbd0a01ca06;$v2d8413ae32cda5259e93d4f3666f1235 = [];$vac5c74b64b4b8352ef2f181affb5ac2a =    "SELECT `id`, `target`, `status` FROM `cms3_redirects` WHERE `source` = '{$vc08b1ffecd5ba75362b821842b4f4505}' AND `made_by_user` = $v6a1ceb246b9ea27f5ab29fbd0a01ca06";$result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);$result->setFetchType(IQueryResult::FETCH_ROW);foreach ($result as $vf1965a857bc285d26fe22023aa5ab50d) {list($vb80bb7740288fda1f201890375a60c8f, $v42aefbae01d2dfd981f7da7d823d689e, $v9acb44549b41563697bb490144ec6258) = $vf1965a857bc285d26fe22023aa5ab50d;$v2d8413ae32cda5259e93d4f3666f1235[$vb80bb7740288fda1f201890375a60c8f] = [$v36cd38f49b9afa08222c0dc9ebfe35eb, $v42aefbae01d2dfd981f7da7d823d689e, (int) $v9acb44549b41563697bb490144ec6258];}return $v2d8413ae32cda5259e93d4f3666f1235;}public function getRedirectIdByTarget($v42aefbae01d2dfd981f7da7d823d689e, $v6a1ceb246b9ea27f5ab29fbd0a01ca06 = false) {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$vf70cd12b2475f48430f5afb914d43f9c = $v4717d53ebfdfea8477f780ec66151dcb->escape($this->parseUri($v42aefbae01d2dfd981f7da7d823d689e));$v6a1ceb246b9ea27f5ab29fbd0a01ca06 = (int) $v6a1ceb246b9ea27f5ab29fbd0a01ca06;$vac5c74b64b4b8352ef2f181affb5ac2a =    "SELECT `id`, `source`, `status` FROM `cms3_redirects` WHERE `target` = '{$vf70cd12b2475f48430f5afb914d43f9c}' AND `made_by_user` = $v6a1ceb246b9ea27f5ab29fbd0a01ca06";$result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);$result->setFetchType(IQueryResult::FETCH_ROW);if ($result->length() == 0) {return false;}list($vb80bb7740288fda1f201890375a60c8f, $v36cd38f49b9afa08222c0dc9ebfe35eb, $v9acb44549b41563697bb490144ec6258) = $result->fetch();return [$v36cd38f49b9afa08222c0dc9ebfe35eb, $v42aefbae01d2dfd981f7da7d823d689e, (int) $v9acb44549b41563697bb490144ec6258];}public function del($vb80bb7740288fda1f201890375a60c8f) {$vb80bb7740288fda1f201890375a60c8f = (int) $vb80bb7740288fda1f201890375a60c8f;$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
DELETE FROM `cms3_redirects` WHERE `id` = '{$vb80bb7740288fda1f201890375a60c8f}'
SQL;   $v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);}public function redirectIfRequired($vf0183130c6c478a364b95e4325786eb9, $v6a1ceb246b9ea27f5ab29fbd0a01ca06 = false) {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$vf0183130c6c478a364b95e4325786eb9 = $v4717d53ebfdfea8477f780ec66151dcb->escape($this->parseUri($vf0183130c6c478a364b95e4325786eb9));$v6a1ceb246b9ea27f5ab29fbd0a01ca06 = (int) $v6a1ceb246b9ea27f5ab29fbd0a01ca06;$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT `target`, `status` FROM `cms3_redirects`
	WHERE `source` = '{$vf0183130c6c478a364b95e4325786eb9}' AND `made_by_user` = $v6a1ceb246b9ea27f5ab29fbd0a01ca06
	ORDER BY `id` DESC LIMIT 1
SQL;   $result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);$result->setFetchType(IQueryResult::FETCH_ROW);if ($result->length() > 0) {list($v42aefbae01d2dfd981f7da7d823d689e, $v9acb44549b41563697bb490144ec6258) = $result->fetch();if (strpos($v42aefbae01d2dfd981f7da7d823d689e, 'http') !== 0) {$v42aefbae01d2dfd981f7da7d823d689e = '/' . $v42aefbae01d2dfd981f7da7d823d689e;}return $this->redirect($v42aefbae01d2dfd981f7da7d823d689e, (int) $v9acb44549b41563697bb490144ec6258);}$v8401668c4e8a4292331d5d46ddd1f649 = explode("/", trim($vf0183130c6c478a364b95e4325786eb9, "/"));do {array_pop($v8401668c4e8a4292331d5d46ddd1f649);$vf93632f2f958d47116bf0ad6ae7e6509 = implode("/", $v8401668c4e8a4292331d5d46ddd1f649) . "/";$v059db73d368bc8964f075448480bb487 = $v4717d53ebfdfea8477f780ec66151dcb->escape($this->parseUri($vf93632f2f958d47116bf0ad6ae7e6509));if (!strlen($v059db73d368bc8964f075448480bb487)) {if (umiCount($v8401668c4e8a4292331d5d46ddd1f649)) {continue;}break;}$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT `source`, `target`, `status` FROM `cms3_redirects`
	WHERE `source` = '{$v059db73d368bc8964f075448480bb487}' AND `made_by_user` = $v6a1ceb246b9ea27f5ab29fbd0a01ca06
	ORDER BY `id` DESC LIMIT 1
SQL;    $result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);$result->setFetchType(IQueryResult::FETCH_ROW);if ($result->length() > 0) {list($v36cd38f49b9afa08222c0dc9ebfe35eb, $v42aefbae01d2dfd981f7da7d823d689e, $v9acb44549b41563697bb490144ec6258) = $result->fetch();$v4cb75ae8da8b4b486d9a2eb6220d78f2 = substr($vf0183130c6c478a364b95e4325786eb9, strlen($v36cd38f49b9afa08222c0dc9ebfe35eb));$v42aefbae01d2dfd981f7da7d823d689e .= $v4cb75ae8da8b4b486d9a2eb6220d78f2;if (strpos($v42aefbae01d2dfd981f7da7d823d689e, 'http') !== 0) {$v42aefbae01d2dfd981f7da7d823d689e = '/' . $v42aefbae01d2dfd981f7da7d823d689e;}$this->redirect($v42aefbae01d2dfd981f7da7d823d689e, $v9acb44549b41563697bb490144ec6258);}}while (umiCount($v8401668c4e8a4292331d5d46ddd1f649) > 1);}public function init() {$v2245023265ae4cf87d02c8b6ba991139 = mainConfiguration::getInstance();if ($v2245023265ae4cf87d02c8b6ba991139->get('seo', 'watch-redirects-history')) {$vd0b62cf0cd270bb58374f321620931ff = new umiEventListener("systemModifyElement", "content", "onModifyPageWatchRedirects");$vd0b62cf0cd270bb58374f321620931ff = new umiEventListener("systemMoveElement", "content", "onModifyPageWatchRedirects");}}public function deleteAllRedirects() {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$v4717d53ebfdfea8477f780ec66151dcb->query('TRUNCATE TABLE `cms3_redirects`;');}protected function redirect($v42aefbae01d2dfd981f7da7d823d689e, $v9acb44549b41563697bb490144ec6258) {$vcccb484e3a7978e609c6d8725c8c8c09 = [    300 => 'Multiple Choices',    'Moved Permanently',    'Found',    'See Other',    'Not Modified',    'Use Proxy',    'Switch Proxy',    'Temporary Redirect'   ];if (!isset($vcccb484e3a7978e609c6d8725c8c8c09[$v9acb44549b41563697bb490144ec6258])) {return false;}$va153823cb904cdc2433606062b6aea0f = $vcccb484e3a7978e609c6d8725c8c8c09[$v9acb44549b41563697bb490144ec6258];$v7f2db423a49b305459147332fb01cf87 = outputBuffer::current();if ($vcea75f8cd36a4f8567d5068b7e7e05e8 = getServer('HTTP_REFERER')) {$v7f2db423a49b305459147332fb01cf87->setHeader('Referrer', (string) $vcea75f8cd36a4f8567d5068b7e7e05e8);}$v7f2db423a49b305459147332fb01cf87->status($v9acb44549b41563697bb490144ec6258 . ' ' . $va153823cb904cdc2433606062b6aea0f);$v7f2db423a49b305459147332fb01cf87->redirect($v42aefbae01d2dfd981f7da7d823d689e);$v7f2db423a49b305459147332fb01cf87->end();}protected function parseUri($v9305b73d359bd06734fee0b3638079e1) {$v9305b73d359bd06734fee0b3638079e1 = ltrim($v9305b73d359bd06734fee0b3638079e1, '/');if ($this->urlSuffix == '/') {return rtrim($v9305b73d359bd06734fee0b3638079e1, '/');}$v4ec1b477cd0232b832c1899905ec51a4 = addcslashes($this->urlSuffix, '\^.$|()[]*+?{},');$v240bf022e685b0ee30ad9fe9e1fb5d5b = '/(' . $v4ec1b477cd0232b832c1899905ec51a4 . ')/';$ve1c903ef0832002e78abaa5dc4993dd3 = preg_replace($v240bf022e685b0ee30ad9fe9e1fb5d5b, '', $v9305b73d359bd06734fee0b3638079e1);return (is_null($ve1c903ef0832002e78abaa5dc4993dd3)) ? $v9305b73d359bd06734fee0b3638079e1 : $ve1c903ef0832002e78abaa5dc4993dd3;}};?>
