<?php
 use UmiCms\Service;class HTTPOutputBuffer extends outputBuffer {protected $options = [   'quick-edit' => true, 'generation-time' => false ];private $headersSent = false;public function send() {$v7f2db423a49b305459147332fb01cf87 = $this->buffer;if ($this->isEventsEnabled()) {$v70e8822b2e035fa3777d666207aeafa8 = new umiEventPoint('systemBufferSend');$v70e8822b2e035fa3777d666207aeafa8->setMode('before');$v70e8822b2e035fa3777d666207aeafa8->addRef('buffer', $v7f2db423a49b305459147332fb01cf87);$v70e8822b2e035fa3777d666207aeafa8->call();}$v10573b873d2fa5a365d558a45e328e47 = Service::Request();if ($v10573b873d2fa5a365d558a45e328e47->isAdmin() && $v10573b873d2fa5a365d558a45e328e47->isHtml()) {$v7f2db423a49b305459147332fb01cf87 = $this->replaceAmpForXsltAdmin($v7f2db423a49b305459147332fb01cf87);}$this->buffer = $v7f2db423a49b305459147332fb01cf87;$this->sendHeaders();echo $this->buffer;$this->clear();}public function sendHeaders() {if ($this->headersSent) {return true;}if (headers_sent()) {return false;}$this->setDefaultHeaders();$this->sendBrowserCacheHeaders();if ($this->isEventsEnabled()) {$v70e8822b2e035fa3777d666207aeafa8 = new umiEventPoint('bufferHeadersSend');$v70e8822b2e035fa3777d666207aeafa8->setMode('before');$v70e8822b2e035fa3777d666207aeafa8->addRef('buffer', $this);$v70e8822b2e035fa3777d666207aeafa8->call();}$this->sendStatusHeader();foreach ($this->getHeaderList() as $v099fb995346f31c749f6e40db0f395e3 => $v2063c1608d6e0baf80249c42e2be5804) {$this->sendHeader($v099fb995346f31c749f6e40db0f395e3, $v2063c1608d6e0baf80249c42e2be5804);}$this->sendCookies();$this->headersSent = true;}public function end() {$this->bufferDirectHeaders();$this->deleteDirectHeaders();if (!DEBUG) {$this->reset();}if ($this->option('quick-edit')) {umiTemplater::prepareQuickEdit();}$v75040253f83b056b5da03ed3c5681039 = $this->getCallTime();if ($v75040253f83b056b5da03ed3c5681039 !== '') {$this->push($this->getCallTime());}$this->send();$this->stop();}public static function checkUrlSecurity($v572d4e421e5e6b9bc11d815e8a027112) {return stripos($v572d4e421e5e6b9bc11d815e8a027112, 'javascript:') === false && stripos($v572d4e421e5e6b9bc11d815e8a027112, 'data:') === false &&    !preg_match('/^\/{2,}/i', $v572d4e421e5e6b9bc11d815e8a027112);}public function redirect($v572d4e421e5e6b9bc11d815e8a027112, $v15e03a651c4771934c90043c22e736ac = '301 Moved Permanently', $vafc83e97f17c79ad582675c662b8ee16 = 301) {$vba7d756f209f3da15d6fdf4de0b50c94 = 0;while (ob_get_level() && $vba7d756f209f3da15d6fdf4de0b50c94++ < 5) {@ob_end_clean();}$v572d4e421e5e6b9bc11d815e8a027112 = urldecode($v572d4e421e5e6b9bc11d815e8a027112);if (!self::checkUrlSecurity($v572d4e421e5e6b9bc11d815e8a027112)) {$this->status('400 Bad Request');$this->sendStatusHeader();flush();$this->stop();}$this->status($v15e03a651c4771934c90043c22e736ac);$this->sendStatusHeader();$vbef65933acbed511ed4f607e97852f2b = parse_url($v572d4e421e5e6b9bc11d815e8a027112);if (!isset($vbef65933acbed511ed4f607e97852f2b['scheme']) && !isset($vbef65933acbed511ed4f607e97852f2b['host'])) {$v572d4e421e5e6b9bc11d815e8a027112 = '/' . ltrim($v572d4e421e5e6b9bc11d815e8a027112, '/');}$this->sendCookies();header('Location: ' . $v572d4e421e5e6b9bc11d815e8a027112, true, $vafc83e97f17c79ad582675c662b8ee16);flush();$this->stop();}public function length() {ob_start();echo $this->buffer;$vf7bd60b75b29d79b660a2859395c1a24 = ob_get_length();ob_end_clean();return $vf7bd60b75b29d79b660a2859395c1a24;}protected function setDefaultHeaders() {if (!$this->issetHeader('Content-Type')) {$this->setHeader('Content-Type', $this->contentType() . '; charset=' . $this->charset());}if (!$this->issetHeader('Content-Length')) {$v2fa47f7c65fec19cc163b195725e3844 = $this->length();if ($v2fa47f7c65fec19cc163b195725e3844) {$this->setHeader('Content-Length', (string) $v2fa47f7c65fec19cc163b195725e3844);}}if (!$this->issetHeader('Date')) {$this->setHeader('Date', gmdate('D, d M Y H:i:s') . ' GMT');}if ($this->isFatalOccurred()) {return;}if (!$this->issetHeader('X-Generated-By')) {$this->setHeader('X-Generated-By', 'UMI.CMS');}if (!$this->issetHeader('X-UA-Compatible') && mb_strpos(getServer('HTTP_USER_AGENT'), 'MSIE')) {$this->setHeader('X-UA-Compatible', 'IE=edge');}$v2af72f100c356273d46284f6fd1dfc08 = (string) Service::RegistrySettings()->getVersion();if (!$this->issetHeader('X-CMS-Version') && !empty($v2af72f100c356273d46284f6fd1dfc08)) {$this->setHeader('X-CMS-Version', $v2af72f100c356273d46284f6fd1dfc08);}if (!$this->issetHeader('X-XSS-Protection')) {$this->setHeader('X-XSS-Protection', '0');}}protected function sendStatusHeader() {header('HTTP/1.1 ' . $this->status());if ((int) mainConfiguration::getInstance()->get('kernel', 'send-additional-status-header')) {header('Status: ' . $this->status());}}protected function sendHeader($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804) {header("{$vb068931cc450442b63f5b3d276ea4297}: {$v2063c1608d6e0baf80249c42e2be5804}");}protected function getCallTime() {$v6b65583eced7f2bc21d80ba0fc82066a = round(microtime(true) - $this->invokeTime, 6);$v500926d0e2f1fd46a82272d2a9b11627 = (string) mainConfiguration::getInstance()    ->get('kernel', 'show-generate-time');if (!$this->option('generation-time') || $v500926d0e2f1fd46a82272d2a9b11627 === '0') {return '';}$v30fbafbb765afb6552e512877a217fc6 = '';$v36750de19bed237506726986ae09e0c9 = parent::contentGenerator();if (is_string($v36750de19bed237506726986ae09e0c9) && $v36750de19bed237506726986ae09e0c9 !== '') {$v30fbafbb765afb6552e512877a217fc6 = ' by ' . $v36750de19bed237506726986ae09e0c9;}switch ($this->contentType()) {case 'text/html':    case 'text/xml':     return "<!-- This page generated in {$v6b65583eced7f2bc21d80ba0fc82066a} secs{$v30fbafbb765afb6552e512877a217fc6} -->";case 'application/javascript':    case 'text/javascript':     return "/* This page generated in {$v6b65583eced7f2bc21d80ba0fc82066a} secs{$v30fbafbb765afb6552e512877a217fc6} */";default:     return '';}}private function replaceAmpForXsltAdmin($v7f2db423a49b305459147332fb01cf87) {return str_replace('&amp;', '&', $v7f2db423a49b305459147332fb01cf87);}private function bufferDirectHeaders() {foreach (headers_list() as $v099fb995346f31c749f6e40db0f395e3) {list($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804) = explode(':', $v099fb995346f31c749f6e40db0f395e3, 2);$this->setHeader(trim($vb068931cc450442b63f5b3d276ea4297), trim($v2063c1608d6e0baf80249c42e2be5804));}}private function deleteDirectHeaders() {@header_remove();}private function sendCookies() {$v239e702a63e7302aa5986640acb62d76 = Service::CookieJar()    ->getResponsePool();foreach ($v239e702a63e7302aa5986640acb62d76->getList() as $v2dccd1ab3e03990aea77359831c85ca2) {setcookie(     $v2dccd1ab3e03990aea77359831c85ca2->getName(),     $v2dccd1ab3e03990aea77359831c85ca2->getValue(),     $v2dccd1ab3e03990aea77359831c85ca2->getExpirationTime(),     $v2dccd1ab3e03990aea77359831c85ca2->getPath(),     $v2dccd1ab3e03990aea77359831c85ca2->getDomain(),     $v2dccd1ab3e03990aea77359831c85ca2->isSecure(),     $v2dccd1ab3e03990aea77359831c85ca2->isForHttpOnly()    );$v239e702a63e7302aa5986640acb62d76->remove($v2dccd1ab3e03990aea77359831c85ca2->getName());}}private function sendBrowserCacheHeaders() {Service::BrowserCache()    ->process();}public function header($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804 = false) {if ($v2063c1608d6e0baf80249c42e2be5804 === false) {$this->unsetHeader($vb068931cc450442b63f5b3d276ea4297);return null;}$this->setHeader($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804);return $v2063c1608d6e0baf80249c42e2be5804;}public function printJson($v8d777f385d3dfec8815d20f7496026dc) {Service::Response()    ->printJson($v8d777f385d3dfec8815d20f7496026dc);}public function getHTTPRequestBody() {return Service::Request()->getRawBody();}}