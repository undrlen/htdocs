<?php
 namespace UmiCms\System\Cache\Statical\Key;use UmiCms\System\Request\iFacade as iRequest;class Generator implements iGenerator {private $request;private $pageCollection;private $config;private $domainCollection;const MOBILE_PREFIX = '/mobile';const DEFAULT_PREFIX = '';public function __construct(   iRequest $v10573b873d2fa5a365d558a45e328e47,   \iUmiHierarchy $vf8aea31a0fd948447674cb859137e6e7,   \iConfiguration $v2245023265ae4cf87d02c8b6ba991139,   \iDomainsCollection $v14a0ffee308315f250f040d5b4d48560  ) {$this->request = $v10573b873d2fa5a365d558a45e328e47;$this->pageCollection = $vf8aea31a0fd948447674cb859137e6e7;$this->config = $v2245023265ae4cf87d02c8b6ba991139;$this->domainCollection = $v14a0ffee308315f250f040d5b4d48560;}public function getKey() {$v851f5ac9941d720844d143ed9cfcf60a = $this->isMobile() ? self::MOBILE_PREFIX : self::DEFAULT_PREFIX;$v67b3dba8bc6778101892eb77249db32e = $this->getHost();$v572d4e421e5e6b9bc11d815e8a027112 = $this->getUrl();return $this->glueKey($v851f5ac9941d720844d143ed9cfcf60a, $v67b3dba8bc6778101892eb77249db32e, $v572d4e421e5e6b9bc11d815e8a027112);}public function getKeyList($vb80bb7740288fda1f201890375a60c8f) {$vf8aea31a0fd948447674cb859137e6e7 = $this->getPageCollection();$v8e2dcfd7e7e24b1ca76c1193f645902b = $vf8aea31a0fd948447674cb859137e6e7->getElement($vb80bb7740288fda1f201890375a60c8f);if (!$v8e2dcfd7e7e24b1ca76c1193f645902b instanceof \iUmiHierarchyElement) {return [];}$vad5f82e879a9c5d6b5b442eb37e50551 = $this->getDomainCollection()    ->getDomain($v8e2dcfd7e7e24b1ca76c1193f645902b->getDomainId());if (!$vad5f82e879a9c5d6b5b442eb37e50551 instanceof \iDomain) {return [];}$v572d4e421e5e6b9bc11d815e8a027112 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getIsDefault() ? '' : ltrim($vf8aea31a0fd948447674cb859137e6e7->getPathById($vb80bb7740288fda1f201890375a60c8f), '/');$v572d4e421e5e6b9bc11d815e8a027112 = str_replace($vad5f82e879a9c5d6b5b442eb37e50551->getUrl() . '/', '', $v572d4e421e5e6b9bc11d815e8a027112);$vf595d4c971339549e44e99ace240cf42 = [];foreach ($this->getPathPartList($vad5f82e879a9c5d6b5b442eb37e50551, $v572d4e421e5e6b9bc11d815e8a027112) as $vc0f11ea04c50a34294e15278b150aad2) {list($v851f5ac9941d720844d143ed9cfcf60a, $v67b3dba8bc6778101892eb77249db32e, $v572d4e421e5e6b9bc11d815e8a027112) = $vc0f11ea04c50a34294e15278b150aad2;$vf595d4c971339549e44e99ace240cf42[] = $this->glueKey($v851f5ac9941d720844d143ed9cfcf60a, $v67b3dba8bc6778101892eb77249db32e, $v572d4e421e5e6b9bc11d815e8a027112);}return $vf595d4c971339549e44e99ace240cf42;}private function getPathPartList(\iDomain $vad5f82e879a9c5d6b5b442eb37e50551, $v572d4e421e5e6b9bc11d815e8a027112) {$vc778d600f4b6bea4c2a70c04149648f9 = $this->filterWWW($vad5f82e879a9c5d6b5b442eb37e50551->getHost(true));$v3a4c2fb7fdc992ce5b94054decec958e = [    [     self::MOBILE_PREFIX,     $vc778d600f4b6bea4c2a70c04149648f9,     $v572d4e421e5e6b9bc11d815e8a027112    ],    [     self::DEFAULT_PREFIX,     $vc778d600f4b6bea4c2a70c04149648f9,     $v572d4e421e5e6b9bc11d815e8a027112    ]   ];foreach ($vad5f82e879a9c5d6b5b442eb37e50551->getMirrorsList() as $vfbe322a89bc0ba531c3f0050e3935f28) {$v7149e61edc76ec4e13af4db36536536a = $this->filterWWW($vfbe322a89bc0ba531c3f0050e3935f28->getHost(true));$v3a4c2fb7fdc992ce5b94054decec958e[] = [     self::MOBILE_PREFIX,     $v7149e61edc76ec4e13af4db36536536a,     $v572d4e421e5e6b9bc11d815e8a027112    ];$v3a4c2fb7fdc992ce5b94054decec958e[] = [     self::DEFAULT_PREFIX,     $v7149e61edc76ec4e13af4db36536536a,     $v572d4e421e5e6b9bc11d815e8a027112    ];}return $v3a4c2fb7fdc992ce5b94054decec958e;}private function isMobile() {return $this->getRequest()->isMobile() && $this->getConfig()     ->get('cache', 'static.cache-for-mobile-devices');}private function glueKey($v851f5ac9941d720844d143ed9cfcf60a, $v67b3dba8bc6778101892eb77249db32e, $v572d4e421e5e6b9bc11d815e8a027112) {return sprintf('%s/%s/%s', $v851f5ac9941d720844d143ed9cfcf60a, $v67b3dba8bc6778101892eb77249db32e, $v572d4e421e5e6b9bc11d815e8a027112);}private function getUrl() {return trim($this->getRequest()->uri(), '/');}private function getHost() {$v67b3dba8bc6778101892eb77249db32e = $this->filterWWW($this->getRequest()->host());return trim($v67b3dba8bc6778101892eb77249db32e, '/');}private function filterWWW($v67b3dba8bc6778101892eb77249db32e) {$v9f93cd8131c6fdb4cc24940eab269ed5 = (bool) $this->getConfig()    ->get('cache', 'static.filter-www');$v67b3dba8bc6778101892eb77249db32e = $v9f93cd8131c6fdb4cc24940eab269ed5 ? preg_replace('/^www\./i', '', $v67b3dba8bc6778101892eb77249db32e) : $v67b3dba8bc6778101892eb77249db32e;return $v67b3dba8bc6778101892eb77249db32e;}private function getRequest() {return $this->request;}private function getPageCollection() {return $this->pageCollection;}private function getConfig() {return $this->config;}private function getDomainCollection() {return $this->domainCollection;}}