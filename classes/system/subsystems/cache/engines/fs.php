<?php
 class fsCacheEngine implements iCacheEngine {protected $root;const NESTING_LEVEL = 5;const SEPARATOR = "\n";const NAME = 'fs';public function __construct() {$v09ccebee89ba1513e068086becf87990 = SYS_CACHE_RUNTIME . 'fs-cache/';$v63a9f0ea7bb98050796b649e85481845 = new umiDirectory($v09ccebee89ba1513e068086becf87990);if ($v63a9f0ea7bb98050796b649e85481845->getIsBroken()) {$v63a9f0ea7bb98050796b649e85481845::requireFolder($v63a9f0ea7bb98050796b649e85481845->getPath());$v63a9f0ea7bb98050796b649e85481845->refresh();}$this->setRoot($v63a9f0ea7bb98050796b649e85481845);}public function getName() {return self::NAME;}public function saveRawData($v3c6e0b8a9c15224a8228b9a98ca1531d, $v8d777f385d3dfec8815d20f7496026dc, $vcd91e7679d575a2c548bd2c889c23b9e) {if ($vcd91e7679d575a2c548bd2c889c23b9e <= 0) {$this->delete($v3c6e0b8a9c15224a8228b9a98ca1531d);}$vd6fe1d0be6347b8ef2427fa629c04485 = $this->calcPathByKey($v3c6e0b8a9c15224a8228b9a98ca1531d);$v8c7dd922ad47494fc02c388e12c00eac = new umiFile($vd6fe1d0be6347b8ef2427fa629c04485);if ($v8c7dd922ad47494fc02c388e12c00eac->getIsBroken()) {$v8c7dd922ad47494fc02c388e12c00eac::requireFile($v8c7dd922ad47494fc02c388e12c00eac->getFilePath());}$v9a0364b9e99bb480dd25e1f0284c8555 = $this->packContent($v8d777f385d3dfec8815d20f7496026dc, $vcd91e7679d575a2c548bd2c889c23b9e);return (bool) @$v8c7dd922ad47494fc02c388e12c00eac->putContent($v9a0364b9e99bb480dd25e1f0284c8555);}public function loadRawData($v3c6e0b8a9c15224a8228b9a98ca1531d) {$vd6fe1d0be6347b8ef2427fa629c04485 = $this->calcPathByKey($v3c6e0b8a9c15224a8228b9a98ca1531d);$v8c7dd922ad47494fc02c388e12c00eac = new umiFile($vd6fe1d0be6347b8ef2427fa629c04485);if ($v8c7dd922ad47494fc02c388e12c00eac->getIsBroken()) {return false;}$v9a0364b9e99bb480dd25e1f0284c8555 = @$v8c7dd922ad47494fc02c388e12c00eac->getContent();if (!is_string($v9a0364b9e99bb480dd25e1f0284c8555) || empty($v9a0364b9e99bb480dd25e1f0284c8555)) {return false;}$vcd91e7679d575a2c548bd2c889c23b9e = $this->unpackExpire($v9a0364b9e99bb480dd25e1f0284c8555);if (time() > ($v8c7dd922ad47494fc02c388e12c00eac->getModifyTime() + $vcd91e7679d575a2c548bd2c889c23b9e)) {$this->delete($v3c6e0b8a9c15224a8228b9a98ca1531d);return false;}return $this->unpackData($v9a0364b9e99bb480dd25e1f0284c8555);}public function delete($v3c6e0b8a9c15224a8228b9a98ca1531d) {$vd6fe1d0be6347b8ef2427fa629c04485 = $this->calcPathByKey($v3c6e0b8a9c15224a8228b9a98ca1531d);$vc9f5e6ea18ee0e381f3c6d6cc41fcb6e = new umiFile($vd6fe1d0be6347b8ef2427fa629c04485);if ($vc9f5e6ea18ee0e381f3c6d6cc41fcb6e->isExists()) {return $vc9f5e6ea18ee0e381f3c6d6cc41fcb6e->delete();}return false;}public function flush() {return $this->getRoot()->deleteRecursively();}public function getIsConnected() {$v63a9f0ea7bb98050796b649e85481845 = $this->getRoot();return $v63a9f0ea7bb98050796b649e85481845->isExists() && $v63a9f0ea7bb98050796b649e85481845->isWritable() && $v63a9f0ea7bb98050796b649e85481845->isReadable();}protected function calcPathByKey($v3c6e0b8a9c15224a8228b9a98ca1531d) {$v2fa47f7c65fec19cc163b195725e3844 = self::NESTING_LEVEL;$v78f0805fa8ffadabda721fdaf85b3ca9 = array_reverse(preg_split("/[_\.\/:]+/", $v3c6e0b8a9c15224a8228b9a98ca1531d));$v8162eb6d94b84f82b3a1ad304a2530ea = array_pop($v78f0805fa8ffadabda721fdaf85b3ca9);if (mb_strlen($v8162eb6d94b84f82b3a1ad304a2530ea) < $v2fa47f7c65fec19cc163b195725e3844) {$v8162eb6d94b84f82b3a1ad304a2530ea = str_repeat('0', $v2fa47f7c65fec19cc163b195725e3844 - mb_strlen($v8162eb6d94b84f82b3a1ad304a2530ea)) . $v8162eb6d94b84f82b3a1ad304a2530ea;}for ($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v2fa47f7c65fec19cc163b195725e3844;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$v78f0805fa8ffadabda721fdaf85b3ca9[] = mb_substr($v8162eb6d94b84f82b3a1ad304a2530ea, $v865c0c0b4ab0e063e5caa3387c1a8741, 1);}if ($v2fa47f7c65fec19cc163b195725e3844 < mb_strlen($v8162eb6d94b84f82b3a1ad304a2530ea)) {$v78f0805fa8ffadabda721fdaf85b3ca9[] = mb_substr($v8162eb6d94b84f82b3a1ad304a2530ea, $v2fa47f7c65fec19cc163b195725e3844);}return $this->getRoot()->getPath() . '/' . implode('/', $v78f0805fa8ffadabda721fdaf85b3ca9);}private function setRoot(iUmiDirectory $v5f8f22b8cdbaeee8cf857673a9b6ba20) {$this->root = $v5f8f22b8cdbaeee8cf857673a9b6ba20;return $this;}private function getRoot() {return $this->root;}private function packContent($v8d777f385d3dfec8815d20f7496026dc, $vcd91e7679d575a2c548bd2c889c23b9e) {return (int) $vcd91e7679d575a2c548bd2c889c23b9e . self::SEPARATOR . serialize($v8d777f385d3dfec8815d20f7496026dc);}private function unpackExpire($v9a0364b9e99bb480dd25e1f0284c8555) {$v841e6d6a6c6d914a1e611477f447d207 = mb_strpos($v9a0364b9e99bb480dd25e1f0284c8555, self::SEPARATOR);return (int) mb_substr($v9a0364b9e99bb480dd25e1f0284c8555, 0, $v841e6d6a6c6d914a1e611477f447d207);}private function unpackData($v9a0364b9e99bb480dd25e1f0284c8555) {$v841e6d6a6c6d914a1e611477f447d207 = mb_strpos($v9a0364b9e99bb480dd25e1f0284c8555, self::SEPARATOR);$v8d777f385d3dfec8815d20f7496026dc = mb_substr($v9a0364b9e99bb480dd25e1f0284c8555, $v841e6d6a6c6d914a1e611477f447d207 + 1);return unserialize($v8d777f385d3dfec8815d20f7496026dc);}}