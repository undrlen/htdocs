<?php
 use UmiCms\Service;class mysqliConnection implements IConnection {private $host;private $userName;private $password;private $databaseName;private $port;private $socket;private $isPersistent;private $isCritical;private $mysqliConnection;private $isOpen = false;private $queriesCount = 0;private $queriesLogger;const PERSISTENT_CONNECTION_PREFIX = 'p:';public function __construct(   $v67b3dba8bc6778101892eb77249db32e,   $v435e0648d634175c46bd40ac366545a8,   $v5f4dcc3b5aa765d61d8327deb882cf99,   $vf618483eef4956a817efb2ca268621ca,   $v901555fb06e346cb065ceb9808dcfc25 = false,   $v23c6323bfb57bb630b8a2ecf703d6bb0 = false,   $v7e85bcb66fb9a809d5ab4f62a8b8bea8 = true  ) {$this->host = $v67b3dba8bc6778101892eb77249db32e;$this->userName = $v435e0648d634175c46bd40ac366545a8;$this->password = $v5f4dcc3b5aa765d61d8327deb882cf99;$this->databaseName = $vf618483eef4956a817efb2ca268621ca;$this->port = is_numeric($v901555fb06e346cb065ceb9808dcfc25) ? $v901555fb06e346cb065ceb9808dcfc25 : null;$this->isPersistent = $v23c6323bfb57bb630b8a2ecf703d6bb0;$this->isCritical = $v7e85bcb66fb9a809d5ab4f62a8b8bea8;}public function setSocket($v61f2529360aec54f5dc9804b842cf3fa) {$this->socket = $v61f2529360aec54f5dc9804b842cf3fa;}public function setLogger(iMysqlLogger $vd58fdb62952eba87b6128598a7874e1b) {$this->queriesLogger = $vd58fdb62952eba87b6128598a7874e1b;}public function open() {if ($this->isOpen()) {return true;}try {$this->mysqliConnection = new mysqli(     $this->isPersistent ? self::PERSISTENT_CONNECTION_PREFIX . $this->host : $this->host,     $this->userName,     $this->password,     $this->databaseName,     $this->port,     $this->socket    );if ($this->errorOccurred()) {throw new Exception($this->errorDescription());}$this->initConnection();}catch (Exception $ve1671797c52e15f763380b45e841ec32) {return $this->isCritical ? $this->makeFatalError() : false;}$this->isOpen = true;return true;}public function close() {if ($this->isOpen() && $this->isCorrectConnection()) {$this->mysqliConnection->close();$this->isOpen = false;}}public function query($vbe571b25caf2bbed46f6e47182670bf7) {if ((!$this->isOpen() || !$this->isCorrectConnection()) && !$this->open()) {return false;}if (!is_string($vbe571b25caf2bbed46f6e47182670bf7)) {throw new Exception('Query string expected');}$vbe571b25caf2bbed46f6e47182670bf7 = $this->prepareQueryString($vbe571b25caf2bbed46f6e47182670bf7);$result = $this->mysqliQuery($vbe571b25caf2bbed46f6e47182670bf7);++$this->queriesCount;if ($this->errorOccurred()) {throw new databaseException($this->errorDescription($vbe571b25caf2bbed46f6e47182670bf7), $this->mysqliConnection->errno);}return $result;}public function startTransaction($v06d4cd63bde972fc66a0aed41d2f5c51 = '') {$v06d4cd63bde972fc66a0aed41d2f5c51 = (!is_string($v06d4cd63bde972fc66a0aed41d2f5c51)) ? '' : $this->escape($v06d4cd63bde972fc66a0aed41d2f5c51);$v1dccadfed7bcbb036c56a4afb97e906f = sprintf('START TRANSACTION /* %s */', $v06d4cd63bde972fc66a0aed41d2f5c51);$this->query($v1dccadfed7bcbb036c56a4afb97e906f);return $this;}public function commitTransaction() {$this->query('COMMIT');return $this;}public function rollbackTransaction() {$this->query('ROLLBACK');return $this;}public function getQueriesCount() {return $this->queriesCount;}public function queryResult($vbe571b25caf2bbed46f6e47182670bf7) {$result = $this->query($vbe571b25caf2bbed46f6e47182670bf7);return $this->isCorrectQueryResult($result) ? new mysqliQueryResult($result) : null;}public function errorOccured() {return $this->errorOccurred();}public function errorOccurred() {if ($this->isCorrectConnection()) {return $this->mysqliConnection->error !== '';}}public function errorDescription($vc4477f6813fbe8d695d230ed95c5e388 = null) {if ($this->isCorrectConnection() && $this->errorOccurred()) {$vd83a5a8080de341e6551f42e0feece88 = $this->mysqliConnection->error;return is_string($vc4477f6813fbe8d695d230ed95c5e388) ? $vd83a5a8080de341e6551f42e0feece88 . ' in query: ' . $vc4477f6813fbe8d695d230ed95c5e388 : $vd83a5a8080de341e6551f42e0feece88;}}public function isOpen() {return $this->isOpen;}public function escape($va43c1b0aa53a0c908810c06ab1ff3967) {if ($this->isOpen() && $this->isCorrectConnection()) {return $this->mysqliConnection->real_escape_string($va43c1b0aa53a0c908810c06ab1ff3967);}return addslashes($va43c1b0aa53a0c908810c06ab1ff3967);}public function getConnectionInfo() {return [    'host' => $this->host,    'port' => $this->port,    'user' => $this->userName,    'password' => $this->password,    'dbname' => $this->databaseName,    'link' => $this->mysqliConnection,    'socket' => $this->socket   ];}public function insertId() {if ($this->isOpen() && $this->isCorrectConnection()) {return $this->mysqliConnection->insert_id;}return 0;}public function errorNumber() {if ($this->isOpen() && $this->isCorrectConnection()) {return $this->mysqliConnection->connect_errno;}return 0;}public function getServerInfo() {if ($this->isOpen() && $this->isCorrectConnection()) {return $this->mysqliConnection->server_info;}return null;}public function errorMessage() {if ($this->isOpen() && $this->isCorrectConnection()) {return $this->mysqliConnection->error;}return '';}public function affectedRows() {if ($this->isOpen() && $this->isCorrectConnection()) {return $this->mysqliConnection->affected_rows;}return 0;}public function isDuplicateKey(databaseException $v42552b1f133f9f8eb406d4f306ea9fd1) {return $v42552b1f133f9f8eb406d4f306ea9fd1->getCode() === self::DUPLICATE_KEY_ERROR_CODE;}private function getLogger() {return $this->queriesLogger;}private function initConnection() {$this->mysqliQuery('SET NAMES utf8');$this->mysqliQuery('SET CHARSET utf8');$this->mysqliQuery('SET CHARACTER SET utf8');$this->mysqliQuery('SET character_set_client = \'utf8\'');$this->mysqliQuery('SET SESSION collation_connection = \'utf8_general_ci\'');$this->mysqliQuery('SET SQL_BIG_SELECTS = 1');$this->queriesCount += 6;}private function isCorrectConnection() {return $this->mysqliConnection instanceof mysqli;}private function isCorrectQueryResult($result) {return $result instanceof mysqli_result;}private function prepareQueryString($vbe571b25caf2bbed46f6e47182670bf7) {return trim($vbe571b25caf2bbed46f6e47182670bf7, " \t\n");}private function makeFatalError() {$v7f2db423a49b305459147332fb01cf87 = Service::Response()    ->getCurrentBuffer();$v7f2db423a49b305459147332fb01cf87->status(500);$v7f2db423a49b305459147332fb01cf87->push(file_get_contents(CURRENT_WORKING_DIR . '/errors/mysql_failed.html'));$v7f2db423a49b305459147332fb01cf87->end();}private function mysqliQuery($vbe571b25caf2bbed46f6e47182670bf7) {if (!$this->isCorrectConnection()) {return false;}$v6db435f352d7ea4a67807a3feb447bf7 = $this->getLogger();if ($v6db435f352d7ea4a67807a3feb447bf7 === null) {return $this->mysqliConnection->query($vbe571b25caf2bbed46f6e47182670bf7);}if ($v6db435f352d7ea4a67807a3feb447bf7 instanceof iMysqlLogger) {$v6db435f352d7ea4a67807a3feb447bf7->runTimer();$v26d59e24afcb9c11f03ffe8392b68734 = $this->mysqliConnection->query($vbe571b25caf2bbed46f6e47182670bf7);$vdad566b38c7c4c71d805927e9fff2732 = $v6db435f352d7ea4a67807a3feb447bf7->getTimer();$v78e731027d8fd50ed642340b7c9a63b3 = $v6db435f352d7ea4a67807a3feb447bf7->getMessage($vbe571b25caf2bbed46f6e47182670bf7, $vdad566b38c7c4c71d805927e9fff2732);$v6db435f352d7ea4a67807a3feb447bf7->log($v78e731027d8fd50ed642340b7c9a63b3);return $v26d59e24afcb9c11f03ffe8392b68734;}}public function clearCache() {return false;}}