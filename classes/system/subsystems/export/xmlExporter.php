<?php
 use UmiCms\Service;use UmiCms\System\Orm\Entity\iExchange;use UmiCms\System\Import\UmiDump\Helper\Entity\iSourceIdBinder;class xmlExporter implements iXmlExporter {const VERSION = '2.0';const RELATED_IMPORT_FORMAT = 'commerceML2';protected static $ROOT_PAGE_TYPE_ID;private $relations;private $entityRelations;protected $source_id;protected $source_name;protected $types;protected $langs;protected $templates;protected $elements;protected $branches;protected $objects = [];protected $restrictions;protected $data_types;protected $registry;protected $domains;protected $files;protected $directories;private $entities = [];private $serializeOptionList = [   xmlTranslator::DEEP_OPTION => true  ];protected   $exported_files = [],   $exported_types = [],   $exported_langs = [],   $exported_domains = [],   $exported_templates = [],   $exported_elements = [],   $exported_objects = [],   $exported_restrictions = [],   $exported_registry_items = [],   $restricted_fields = [],   $exported_data_types = [],   $exported_dirs = [],   $exported_entities = [];protected $excludedElements = [];protected $limit;protected $position = 0;protected $break = false;protected $translator;protected $destination;protected $completed = false;protected $doc;protected $root;protected $meta_container;protected $files_container;protected $types_container;protected $data_types_container;protected $pages_container;protected $objects_container;protected $relations_container;protected $restrictions_container;protected $registry_container;protected $dirs_container;protected $hierarchy_container;private $domains_container;private $permissions_container;private $options_container;private $templates_container;private $langs_container;private $entities_container;protected $export_log = [];protected $showAllFields = false;protected $ignoreRelations = false;protected $saveRelations = [];protected $installOnly = [];protected $ignorePermissions = false;protected $oldGetLinks;protected $includeGuidesEnabled = false;private $exportAllModuleMethodPermissions = false;private $fieldAllowRuntimeAdd = false;public function __construct($v7c95caafbd5e4b5db3977617a0498de6, $vae7095443e0f6858f7aad7c7547e743b = false) {$this->relations = umiImportRelations::getInstance();$this->source_name = $v7c95caafbd5e4b5db3977617a0498de6;$this->source_id = $this->relations->addNewSource($v7c95caafbd5e4b5db3977617a0498de6);$this->entityRelations = Service::ImportEntitySourceIdBinderFactory()    ->create($this->source_id);$this->limit = is_numeric($vae7095443e0f6858f7aad7c7547e743b) ? $vae7095443e0f6858f7aad7c7547e743b : false;self::$ROOT_PAGE_TYPE_ID = umiObjectTypesCollection::getInstance()->getTypeIdByGUID('root-pages-type');}public function includeGuides() {$this->includeGuidesEnabled = true;}public function setInstallOnlyEntities(array $v07214c6750d983a32e0a33da225c4efd) {$this->installOnly = $v07214c6750d983a32e0a33da225c4efd;}public function setIgnorePermissions($v9acb44549b41563697bb490144ec6258) {$this->ignorePermissions = (bool) $v9acb44549b41563697bb490144ec6258;}public function ignoreRelationsExcept($v621ddfd2ea41b75c6051189a7a012196) {$this->setIgnoreRelations($v621ddfd2ea41b75c6051189a7a012196);}public function setIgnoreRelations($v621ddfd2ea41b75c6051189a7a012196 = []) {$this->ignoreRelations = true;$this->saveRelations = (array) $v621ddfd2ea41b75c6051189a7a012196;}public function setShowAllFields($v999429990f5610353c3b2ccfd54b5ad4 = false) {$this->showAllFields = $v999429990f5610353c3b2ccfd54b5ad4;}public function setSerializeOption($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804) {if (!is_string($vb068931cc450442b63f5b3d276ea4297) || $vb068931cc450442b63f5b3d276ea4297 === '') {throw new InvalidArgumentException('Incorrect serialize option name given');}$this->serializeOptionList[$vb068931cc450442b63f5b3d276ea4297] = $v2063c1608d6e0baf80249c42e2be5804;return $this;}public function getExportLog() {return $this->export_log;}protected function writeLog($v78e731027d8fd50ed642340b7c9a63b3) {if (defined('UMICMS_CLI_MODE') && UMICMS_CLI_MODE) {Service::Response()     ->getCliBuffer()     ->push($v78e731027d8fd50ed642340b7c9a63b3 . PHP_EOL);}$this->export_log[] = $v78e731027d8fd50ed642340b7c9a63b3;}protected function reportError($vcb5e100e5a9a3e7f6d1fd97512215282) {if (defined('UMICMS_CLI_MODE') && UMICMS_CLI_MODE) {Service::Response()     ->getCliBuffer()     ->push($vcb5e100e5a9a3e7f6d1fd97512215282 . PHP_EOL);}$this->export_log[] = "<font style='color:red''>" . $vcb5e100e5a9a3e7f6d1fd97512215282 . '</font>';}protected function saveState() {$v87a0860e170e57ac18a827962ccd6816 = $this->getCacheFilePath();if (!$this->break) {if (file_exists($v87a0860e170e57ac18a827962ccd6816)) {unlink($v87a0860e170e57ac18a827962ccd6816);}return;}$vd36a87418dcd06d8fbb68d2a1776284e = array_keys($this->exported_types, 'found');foreach ($vd36a87418dcd06d8fbb68d2a1776284e as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {unset($this->exported_types[$v2063c1608d6e0baf80249c42e2be5804]);}$vd36a87418dcd06d8fbb68d2a1776284e = array_keys($this->exported_elements, 'found');foreach ($vd36a87418dcd06d8fbb68d2a1776284e as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {unset($this->exported_elements[$v2063c1608d6e0baf80249c42e2be5804]);}$vd36a87418dcd06d8fbb68d2a1776284e = array_keys($this->exported_objects, 'found');foreach ($vd36a87418dcd06d8fbb68d2a1776284e as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {unset($this->exported_objects[$v2063c1608d6e0baf80249c42e2be5804]);}$vf1f713c9e000f5d3f280adbd124df4f5 = [    'exported_files' => $this->exported_files,    'exported_types' => $this->exported_types,    'exported_langs' => $this->exported_langs,    'exported_domains' => $this->exported_domains,    'exported_templates' => $this->exported_templates,    'exported_elements' => $this->exported_elements,    'exported_objects' => $this->exported_objects,    'restricted_fields' => $this->restricted_fields,    'restrictions' => $this->restrictions,    'exported_restrictions' => $this->exported_restrictions,    'exported_registry_items' => $this->exported_registry_items,    'exported_data_types' => $this->exported_data_types,    'exported_dirs' => $this->exported_dirs,    'exported_entities' => $this->exported_entities,   ];file_put_contents($v87a0860e170e57ac18a827962ccd6816, serialize($vf1f713c9e000f5d3f280adbd124df4f5));}private function restoreState() {$v87a0860e170e57ac18a827962ccd6816 = $this->getCacheFilePath();if (!file_exists($v87a0860e170e57ac18a827962ccd6816)) {return;}$vf1f713c9e000f5d3f280adbd124df4f5 = unserialize(file_get_contents($v87a0860e170e57ac18a827962ccd6816));$this->exported_files = $vf1f713c9e000f5d3f280adbd124df4f5['exported_files'];$this->exported_types = $vf1f713c9e000f5d3f280adbd124df4f5['exported_types'];$this->exported_langs = $vf1f713c9e000f5d3f280adbd124df4f5['exported_langs'];$this->exported_domains = $vf1f713c9e000f5d3f280adbd124df4f5['exported_domains'];$this->exported_templates = $vf1f713c9e000f5d3f280adbd124df4f5['exported_templates'];$this->exported_elements = $vf1f713c9e000f5d3f280adbd124df4f5['exported_elements'];$this->exported_objects = $vf1f713c9e000f5d3f280adbd124df4f5['exported_objects'];$this->exported_restrictions = $vf1f713c9e000f5d3f280adbd124df4f5['exported_restrictions'];$this->restricted_fields = $vf1f713c9e000f5d3f280adbd124df4f5['restricted_fields'];$this->restrictions = $vf1f713c9e000f5d3f280adbd124df4f5['restrictions'];$this->exported_registry_items = $vf1f713c9e000f5d3f280adbd124df4f5['exported_registry_items'];$this->exported_data_types = $vf1f713c9e000f5d3f280adbd124df4f5['exported_data_types'];$this->exported_dirs = $vf1f713c9e000f5d3f280adbd124df4f5['exported_dirs'];$this->exported_entities = $vf1f713c9e000f5d3f280adbd124df4f5['exported_entities'];}private function getCacheFilePath() {return SYS_TEMP_PATH . '/runtime-cache/' . md5($this->source_name);}public function getExportedElements() {return $this->exported_elements;}public function getExportedObject() {return $this->exported_objects;}public function addElements($v8bde57434adb7a78cc31875b6e82f43e) {foreach ($v8bde57434adb7a78cc31875b6e82f43e as $v7552cd149af7495ee7d8225974e50f80) {if ($v7552cd149af7495ee7d8225974e50f80 instanceof iUmiHierarchyElement) {$v7552cd149af7495ee7d8225974e50f80 = $v7552cd149af7495ee7d8225974e50f80->getId();}$this->elements[] = $v7552cd149af7495ee7d8225974e50f80;}}public function addBranches($vc6f70cea476c1b694a66053ac81262f9) {foreach ($vc6f70cea476c1b694a66053ac81262f9 as $v7552cd149af7495ee7d8225974e50f80) {if ($v7552cd149af7495ee7d8225974e50f80 instanceof iUmiHierarchyElement) {$v7552cd149af7495ee7d8225974e50f80 = $v7552cd149af7495ee7d8225974e50f80->getId();}$this->branches[] = $v7552cd149af7495ee7d8225974e50f80;}}public function excludeBranches(array $vc6f70cea476c1b694a66053ac81262f9) {$v475d6424dac268bb5fffd0235530c333 = umiHierarchy::getInstance();foreach ($vc6f70cea476c1b694a66053ac81262f9 as $v7552cd149af7495ee7d8225974e50f80) {if ($v7552cd149af7495ee7d8225974e50f80 instanceof iUmiHierarchyElement) {$v7552cd149af7495ee7d8225974e50f80 = $v7552cd149af7495ee7d8225974e50f80->getId();}$this->excludedElements[$v7552cd149af7495ee7d8225974e50f80] = $v7552cd149af7495ee7d8225974e50f80;$va8d8b14c2944fa96236c337c3305270f = $v475d6424dac268bb5fffd0235530c333->getChildrenList($v7552cd149af7495ee7d8225974e50f80);foreach ($va8d8b14c2944fa96236c337c3305270f as $vf4f40123eb510dd3290125b38f4eb898) {$this->excludedElements[$vf4f40123eb510dd3290125b38f4eb898] = $vf4f40123eb510dd3290125b38f4eb898;}}}public function addObjects($v7beef54c8a75efe23880c9c3bfaf46d7) {foreach ($v7beef54c8a75efe23880c9c3bfaf46d7 as $v16b2b26000987faccb260b9d39df1269) {if ($v16b2b26000987faccb260b9d39df1269 instanceof iUmiObject) {$v16b2b26000987faccb260b9d39df1269 = $v16b2b26000987faccb260b9d39df1269->getId();}if (is_numeric($v16b2b26000987faccb260b9d39df1269)) {$v16b2b26000987faccb260b9d39df1269 = (int) $v16b2b26000987faccb260b9d39df1269;$this->objects[$v16b2b26000987faccb260b9d39df1269] = $v16b2b26000987faccb260b9d39df1269;}}}public function addTypes($va9e2e7908a1f06effc849966dcf44b1c) {foreach ($va9e2e7908a1f06effc849966dcf44b1c as $v5f694956811487225d15e973ca38fbab) {if ($v5f694956811487225d15e973ca38fbab instanceof iUmiObjectType) {$v5f694956811487225d15e973ca38fbab = $v5f694956811487225d15e973ca38fbab->getId();}$this->types[] = $v5f694956811487225d15e973ca38fbab;}}public function addRestrictions($ve04570a94cf3bb43edfb635caa2af2bf) {foreach ($ve04570a94cf3bb43edfb635caa2af2bf as $v6b1a57fa235477758817df3c91158006) {if ($v6b1a57fa235477758817df3c91158006 instanceof baseRestriction) {$v6b1a57fa235477758817df3c91158006 = $v6b1a57fa235477758817df3c91158006->getId();}$this->restrictions[] = $v6b1a57fa235477758817df3c91158006;}}public function addRegistry($vf595d4c971339549e44e99ace240cf42 = []) {foreach ($vf595d4c971339549e44e99ace240cf42 as $vd6fe1d0be6347b8ef2427fa629c04485) {$this->registry[] = $vd6fe1d0be6347b8ef2427fa629c04485;}}public function setDestination($v6990a54322d9232390a784c5c9247dd6) {if (!is_dir($v6990a54322d9232390a784c5c9247dd6)) {$this->reportError('Destination folder does not exist');return false;}$this->destination = $v6990a54322d9232390a784c5c9247dd6;}public function addFiles($vf595d4c971339549e44e99ace240cf42 = []) {foreach ($vf595d4c971339549e44e99ace240cf42 as $vd6fe1d0be6347b8ef2427fa629c04485) {if (is_file($vd6fe1d0be6347b8ef2427fa629c04485)) {$this->files[$vd6fe1d0be6347b8ef2427fa629c04485] = new umiFile($vd6fe1d0be6347b8ef2427fa629c04485);}else {$this->reportError("File {$vd6fe1d0be6347b8ef2427fa629c04485} doesn't exist");}}}public function addDirs($vf595d4c971339549e44e99ace240cf42 = []) {foreach ($vf595d4c971339549e44e99ace240cf42 as $vd6fe1d0be6347b8ef2427fa629c04485) {if (is_dir($vd6fe1d0be6347b8ef2427fa629c04485)) {$this->directories[] = new umiDirectory($vd6fe1d0be6347b8ef2427fa629c04485);}else {$this->reportError("Folder {$vd6fe1d0be6347b8ef2427fa629c04485} doesn't exist");}}}public function addDomains($ve4e46deb7f9cc58c7abfb32e5570b6f3 = []) {foreach ($ve4e46deb7f9cc58c7abfb32e5570b6f3 as $vad5f82e879a9c5d6b5b442eb37e50551) {if (!$vad5f82e879a9c5d6b5b442eb37e50551 instanceof iDomain) {continue;}$this->domains[] = $vad5f82e879a9c5d6b5b442eb37e50551;$vd02a42d9cb3dec9320e5f550278911c7 = $vad5f82e879a9c5d6b5b442eb37e50551->getFavicon();if (!$vd02a42d9cb3dec9320e5f550278911c7 instanceof iUmiImageFile) {continue;}$this->addFiles([$vd02a42d9cb3dec9320e5f550278911c7->getFilePath()]);}}public function addLangs($v6d147279d84becb776690e8a5812f02c = []) {foreach ($v6d147279d84becb776690e8a5812f02c as $vf585b7f018bb4ced15a03683a733e50b) {if ($vf585b7f018bb4ced15a03683a733e50b instanceof iLang) {$vf585b7f018bb4ced15a03683a733e50b = $vf585b7f018bb4ced15a03683a733e50b->getId();}$this->langs[] = $vf585b7f018bb4ced15a03683a733e50b;}}public function addTemplates($v4334e531f3928afebdbe8f44febfc0fa = []) {foreach ($v4334e531f3928afebdbe8f44febfc0fa as $v3200a31fc05da4e9d5a0465c36822e2f) {if ($v3200a31fc05da4e9d5a0465c36822e2f instanceof iTemplate) {$v3200a31fc05da4e9d5a0465c36822e2f = $v3200a31fc05da4e9d5a0465c36822e2f->getId();}$this->templates[] = $v3200a31fc05da4e9d5a0465c36822e2f;}}public function addDataTypes($v9aed435cf9ba0f9ae44e92f61f1ade2f = []) {foreach ($v9aed435cf9ba0f9ae44e92f61f1ade2f as $v833750ac635fcc57dc33ecafe365f9a7) {if ($v833750ac635fcc57dc33ecafe365f9a7 instanceof iUmiFieldType) {$this->data_types[] = $v833750ac635fcc57dc33ecafe365f9a7->getId();}}}public function isCompleted() {return $this->completed;}public function needToExportAllModuleMethodPermissions() {$this->exportAllModuleMethodPermissions = true;}public function addEntities(array $v82524334d802a9f208f312b0f69a98d7) {$v91cf0798674b26be2387f6cf1f7ec2bb = [];$v8b1dc169bf460ee884fceef66c6607d6 = cmsController::getInstance();foreach ($v82524334d802a9f208f312b0f69a98d7 as $v0f096338b64a1d1b348b86df38313c01 => $v490989c86f3332dc089a7b994bd654c7) {if (isset($this->entities[$v0f096338b64a1d1b348b86df38313c01])) {$va4722ac0515113508bfb1659662a465e = $this->entities[$v0f096338b64a1d1b348b86df38313c01];$v2d2dee7af60385a060eae7f556845a8b = array_diff($va4722ac0515113508bfb1659662a465e, $v490989c86f3332dc089a7b994bd654c7);if (count($v2d2dee7af60385a060eae7f556845a8b) === 0) {continue;}$v490989c86f3332dc089a7b994bd654c7 = array_merge($va4722ac0515113508bfb1659662a465e, $v490989c86f3332dc089a7b994bd654c7);}$this->entities[$v0f096338b64a1d1b348b86df38313c01] = $v490989c86f3332dc089a7b994bd654c7;if ($v0f096338b64a1d1b348b86df38313c01 == 'modules_to_load') {foreach ($v490989c86f3332dc089a7b994bd654c7 as $v52a43e48ec4649dee819dadabcab1bde) {$v8b1dc169bf460ee884fceef66c6607d6->getModule($v52a43e48ec4649dee819dadabcab1bde);}continue;}$vaaabf0d39951f3e6c3e8a7911df524c2 = $this->getService($v0f096338b64a1d1b348b86df38313c01);if (!$vaaabf0d39951f3e6c3e8a7911df524c2 instanceof iExchange) {continue;}$v91cf0798674b26be2387f6cf1f7ec2bb[] = $vaaabf0d39951f3e6c3e8a7911df524c2->getDependenciesForExportMany($v490989c86f3332dc089a7b994bd654c7);}foreach ($v91cf0798674b26be2387f6cf1f7ec2bb as $v5004dd8dfcfc5598a022325dec4d0a13) {foreach ($v5004dd8dfcfc5598a022325dec4d0a13 as  $v90578a9bee637fcaaf4b60ac8b0b6566 => $vb56c340c9d5370389ac123c9ae3e2fba) {switch ($v90578a9bee637fcaaf4b60ac8b0b6566) {case 'TradeOfferCharacteristicExchange' : {break;}case 'TradeOfferPriceCurrencyExchange' :      case 'TradeStockExchange' :      case 'umiObjectExchange' : {$this->addObjects($vb56c340c9d5370389ac123c9ae3e2fba);break;}case 'umiObjectTypeExchange' : {$this->addTypes($vb56c340c9d5370389ac123c9ae3e2fba);break;}default : {$this->addEntities([        $v90578a9bee637fcaaf4b60ac8b0b6566 => $vb56c340c9d5370389ac123c9ae3e2fba       ]);}}}}}public function setFieldsAllowRuntimeAdd($v327a6c4304ad5938eaf0efb6cc3e53dc = true) {$this->fieldAllowRuntimeAdd = (bool) $v327a6c4304ad5938eaf0efb6cc3e53dc;return $this;}public function isAllowFieldsRuntimeAdd() {return $this->fieldAllowRuntimeAdd;}private function exportEntities() {$v7ea735bf6ee42197f385ca808aec65e5 = isset($this->entities['modules_to_load']) ? $this->entities['modules_to_load'] : [];$v0ffc9ad8303afce4216f05d62289e63c = array_values($v7ea735bf6ee42197f385ca808aec65e5);$v0ffc9ad8303afce4216f05d62289e63c = array_unique($v0ffc9ad8303afce4216f05d62289e63c);$v8b1dc169bf460ee884fceef66c6607d6 = cmsController::getInstance();foreach ($v0ffc9ad8303afce4216f05d62289e63c as $v22884db148f0ffb0d830ba431102b0b5) {$v8b1dc169bf460ee884fceef66c6607d6->getModule($v22884db148f0ffb0d830ba431102b0b5);}$v8e4a156539e5e358472044b3e46a1fa1 = $this->sortEntities($this->entities);foreach ($v8e4a156539e5e358472044b3e46a1fa1 as $v0f096338b64a1d1b348b86df38313c01 => $v5a2576254d428ddc22a03fac145c8749) {if ($v0f096338b64a1d1b348b86df38313c01 == 'modules_to_load') {continue;}try {$vaaabf0d39951f3e6c3e8a7911df524c2 = $this->getService($v0f096338b64a1d1b348b86df38313c01);if (!is_object($vaaabf0d39951f3e6c3e8a7911df524c2)) {$this->reportError(getLabel('error-no-collection-for-service', false, $vaaabf0d39951f3e6c3e8a7911df524c2));continue;}if ($vaaabf0d39951f3e6c3e8a7911df524c2 instanceof iExchange) {$v8e4a156539e5e358472044b3e46a1fa1 = $vaaabf0d39951f3e6c3e8a7911df524c2->exportMany($v5a2576254d428ddc22a03fac145c8749, $this);}else {$v21ffce5b8a6cc8cc6a41448dd69623c9 = (umiCount($v5a2576254d428ddc22a03fac145c8749) > 0) ? ['id' => $v5a2576254d428ddc22a03fac145c8749] : [];$v8e4a156539e5e358472044b3e46a1fa1 = $vaaabf0d39951f3e6c3e8a7911df524c2->export($v21ffce5b8a6cc8cc6a41448dd69623c9);}$v22884db148f0ffb0d830ba431102b0b5 = isset($v7ea735bf6ee42197f385ca808aec65e5[$v0f096338b64a1d1b348b86df38313c01]) ? $v7ea735bf6ee42197f385ca808aec65e5[$v0f096338b64a1d1b348b86df38313c01] : null;foreach ($v8e4a156539e5e358472044b3e46a1fa1 as $vf5e638cc78dd325906c1298a0c21fb6b) {$this->exportEntity($vf5e638cc78dd325906c1298a0c21fb6b, $v0f096338b64a1d1b348b86df38313c01, $v22884db148f0ffb0d830ba431102b0b5);}}catch (Exception $ve1671797c52e15f763380b45e841ec32) {$this->reportError($ve1671797c52e15f763380b45e841ec32->getMessage());}}}private function sortEntities(array $v8e4a156539e5e358472044b3e46a1fa1) {$v252a2033c08d95bc80a65377fb79d726 = [    'MailNotifications',    'MailTemplates',    'MailVariables',    'SlidersCollection',    'SlidesCollection',    'AppointmentServiceGroups',    'AppointmentServices',    'AppointmentEmployees',    'AppointmentEmployeesServices',    'AppointmentEmployeesSchedules',    'AppointmentOrders',    'TradeOfferPriceTypeExchange',    'TradeOfferExchange',    'TradeOfferPriceExchange',    'TradeStockBalanceExchange'   ];uksort($v8e4a156539e5e358472044b3e46a1fa1, function($v4cdf673ebc83583bc0f0733312fdc917, $vd57d0ed2065eb7e52b0d17e356abcd8c) use ($v252a2033c08d95bc80a65377fb79d726) {$v187ed39609834b28c1672092d1afe390 = array_search($v4cdf673ebc83583bc0f0733312fdc917, $v252a2033c08d95bc80a65377fb79d726);$vb0dcff78b85215bf94cb505561abb53e = array_search($vd57d0ed2065eb7e52b0d17e356abcd8c, $v252a2033c08d95bc80a65377fb79d726);if ($v187ed39609834b28c1672092d1afe390 === false || $vb0dcff78b85215bf94cb505561abb53e === false) {return 0;}if ($v187ed39609834b28c1672092d1afe390 === $vb0dcff78b85215bf94cb505561abb53e) {return 0;}return ($v187ed39609834b28c1672092d1afe390 > $vb0dcff78b85215bf94cb505561abb53e) ? 1 : -1;});return $v8e4a156539e5e358472044b3e46a1fa1;}private function getService($vb068931cc450442b63f5b3d276ea4297) {return Service::get($vb068931cc450442b63f5b3d276ea4297);}private function exportEntity(array $vf5e638cc78dd325906c1298a0c21fb6b, $vaaabf0d39951f3e6c3e8a7911df524c2, $v22884db148f0ffb0d830ba431102b0b5) {if (isset($this->exported_entities[$vaaabf0d39951f3e6c3e8a7911df524c2][$vf5e638cc78dd325906c1298a0c21fb6b['id']])) {return;}if ($this->isLimitExceeded()) {$this->break = true;return;}$v904392a19930b5c35e97bfd3c4dac307 = null;try {$v904392a19930b5c35e97bfd3c4dac307 = $this->generateEntityNode($vf5e638cc78dd325906c1298a0c21fb6b, $vaaabf0d39951f3e6c3e8a7911df524c2, $v22884db148f0ffb0d830ba431102b0b5);}catch (Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {$this->reportError($v42552b1f133f9f8eb406d4f306ea9fd1->getMessage());}if (!$v904392a19930b5c35e97bfd3c4dac307 instanceof DOMNode) {return;}$this->entities_container->appendChild($v904392a19930b5c35e97bfd3c4dac307);$this->exported_entities[$vaaabf0d39951f3e6c3e8a7911df524c2][$vf5e638cc78dd325906c1298a0c21fb6b['id']] = $vf5e638cc78dd325906c1298a0c21fb6b['id'];$this->position += 1;}private function generateEntityNode(array $vf5e638cc78dd325906c1298a0c21fb6b, $v0f096338b64a1d1b348b86df38313c01, $v22884db148f0ffb0d830ba431102b0b5) {$v904392a19930b5c35e97bfd3c4dac307 = $this->doc->createElement('entity');$vaaabf0d39951f3e6c3e8a7911df524c2 = $this->getService($v0f096338b64a1d1b348b86df38313c01);if ($vaaabf0d39951f3e6c3e8a7911df524c2 instanceof iUmiCollection) {$vaab9e1de16f38176f86d7a92ba337a8d = $vaaabf0d39951f3e6c3e8a7911df524c2->getMap()->get('EXCHANGE_RELATION_TABLE_NAME');$vb80bb7740288fda1f201890375a60c8f = $this->determineExternalEntityId($vf5e638cc78dd325906c1298a0c21fb6b['id'], $vaab9e1de16f38176f86d7a92ba337a8d);}else {$vb80bb7740288fda1f201890375a60c8f = $vf5e638cc78dd325906c1298a0c21fb6b['id'];}$v811ffe5ef7260e9e4ee22e29f304e00a = $this->doc->createAttribute('id');$v811ffe5ef7260e9e4ee22e29f304e00a->value = $vb80bb7740288fda1f201890375a60c8f;$v904392a19930b5c35e97bfd3c4dac307->appendChild($v811ffe5ef7260e9e4ee22e29f304e00a);$vdfb6cbe29434098b69802b064eba6a61 = $this->doc->createAttribute('service');$vdfb6cbe29434098b69802b064eba6a61->value = $v0f096338b64a1d1b348b86df38313c01;$v904392a19930b5c35e97bfd3c4dac307->appendChild($vdfb6cbe29434098b69802b064eba6a61);if ($v22884db148f0ffb0d830ba431102b0b5 !== null) {$v68b013b9a26ef92d7c04b8005e3b7564 = $this->doc->createAttribute('module');$v68b013b9a26ef92d7c04b8005e3b7564->value = $v22884db148f0ffb0d830ba431102b0b5;$v904392a19930b5c35e97bfd3c4dac307->appendChild($v68b013b9a26ef92d7c04b8005e3b7564);}if (in_array('entities', $this->installOnly)) {$v6a0f5c4a6f37a952264da4fd4ebd1ad9 = $this->doc->createAttribute('install-only');$v6a0f5c4a6f37a952264da4fd4ebd1ad9->value = '1';$v904392a19930b5c35e97bfd3c4dac307->appendChild($v6a0f5c4a6f37a952264da4fd4ebd1ad9);}$v74693d2fc58b46bd06410f278e39aa71 = $vf5e638cc78dd325906c1298a0c21fb6b;unset($v74693d2fc58b46bd06410f278e39aa71['id']);$this->translateEntity($v74693d2fc58b46bd06410f278e39aa71, $v904392a19930b5c35e97bfd3c4dac307);return $v904392a19930b5c35e97bfd3c4dac307;}private function determineExternalEntityId($v1c043be0eed6949c174fcf4359f7c601, $vaab9e1de16f38176f86d7a92ba337a8d) {$vb508148712cb53958c7e3d25ec86d72a = $this->getEntitySourceIdBinder();$v32a9d3c9a4b1449499e182e90d04fcc9 = $vb508148712cb53958c7e3d25ec86d72a->getExternalId($v1c043be0eed6949c174fcf4359f7c601, $vaab9e1de16f38176f86d7a92ba337a8d);if (!$v32a9d3c9a4b1449499e182e90d04fcc9) {$v32a9d3c9a4b1449499e182e90d04fcc9 = $v1c043be0eed6949c174fcf4359f7c601;$vb508148712cb53958c7e3d25ec86d72a->defineRelation($v32a9d3c9a4b1449499e182e90d04fcc9, $v1c043be0eed6949c174fcf4359f7c601, $vaab9e1de16f38176f86d7a92ba337a8d);}return $v32a9d3c9a4b1449499e182e90d04fcc9;}public function getEntitySourceIdBinder() {return $this->entityRelations;}public function execute() {if (getRequest('links') !== null) {$this->oldGetLinks = getRequest('links');unset($_REQUEST['links']);}$this->position = 0;$this->break = false;$v9a09b4dfda82e3e665e31092d1c3ec8d = new DOMDocument('1.0', 'utf-8');$v9a09b4dfda82e3e665e31092d1c3ec8d->formatOutput = XML_FORMAT_OUTPUT;$v63a9f0ea7bb98050796b649e85481845 = $v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('umidump');$v63a9f0ea7bb98050796b649e85481845->setAttribute('xmlns:xlink', 'http://www.w3.org/TR/xlink');$v2af72f100c356273d46284f6fd1dfc08 = $v9a09b4dfda82e3e665e31092d1c3ec8d->createAttribute('version');$v2af72f100c356273d46284f6fd1dfc08->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createTextNode(self::VERSION));$v63a9f0ea7bb98050796b649e85481845->appendChild($v2af72f100c356273d46284f6fd1dfc08);$v9a09b4dfda82e3e665e31092d1c3ec8d->appendChild($v63a9f0ea7bb98050796b649e85481845);$this->translator = new xmlTranslator($v9a09b4dfda82e3e665e31092d1c3ec8d);if ($this->showAllFields) {$ved2767f3d8b91be52c4cb22eb81a04b3 = xmlTranslator::$showHiddenFieldGroups;xmlTranslator::$showHiddenFieldGroups = true;$vcf90eeb77dd5c141a9e9b72790489e27 = xmlTranslator::$showUnsecureFields;xmlTranslator::$showUnsecureFields = true;}$v07d2e301ed1b9e6b89b58497f1810239 = umiObjectProperty::$IGNORE_CACHE;umiObjectProperty::$IGNORE_CACHE = true;$this->doc = $v9a09b4dfda82e3e665e31092d1c3ec8d;$this->root = $v63a9f0ea7bb98050796b649e85481845;$this->restoreState();$this->createGrid();$this->export();$this->saveState();if ($this->showAllFields) {xmlTranslator::$showHiddenFieldGroups = $ved2767f3d8b91be52c4cb22eb81a04b3;xmlTranslator::$showUnsecureFields = $vcf90eeb77dd5c141a9e9b72790489e27;}umiObjectProperty::$IGNORE_CACHE = $v07d2e301ed1b9e6b89b58497f1810239;if ($this->oldGetLinks !== null) {$_REQUEST['links'] = $this->oldGetLinks;}return $this->doc;}private function export() {if ($this->directories && !$this->break) {$this->exportDirs();}if ($this->files && !$this->break) {$this->exportFiles();}if ($this->langs && !$this->break) {$this->exportLangs();}if ($this->domains && !$this->break) {$this->exportDomains();}if ($this->templates && !$this->break) {$this->exportTemplates();}if ($this->data_types && !$this->break) {$this->exportDataTypes();}if ($this->types && !$this->break) {$this->exportTypes();}if ($this->elements && !$this->break) {$this->exportElements();}if ($this->objects && !$this->break) {$this->exportObjects();}if ($this->branches && !$this->break) {$this->exportBranches();}if ($this->restrictions && !$this->break) {$this->exportRestrictions();}if ($this->registry && !$this->break) {$this->exportRegs();}if (!$this->break) {$this->exportEntities();}if ($this->isNeedToExportAllModuleMethodPermissions()) {$this->exportModuleMethodPermissions();}$this->completed = !$this->break;$this->exportMetaBranches();}private function exportMetaBranches() {if (umiCount($this->branches) && $this->completed) {$va94b1cd87257175251e68dc9ecf58242 = [];foreach ($this->branches as $v53eaf2ccc6a17c161589fabc2352eb5b) {if (isset($this->exported_elements[$v53eaf2ccc6a17c161589fabc2352eb5b]) && $this->exported_elements[$v53eaf2ccc6a17c161589fabc2352eb5b] != 'found') {$v53eaf2ccc6a17c161589fabc2352eb5b = $this->exported_elements[$v53eaf2ccc6a17c161589fabc2352eb5b];}$va94b1cd87257175251e68dc9ecf58242[] = $v53eaf2ccc6a17c161589fabc2352eb5b;}$v42fb42be9c2ff0c053e34da7049ed27d = $this->doc->createElement('branches');$this->translateEntity(['nodes:id' => $va94b1cd87257175251e68dc9ecf58242], $v42fb42be9c2ff0c053e34da7049ed27d);$this->meta_container->appendChild($v42fb42be9c2ff0c053e34da7049ed27d);}}protected function createDateSection($vd7e6d55ba379a13d08c25d15faf2a23b, DOMElement $v5f0b6ebc4bea10285ba2b8a6ce78b863) {$v9a09b4dfda82e3e665e31092d1c3ec8d = $this->doc;$v5fc732311905cb27e82d67f4f6511f7f = new umiDate($vd7e6d55ba379a13d08c25d15faf2a23b);$ve8852004f543928290b9de4f99c9a7c0 = $v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('timestamp');$ve8852004f543928290b9de4f99c9a7c0->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createTextNode($v5fc732311905cb27e82d67f4f6511f7f->getFormattedDate('U')));$v5f0b6ebc4bea10285ba2b8a6ce78b863->appendChild($ve8852004f543928290b9de4f99c9a7c0);$v976db921e242a0600e07471cc510d8f1 = $v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('rfc');$v976db921e242a0600e07471cc510d8f1->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createTextNode($v5fc732311905cb27e82d67f4f6511f7f->getFormattedDate('r')));$v5f0b6ebc4bea10285ba2b8a6ce78b863->appendChild($v976db921e242a0600e07471cc510d8f1);$v5b3c5210817c904689dd3d88ecb40e5a = $v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('utc');$v5b3c5210817c904689dd3d88ecb40e5a->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createTextNode($v5fc732311905cb27e82d67f4f6511f7f->getFormattedDate(DATE_ATOM)));$v5f0b6ebc4bea10285ba2b8a6ce78b863->appendChild($v5b3c5210817c904689dd3d88ecb40e5a);return $v5f0b6ebc4bea10285ba2b8a6ce78b863;}protected function createGrid() {$vfdc3bdefb79cec8eb8211d2499e04704 = $this->doc;$this->meta_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('meta');$this->root->appendChild($this->meta_container);$this->exportMeta();$this->registry_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('registry');$this->root->appendChild($this->registry_container);$this->dirs_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('directories');$this->root->appendChild($this->dirs_container);$this->files_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('files');$this->root->appendChild($this->files_container);$this->langs_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('langs');$this->root->appendChild($this->langs_container);$this->domains_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('domains');$this->root->appendChild($this->domains_container);$this->templates_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('templates');$this->root->appendChild($this->templates_container);$this->data_types_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('datatypes');$this->root->appendChild($this->data_types_container);$this->types_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('types');$this->root->appendChild($this->types_container);$this->objects_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('objects');$this->root->appendChild($this->objects_container);$this->pages_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('pages');$this->root->appendChild($this->pages_container);$this->entities_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('entities');$this->root->appendChild($this->entities_container);$this->relations_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('relations');$this->root->appendChild($this->relations_container);$this->options_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('options');$this->root->appendChild($this->options_container);$this->restrictions_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('restrictions');$this->root->appendChild($this->restrictions_container);$this->permissions_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('permissions');$this->root->appendChild($this->permissions_container);$this->hierarchy_container = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('hierarchy');$this->root->appendChild($this->hierarchy_container);}private function exportMeta() {$vfdc3bdefb79cec8eb8211d2499e04704 = $this->doc;$vad5f82e879a9c5d6b5b442eb37e50551 = Service::DomainDetector()->detect();$v7572559ca86e781ba8fe8073a0b725c6 = Service::LanguageDetector()->detect();$v1b33d8364c736929e7a40bd04f138194 = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('site-name');$v1b33d8364c736929e7a40bd04f138194->appendChild($vfdc3bdefb79cec8eb8211d2499e04704->createCDATASection(def_module::parseTPLMacroses(macros_sitename())));$this->meta_container->appendChild($v1b33d8364c736929e7a40bd04f138194);$v204aadf644884156d194b4fccb7a101a = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('domain');$v204aadf644884156d194b4fccb7a101a->appendChild($vfdc3bdefb79cec8eb8211d2499e04704->createCDATASection($vad5f82e879a9c5d6b5b442eb37e50551->getHost()));$this->meta_container->appendChild($v204aadf644884156d194b4fccb7a101a);$va24bcccab40205d7e681050e137f6c99 = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('lang');$va24bcccab40205d7e681050e137f6c99->appendChild($vfdc3bdefb79cec8eb8211d2499e04704->createCDATASection($v7572559ca86e781ba8fe8073a0b725c6->getPrefix()));$this->meta_container->appendChild($va24bcccab40205d7e681050e137f6c99);$v9256e115e735ddbb83fa6787fafde4bd = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('source-name');$v7c95caafbd5e4b5db3977617a0498de6 = $this->source_name ?: md5($vad5f82e879a9c5d6b5b442eb37e50551->getId() . $v7572559ca86e781ba8fe8073a0b725c6->getId());$v9256e115e735ddbb83fa6787fafde4bd->appendChild($vfdc3bdefb79cec8eb8211d2499e04704->createCDATASection($v7c95caafbd5e4b5db3977617a0498de6));$this->meta_container->appendChild($v9256e115e735ddbb83fa6787fafde4bd);$vbd80c856be87c219363221dc9be1c2e2 = $vfdc3bdefb79cec8eb8211d2499e04704->createElement('generate-time');$this->createDateSection(time(), $vbd80c856be87c219363221dc9be1c2e2);$this->meta_container->appendChild($vbd80c856be87c219363221dc9be1c2e2);}protected function translateEntity($vf5e638cc78dd325906c1298a0c21fb6b, $v5f0b6ebc4bea10285ba2b8a6ce78b863) {$this->translator->chooseTranslator($v5f0b6ebc4bea10285ba2b8a6ce78b863, $vf5e638cc78dd325906c1298a0c21fb6b, $this->getOptionList());}private function getOptionList() {return $this->serializeOptionList;}protected function exportFiles() {foreach ($this->files as $v8c7dd922ad47494fc02c388e12c00eac) {$this->exportFile($v8c7dd922ad47494fc02c388e12c00eac);}if ($this->destination) {$vf35596be31d40176826fce6b837a9ddc = new umiDirectory($this->destination);$v00c9a807e725e6d86bde261aa73866a8 = $vf35596be31d40176826fce6b837a9ddc->getFSObjects(2);foreach ($v00c9a807e725e6d86bde261aa73866a8 as $v736007832d2167baaae763fd3a3f3cf1) {chmod($v736007832d2167baaae763fd3a3f3cf1, 0777);}}}protected function exportFile(umiFile $v8c7dd922ad47494fc02c388e12c00eac) {$vd6fe1d0be6347b8ef2427fa629c04485 = $v8c7dd922ad47494fc02c388e12c00eac->getFilePath();if (isset($this->exported_files[$vd6fe1d0be6347b8ef2427fa629c04485])) {return false;}if ($this->isLimitExceeded()) {$this->break = true;return false;}$v3ded0fa90fac2901571c95109308f187 = $this->doc->createElement('file');$this->files_container->appendChild($v3ded0fa90fac2901571c95109308f187);$this->translateEntity($v8c7dd922ad47494fc02c388e12c00eac, $v3ded0fa90fac2901571c95109308f187);$v0800fc577294c34e0b28ad2839435945 = md5_file($vd6fe1d0be6347b8ef2427fa629c04485);$v4493ba1ac6e2a63455acda96db3da768 = $this->doc->createAttribute('hash');$v3ded0fa90fac2901571c95109308f187->appendChild($v4493ba1ac6e2a63455acda96db3da768);$va14ef8ab1dc3a33642fcbdc20b856dbb = $this->doc->createTextNode("{$v0800fc577294c34e0b28ad2839435945}");$v4493ba1ac6e2a63455acda96db3da768->appendChild($va14ef8ab1dc3a33642fcbdc20b856dbb);$v5b063e275d506f65ebf1b02d926f19a4 = $v8c7dd922ad47494fc02c388e12c00eac->getFileName();$vc29a0c0bef824ee1691bc91da9b60bb7 = $this->doc->createAttribute('name');$v3ded0fa90fac2901571c95109308f187->appendChild($vc29a0c0bef824ee1691bc91da9b60bb7);$v7affb12a524a065ba5ff47dc80e5bd68 = $this->doc->createTextNode("{$v5b063e275d506f65ebf1b02d926f19a4}");$vc29a0c0bef824ee1691bc91da9b60bb7->appendChild($v7affb12a524a065ba5ff47dc80e5bd68);if ($this->destination) {$v47826cacc65c665212b821e6ff80b9b0 = $this->destination . $v8c7dd922ad47494fc02c388e12c00eac->getFilePath(true);$vaedcc8bf00dbfd959b5898fe1e21c7ab = dirname($v47826cacc65c665212b821e6ff80b9b0);if (!file_exists($vaedcc8bf00dbfd959b5898fe1e21c7ab)) {mkdir($vaedcc8bf00dbfd959b5898fe1e21c7ab, 0777, true);}if (copy($vd6fe1d0be6347b8ef2427fa629c04485, $v47826cacc65c665212b821e6ff80b9b0)) {chmod($v47826cacc65c665212b821e6ff80b9b0, 0777);}else {$this->reportError("File \"{$vd6fe1d0be6347b8ef2427fa629c04485} \" cannot be copied to \"{$v47826cacc65c665212b821e6ff80b9b0}\"");}}else {$this->reportError('Files cannot be copied because destination folder isn\'t defined');}$this->exported_files[$vd6fe1d0be6347b8ef2427fa629c04485] = $vd6fe1d0be6347b8ef2427fa629c04485;$this->position++;return true;}private function isLimitExceeded() {return $this->limit && ($this->position >= $this->limit);}protected function exportDirs() {foreach ($this->directories as $v5f8f22b8cdbaeee8cf857673a9b6ba20) {$this->exportDir($v5f8f22b8cdbaeee8cf857673a9b6ba20);}}protected function exportDir(umiDirectory $v5f8f22b8cdbaeee8cf857673a9b6ba20) {$vd6fe1d0be6347b8ef2427fa629c04485 = $v5f8f22b8cdbaeee8cf857673a9b6ba20->getPath();$v651fd5d791e56187822de080423fe012 = ltrim($vd6fe1d0be6347b8ef2427fa629c04485, '.');if (isset($this->exported_dirs[$vd6fe1d0be6347b8ef2427fa629c04485])) {return false;}if ($this->isLimitExceeded()) {$this->break = true;return false;}$v5ad71e29dde7915da6a5874921360908 = $this->doc->createElement('directory', $v651fd5d791e56187822de080423fe012);$this->dirs_container->appendChild($v5ad71e29dde7915da6a5874921360908);$v5ad71e29dde7915da6a5874921360908->setAttribute('path', $vd6fe1d0be6347b8ef2427fa629c04485);$v5ad71e29dde7915da6a5874921360908->setAttribute('name', $v5f8f22b8cdbaeee8cf857673a9b6ba20->getName());$this->exported_dirs[$vd6fe1d0be6347b8ef2427fa629c04485] = $vd6fe1d0be6347b8ef2427fa629c04485;$this->position++;return true;}protected function exportLangs() {foreach ($this->langs as $vf585b7f018bb4ced15a03683a733e50b) {$this->exportLang($vf585b7f018bb4ced15a03683a733e50b);}}protected function exportLang($vf585b7f018bb4ced15a03683a733e50b) {if (isset($this->exported_langs[$vf585b7f018bb4ced15a03683a733e50b])) {return false;}if ($this->isLimitExceeded()) {$this->break = true;return false;}$v7572559ca86e781ba8fe8073a0b725c6 = Service::LanguageCollection()->getLang($vf585b7f018bb4ced15a03683a733e50b);$va24bcccab40205d7e681050e137f6c99 = $this->doc->createElement('lang');$this->translateEntity($v7572559ca86e781ba8fe8073a0b725c6, $va24bcccab40205d7e681050e137f6c99);$v55203ad3e645c98492df0c94caf19b93 = $this->relations->getOldLangIdRelation($this->source_id, $vf585b7f018bb4ced15a03683a733e50b);if ($v55203ad3e645c98492df0c94caf19b93 === false) {$this->relations->setLangIdRelation($this->source_id, $vf585b7f018bb4ced15a03683a733e50b, $vf585b7f018bb4ced15a03683a733e50b);$v55203ad3e645c98492df0c94caf19b93 = $vf585b7f018bb4ced15a03683a733e50b;}else {$va24bcccab40205d7e681050e137f6c99->setAttribute('id', $v55203ad3e645c98492df0c94caf19b93);}if (in_array('langs', $this->installOnly)) {$v6a0f5c4a6f37a952264da4fd4ebd1ad9 = $this->doc->createAttribute('install-only');$v6a0f5c4a6f37a952264da4fd4ebd1ad9->value = '1';$va24bcccab40205d7e681050e137f6c99->appendChild($v6a0f5c4a6f37a952264da4fd4ebd1ad9);}$this->langs_container->appendChild($va24bcccab40205d7e681050e137f6c99);$this->exported_langs[$vf585b7f018bb4ced15a03683a733e50b] = $v55203ad3e645c98492df0c94caf19b93;$this->position++;return true;}protected function exportDomains() {foreach ($this->domains as $vad5f82e879a9c5d6b5b442eb37e50551) {$this->exportDomain($vad5f82e879a9c5d6b5b442eb37e50551);}}protected function exportDomain(iDomain $vad5f82e879a9c5d6b5b442eb37e50551) {$v72ee76c5c29383b7c9f9225c1fa4d10b = $vad5f82e879a9c5d6b5b442eb37e50551->getId();if (isset($this->exported_domains[$v72ee76c5c29383b7c9f9225c1fa4d10b])) {return false;}if ($this->isLimitExceeded()) {$this->break = true;return false;}$v204aadf644884156d194b4fccb7a101a = $this->doc->createElement('domain');$this->translateEntity($vad5f82e879a9c5d6b5b442eb37e50551, $v204aadf644884156d194b4fccb7a101a);$v92bfc705285f36f484ee5b057b290d24 = $this->relations->getOldDomainIdRelation($this->source_id, $v72ee76c5c29383b7c9f9225c1fa4d10b);if ($v92bfc705285f36f484ee5b057b290d24 === false) {$this->relations->setDomainIdRelation($this->source_id, $v72ee76c5c29383b7c9f9225c1fa4d10b, $v72ee76c5c29383b7c9f9225c1fa4d10b);$v92bfc705285f36f484ee5b057b290d24 = $v72ee76c5c29383b7c9f9225c1fa4d10b;}else {$v204aadf644884156d194b4fccb7a101a->setAttribute('id', $v92bfc705285f36f484ee5b057b290d24);}if (in_array('domains', $this->installOnly)) {$v6a0f5c4a6f37a952264da4fd4ebd1ad9 = $this->doc->createAttribute('install-only');$v6a0f5c4a6f37a952264da4fd4ebd1ad9->value = '1';$v204aadf644884156d194b4fccb7a101a->appendChild($v6a0f5c4a6f37a952264da4fd4ebd1ad9);}$vf585b7f018bb4ced15a03683a733e50b = $vad5f82e879a9c5d6b5b442eb37e50551->getDefaultLangId();if ($this->exportLang($vf585b7f018bb4ced15a03683a733e50b)) {if ($this->isLimitExceeded()) {$this->break = true;return true;}}$v55203ad3e645c98492df0c94caf19b93 = $this->relations->getOldLangIdRelation($this->source_id, $vf585b7f018bb4ced15a03683a733e50b);$v204aadf644884156d194b4fccb7a101a->setAttribute('lang-id', $v55203ad3e645c98492df0c94caf19b93);$v7f8de18d94866ec275e97fa816e10897 = $vad5f82e879a9c5d6b5b442eb37e50551->getMirrorsList();foreach ($v7f8de18d94866ec275e97fa816e10897 as $v95be0a2e6132b4fa2294808f7dbcc52a) {$ve66673bf13d4f6427125f5380df0ecb7 = $this->doc->createElement('domain-mirror');$v204aadf644884156d194b4fccb7a101a->appendChild($ve66673bf13d4f6427125f5380df0ecb7);$this->translateEntity($v95be0a2e6132b4fa2294808f7dbcc52a, $ve66673bf13d4f6427125f5380df0ecb7);$v13c1f5c5e4829e276308259711c5bd33 = $v95be0a2e6132b4fa2294808f7dbcc52a->getId();$v084d54c01425a31b4d1f0e253bfede26 = $this->relations->getOldDomainMirrorIdRelation($this->source_id, $v13c1f5c5e4829e276308259711c5bd33);if ($v084d54c01425a31b4d1f0e253bfede26 === false) {$this->relations->setDomainMirrorIdRelation($this->source_id, $v13c1f5c5e4829e276308259711c5bd33, $v13c1f5c5e4829e276308259711c5bd33);}else {$ve66673bf13d4f6427125f5380df0ecb7->setAttribute('id', $v084d54c01425a31b4d1f0e253bfede26);}}$this->domains_container->appendChild($v204aadf644884156d194b4fccb7a101a);$this->exported_domains[$v72ee76c5c29383b7c9f9225c1fa4d10b] = $v92bfc705285f36f484ee5b057b290d24;$this->position++;return true;}protected function exportTemplates() {foreach ($this->templates as $v3200a31fc05da4e9d5a0465c36822e2f) {$this->exportTemplate($v3200a31fc05da4e9d5a0465c36822e2f);}}protected function exportTemplate($v3200a31fc05da4e9d5a0465c36822e2f) {$v66f6181bcb4cff4cd38fbc804a036db6 = templatesCollection::getInstance()->getTemplate($v3200a31fc05da4e9d5a0465c36822e2f);if (isset($this->exported_templates[$v3200a31fc05da4e9d5a0465c36822e2f])) {return false;}if ($this->isLimitExceeded()) {$this->break = true;return false;}$v01947397aa2c441e93a8f772847d5aca = $this->doc->createElement('template');$this->translateEntity($v66f6181bcb4cff4cd38fbc804a036db6, $v01947397aa2c441e93a8f772847d5aca);$vcb228da22e90f3b044818fec501f8979 = $this->relations->getOldTemplateIdRelation($this->source_id, $v3200a31fc05da4e9d5a0465c36822e2f);if ($vcb228da22e90f3b044818fec501f8979 === false) {$this->relations->setTemplateIdRelation($this->source_id, $v3200a31fc05da4e9d5a0465c36822e2f, $v3200a31fc05da4e9d5a0465c36822e2f);$vcb228da22e90f3b044818fec501f8979 = $v3200a31fc05da4e9d5a0465c36822e2f;}else {$v01947397aa2c441e93a8f772847d5aca->setAttribute('id', $vcb228da22e90f3b044818fec501f8979);}if (in_array('templates', $this->installOnly)) {$v6a0f5c4a6f37a952264da4fd4ebd1ad9 = $this->doc->createAttribute('install-only');$v6a0f5c4a6f37a952264da4fd4ebd1ad9->value = '1';$v01947397aa2c441e93a8f772847d5aca->appendChild($v6a0f5c4a6f37a952264da4fd4ebd1ad9);}$vf585b7f018bb4ced15a03683a733e50b = $v66f6181bcb4cff4cd38fbc804a036db6->getLangId();if ($this->exportLang($vf585b7f018bb4ced15a03683a733e50b)) {if ($this->isLimitExceeded()) {$this->break = true;return true;}}$v55203ad3e645c98492df0c94caf19b93 = $this->relations->getOldLangIdRelation($this->source_id, $vf585b7f018bb4ced15a03683a733e50b);$v01947397aa2c441e93a8f772847d5aca->setAttribute('lang-id', $v55203ad3e645c98492df0c94caf19b93);$v72ee76c5c29383b7c9f9225c1fa4d10b = $v66f6181bcb4cff4cd38fbc804a036db6->getDomainId();$vad5f82e879a9c5d6b5b442eb37e50551 = Service::DomainCollection()->getDomain($v72ee76c5c29383b7c9f9225c1fa4d10b);if ($this->exportDomain($vad5f82e879a9c5d6b5b442eb37e50551)) {if ($this->isLimitExceeded()) {$this->break = true;return true;}}$v92bfc705285f36f484ee5b057b290d24 = $this->relations->getOldDomainIdRelation($this->source_id, $v72ee76c5c29383b7c9f9225c1fa4d10b);$v01947397aa2c441e93a8f772847d5aca->setAttribute('domain-id', $v92bfc705285f36f484ee5b057b290d24);$this->templates_container->appendChild($v01947397aa2c441e93a8f772847d5aca);$this->exported_templates[$v3200a31fc05da4e9d5a0465c36822e2f] = $vcb228da22e90f3b044818fec501f8979;$this->position++;return true;}protected function exportDataTypes() {foreach ($this->data_types as $v5f694956811487225d15e973ca38fbab) {if ($this->break) {return;}$this->exportDataType($v5f694956811487225d15e973ca38fbab);}}protected function exportDataType($v5f694956811487225d15e973ca38fbab) {$v599dcce2998a6b40b1e38e8c6006cb0a = umiFieldTypesCollection::getInstance()->getFieldType($v5f694956811487225d15e973ca38fbab);if (!$v599dcce2998a6b40b1e38e8c6006cb0a instanceof iUmiFieldType) {return false;}if (isset($this->exported_data_types[$v5f694956811487225d15e973ca38fbab])) {return false;}if ($this->isLimitExceeded()) {$this->break = true;return false;}$v8e426de3bfa4efd7556ed624ebae4c29 = $this->doc->createElement('datatype');$this->data_types_container->appendChild($v8e426de3bfa4efd7556ed624ebae4c29);$this->translateEntity($v599dcce2998a6b40b1e38e8c6006cb0a, $v8e426de3bfa4efd7556ed624ebae4c29);$v8e426de3bfa4efd7556ed624ebae4c29->removeAttribute('id');$this->exported_data_types[$v5f694956811487225d15e973ca38fbab] = $v5f694956811487225d15e973ca38fbab;}protected function exportTypes() {foreach ($this->types as $v5f694956811487225d15e973ca38fbab) {$this->exportType($v5f694956811487225d15e973ca38fbab);}}protected function exportType($v5f694956811487225d15e973ca38fbab) {$v599dcce2998a6b40b1e38e8c6006cb0a = umiObjectTypesCollection::getInstance()->getType($v5f694956811487225d15e973ca38fbab);if (!$v599dcce2998a6b40b1e38e8c6006cb0a instanceof iUmiObjectType) {return false;}if (isset($this->exported_types[$v5f694956811487225d15e973ca38fbab])) {return false;}if ($this->isLimitExceeded()) {$this->break = true;return false;}$this->exported_types[$v5f694956811487225d15e973ca38fbab] = 'found';$va08f2aee9de301619776deb6fee83e50 = $v599dcce2998a6b40b1e38e8c6006cb0a->getParentId();if ($va08f2aee9de301619776deb6fee83e50) {if ($this->exportType($va08f2aee9de301619776deb6fee83e50)) {if ($this->isLimitExceeded()) {$this->break = true;return true;}}}$v8d90d57cd5d62bf377f6f8bc0cffc325 = $this->doc->createElement('type');$this->translateEntity($v599dcce2998a6b40b1e38e8c6006cb0a, $v8d90d57cd5d62bf377f6f8bc0cffc325);$v684e7fcd9c20d41a3074eb495fe91a7f = $this->relations->getOldTypeIdRelation($this->source_id, $v5f694956811487225d15e973ca38fbab);if (!$v684e7fcd9c20d41a3074eb495fe91a7f) {$v684e7fcd9c20d41a3074eb495fe91a7f = ($v5f694956811487225d15e973ca38fbab == self::$ROOT_PAGE_TYPE_ID) ? '{root-pages-type}' : $v5f694956811487225d15e973ca38fbab;$this->relations->setTypeIdRelation($this->source_id, $v684e7fcd9c20d41a3074eb495fe91a7f, $v5f694956811487225d15e973ca38fbab);}$v8d90d57cd5d62bf377f6f8bc0cffc325->setAttribute('id', $v684e7fcd9c20d41a3074eb495fe91a7f);if (in_array('types', $this->installOnly)) {$v6a0f5c4a6f37a952264da4fd4ebd1ad9 = $this->doc->createAttribute('install-only');$v6a0f5c4a6f37a952264da4fd4ebd1ad9->value = '1';$v8d90d57cd5d62bf377f6f8bc0cffc325->appendChild($v6a0f5c4a6f37a952264da4fd4ebd1ad9);}$va08f2aee9de301619776deb6fee83e50 = $v599dcce2998a6b40b1e38e8c6006cb0a->getParentId();if ($va08f2aee9de301619776deb6fee83e50) {$v1d282ed34f8261ef8e0ba79eb0fe86db = $this->relations->getOldTypeIdRelation($this->source_id, $va08f2aee9de301619776deb6fee83e50);if ($v1d282ed34f8261ef8e0ba79eb0fe86db === false) {$v1d282ed34f8261ef8e0ba79eb0fe86db = ($va08f2aee9de301619776deb6fee83e50 == self::$ROOT_PAGE_TYPE_ID) ? '{root-pages-type}' : $va08f2aee9de301619776deb6fee83e50;$this->relations->setTypeIdRelation($this->source_id, $v1d282ed34f8261ef8e0ba79eb0fe86db, $va08f2aee9de301619776deb6fee83e50);}$v8d90d57cd5d62bf377f6f8bc0cffc325->setAttribute('parent-id', $v1d282ed34f8261ef8e0ba79eb0fe86db);}$v3643b86326b2ffcc0a085b4dd3a4309b = new DOMXPath($this->doc);if ($v3643b86326b2ffcc0a085b4dd3a4309b->evaluate('base', $v8d90d57cd5d62bf377f6f8bc0cffc325)->length) {$v4904a1709d167d8260637d0bff1213b2 = $v3643b86326b2ffcc0a085b4dd3a4309b->evaluate('base', $v8d90d57cd5d62bf377f6f8bc0cffc325)->item(0);$v4904a1709d167d8260637d0bff1213b2->removeAttribute('id');}foreach ($v3643b86326b2ffcc0a085b4dd3a4309b->evaluate('fieldgroups/group', $v8d90d57cd5d62bf377f6f8bc0cffc325) as $va675fe51a42ad86a342be910e8266321) {$v47db2588331bbe530c80dd001fc60aed = $va675fe51a42ad86a342be910e8266321->getAttribute('id');$v7617417dc7eb3bbc463bf3c66d341d7b = $v599dcce2998a6b40b1e38e8c6006cb0a->getFieldsGroup($v47db2588331bbe530c80dd001fc60aed, true);if (!$v7617417dc7eb3bbc463bf3c66d341d7b instanceof iUmiFieldsGroup) {continue;}if ($v7617417dc7eb3bbc463bf3c66d341d7b->getIsActive()) {$va675fe51a42ad86a342be910e8266321->setAttribute('active', 'active');}else {$va675fe51a42ad86a342be910e8266321->setAttribute('active', '0');}if (!$v7617417dc7eb3bbc463bf3c66d341d7b->getIsVisible()) {$va675fe51a42ad86a342be910e8266321->setAttribute('visible', '0');}$va675fe51a42ad86a342be910e8266321->removeAttribute('id');}$v5df80bc8ce306a564d91fa6a4da3d95b = [];$v8797e64b0b663bbad43134e3003a4ef4 = umiFieldsCollection::getInstance();foreach ($v3643b86326b2ffcc0a085b4dd3a4309b->evaluate('fieldgroups/group/field', $v8d90d57cd5d62bf377f6f8bc0cffc325) as $v89a2007e7c15e80c35f21ea4a4540700) {$v945100186b119048837b9859c2c46410 = (int) $v89a2007e7c15e80c35f21ea4a4540700->getAttribute('id');$v972bf3f05d14ffbdb817bef60638ff00 = $v89a2007e7c15e80c35f21ea4a4540700->getAttribute('name');$v5f01d4e9bac164e092ef889df385bd84 = $this->relations->getOldFieldName($this->source_id, $v5f694956811487225d15e973ca38fbab, $v945100186b119048837b9859c2c46410);if ($v5f01d4e9bac164e092ef889df385bd84 === false) {$this->relations->setFieldIdRelation($this->source_id, $v5f694956811487225d15e973ca38fbab, $v972bf3f05d14ffbdb817bef60638ff00, $v945100186b119048837b9859c2c46410);$v5f01d4e9bac164e092ef889df385bd84 = $v972bf3f05d14ffbdb817bef60638ff00;}else {$v89a2007e7c15e80c35f21ea4a4540700->setAttribute('name', $v5f01d4e9bac164e092ef889df385bd84);}if ($v89a2007e7c15e80c35f21ea4a4540700->getElementsByTagName('restriction')->length) {$v6563beab5cccca8f6f85c970522cb0ba = $v89a2007e7c15e80c35f21ea4a4540700->getElementsByTagName('restriction')->item(0);$v6b1a57fa235477758817df3c91158006 = $v6563beab5cccca8f6f85c970522cb0ba->getAttribute('id');$this->restrictions[] = $v6b1a57fa235477758817df3c91158006;$this->restricted_fields[] = [      'restriction-id' => $v6b1a57fa235477758817df3c91158006,      'field-name' => $v5f01d4e9bac164e092ef889df385bd84,      'type-id' => $v684e7fcd9c20d41a3074eb495fe91a7f,     ];$v6563beab5cccca8f6f85c970522cb0ba->removeAttribute('field-type-id');}$v52eb29c6d8ea0d3a5bb3654f49bbd7c7 = $v89a2007e7c15e80c35f21ea4a4540700->hasAttribute('guide-id') ? $v89a2007e7c15e80c35f21ea4a4540700->getAttribute('guide-id') : false;if ($v52eb29c6d8ea0d3a5bb3654f49bbd7c7 && $this->includeGuidesEnabled) {$vff3b49d87db7279f471e6529a2f49786 = $this->doc->createElement('guide');$vff3b49d87db7279f471e6529a2f49786->setAttribute('id', $v52eb29c6d8ea0d3a5bb3654f49bbd7c7);foreach ($this->getItems($v52eb29c6d8ea0d3a5bb3654f49bbd7c7, ['id', 'name']) as $va8cfde6331bd59eb2ac96f8911c4b666) {$vdafb8b287b8f84de951377d662f0bb07 = $this->doc->createElement('item');$vdafb8b287b8f84de951377d662f0bb07->setAttribute('id', $va8cfde6331bd59eb2ac96f8911c4b666['id']);$vdafb8b287b8f84de951377d662f0bb07->setAttribute('name', $va8cfde6331bd59eb2ac96f8911c4b666['name']);$v947741478fc66ed325eff559b08dde17 = umiImportRelations::getInstance();$v60f1e5fd53d554dae3ff39cb9ea22f9f = $v947741478fc66ed325eff559b08dde17->getOldObjectIdRelation(       $v947741478fc66ed325eff559b08dde17->getSourceId(self::RELATED_IMPORT_FORMAT),       $va8cfde6331bd59eb2ac96f8911c4b666['id']      );$vdafb8b287b8f84de951377d662f0bb07->setAttribute('relation', $v60f1e5fd53d554dae3ff39cb9ea22f9f);$vff3b49d87db7279f471e6529a2f49786->appendChild($vdafb8b287b8f84de951377d662f0bb07);}$v89a2007e7c15e80c35f21ea4a4540700->appendChild($vff3b49d87db7279f471e6529a2f49786);}if ($v52eb29c6d8ea0d3a5bb3654f49bbd7c7 && (!$this->ignoreRelations || in_array('guides', $this->saveRelations))) {if ($this->exportType($v52eb29c6d8ea0d3a5bb3654f49bbd7c7)) {if ($this->isLimitExceeded()) {$this->break = true;return true;}}if ($this->objects) {$v8be74552df93e31bbdd6b36ed74bdb6a = new selector('objects');$v8be74552df93e31bbdd6b36ed74bdb6a->types('object-type')->id($v52eb29c6d8ea0d3a5bb3654f49bbd7c7);$v8be74552df93e31bbdd6b36ed74bdb6a->option('return')->value('id');foreach ((array) $v8be74552df93e31bbdd6b36ed74bdb6a->result() as $va8cfde6331bd59eb2ac96f8911c4b666) {if (!in_array($va8cfde6331bd59eb2ac96f8911c4b666['id'], $this->objects)) {$this->objects[] = $va8cfde6331bd59eb2ac96f8911c4b666['id'];}}}$v05931a7b2453ca0d80978f019912b849 = $this->relations->getOldTypeIdRelation($this->source_id, $v52eb29c6d8ea0d3a5bb3654f49bbd7c7);$v89a2007e7c15e80c35f21ea4a4540700->setAttribute('guide-id', $v05931a7b2453ca0d80978f019912b849);$vf03ad9e4ebc731946c49a47a1a26925d = $this->doc->createElement('relation');$vf03ad9e4ebc731946c49a47a1a26925d->setAttribute('type-id', $v684e7fcd9c20d41a3074eb495fe91a7f);$vf03ad9e4ebc731946c49a47a1a26925d->setAttribute('field-name', $v5f01d4e9bac164e092ef889df385bd84);$vff3b49d87db7279f471e6529a2f49786 = $this->doc->createElement('guide');$vff3b49d87db7279f471e6529a2f49786->setAttribute('id', $v05931a7b2453ca0d80978f019912b849);$vf03ad9e4ebc731946c49a47a1a26925d->appendChild($vff3b49d87db7279f471e6529a2f49786);$v5df80bc8ce306a564d91fa6a4da3d95b[] = $vf03ad9e4ebc731946c49a47a1a26925d;}if ($v89a2007e7c15e80c35f21ea4a4540700->getElementsByTagName('type')->length) {$v833750ac635fcc57dc33ecafe365f9a7 = $v89a2007e7c15e80c35f21ea4a4540700->getElementsByTagName('type')->item(0);$v833750ac635fcc57dc33ecafe365f9a7->removeAttribute('id');}$vce6ba6b4afd61be6d0f21f1e2a995213 = $v8797e64b0b663bbad43134e3003a4ef4->getField($v945100186b119048837b9859c2c46410);if ($vce6ba6b4afd61be6d0f21f1e2a995213->getIsSystem()) {$v89a2007e7c15e80c35f21ea4a4540700->setAttribute('system', 'system');}if ($vce6ba6b4afd61be6d0f21f1e2a995213->isImportant()) {$v89a2007e7c15e80c35f21ea4a4540700->setAttribute('important', 'important');}$v89a2007e7c15e80c35f21ea4a4540700->removeAttribute('field-type-id');}foreach ($v5df80bc8ce306a564d91fa6a4da3d95b as $vf03ad9e4ebc731946c49a47a1a26925d) {$this->relations_container->appendChild($vf03ad9e4ebc731946c49a47a1a26925d);}$this->types_container->appendChild($v8d90d57cd5d62bf377f6f8bc0cffc325);$this->exported_types[$v5f694956811487225d15e973ca38fbab] = $v684e7fcd9c20d41a3074eb495fe91a7f;$this->position++;return true;}public function getItems($v52eb29c6d8ea0d3a5bb3654f49bbd7c7, $vd05b6ed7d2345020440df396d6da7f73 = ['id']) {try {$v8be74552df93e31bbdd6b36ed74bdb6a = new selector('objects');$v8be74552df93e31bbdd6b36ed74bdb6a->types('object-type')->id($v52eb29c6d8ea0d3a5bb3654f49bbd7c7);$v8be74552df93e31bbdd6b36ed74bdb6a->option('return')->value($vd05b6ed7d2345020440df396d6da7f73);return $v8be74552df93e31bbdd6b36ed74bdb6a->result();}catch (Exception $ve1671797c52e15f763380b45e841ec32) {return [];}}protected function exportRestrictions() {if (!$this->ignoreRelations || in_array('restrictions', $this->saveRelations)) {foreach ($this->restrictions as $v6b1a57fa235477758817df3c91158006) {$this->exportRestriction($v6b1a57fa235477758817df3c91158006);}}}protected function exportRestriction($v6b1a57fa235477758817df3c91158006) {if (isset($this->exported_restrictions[$v6b1a57fa235477758817df3c91158006])) {return false;}$v3dadfaeb46ec74762b37de11fea7605c = baseRestriction::get($v6b1a57fa235477758817df3c91158006);if (!$v3dadfaeb46ec74762b37de11fea7605c instanceof baseRestriction) {return false;}$v851f5ac9941d720844d143ed9cfcf60a = $v3dadfaeb46ec74762b37de11fea7605c->getClassName();$vd5d3db1765287eef77d7927cc956f50a = $v3dadfaeb46ec74762b37de11fea7605c->getTitle();$v5f694956811487225d15e973ca38fbab = $v3dadfaeb46ec74762b37de11fea7605c->getFieldTypeId();$v599dcce2998a6b40b1e38e8c6006cb0a = umiFieldTypesCollection::getInstance()->getFieldType($v5f694956811487225d15e973ca38fbab);$v870b60148237c1452dfb337fdd19c314 = $v599dcce2998a6b40b1e38e8c6006cb0a->getDataType();$v09ec737a9ab66d1d796304239d3f8a86 = $v599dcce2998a6b40b1e38e8c6006cb0a->getIsMultiple();$v16039f2151ca0506b29e30a4ff61de7d = $this->relations->getOldRestrictionIdRelation($this->source_id, $v6b1a57fa235477758817df3c91158006);if (!$v16039f2151ca0506b29e30a4ff61de7d) {$this->relations->setRestrictionIdRelation($this->source_id, $v6b1a57fa235477758817df3c91158006, $v6b1a57fa235477758817df3c91158006);$v16039f2151ca0506b29e30a4ff61de7d = $v6b1a57fa235477758817df3c91158006;}$v37172e3fafb4237c23dfa49f7635984a = $this->doc->createElement('restriction');$v37172e3fafb4237c23dfa49f7635984a->setAttribute('id', $v16039f2151ca0506b29e30a4ff61de7d);$v37172e3fafb4237c23dfa49f7635984a->setAttribute('prefix', $v851f5ac9941d720844d143ed9cfcf60a);$v37172e3fafb4237c23dfa49f7635984a->setAttribute('title', $vd5d3db1765287eef77d7927cc956f50a);$v37172e3fafb4237c23dfa49f7635984a->setAttribute('field-type', $v870b60148237c1452dfb337fdd19c314);$v37172e3fafb4237c23dfa49f7635984a->setAttribute('is-multiple', $v09ec737a9ab66d1d796304239d3f8a86);foreach ($this->restricted_fields as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {if ($v2063c1608d6e0baf80249c42e2be5804['restriction-id'] == $v6b1a57fa235477758817df3c91158006) {$v89a2007e7c15e80c35f21ea4a4540700 = $this->doc->createElement('field');$v89a2007e7c15e80c35f21ea4a4540700->setAttribute('field-name', $v2063c1608d6e0baf80249c42e2be5804['field-name']);$v89a2007e7c15e80c35f21ea4a4540700->setAttribute('type-id', $v2063c1608d6e0baf80249c42e2be5804['type-id']);$v37172e3fafb4237c23dfa49f7635984a->appendChild($v89a2007e7c15e80c35f21ea4a4540700);}}if (in_array('restriction', $this->installOnly)) {$v6a0f5c4a6f37a952264da4fd4ebd1ad9 = $this->doc->createAttribute('install-only');$v6a0f5c4a6f37a952264da4fd4ebd1ad9->value = '1';$v37172e3fafb4237c23dfa49f7635984a->appendChild($v6a0f5c4a6f37a952264da4fd4ebd1ad9);}$this->restrictions_container->appendChild($v37172e3fafb4237c23dfa49f7635984a);$this->exported_restrictions[$v6b1a57fa235477758817df3c91158006] = $v16039f2151ca0506b29e30a4ff61de7d;$this->position++;return true;}protected function exportRegs() {foreach ($this->registry as $vd6fe1d0be6347b8ef2427fa629c04485) {if ($this->break) {return;}$this->exportReg($vd6fe1d0be6347b8ef2427fa629c04485);}}protected function exportReg($vd6fe1d0be6347b8ef2427fa629c04485) {if (isset($this->exported_registry_items[$vd6fe1d0be6347b8ef2427fa629c04485])) {return false;}if ($this->isLimitExceeded()) {$this->break = true;return false;}$vb1444fb0c07653567ad325aa25d4e37a = Service::Registry();$vd6fe1d0be6347b8ef2427fa629c04485 = trim($vd6fe1d0be6347b8ef2427fa629c04485, '/');if (!$vb1444fb0c07653567ad325aa25d4e37a->contains($vd6fe1d0be6347b8ef2427fa629c04485)) {return false;}$v2063c1608d6e0baf80249c42e2be5804 = $vb1444fb0c07653567ad325aa25d4e37a->get($vd6fe1d0be6347b8ef2427fa629c04485);if (mb_strrpos($vd6fe1d0be6347b8ef2427fa629c04485, '/')) {$v2405a5d61f2f462a1371b33338295c09 = substr_replace($vd6fe1d0be6347b8ef2427fa629c04485, '', mb_strrpos($vd6fe1d0be6347b8ef2427fa629c04485, '/'));if ($this->exportReg($v2405a5d61f2f462a1371b33338295c09)) {if ($this->isLimitExceeded()) {$this->break = true;return true;}}}$v4440c59bedd6c4ec74875425a6666bd8 = $this->doc->createElement('key');$v4440c59bedd6c4ec74875425a6666bd8->setAttribute('path', $vd6fe1d0be6347b8ef2427fa629c04485);$v4440c59bedd6c4ec74875425a6666bd8->setAttribute('val', $v2063c1608d6e0baf80249c42e2be5804);$this->registry_container->appendChild($v4440c59bedd6c4ec74875425a6666bd8);$this->exported_registry_items[$vd6fe1d0be6347b8ef2427fa629c04485] = $vd6fe1d0be6347b8ef2427fa629c04485;$this->position++;return true;}protected function exportBranches() {foreach ($this->branches as $v53eaf2ccc6a17c161589fabc2352eb5b) {if ($this->break) {break;}$this->exportBranch($v53eaf2ccc6a17c161589fabc2352eb5b);}}protected function exportBranch($v7552cd149af7495ee7d8225974e50f80) {if (isset($this->excludedElements[$v7552cd149af7495ee7d8225974e50f80])) {return false;}$this->exportElement($v7552cd149af7495ee7d8225974e50f80);$v268184c12df027f536154d099d497b31 = umiHierarchy::getInstance()->getChildrenTree($v7552cd149af7495ee7d8225974e50f80, true, true, 1);foreach ($v268184c12df027f536154d099d497b31 as $vf4f40123eb510dd3290125b38f4eb898 => $vfa816edb83e95bf0c8da580bdfd491ef) {if ($this->break) {return false;}$this->exportElement($vf4f40123eb510dd3290125b38f4eb898);$this->exportBranch($vf4f40123eb510dd3290125b38f4eb898);}}protected function exportElements() {foreach ($this->elements as $v7552cd149af7495ee7d8225974e50f80) {if ($this->break) {return;}$this->exportElement($v7552cd149af7495ee7d8225974e50f80);}}protected function exportElement($v7552cd149af7495ee7d8225974e50f80) {umiHierarchy::getInstance()->clearCache();if (isset($this->excludedElements[$v7552cd149af7495ee7d8225974e50f80])) {return false;}if (isset($this->exported_elements[$v7552cd149af7495ee7d8225974e50f80])) {return false;}if ($this->isLimitExceeded()) {$this->break = true;return false;}$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7552cd149af7495ee7d8225974e50f80, true, true);if (!$v8e2dcfd7e7e24b1ca76c1193f645902b instanceof iUmiHierarchyElement) {return false;}$this->exported_elements[$v7552cd149af7495ee7d8225974e50f80] = 'found';$v5f694956811487225d15e973ca38fbab = $v8e2dcfd7e7e24b1ca76c1193f645902b->getObjectTypeId();if ($this->exportType($v5f694956811487225d15e973ca38fbab)) {if ($this->isLimitExceeded()) {$this->break = true;return true;}}$v77f3c48f175369c446fbe421012437c2 = $this->doc->createElement('page');$this->translateEntity($v8e2dcfd7e7e24b1ca76c1193f645902b, $v77f3c48f175369c446fbe421012437c2);$v77f3c48f175369c446fbe421012437c2->removeAttribute('update-time');$vf585b7f018bb4ced15a03683a733e50b = $v8e2dcfd7e7e24b1ca76c1193f645902b->getLangId();if (!$this->ignoreRelations || in_array('langs', $this->saveRelations)) {if ($this->exportLang($vf585b7f018bb4ced15a03683a733e50b)) {if ($this->isLimitExceeded()) {$this->break = true;return true;}}$v55203ad3e645c98492df0c94caf19b93 = $this->relations->getOldLangIdRelation($this->source_id, $vf585b7f018bb4ced15a03683a733e50b);}else {$v55203ad3e645c98492df0c94caf19b93 = $this->relations->getOldLangIdRelation($this->source_id, $vf585b7f018bb4ced15a03683a733e50b);if ($v55203ad3e645c98492df0c94caf19b93 === false) {$this->relations->setLangIdRelation($this->source_id, $vf585b7f018bb4ced15a03683a733e50b, $vf585b7f018bb4ced15a03683a733e50b);$v55203ad3e645c98492df0c94caf19b93 = $vf585b7f018bb4ced15a03683a733e50b;}}$v77f3c48f175369c446fbe421012437c2->setAttribute('lang-id', $v55203ad3e645c98492df0c94caf19b93);$v72ee76c5c29383b7c9f9225c1fa4d10b = $v8e2dcfd7e7e24b1ca76c1193f645902b->getDomainId();if (!$this->ignoreRelations || in_array('domains', $this->saveRelations)) {$vad5f82e879a9c5d6b5b442eb37e50551 = Service::DomainCollection()->getDomain($v72ee76c5c29383b7c9f9225c1fa4d10b);if ($this->exportDomain($vad5f82e879a9c5d6b5b442eb37e50551)) {if ($this->isLimitExceeded()) {$this->break = true;return true;}}$v92bfc705285f36f484ee5b057b290d24 = $this->relations->getOldDomainIdRelation($this->source_id, $v72ee76c5c29383b7c9f9225c1fa4d10b);}else {$v92bfc705285f36f484ee5b057b290d24 = $this->relations->getOldDomainIdRelation($this->source_id, $v72ee76c5c29383b7c9f9225c1fa4d10b);if ($v92bfc705285f36f484ee5b057b290d24 === false) {$this->relations->setDomainIdRelation($this->source_id, $v72ee76c5c29383b7c9f9225c1fa4d10b, $v72ee76c5c29383b7c9f9225c1fa4d10b);$v92bfc705285f36f484ee5b057b290d24 = $v72ee76c5c29383b7c9f9225c1fa4d10b;}}$v77f3c48f175369c446fbe421012437c2->setAttribute('domain-id', $v92bfc705285f36f484ee5b057b290d24);$v3200a31fc05da4e9d5a0465c36822e2f = $v8e2dcfd7e7e24b1ca76c1193f645902b->getTplId();if (!$this->ignoreRelations || in_array('templates', $this->saveRelations)) {if ($this->exportTemplate($v3200a31fc05da4e9d5a0465c36822e2f)) {if ($this->isLimitExceeded()) {$this->break = true;return true;}}$vcb228da22e90f3b044818fec501f8979 = $this->relations->getOldTemplateIdRelation($this->source_id, $v3200a31fc05da4e9d5a0465c36822e2f);}else {$vcb228da22e90f3b044818fec501f8979 = $this->relations->getOldTemplateIdRelation($this->source_id, $v3200a31fc05da4e9d5a0465c36822e2f);if ($vcb228da22e90f3b044818fec501f8979 === false) {$this->relations->setTemplateIdRelation($this->source_id, $v3200a31fc05da4e9d5a0465c36822e2f, $v3200a31fc05da4e9d5a0465c36822e2f);$vcb228da22e90f3b044818fec501f8979 = $v3200a31fc05da4e9d5a0465c36822e2f;}}if (in_array('pages', $this->installOnly)) {$v6a0f5c4a6f37a952264da4fd4ebd1ad9 = $this->doc->createAttribute('install-only');$v6a0f5c4a6f37a952264da4fd4ebd1ad9->value = '1';$v77f3c48f175369c446fbe421012437c2->appendChild($v6a0f5c4a6f37a952264da4fd4ebd1ad9);}$vf2ce473b36fb79a44028293890c685be = templatesCollection::getInstance()->getTemplate($v3200a31fc05da4e9d5a0465c36822e2f)->getFilename();$v01947397aa2c441e93a8f772847d5aca = $this->doc->createElement('template');$v01947397aa2c441e93a8f772847d5aca->setAttribute('id', $vcb228da22e90f3b044818fec501f8979);$v01947397aa2c441e93a8f772847d5aca->appendChild($this->doc->createTextNode($vf2ce473b36fb79a44028293890c685be));$v77f3c48f175369c446fbe421012437c2->appendChild($v01947397aa2c441e93a8f772847d5aca);$va1613373380c209e3a731bf46ce7991c = $this->relations->getOldIdRelation($this->source_id, $v7552cd149af7495ee7d8225974e50f80);if ($va1613373380c209e3a731bf46ce7991c === false) {$this->relations->setIdRelation($this->source_id, $v7552cd149af7495ee7d8225974e50f80, $v7552cd149af7495ee7d8225974e50f80);$va1613373380c209e3a731bf46ce7991c = $v7552cd149af7495ee7d8225974e50f80;}else {$v77f3c48f175369c446fbe421012437c2->setAttribute('id', $va1613373380c209e3a731bf46ce7991c);}$vbfa030fe63bacd523dd70a76cfaed98a = $v8e2dcfd7e7e24b1ca76c1193f645902b->getParentId();if ($vbfa030fe63bacd523dd70a76cfaed98a) {$v410ba64ebd2f3d4568eecbf91ef7e354 = $this->relations->getOldIdRelation($this->source_id, $vbfa030fe63bacd523dd70a76cfaed98a);if ($v410ba64ebd2f3d4568eecbf91ef7e354 === false) {$this->relations->setIdRelation($this->source_id, $vbfa030fe63bacd523dd70a76cfaed98a, $vbfa030fe63bacd523dd70a76cfaed98a);$v410ba64ebd2f3d4568eecbf91ef7e354 = $vbfa030fe63bacd523dd70a76cfaed98a;}$v77f3c48f175369c446fbe421012437c2->setAttribute('parentId', $v410ba64ebd2f3d4568eecbf91ef7e354);}$v3643b86326b2ffcc0a085b4dd3a4309b = new DOMXPath($this->doc);if ($v3643b86326b2ffcc0a085b4dd3a4309b->evaluate('basetype', $v77f3c48f175369c446fbe421012437c2)->length) {$v7f71351d479800b51f4e2aa6526d92a9 = $v3643b86326b2ffcc0a085b4dd3a4309b->evaluate('basetype', $v77f3c48f175369c446fbe421012437c2)->item(0);$v7f71351d479800b51f4e2aa6526d92a9->removeAttribute('id');}$v684e7fcd9c20d41a3074eb495fe91a7f = $this->relations->getOldTypeIdRelation($this->source_id, $v5f694956811487225d15e973ca38fbab);$v77f3c48f175369c446fbe421012437c2->setAttribute('type-id', $v684e7fcd9c20d41a3074eb495fe91a7f);$v16b2b26000987faccb260b9d39df1269 = $v77f3c48f175369c446fbe421012437c2->getAttribute('object-id');if (!$this->ignoreRelations || in_array('objects', $this->saveRelations)) {if ($this->exportObject($v16b2b26000987faccb260b9d39df1269)) {if ($this->isLimitExceeded()) {$this->break = true;return true;}}$vab3bb1a616c225b159f33ef1de49779d = $this->relations->getOldObjectIdRelation($this->source_id, $v16b2b26000987faccb260b9d39df1269);}else {$vab3bb1a616c225b159f33ef1de49779d = $this->relations->getOldObjectIdRelation($this->source_id, $v16b2b26000987faccb260b9d39df1269);if ($vab3bb1a616c225b159f33ef1de49779d === false) {$this->relations->setObjectIdRelation($this->source_id, $v16b2b26000987faccb260b9d39df1269, $v16b2b26000987faccb260b9d39df1269);$vab3bb1a616c225b159f33ef1de49779d = $v16b2b26000987faccb260b9d39df1269;}}$v77f3c48f175369c446fbe421012437c2->setAttribute('object-id', $vab3bb1a616c225b159f33ef1de49779d);foreach ($v3643b86326b2ffcc0a085b4dd3a4309b->evaluate('properties/group', $v77f3c48f175369c446fbe421012437c2) as $va675fe51a42ad86a342be910e8266321) {if ($va675fe51a42ad86a342be910e8266321->hasAttribute('id')) {$va675fe51a42ad86a342be910e8266321->removeAttribute('id');}}$v5df80bc8ce306a564d91fa6a4da3d95b = [];$vc639bc918ec583ce6a914b6bbb29095d = [];foreach ($v3643b86326b2ffcc0a085b4dd3a4309b->evaluate('properties/group/property', $v77f3c48f175369c446fbe421012437c2) as $v96b8eeb9e337bd8704b337b404d62688) {$v945100186b119048837b9859c2c46410 = (int) $v96b8eeb9e337bd8704b337b404d62688->getAttribute('id');$v5f01d4e9bac164e092ef889df385bd84 = $this->relations->getOldFieldName($this->source_id, $v5f694956811487225d15e973ca38fbab, $v945100186b119048837b9859c2c46410);if ($v5f01d4e9bac164e092ef889df385bd84) {$v96b8eeb9e337bd8704b337b404d62688->setAttribute('name', $v5f01d4e9bac164e092ef889df385bd84);}if ($this->isAllowFieldsRuntimeAdd()) {$v96b8eeb9e337bd8704b337b404d62688->setAttribute('allow-runtime-add', '1');}$v833750ac635fcc57dc33ecafe365f9a7 = $v96b8eeb9e337bd8704b337b404d62688->getAttribute('type');if ($v833750ac635fcc57dc33ecafe365f9a7 == 'relation' && $this->shouldExportRelations()) {$vf03ad9e4ebc731946c49a47a1a26925d = $this->buildPageRelationNode($v5f01d4e9bac164e092ef889df385bd84, $va1613373380c209e3a731bf46ce7991c);if (!$this->exportRelation($vf03ad9e4ebc731946c49a47a1a26925d, $v96b8eeb9e337bd8704b337b404d62688)) {return true;}$v5df80bc8ce306a564d91fa6a4da3d95b[] = $vf03ad9e4ebc731946c49a47a1a26925d;}if ($v833750ac635fcc57dc33ecafe365f9a7 == 'symlink' && $this->shouldExportSymlinks()) {$vf03ad9e4ebc731946c49a47a1a26925d = $this->buildPageRelationNode($v5f01d4e9bac164e092ef889df385bd84, $va1613373380c209e3a731bf46ce7991c);if (!$this->exportRelation($vf03ad9e4ebc731946c49a47a1a26925d, $v96b8eeb9e337bd8704b337b404d62688)) {return true;}$v5df80bc8ce306a564d91fa6a4da3d95b[] = $vf03ad9e4ebc731946c49a47a1a26925d;}if ($v833750ac635fcc57dc33ecafe365f9a7 == 'optioned' && $this->shouldExportOptions()) {$v904392a19930b5c35e97bfd3c4dac307 = $this->buildPageOptionNode($v5f01d4e9bac164e092ef889df385bd84, $va1613373380c209e3a731bf46ce7991c);if (!$this->exportOptions($v96b8eeb9e337bd8704b337b404d62688, $v904392a19930b5c35e97bfd3c4dac307)) {return true;}$vc639bc918ec583ce6a914b6bbb29095d[] = $v904392a19930b5c35e97bfd3c4dac307;}if (!$this->ignoreRelations || in_array('files', $this->saveRelations)) {if ($v833750ac635fcc57dc33ecafe365f9a7 == 'file' || $v833750ac635fcc57dc33ecafe365f9a7 == 'swf_file' || $v833750ac635fcc57dc33ecafe365f9a7 == 'img_file') {$v47826cacc65c665212b821e6ff80b9b0 = $v96b8eeb9e337bd8704b337b404d62688->getElementsByTagName('value')->item(0)->nodeValue;if (file_exists('./' . $v47826cacc65c665212b821e6ff80b9b0)) {$v8c7dd922ad47494fc02c388e12c00eac = new umiFile('./' . $v47826cacc65c665212b821e6ff80b9b0);$this->exportFile($v8c7dd922ad47494fc02c388e12c00eac);}elseif (file_exists(CURRENT_WORKING_DIR . $v47826cacc65c665212b821e6ff80b9b0)) {$v8c7dd922ad47494fc02c388e12c00eac = new umiFile(CURRENT_WORKING_DIR . $v47826cacc65c665212b821e6ff80b9b0);$this->exportFile($v8c7dd922ad47494fc02c388e12c00eac);}}}if ($v833750ac635fcc57dc33ecafe365f9a7 == 'offer_id_list' || $v833750ac635fcc57dc33ecafe365f9a7 == 'offer_id') {$this->exportTradeOfferList($v3643b86326b2ffcc0a085b4dd3a4309b, $v96b8eeb9e337bd8704b337b404d62688);$vf03ad9e4ebc731946c49a47a1a26925d = $this->buildPageRelationNode($v5f01d4e9bac164e092ef889df385bd84, $va1613373380c209e3a731bf46ce7991c);if (!$this->exportRelation($vf03ad9e4ebc731946c49a47a1a26925d, $v96b8eeb9e337bd8704b337b404d62688)) {return true;}$v5df80bc8ce306a564d91fa6a4da3d95b[] = $vf03ad9e4ebc731946c49a47a1a26925d;}}$v9f5a2d64925838158f3ef0a206b58c00 = [];if ((!$this->ignoreRelations || in_array('permissions', $this->saveRelations)) && !$this->ignorePermissions) {$permissions = permissionsCollection::getInstance()->getRecordedPermissions($v7552cd149af7495ee7d8225974e50f80);if (is_array($permissions)) {$v3eab20b6b92c5ab57d985694bf131c51 = $this->doc->createElement('permission');$v3eab20b6b92c5ab57d985694bf131c51->setAttribute('page-id', $va1613373380c209e3a731bf46ce7991c);foreach ($permissions as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {$v7437f43390ef2a19140ea6bf0aa6a7a4 = $this->doc->createElement('owner');if ($this->exportObject($v3c6e0b8a9c15224a8228b9a98ca1531d)) {if ($this->isLimitExceeded()) {$this->break = true;return true;}}$v3f88395270f52ead5f60f23216a362aa = $this->relations->getOldObjectIdRelation($this->source_id, $v3c6e0b8a9c15224a8228b9a98ca1531d);$v7437f43390ef2a19140ea6bf0aa6a7a4->setAttribute('id', $v3f88395270f52ead5f60f23216a362aa);$v7437f43390ef2a19140ea6bf0aa6a7a4->setAttribute('level', $v2063c1608d6e0baf80249c42e2be5804);$v3eab20b6b92c5ab57d985694bf131c51->appendChild($v7437f43390ef2a19140ea6bf0aa6a7a4);}$v9f5a2d64925838158f3ef0a206b58c00[] = $v3eab20b6b92c5ab57d985694bf131c51;}}foreach ($v5df80bc8ce306a564d91fa6a4da3d95b as $vf03ad9e4ebc731946c49a47a1a26925d) {$this->relations_container->appendChild($vf03ad9e4ebc731946c49a47a1a26925d);}foreach ($vc639bc918ec583ce6a914b6bbb29095d as $v904392a19930b5c35e97bfd3c4dac307) {$this->options_container->appendChild($v904392a19930b5c35e97bfd3c4dac307);}foreach ($v9f5a2d64925838158f3ef0a206b58c00 as $v3eab20b6b92c5ab57d985694bf131c51) {$this->permissions_container->appendChild($v3eab20b6b92c5ab57d985694bf131c51);}if (!$this->ignoreRelations || in_array('hierarchy', $this->saveRelations)) {$v8bef1cc20ada3bef55fdf132cb2a1cb9 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getOrd();$v679d79ed1b28f723d9b8f99287793079 = $this->doc->createElement('relation');$v679d79ed1b28f723d9b8f99287793079->setAttribute('id', $va1613373380c209e3a731bf46ce7991c);$v679d79ed1b28f723d9b8f99287793079->setAttribute('ord', $v8bef1cc20ada3bef55fdf132cb2a1cb9);if ($vbfa030fe63bacd523dd70a76cfaed98a) {$v679d79ed1b28f723d9b8f99287793079->setAttribute('parent-id', $v410ba64ebd2f3d4568eecbf91ef7e354);}else {$v679d79ed1b28f723d9b8f99287793079->setAttribute('parent-id', 0);}$this->hierarchy_container->appendChild($v679d79ed1b28f723d9b8f99287793079);}$this->pages_container->appendChild($v77f3c48f175369c446fbe421012437c2);$this->exported_elements[$v7552cd149af7495ee7d8225974e50f80] = $va1613373380c209e3a731bf46ce7991c;$this->position++;return true;}protected function exportTradeOfferList(DOMXPath $v3643b86326b2ffcc0a085b4dd3a4309b, DOMElement $v96b8eeb9e337bd8704b337b404d62688) {$v664c671118d4f048dc023baf0d285c54 = $this->extractTradeOfferIdList($v3643b86326b2ffcc0a085b4dd3a4309b, $v96b8eeb9e337bd8704b337b404d62688);if (count($v664c671118d4f048dc023baf0d285c54) > 0) {$this->addEntities([     'TradeOfferExchange' => $v664c671118d4f048dc023baf0d285c54    ]);$this->exportEntities();}return $this;}protected function extractTradeOfferIdList(DOMXPath $v3643b86326b2ffcc0a085b4dd3a4309b, DOMElement $v96b8eeb9e337bd8704b337b404d62688) {$v664c671118d4f048dc023baf0d285c54 = [];foreach ($v3643b86326b2ffcc0a085b4dd3a4309b->evaluate('value/offer/@id', $v96b8eeb9e337bd8704b337b404d62688) as $v811ffe5ef7260e9e4ee22e29f304e00a) {$v664c671118d4f048dc023baf0d285c54[] = $v811ffe5ef7260e9e4ee22e29f304e00a->value;}return $v664c671118d4f048dc023baf0d285c54;}protected function buildPageRelationNode($v972bf3f05d14ffbdb817bef60638ff00, $va6eb4816205178e88dad66a16a19ff45) {return $this->buildRelationNode($v972bf3f05d14ffbdb817bef60638ff00, $va6eb4816205178e88dad66a16a19ff45, 'page');}protected function buildObjectRelationNode($v972bf3f05d14ffbdb817bef60638ff00, $v16b2b26000987faccb260b9d39df1269) {return $this->buildRelationNode($v972bf3f05d14ffbdb817bef60638ff00, $v16b2b26000987faccb260b9d39df1269, 'object');}protected function buildRelationNode($v972bf3f05d14ffbdb817bef60638ff00, $vb80bb7740288fda1f201890375a60c8f, $v599dcce2998a6b40b1e38e8c6006cb0a) {$vf03ad9e4ebc731946c49a47a1a26925d = $this->doc->createElement('relation');$vf03ad9e4ebc731946c49a47a1a26925d->setAttribute(sprintf('%s-id', $v599dcce2998a6b40b1e38e8c6006cb0a), $vb80bb7740288fda1f201890375a60c8f);$vf03ad9e4ebc731946c49a47a1a26925d->setAttribute('field-name', $v972bf3f05d14ffbdb817bef60638ff00);return $vf03ad9e4ebc731946c49a47a1a26925d;}protected function buildPageOptionNode($v972bf3f05d14ffbdb817bef60638ff00, $va6eb4816205178e88dad66a16a19ff45) {return $this->buildOptionNode($v972bf3f05d14ffbdb817bef60638ff00, $va6eb4816205178e88dad66a16a19ff45, 'page');}protected function buildObjectOptionNode($v972bf3f05d14ffbdb817bef60638ff00, $v16b2b26000987faccb260b9d39df1269) {return $this->buildOptionNode($v972bf3f05d14ffbdb817bef60638ff00, $v16b2b26000987faccb260b9d39df1269, 'object');}protected function buildOptionNode($v972bf3f05d14ffbdb817bef60638ff00, $vb80bb7740288fda1f201890375a60c8f, $v599dcce2998a6b40b1e38e8c6006cb0a) {$v904392a19930b5c35e97bfd3c4dac307 = $this->doc->createElement('entity');$v904392a19930b5c35e97bfd3c4dac307->setAttribute(sprintf('%s-id', $v599dcce2998a6b40b1e38e8c6006cb0a), $vb80bb7740288fda1f201890375a60c8f);$v904392a19930b5c35e97bfd3c4dac307->setAttribute('field-name', $v972bf3f05d14ffbdb817bef60638ff00);return $v904392a19930b5c35e97bfd3c4dac307;}protected function exportRelation(DOMElement $vf03ad9e4ebc731946c49a47a1a26925d, DOMElement $v96b8eeb9e337bd8704b337b404d62688) {$this->exportRelationPropertyRelations($vf03ad9e4ebc731946c49a47a1a26925d, $v96b8eeb9e337bd8704b337b404d62688);$this->exportSymlinkPropertyRelations($vf03ad9e4ebc731946c49a47a1a26925d, $v96b8eeb9e337bd8704b337b404d62688);$this->exportOfferIdListPropertyRelations($vf03ad9e4ebc731946c49a47a1a26925d, $v96b8eeb9e337bd8704b337b404d62688);return true;}protected function exportSymlinkPropertyRelations(DOMElement $vf03ad9e4ebc731946c49a47a1a26925d, DOMElement $v96b8eeb9e337bd8704b337b404d62688) {$v93df78318b2494c10566a2c4c069084d = $v96b8eeb9e337bd8704b337b404d62688->getElementsByTagName('page');foreach ($v93df78318b2494c10566a2c4c069084d as $v77f3c48f175369c446fbe421012437c2) {if ($this->exportElement($v77f3c48f175369c446fbe421012437c2->getAttribute('id'))) {if ($this->isLimitExceeded()) {$this->break = true;return false;}}$va6eb4816205178e88dad66a16a19ff45 = $this->relations->getOldIdRelation($this->source_id, $v77f3c48f175369c446fbe421012437c2->getAttribute('id'));$vde9e84af086ead623e4823c3f8970ef7 = $this->doc->createElement('page');$vde9e84af086ead623e4823c3f8970ef7->setAttribute('id', $va6eb4816205178e88dad66a16a19ff45);$v77f3c48f175369c446fbe421012437c2->setAttribute('id', $va6eb4816205178e88dad66a16a19ff45);if ($this->exportType($v77f3c48f175369c446fbe421012437c2->getAttribute('type-id'))) {if ($this->isLimitExceeded()) {$this->break = true;return false;}}$v5f694956811487225d15e973ca38fbab = $this->relations->getOldTypeIdRelation($this->source_id, $v77f3c48f175369c446fbe421012437c2->getAttribute('type-id'));$v77f3c48f175369c446fbe421012437c2->setAttribute('type-id', $v5f694956811487225d15e973ca38fbab);$vbfa030fe63bacd523dd70a76cfaed98a = $v77f3c48f175369c446fbe421012437c2->getAttribute('parentId');if ($this->exportElement($vbfa030fe63bacd523dd70a76cfaed98a)) {if ($this->isLimitExceeded()) {$this->break = true;return false;}}$v410ba64ebd2f3d4568eecbf91ef7e354 = $this->relations->getOldIdRelation($this->source_id, $vbfa030fe63bacd523dd70a76cfaed98a);$v77f3c48f175369c446fbe421012437c2->setAttribute('parentId', $v410ba64ebd2f3d4568eecbf91ef7e354);$v16b2b26000987faccb260b9d39df1269 = $v77f3c48f175369c446fbe421012437c2->getAttribute('object-id');if ($this->exportObject($v16b2b26000987faccb260b9d39df1269)) {if ($this->isLimitExceeded()) {$this->break = true;return false;}}$vab3bb1a616c225b159f33ef1de49779d = $this->relations->getOldObjectIdRelation($this->source_id, $v16b2b26000987faccb260b9d39df1269);$v77f3c48f175369c446fbe421012437c2->setAttribute('object-id', $vab3bb1a616c225b159f33ef1de49779d);$v77f3c48f175369c446fbe421012437c2->removeAttribute('xlink:href');$v77f3c48f175369c446fbe421012437c2->removeAttribute('update-time');if ($v77f3c48f175369c446fbe421012437c2->getElementsByTagName('basetype')->length) {$v7f71351d479800b51f4e2aa6526d92a9 = $v77f3c48f175369c446fbe421012437c2->getElementsByTagName('basetype')->item(0);$v7f71351d479800b51f4e2aa6526d92a9->removeAttribute('id');}$vf03ad9e4ebc731946c49a47a1a26925d->appendChild($vde9e84af086ead623e4823c3f8970ef7);}}protected function exportRelationPropertyRelations(DOMElement $vf03ad9e4ebc731946c49a47a1a26925d, DOMElement $v96b8eeb9e337bd8704b337b404d62688) {$v4286560a0f2b34cf2b3d7e658673c613 = $v96b8eeb9e337bd8704b337b404d62688->getElementsByTagName('item');foreach ($v4286560a0f2b34cf2b3d7e658673c613 as $v399a75af3a8a951a74e76f096d19233b) {$v59a814aa020a1b32c4674a5887a35022 = $v399a75af3a8a951a74e76f096d19233b->getAttribute('id');if ($this->exportObject($v59a814aa020a1b32c4674a5887a35022)) {if ($this->isLimitExceeded()) {$this->break = true;return false;}}$v450144afc6bc9d1be4a21a15659f6d8b = $this->relations->getOldObjectIdRelation($this->source_id, $v59a814aa020a1b32c4674a5887a35022);$v399a75af3a8a951a74e76f096d19233b->setAttribute('id', $v450144afc6bc9d1be4a21a15659f6d8b);$v6149843274f2e068b5b7de0061ffa338 = $v399a75af3a8a951a74e76f096d19233b->getAttribute('type-id');if ($this->exportType($v6149843274f2e068b5b7de0061ffa338)) {if ($this->isLimitExceeded()) {$this->break = true;return false;}}$ve03a03198a18635908f8ffdbd6c8698c = $this->relations->getOldTypeIdRelation($this->source_id, $v6149843274f2e068b5b7de0061ffa338);$v399a75af3a8a951a74e76f096d19233b->setAttribute('type-id', $ve03a03198a18635908f8ffdbd6c8698c);if ($v399a75af3a8a951a74e76f096d19233b->hasAttribute('ownerId')) {$v7a656cea54e4d36ea5be8b6fdee0b60b = $v399a75af3a8a951a74e76f096d19233b->getAttribute('ownerId');if ($this->exportObject($v7a656cea54e4d36ea5be8b6fdee0b60b)) {if ($this->isLimitExceeded()) {$this->break = true;return false;}}$v884d667e8906bf4654651e2a4cd4bd27 = $this->relations->getOldObjectIdRelation($this->source_id, $v7a656cea54e4d36ea5be8b6fdee0b60b);$v399a75af3a8a951a74e76f096d19233b->setAttribute('ownerId', $v884d667e8906bf4654651e2a4cd4bd27);}$v399a75af3a8a951a74e76f096d19233b->removeAttribute('xlink:href');$vbfb9b1cd25f05560dfdda8bca7dac185 = $this->doc->createElement('object');$vbfb9b1cd25f05560dfdda8bca7dac185->setAttribute('id', $v450144afc6bc9d1be4a21a15659f6d8b);$vf03ad9e4ebc731946c49a47a1a26925d->appendChild($vbfb9b1cd25f05560dfdda8bca7dac185);}}protected function exportOfferIdListPropertyRelations(DOMElement $vf03ad9e4ebc731946c49a47a1a26925d, DOMElement $vfdc07bad76575e8a3d3ee6f0d0eca73f) {$v0f2f2e8e02dde0f7dc236941de705486 = $vfdc07bad76575e8a3d3ee6f0d0eca73f->getElementsByTagName('offer');$v58a5d4fb4673437868724dd7ac7beb83 = [];foreach ($v0f2f2e8e02dde0f7dc236941de705486 as $v7a7e2470430f4662fc77b51ed0798b81) {$v58a5d4fb4673437868724dd7ac7beb83[] = $v7a7e2470430f4662fc77b51ed0798b81->getAttribute('id');}try {$v2be74b548266012432df4ad7087f126c = $this->getService('TradeOfferExchange')     ->getExternalIdList($v58a5d4fb4673437868724dd7ac7beb83, $this);}catch (Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {$this->reportError($v42552b1f133f9f8eb406d4f306ea9fd1->getMessage());return false;}foreach ($v2be74b548266012432df4ad7087f126c as $vcaf0668d111ecd8c52e8791730141896) {$v7a7e2470430f4662fc77b51ed0798b81 = $this->doc->createElement('offer');$v7a7e2470430f4662fc77b51ed0798b81->setAttribute('id', $vcaf0668d111ecd8c52e8791730141896);$vf03ad9e4ebc731946c49a47a1a26925d->appendChild($v7a7e2470430f4662fc77b51ed0798b81);}return true;}protected function exportObjects() {foreach ($this->objects as $v16b2b26000987faccb260b9d39df1269) {if ($this->break) {return;}$this->exportObject($v16b2b26000987faccb260b9d39df1269);}}protected function exportObject($v16b2b26000987faccb260b9d39df1269) {$v16b2b26000987faccb260b9d39df1269 = (int) $v16b2b26000987faccb260b9d39df1269;if (isset($this->exported_objects[$v16b2b26000987faccb260b9d39df1269])) {return false;}if ($this->isLimitExceeded()) {$this->break = true;return false;}$this->exported_objects[$v16b2b26000987faccb260b9d39df1269] = 'found';$va8cfde6331bd59eb2ac96f8911c4b666 = umiObjectsCollection::getInstance()->getObject($v16b2b26000987faccb260b9d39df1269);if (!$va8cfde6331bd59eb2ac96f8911c4b666 instanceof iUmiObject) {return false;}$v5f694956811487225d15e973ca38fbab = $va8cfde6331bd59eb2ac96f8911c4b666->getTypeId();if ($this->exportType($v5f694956811487225d15e973ca38fbab)) {if ($this->isLimitExceeded()) {$this->break = true;return true;}}$vbfb9b1cd25f05560dfdda8bca7dac185 = $this->doc->createElement('object');$this->translateEntity($va8cfde6331bd59eb2ac96f8911c4b666, $vbfb9b1cd25f05560dfdda8bca7dac185);$vab3bb1a616c225b159f33ef1de49779d = $this->relations->getOldObjectIdRelation($this->source_id, $v16b2b26000987faccb260b9d39df1269);if ($vab3bb1a616c225b159f33ef1de49779d === false) {$this->relations->setObjectIdRelation($this->source_id, $v16b2b26000987faccb260b9d39df1269, $v16b2b26000987faccb260b9d39df1269);$vab3bb1a616c225b159f33ef1de49779d = $v16b2b26000987faccb260b9d39df1269;}else {$vbfb9b1cd25f05560dfdda8bca7dac185->setAttribute('id', $vab3bb1a616c225b159f33ef1de49779d);}$v599dcce2998a6b40b1e38e8c6006cb0a = umiObjectTypesCollection::getInstance()    ->getType($v5f694956811487225d15e973ca38fbab);$v6b9cabb4eeb65f66097d5658f2a92258 = ($v599dcce2998a6b40b1e38e8c6006cb0a instanceof iUmiObjectType) ? $v599dcce2998a6b40b1e38e8c6006cb0a->getGUID() : '';if (in_array('objects', $this->installOnly) && $v6b9cabb4eeb65f66097d5658f2a92258 != 'tax-rate-guide') {$v6a0f5c4a6f37a952264da4fd4ebd1ad9 = $this->doc->createAttribute('install-only');$v6a0f5c4a6f37a952264da4fd4ebd1ad9->value = '1';$vbfb9b1cd25f05560dfdda8bca7dac185->appendChild($v6a0f5c4a6f37a952264da4fd4ebd1ad9);}$v684e7fcd9c20d41a3074eb495fe91a7f = $this->relations->getOldTypeIdRelation($this->source_id, $v5f694956811487225d15e973ca38fbab);$vbfb9b1cd25f05560dfdda8bca7dac185->setAttribute('type-id', $v684e7fcd9c20d41a3074eb495fe91a7f);$v3643b86326b2ffcc0a085b4dd3a4309b = new DOMXPath($this->doc);foreach ($v3643b86326b2ffcc0a085b4dd3a4309b->evaluate('properties/group', $vbfb9b1cd25f05560dfdda8bca7dac185) as $va675fe51a42ad86a342be910e8266321) {if ($va675fe51a42ad86a342be910e8266321->hasAttribute('id')) {$va675fe51a42ad86a342be910e8266321->removeAttribute('id');}}$v5df80bc8ce306a564d91fa6a4da3d95b = [];$vc639bc918ec583ce6a914b6bbb29095d = [];foreach ($v3643b86326b2ffcc0a085b4dd3a4309b->evaluate('properties/group/property', $vbfb9b1cd25f05560dfdda8bca7dac185) as $v96b8eeb9e337bd8704b337b404d62688) {$v945100186b119048837b9859c2c46410 = (int) $v96b8eeb9e337bd8704b337b404d62688->getAttribute('id');$v833750ac635fcc57dc33ecafe365f9a7 = $v96b8eeb9e337bd8704b337b404d62688->getAttribute('type');$v5f01d4e9bac164e092ef889df385bd84 = $this->relations->getOldFieldName($this->source_id, $v5f694956811487225d15e973ca38fbab, $v945100186b119048837b9859c2c46410);if ($v5f01d4e9bac164e092ef889df385bd84) {$v96b8eeb9e337bd8704b337b404d62688->setAttribute('name', $v5f01d4e9bac164e092ef889df385bd84);}if ($v833750ac635fcc57dc33ecafe365f9a7 == 'relation' && $this->shouldExportRelations()) {$vf03ad9e4ebc731946c49a47a1a26925d = $this->buildObjectRelationNode($v5f01d4e9bac164e092ef889df385bd84, $vab3bb1a616c225b159f33ef1de49779d);if (!$this->exportRelation($vf03ad9e4ebc731946c49a47a1a26925d, $v96b8eeb9e337bd8704b337b404d62688)) {return true;}$v5df80bc8ce306a564d91fa6a4da3d95b[] = $vf03ad9e4ebc731946c49a47a1a26925d;}if ($v833750ac635fcc57dc33ecafe365f9a7 == 'symlink' && $this->shouldExportSymlinks()) {$vf03ad9e4ebc731946c49a47a1a26925d = $this->buildObjectRelationNode($v5f01d4e9bac164e092ef889df385bd84, $vab3bb1a616c225b159f33ef1de49779d);if (!$this->exportRelation($vf03ad9e4ebc731946c49a47a1a26925d, $v96b8eeb9e337bd8704b337b404d62688)) {return true;}$v5df80bc8ce306a564d91fa6a4da3d95b[] = $vf03ad9e4ebc731946c49a47a1a26925d;}if ($v833750ac635fcc57dc33ecafe365f9a7 == 'optioned' && $this->shouldExportOptions()) {$v904392a19930b5c35e97bfd3c4dac307 = $this->buildObjectOptionNode($v5f01d4e9bac164e092ef889df385bd84, $vab3bb1a616c225b159f33ef1de49779d);if (!$this->exportOptions($v96b8eeb9e337bd8704b337b404d62688, $v904392a19930b5c35e97bfd3c4dac307)) {return true;}$vc639bc918ec583ce6a914b6bbb29095d[] = $v904392a19930b5c35e97bfd3c4dac307;}if ($v833750ac635fcc57dc33ecafe365f9a7 == 'offer_id_list' || $v833750ac635fcc57dc33ecafe365f9a7 == 'offer_id') {$this->exportTradeOfferList($v3643b86326b2ffcc0a085b4dd3a4309b, $v96b8eeb9e337bd8704b337b404d62688);$vf03ad9e4ebc731946c49a47a1a26925d = $this->buildObjectRelationNode($v5f01d4e9bac164e092ef889df385bd84, $vab3bb1a616c225b159f33ef1de49779d);if (!$this->exportRelation($vf03ad9e4ebc731946c49a47a1a26925d, $v96b8eeb9e337bd8704b337b404d62688)) {return true;}$v5df80bc8ce306a564d91fa6a4da3d95b[] = $vf03ad9e4ebc731946c49a47a1a26925d;}}$v9f5a2d64925838158f3ef0a206b58c00 = [];$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();if ((!$this->ignoreRelations || in_array('permissions', $this->saveRelations)) && !$this->ignorePermissions) {$v3eab20b6b92c5ab57d985694bf131c51 = $this->doc->createElement('permission');$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT `module`, `method`, `allow` FROM cms_permissions WHERE owner_id = '{$v16b2b26000987faccb260b9d39df1269}'";$result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);$result->setFetchType(IQueryResult::FETCH_ROW);foreach ($result as $vf1965a857bc285d26fe22023aa5ab50d) {$v971db15640938b4f0571f6a2d94b6af6 = $this->doc->createElement('module');$v971db15640938b4f0571f6a2d94b6af6->setAttribute('name', array_shift($vf1965a857bc285d26fe22023aa5ab50d));$v971db15640938b4f0571f6a2d94b6af6->setAttribute('method', array_shift($vf1965a857bc285d26fe22023aa5ab50d));$v971db15640938b4f0571f6a2d94b6af6->setAttribute('allow', array_shift($vf1965a857bc285d26fe22023aa5ab50d));if (in_array('modules_permissions', $this->installOnly)) {$v971db15640938b4f0571f6a2d94b6af6->setAttribute('install-only', '1');}$v3eab20b6b92c5ab57d985694bf131c51->appendChild($v971db15640938b4f0571f6a2d94b6af6);}$v3eab20b6b92c5ab57d985694bf131c51->setAttribute('object-id', $vab3bb1a616c225b159f33ef1de49779d);if ($vbfb9b1cd25f05560dfdda8bca7dac185->hasAttribute('ownerId')) {$vb0ab4f7791b60b1e8ea01057b77873b0 = $va8cfde6331bd59eb2ac96f8911c4b666->getOwnerId();if ($this->exportObject($vb0ab4f7791b60b1e8ea01057b77873b0)) {if ($this->isLimitExceeded()) {$this->break = true;return true;}}$v342ffc969bfcd7ea6436ad2934c01f28 = $this->relations->getOldObjectIdRelation($this->source_id, $vb0ab4f7791b60b1e8ea01057b77873b0);$vbfb9b1cd25f05560dfdda8bca7dac185->setAttribute('ownerId', $v342ffc969bfcd7ea6436ad2934c01f28);$v7437f43390ef2a19140ea6bf0aa6a7a4 = $this->doc->createElement('owner');$v7437f43390ef2a19140ea6bf0aa6a7a4->setAttribute('id', $v342ffc969bfcd7ea6436ad2934c01f28);$v3eab20b6b92c5ab57d985694bf131c51->appendChild($v7437f43390ef2a19140ea6bf0aa6a7a4);}$v9f5a2d64925838158f3ef0a206b58c00[] = $v3eab20b6b92c5ab57d985694bf131c51;}foreach ($v5df80bc8ce306a564d91fa6a4da3d95b as $vf03ad9e4ebc731946c49a47a1a26925d) {$this->relations_container->appendChild($vf03ad9e4ebc731946c49a47a1a26925d);}foreach ($vc639bc918ec583ce6a914b6bbb29095d as $v904392a19930b5c35e97bfd3c4dac307) {$this->options_container->appendChild($v904392a19930b5c35e97bfd3c4dac307);}foreach ($v9f5a2d64925838158f3ef0a206b58c00 as $v3eab20b6b92c5ab57d985694bf131c51) {$this->permissions_container->appendChild($v3eab20b6b92c5ab57d985694bf131c51);}$this->objects_container->appendChild($vbfb9b1cd25f05560dfdda8bca7dac185);$this->exported_objects[$v16b2b26000987faccb260b9d39df1269] = $v16b2b26000987faccb260b9d39df1269;$this->position++;return true;}protected function exportOptions($v06e3d36fa30cea095545139854ad1fb9, $v904392a19930b5c35e97bfd3c4dac307) {$vf43f664b9a38b1058c0ed2dcab20517a = $v06e3d36fa30cea095545139854ad1fb9->getElementsByTagName('option');foreach ($vf43f664b9a38b1058c0ed2dcab20517a as $v08df8d33f92ccf903ad3819176d0f032) {$vc3660ff61995c9ac9ac147882e39bb2e = $this->doc->createElement('option');if ($v08df8d33f92ccf903ad3819176d0f032->hasAttributes()) {foreach ($v08df8d33f92ccf903ad3819176d0f032->attributes as $vd2eb444e35c0a71f0a85df8194acb5b6) {$vc3660ff61995c9ac9ac147882e39bb2e->setAttribute($vd2eb444e35c0a71f0a85df8194acb5b6->name, $vd2eb444e35c0a71f0a85df8194acb5b6->value);}}if ($v08df8d33f92ccf903ad3819176d0f032->getElementsByTagName('object')->length) {$va8cfde6331bd59eb2ac96f8911c4b666 = $v08df8d33f92ccf903ad3819176d0f032->getElementsByTagName('object')->item(0);if ($this->exportObject($va8cfde6331bd59eb2ac96f8911c4b666->getAttribute('id'))) {if ($this->isLimitExceeded()) {$this->break = true;return false;}}$vb80bb7740288fda1f201890375a60c8f = $this->relations->getOldObjectIdRelation($this->source_id, $va8cfde6331bd59eb2ac96f8911c4b666->getAttribute('id'));$vc3660ff61995c9ac9ac147882e39bb2e->setAttribute('object-id', $vb80bb7740288fda1f201890375a60c8f);$va8cfde6331bd59eb2ac96f8911c4b666->setAttribute('id', $vb80bb7740288fda1f201890375a60c8f);if ($this->exportType($va8cfde6331bd59eb2ac96f8911c4b666->getAttribute('type-id'))) {if ($this->isLimitExceeded()) {$this->break = true;return false;}}$v5f694956811487225d15e973ca38fbab = $this->relations->getOldTypeIdRelation($this->source_id, $va8cfde6331bd59eb2ac96f8911c4b666->getAttribute('type-id'));$va8cfde6331bd59eb2ac96f8911c4b666->setAttribute('type-id', $v5f694956811487225d15e973ca38fbab);if ($va8cfde6331bd59eb2ac96f8911c4b666->hasAttribute('ownerId')) {$vb0ab4f7791b60b1e8ea01057b77873b0 = $va8cfde6331bd59eb2ac96f8911c4b666->getAttribute('ownerId');if ($vb0ab4f7791b60b1e8ea01057b77873b0) {if ($this->isLimitExceeded()) {$this->break = true;return false;}}$this->exportObject($vb0ab4f7791b60b1e8ea01057b77873b0);$v342ffc969bfcd7ea6436ad2934c01f28 = $this->relations->getOldObjectIdRelation($this->source_id, $vb0ab4f7791b60b1e8ea01057b77873b0);$va8cfde6331bd59eb2ac96f8911c4b666->setAttribute('ownerId', $v342ffc969bfcd7ea6436ad2934c01f28);$va8cfde6331bd59eb2ac96f8911c4b666->removeAttribute('xlink:href');}}if ($v08df8d33f92ccf903ad3819176d0f032->getElementsByTagName('page')->length) {$v71860c77c6745379b0d44304d66b6a13 = $v08df8d33f92ccf903ad3819176d0f032->getElementsByTagName('page')->item(0);if ($this->exportElement($v71860c77c6745379b0d44304d66b6a13->getAttribute('id'))) {if ($this->isLimitExceeded()) {$this->break = true;return false;}}$vb80bb7740288fda1f201890375a60c8f = $this->relations->getOldIdRelation($this->source_id, $v71860c77c6745379b0d44304d66b6a13->getAttribute('id'));$vc3660ff61995c9ac9ac147882e39bb2e->setAttribute('page-id', $vb80bb7740288fda1f201890375a60c8f);$v71860c77c6745379b0d44304d66b6a13->setAttribute('id', $vb80bb7740288fda1f201890375a60c8f);if ($this->exportType($v71860c77c6745379b0d44304d66b6a13->getAttribute('type-id'))) {if ($this->isLimitExceeded()) {$this->break = true;return false;}}$v5f694956811487225d15e973ca38fbab = $this->relations->getOldTypeIdRelation($this->source_id, $v71860c77c6745379b0d44304d66b6a13->getAttribute('type-id'));$v71860c77c6745379b0d44304d66b6a13->setAttribute('type-id', $v5f694956811487225d15e973ca38fbab);$v71860c77c6745379b0d44304d66b6a13->removeAttribute('xlink:href');$v71860c77c6745379b0d44304d66b6a13->removeAttribute('update-time');}$v904392a19930b5c35e97bfd3c4dac307->appendChild($vc3660ff61995c9ac9ac147882e39bb2e);}return true;}private function isNeedToExportAllModuleMethodPermissions() {return $this->exportAllModuleMethodPermissions;}private function isObjectHasBeenExported($vb80bb7740288fda1f201890375a60c8f) {return $this->relations->getOldObjectIdRelation($this->source_id, $vb80bb7740288fda1f201890375a60c8f) !== false;}private function exportModuleMethodPermissions() {if (!$this->doc instanceof DOMDocument) {return false;}$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$vac5c74b64b4b8352ef2f181affb5ac2a = 'SELECT `module`, `method`, `allow`, `owner_id` FROM `cms_permissions` ORDER BY `owner_id`';$result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);$result->setFetchType(IQueryResult::FETCH_ASSOC);if ($result->length() == 0) {return true;}$permissions = [];$v86dce043678952b27d5b27a5296f020c = in_array('modules_permissions', $this->installOnly);foreach ($result as $vf1965a857bc285d26fe22023aa5ab50d) {$vb0ab4f7791b60b1e8ea01057b77873b0 = isset($vf1965a857bc285d26fe22023aa5ab50d['owner_id']) ? $vf1965a857bc285d26fe22023aa5ab50d['owner_id'] : null;if (!$this->isObjectHasBeenExported($vb0ab4f7791b60b1e8ea01057b77873b0)) {continue;}$v52a43e48ec4649dee819dadabcab1bde = isset($vf1965a857bc285d26fe22023aa5ab50d['module']) ? $vf1965a857bc285d26fe22023aa5ab50d['module'] : null;$vea9f6aca279138c58f705c8d4cb4b8ce = isset($vf1965a857bc285d26fe22023aa5ab50d['method']) ? $vf1965a857bc285d26fe22023aa5ab50d['method'] : null;$vb394126a0e52e75f1e3d535d0fb0d33c = isset($vf1965a857bc285d26fe22023aa5ab50d['allow']) ? $vf1965a857bc285d26fe22023aa5ab50d['allow'] : null;$v971db15640938b4f0571f6a2d94b6af6 = $this->doc->createElement('module');$v971db15640938b4f0571f6a2d94b6af6->setAttribute('name', $v52a43e48ec4649dee819dadabcab1bde);$v971db15640938b4f0571f6a2d94b6af6->setAttribute('method', $vea9f6aca279138c58f705c8d4cb4b8ce);$v971db15640938b4f0571f6a2d94b6af6->setAttribute('allow', $vb394126a0e52e75f1e3d535d0fb0d33c);if ($v86dce043678952b27d5b27a5296f020c) {$v971db15640938b4f0571f6a2d94b6af6->setAttribute('install-only', '1');}if (isset($permissions[$vb0ab4f7791b60b1e8ea01057b77873b0])) {$permissions[$vb0ab4f7791b60b1e8ea01057b77873b0]->appendChild($v971db15640938b4f0571f6a2d94b6af6);}else {$v3eab20b6b92c5ab57d985694bf131c51 = $this->doc->createElement('permission');$v3eab20b6b92c5ab57d985694bf131c51->setAttribute('object-id', $vb0ab4f7791b60b1e8ea01057b77873b0);$v3eab20b6b92c5ab57d985694bf131c51->appendChild($v971db15640938b4f0571f6a2d94b6af6);$permissions[$vb0ab4f7791b60b1e8ea01057b77873b0] = $v3eab20b6b92c5ab57d985694bf131c51;}}foreach ($permissions as $v3eab20b6b92c5ab57d985694bf131c51) {if ($v3eab20b6b92c5ab57d985694bf131c51->hasChildNodes()) {$this->permissions_container->appendChild($v3eab20b6b92c5ab57d985694bf131c51);}}return true;}private function shouldExportRelations() {return    !$this->ignoreRelations ||    in_array('fields_relations', $this->saveRelations) ||    in_array('relations', $this->saveRelations);}private function shouldExportSymlinks() {return    !$this->ignoreRelations ||    in_array('fields_relations', $this->saveRelations) ||    in_array('symlinks', $this->saveRelations);}private function shouldExportOptions() {return    !$this->ignoreRelations ||    in_array('fields_relations', $this->saveRelations) ||    in_array('options', $this->saveRelations);}}