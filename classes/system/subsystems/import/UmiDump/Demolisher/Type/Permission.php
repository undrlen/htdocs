<?php
 namespace UmiCms\System\Import\UmiDump\Demolisher\Type;use UmiCms\System\Import\UmiDump\Demolisher;use UmiCms\System\Permissions\iSystemUsersPermissions;class Permission extends Demolisher {private $permissionCollection;private $systemUsersPermissions;private $objectsCollection;public function __construct(   \iPermissionsCollection $v3e6d17f66651c4d9e5bed84613507302,   iSystemUsersPermissions $v1876714ec08549d69462e2d7617c83c8,   \iUmiObjectsCollection $v69ae498121c2d8e63f20c7144a0246d7  ) {$this->permissionCollection = $v3e6d17f66651c4d9e5bed84613507302;$this->systemUsersPermissions = $v1876714ec08549d69462e2d7617c83c8;$this->objectsCollection = $v69ae498121c2d8e63f20c7144a0246d7;}protected function execute() {$this->deleteModulePermissions();$this->deletePagePermissions();$this->resetObjectOwners();}private function deleteModulePermissions() {$v03baa892ab2c065dcd75086dfd3a5b1e = $this->getSourceIdBinder();$v52195dae0174459c5f066fa0df053c26 = $this->getSourceId();$v3e6d17f66651c4d9e5bed84613507302 = $this->getPermissionCollection();foreach ($this->getModulePermissionList() as $v7e6e27d400e19dff106a253aaa982ed9 => $va0b89a749f50a79c157f960b038236af) {$vb0ab4f7791b60b1e8ea01057b77873b0 = $v03baa892ab2c065dcd75086dfd3a5b1e->getNewObjectIdRelation($v52195dae0174459c5f066fa0df053c26, $v7e6e27d400e19dff106a253aaa982ed9);if (!$vb0ab4f7791b60b1e8ea01057b77873b0) {$this->pushLog(sprintf('Module permission with owner "%s" was ignored', $vb0ab4f7791b60b1e8ea01057b77873b0));continue;}foreach ($va0b89a749f50a79c157f960b038236af as $v4b65ca0f8b76e7181a12bf1fabc48532) {$v22884db148f0ffb0d830ba431102b0b5 = $v4b65ca0f8b76e7181a12bf1fabc48532['module'];$vea9f6aca279138c58f705c8d4cb4b8ce = $v4b65ca0f8b76e7181a12bf1fabc48532['method'];if ($vea9f6aca279138c58f705c8d4cb4b8ce) {$v3e6d17f66651c4d9e5bed84613507302->deleteMethodPermission($vb0ab4f7791b60b1e8ea01057b77873b0, $v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce);$v78e731027d8fd50ed642340b7c9a63b3 = sprintf(       'Method permission "%s:%s" with owner "%s" was deleted',       $v22884db148f0ffb0d830ba431102b0b5,       $vea9f6aca279138c58f705c8d4cb4b8ce,       $vb0ab4f7791b60b1e8ea01057b77873b0      );}else {$v3e6d17f66651c4d9e5bed84613507302->deleteModulePermission($vb0ab4f7791b60b1e8ea01057b77873b0, $v22884db148f0ffb0d830ba431102b0b5);$v78e731027d8fd50ed642340b7c9a63b3 = sprintf(       'Module permission "%s" with owner "%s" was deleted',       $v22884db148f0ffb0d830ba431102b0b5,       $vb0ab4f7791b60b1e8ea01057b77873b0      );}$this->pushLog($v78e731027d8fd50ed642340b7c9a63b3);}}}private function deletePagePermissions() {$v03baa892ab2c065dcd75086dfd3a5b1e = $this->getSourceIdBinder();$v52195dae0174459c5f066fa0df053c26 = $this->getSourceId();$v3e6d17f66651c4d9e5bed84613507302 = $this->getPermissionCollection();foreach ($this->getPagePermission() as $vc32f93b97487df243397614496865136 => $vce94a97c1f7c4a8602be635d29816932) {$va6eb4816205178e88dad66a16a19ff45 = $v03baa892ab2c065dcd75086dfd3a5b1e->getNewIdRelation($v52195dae0174459c5f066fa0df053c26, $vc32f93b97487df243397614496865136);if (!$va6eb4816205178e88dad66a16a19ff45) {$this->pushLog(sprintf('Page permission for page "%s" was ignored', $vc32f93b97487df243397614496865136));continue;}foreach ($vce94a97c1f7c4a8602be635d29816932 as $v7e6e27d400e19dff106a253aaa982ed9) {$vb0ab4f7791b60b1e8ea01057b77873b0 = $v03baa892ab2c065dcd75086dfd3a5b1e->getNewObjectIdRelation($v52195dae0174459c5f066fa0df053c26, $v7e6e27d400e19dff106a253aaa982ed9);if (!$vb0ab4f7791b60b1e8ea01057b77873b0) {$this->pushLog(sprintf(       'Page permission for page "%s" with owner "%s" was ignored', $va6eb4816205178e88dad66a16a19ff45, $v7e6e27d400e19dff106a253aaa982ed9      ));continue;}$v3e6d17f66651c4d9e5bed84613507302->resetElementPermissions($va6eb4816205178e88dad66a16a19ff45, $vb0ab4f7791b60b1e8ea01057b77873b0);$this->pushLog(sprintf(      'Page permission for page "%s" with owner "%s" was deleted', $va6eb4816205178e88dad66a16a19ff45, $vb0ab4f7791b60b1e8ea01057b77873b0     ));}}}private function resetObjectOwners() {$v03baa892ab2c065dcd75086dfd3a5b1e = $this->getSourceIdBinder();$v52195dae0174459c5f066fa0df053c26 = $this->getSourceId();$vfa5a883455df69e98c0f154ad0e5d47b = $this->getObjectCollection();$v241045209d1884511acb18dffbeb2641 = $this->getSystemUsersPermissions()    ->getSvUserId();foreach ($this->getObjectPermission() as $v2e793ac17f73fee604426a1e93a5b7db) {$v16b2b26000987faccb260b9d39df1269 = $v03baa892ab2c065dcd75086dfd3a5b1e->getNewObjectIdRelation($v52195dae0174459c5f066fa0df053c26, $v2e793ac17f73fee604426a1e93a5b7db);$va8cfde6331bd59eb2ac96f8911c4b666 = $vfa5a883455df69e98c0f154ad0e5d47b->getObject($v16b2b26000987faccb260b9d39df1269);if (!$va8cfde6331bd59eb2ac96f8911c4b666 instanceof \iUmiObject) {$this->pushLog(sprintf('Owner of object with id "%s" reset was ignored', $v2e793ac17f73fee604426a1e93a5b7db));continue;}$va8cfde6331bd59eb2ac96f8911c4b666->setOwnerId($v241045209d1884511acb18dffbeb2641);$va8cfde6331bd59eb2ac96f8911c4b666->commit();$this->pushLog(sprintf('Owner of object with id "%s" was reset', $v16b2b26000987faccb260b9d39df1269));$vfa5a883455df69e98c0f154ad0e5d47b->unloadObject($va8cfde6331bd59eb2ac96f8911c4b666->getId());}}private function getModulePermissionList() {$result = [];foreach ($this->parse('/umidump/permissions/permission') as $v4b65ca0f8b76e7181a12bf1fabc48532) {$v342ffc969bfcd7ea6436ad2934c01f28 = $v4b65ca0f8b76e7181a12bf1fabc48532->getAttribute('object-id');if (!$v342ffc969bfcd7ea6436ad2934c01f28) {continue;}foreach ($this->parse('module', $v4b65ca0f8b76e7181a12bf1fabc48532) as $v22884db148f0ffb0d830ba431102b0b5) {$vb068931cc450442b63f5b3d276ea4297 = $v22884db148f0ffb0d830ba431102b0b5->getAttribute('name');if (!$vb068931cc450442b63f5b3d276ea4297) {continue;}$result[$v342ffc969bfcd7ea6436ad2934c01f28][] = [      'module' => $vb068931cc450442b63f5b3d276ea4297,      'method' => $v22884db148f0ffb0d830ba431102b0b5->getAttribute('method')     ];}}return $result;}private function getPagePermission() {return $this->getNodeValueTree(    [],    '/umidump/permissions/permission',    'page-id',    'owner/@id'   );}private function getObjectPermission() {return $this->getNodeValueList('/umidump/permissions/permission/@object-id');}private function getPermissionCollection() {return $this->permissionCollection;}private function getSystemUsersPermissions() {return $this->systemUsersPermissions;}private function getObjectCollection() {return $this->objectsCollection;}}