<?php
 namespace UmiCms\Manifest\Migrate\Field;use UmiCms\Service;use UmiCms\System\Data\Object\Property\iRepository;use UmiCms\System\Data\Object\Property\Value\iMigration;class MoveValueAction extends \IterableAction {private $targetList = [];const LIMIT = 150;const OFFSET = 0;public function execute() {return $this->processTargetList([$this->getMigration(), 'migrate']);}public function rollback() {try {return $this->processTargetList([$this->getMigration(), 'rollback']);}catch (\Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {return $this;}}protected function loadTargetList() {$vec5417144d6345f378e17d0ee837affc = $this->getParam('target');if (!is_array($vec5417144d6345f378e17d0ee837affc)) {throw new \RuntimeException('Incorrect target list given: ' . var_export($vec5417144d6345f378e17d0ee837affc, true));}return $this->setTargetList($vec5417144d6345f378e17d0ee837affc);}protected function getFieldIdByTarget(array $v42aefbae01d2dfd981f7da7d823d689e) {if (!isset($v42aefbae01d2dfd981f7da7d823d689e['type-guid'], $v42aefbae01d2dfd981f7da7d823d689e['field'], $v42aefbae01d2dfd981f7da7d823d689e['from'])) {throw new \RuntimeException('Incorrect target given: ' . var_export($v42aefbae01d2dfd981f7da7d823d689e, true));}$v599dcce2998a6b40b1e38e8c6006cb0a = $this->getTypeCollection()    ->getTypeByGUID($v42aefbae01d2dfd981f7da7d823d689e['type-guid']);if (!$v599dcce2998a6b40b1e38e8c6006cb0a instanceof \iUmiObjectType) {throw new \RuntimeException('Incorrect type guid given: ' . var_export($v42aefbae01d2dfd981f7da7d823d689e['type-guid'], true));}return (int) $v599dcce2998a6b40b1e38e8c6006cb0a->getFieldId($v42aefbae01d2dfd981f7da7d823d689e['field']);}protected function getMigration() {return Service::get('ObjectPropertyValueDomainIdMigration');}protected function setTargetList(array $vec5417144d6345f378e17d0ee837affc) {$this->targetList = $vec5417144d6345f378e17d0ee837affc;return $this;}private function processTargetList(callable $vf7235a61fdc3adc78d866fd8085d44db) {$v9d44bee4fccc00cf807b1ecb141e7fe5 = true;foreach ($this->getTargetList() as $v6a992d5529f459a44fee58c733255e86 => $v42aefbae01d2dfd981f7da7d823d689e) {$vaf8d48af32658e6a3a8a993b8f80693b = $this->isReadyPart($v6a992d5529f459a44fee58c733255e86);$v9d44bee4fccc00cf807b1ecb141e7fe5 = $v9d44bee4fccc00cf807b1ecb141e7fe5 && $vaf8d48af32658e6a3a8a993b8f80693b;if ($vaf8d48af32658e6a3a8a993b8f80693b) {continue;}$ve80a65643b7f2cf6aa0c3ba27b789570 = true;foreach ($this->getPropertyList($v42aefbae01d2dfd981f7da7d823d689e) as $v1a8db4c996d8ed8289da5f957879ab94) {call_user_func_array($vf7235a61fdc3adc78d866fd8085d44db, [$v1a8db4c996d8ed8289da5f957879ab94, $v42aefbae01d2dfd981f7da7d823d689e['from']]);$ve80a65643b7f2cf6aa0c3ba27b789570 = false;}if ($ve80a65643b7f2cf6aa0c3ba27b789570) {$this->setPartIsReady($v6a992d5529f459a44fee58c733255e86);}else {break;}}if ($v9d44bee4fccc00cf807b1ecb141e7fe5) {$this->setIsReady();$this->resetState();}$this->saveState();return $this;}private function getPropertyList(array $v42aefbae01d2dfd981f7da7d823d689e) {$v945100186b119048837b9859c2c46410 = $this->getFieldIdByTarget($v42aefbae01d2dfd981f7da7d823d689e);$v99ac724d387523f1349bf0bdeef6eb44 = $v42aefbae01d2dfd981f7da7d823d689e['from'];return $this->getRepository()    ->getListByFieldId($v945100186b119048837b9859c2c46410, self::LIMIT, self::OFFSET, $v99ac724d387523f1349bf0bdeef6eb44);}private function getTargetList() {if (isEmptyArray($this->targetList)) {$this->loadTargetList();}return $this->targetList;}private function setPartIsReady($v6a992d5529f459a44fee58c733255e86) {$v6042a4798110acdae66872db90c6ba38 = (array) $this->getStatePart('readiness');$v6042a4798110acdae66872db90c6ba38[$v6a992d5529f459a44fee58c733255e86] = true;return $this->setStatePart('readiness', $v6042a4798110acdae66872db90c6ba38);}private function isReadyPart($v6a992d5529f459a44fee58c733255e86) {$v6042a4798110acdae66872db90c6ba38 = (array) $this->getStatePart('readiness');return isset($v6042a4798110acdae66872db90c6ba38[$v6a992d5529f459a44fee58c733255e86]) ? (bool) $v6042a4798110acdae66872db90c6ba38[$v6a992d5529f459a44fee58c733255e86] : false;}private function getTypeCollection() {return \umiObjectTypesCollection::getInstance();}private function getRepository() {return Service::get('ObjectPropertyRepository');}}