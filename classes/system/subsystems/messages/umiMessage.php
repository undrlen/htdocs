<?php
 use UmiCms\Service;class umiMessage extends umiEntinty implements iUmiMessage {protected $store_type = 'message', $title, $content, $senderId, $createTime, $type, $priority, $isSended;public function getTitle() {return $this->title;}public function setTitle($vd5d3db1765287eef77d7927cc956f50a) {$vd5d3db1765287eef77d7927cc956f50a = (string) $vd5d3db1765287eef77d7927cc956f50a;if ($this->getTitle() != $vd5d3db1765287eef77d7927cc956f50a) {$this->title = $vd5d3db1765287eef77d7927cc956f50a;$this->setIsUpdated();}}public function getContent() {return $this->content;}public function setContent($v9a0364b9e99bb480dd25e1f0284c8555) {$v9a0364b9e99bb480dd25e1f0284c8555 = (string) $v9a0364b9e99bb480dd25e1f0284c8555;if ($this->getContent() != $v9a0364b9e99bb480dd25e1f0284c8555) {$this->content = $v9a0364b9e99bb480dd25e1f0284c8555;$this->setIsUpdated();}}public function getSenderId() {return $this->senderId;}public function setSenderId($v3b8cb51bd8c4ef331893ce61e3f3bc39 = null) {$v3b8cb51bd8c4ef331893ce61e3f3bc39 = (int) $v3b8cb51bd8c4ef331893ce61e3f3bc39;if ($this->getSenderId() != $v3b8cb51bd8c4ef331893ce61e3f3bc39) {$this->senderId = $v3b8cb51bd8c4ef331893ce61e3f3bc39;$this->setIsUpdated();}}public function getType() {return $this->type;}public function setType($v599dcce2998a6b40b1e38e8c6006cb0a) {$v599dcce2998a6b40b1e38e8c6006cb0a = (string) $v599dcce2998a6b40b1e38e8c6006cb0a;if (!in_array($v599dcce2998a6b40b1e38e8c6006cb0a, umiMessages::getAllowedTypes())) {throw new coreException("Unknown message type \"{$v599dcce2998a6b40b1e38e8c6006cb0a}\"");}if ($this->getType() != $v599dcce2998a6b40b1e38e8c6006cb0a) {$this->type = $v599dcce2998a6b40b1e38e8c6006cb0a;$this->setIsUpdated();}}public function getPriority() {return $this->priority;}public function setPriority($vb988295c268025b49dfb3df26171ddc3 = 0) {$vb988295c268025b49dfb3df26171ddc3 = (int) $vb988295c268025b49dfb3df26171ddc3;if ($this->getPriority() != $vb988295c268025b49dfb3df26171ddc3) {$this->priority = $vb988295c268025b49dfb3df26171ddc3;$this->setIsUpdated();}}public function getCreateTime() {return $this->createTime;}public function setCreateTime($v07cc694b9b3fc636710fa08b6922c42b) {$v07cc694b9b3fc636710fa08b6922c42b = ($v07cc694b9b3fc636710fa08b6922c42b instanceof umiDate) ? $v07cc694b9b3fc636710fa08b6922c42b : new umiDate($v07cc694b9b3fc636710fa08b6922c42b);if ($this->getCreateTime()->getDateTimeStamp() != $v07cc694b9b3fc636710fa08b6922c42b->getDateTimeStamp()) {$this->createTime = $v07cc694b9b3fc636710fa08b6922c42b;$this->setIsUpdated();}}public function getIsSended() {return $this->isSended;}public function getRecipients() {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$vb80bb7740288fda1f201890375a60c8f = (int) $this->id;$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT `recipient_id` FROM `cms3_messages_inbox` WHERE `message_id` = '{$vb80bb7740288fda1f201890375a60c8f}'
SQL;   $result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);$result->setFetchType(IQueryResult::FETCH_ROW);$v972af69bf73f8ad23a446a346a6f0fff = [];foreach ($result as $vf1965a857bc285d26fe22023aa5ab50d) {$v972af69bf73f8ad23a446a346a6f0fff[] = array_shift($vf1965a857bc285d26fe22023aa5ab50d);}return $v972af69bf73f8ad23a446a346a6f0fff;}public function send($v972af69bf73f8ad23a446a346a6f0fff) {if ($this->getIsSended()) {return false;}if (umiCount($v972af69bf73f8ad23a446a346a6f0fff)) {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$vf39cb51688b94030135fa75837c55ac2 = implode(', ', array_map('intval', $v972af69bf73f8ad23a446a346a6f0fff));$vb80bb7740288fda1f201890375a60c8f = (int) $this->id;$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
INSERT INTO `cms3_messages_inbox`
	(`message_id`, `recipient_id`)
		SELECT '{$vb80bb7740288fda1f201890375a60c8f}', `id` FROM `cms3_objects`
			WHERE `id` IN ({$vf39cb51688b94030135fa75837c55ac2})
SQL;    $v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);}$this->setIsSended(true);$this->setIsUpdated();}public function setIsOpened($v007be202b67f2d1fba402fe1b3b078e5, $v8e44f0089b076e18a718eb9ca3d94674 = false) {if ($v8e44f0089b076e18a718eb9ca3d94674) {$v8e44f0089b076e18a718eb9ca3d94674 = (int) $v8e44f0089b076e18a718eb9ca3d94674;}else {$vfa53b91ccc1b78668d5af58e1ed3a485 = Service::Auth();$v8e44f0089b076e18a718eb9ca3d94674 = $vfa53b91ccc1b78668d5af58e1ed3a485->getUserId();}$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$v007be202b67f2d1fba402fe1b3b078e5 = (int) $v007be202b67f2d1fba402fe1b3b078e5;$vb80bb7740288fda1f201890375a60c8f = (int) $this->id;$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
UPDATE `cms3_messages_inbox` SET `is_opened` = '{$v007be202b67f2d1fba402fe1b3b078e5}' WHERE `message_id` = '{$vb80bb7740288fda1f201890375a60c8f}' AND `recipient_id` = '{$v8e44f0089b076e18a718eb9ca3d94674}'
SQL;   $v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);}private function setIsSended($v9c014ff3d8d453a6273a3384feca7414) {$v9c014ff3d8d453a6273a3384feca7414 = (bool) $v9c014ff3d8d453a6273a3384feca7414;if ($this->getIsSended() != $v9c014ff3d8d453a6273a3384feca7414) {$this->isSended = $v9c014ff3d8d453a6273a3384feca7414;$this->setIsUpdated();}}protected function loadInfo($vf1965a857bc285d26fe22023aa5ab50d = false) {if (!is_array($vf1965a857bc285d26fe22023aa5ab50d) || count($vf1965a857bc285d26fe22023aa5ab50d) < 8) {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$v817f7de13f58df29b13a9570082097da = (int) $this->getId();$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT `id`, `title`, `content`, `sender_id`, `create_time`, `type`, `priority`, `is_sended`
	FROM `cms3_messages` WHERE `id` = $v817f7de13f58df29b13a9570082097da LIMIT 0,1
SQL;    $result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);$result->setFetchType(IQueryResult::FETCH_ROW);$vf1965a857bc285d26fe22023aa5ab50d = $result->fetch();}if (!is_array($vf1965a857bc285d26fe22023aa5ab50d) || count($vf1965a857bc285d26fe22023aa5ab50d) < 8) {return false;}list($vb80bb7740288fda1f201890375a60c8f, $vd5d3db1765287eef77d7927cc956f50a, $v9a0364b9e99bb480dd25e1f0284c8555, $v3b8cb51bd8c4ef331893ce61e3f3bc39, $v1ed2e1b19b6e55d52d2473be17a4afd9, $v599dcce2998a6b40b1e38e8c6006cb0a, $vb988295c268025b49dfb3df26171ddc3, $v57bdf2ced5c364d8a040512e00c051d2) = $vf1965a857bc285d26fe22023aa5ab50d;$this->title = (string) $vd5d3db1765287eef77d7927cc956f50a;$this->content = (string) $v9a0364b9e99bb480dd25e1f0284c8555;$this->senderId = (int) $v3b8cb51bd8c4ef331893ce61e3f3bc39;$this->createTime = new umiDate($v1ed2e1b19b6e55d52d2473be17a4afd9);$this->type = (string) $v599dcce2998a6b40b1e38e8c6006cb0a;$this->priority = (int) $vb988295c268025b49dfb3df26171ddc3;$this->isSended = (bool) $v57bdf2ced5c364d8a040512e00c051d2;return true;}protected function save() {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$vd5d3db1765287eef77d7927cc956f50a = $v4717d53ebfdfea8477f780ec66151dcb->escape($this->title);$v9a0364b9e99bb480dd25e1f0284c8555 = $v4717d53ebfdfea8477f780ec66151dcb->escape($this->content);$v3b8cb51bd8c4ef331893ce61e3f3bc39 = $this->senderId ?: 'NULL';$v1ed2e1b19b6e55d52d2473be17a4afd9 = $this->createTime->getDateTimeStamp();$vb988295c268025b49dfb3df26171ddc3 = (int) $this->priority;$v599dcce2998a6b40b1e38e8c6006cb0a = $this->type;$v9c014ff3d8d453a6273a3384feca7414 = (int) $this->isSended;$vb80bb7740288fda1f201890375a60c8f = (int) $this->id;$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
UPDATE `cms3_messages`
	SET `title` = '{$vd5d3db1765287eef77d7927cc956f50a}', `content` = '{$v9a0364b9e99bb480dd25e1f0284c8555}',
		`create_time` = '{$v1ed2e1b19b6e55d52d2473be17a4afd9}', `priority` = '{$vb988295c268025b49dfb3df26171ddc3}',
		`type` = '{$v599dcce2998a6b40b1e38e8c6006cb0a}', `sender_id` = {$v3b8cb51bd8c4ef331893ce61e3f3bc39}, `is_sended` = '{$v9c014ff3d8d453a6273a3384feca7414}'
			WHERE `id` = '{$vb80bb7740288fda1f201890375a60c8f}'
SQL;   $v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);}public function __destruct() {}}