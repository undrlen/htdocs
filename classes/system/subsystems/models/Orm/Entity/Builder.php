<?php
 namespace UmiCms\System\Orm\Entity;use UmiCms\System\Orm\iEntity;use UmiCms\System\Orm\Entity\Mapper\tInjector as tMapperInjector;use UmiCms\System\Orm\Entity\Relation\Mutator\tInjector as tRelationMutatorInjector;use UmiCms\System\Orm\Entity\Attribute\Mutator\tInjector as tAttributeMutatorInjector;use UmiCms\System\Orm\Entity\Attribute\Accessor\tInjector as tAttributeAccessorInjector;abstract class Builder implements iBuilder {use tMapperInjector;use tRelationMutatorInjector;use tAttributeMutatorInjector;use tAttributeAccessorInjector;private $serviceContainer;public function __construct(   iMapper $v4b9f83e1257a95912768124924dfb143,   \iServiceContainer $v06d419f75cbecf6df5a44ea9471105ba,   iMutator $vb6276ef330616bdbebda986ca9abe267,   iAccessor $v4209ae65645472477d5389fe6ba7c0fa,   iMutator $v2c6eb8b452b2d4aeef2c89598b09f5f5  ) {$this->setMapper($v4b9f83e1257a95912768124924dfb143)    ->setServiceContainer($v06d419f75cbecf6df5a44ea9471105ba)    ->setRelationMutator($vb6276ef330616bdbebda986ca9abe267)    ->setAttributeAccessor($v4209ae65645472477d5389fe6ba7c0fa)    ->setAttributeMutator($v2c6eb8b452b2d4aeef2c89598b09f5f5);}public function buildAllRelations(iEntity $vf5e638cc78dd325906c1298a0c21fb6b) {foreach ($this->getMapper()->getRelationSchemaList() as $v2617c9384e4bb1af369e034ffd4490c9 => $vc9550d5fad73447fc24ba47f95d1c6b7) {$this->buildRelation($vf5e638cc78dd325906c1298a0c21fb6b, $v2617c9384e4bb1af369e034ffd4490c9, $vc9550d5fad73447fc24ba47f95d1c6b7);}return $vf5e638cc78dd325906c1298a0c21fb6b;}public function buildAttributesList(iEntity $vf5e638cc78dd325906c1298a0c21fb6b, array $v6dd047148d685270458ecc44ee128a4d) {return $this->getAttributeMutator()    ->mutateList($vf5e638cc78dd325906c1298a0c21fb6b, $v6dd047148d685270458ecc44ee128a4d);}public function buildAllRelationsForCollection(iCollection $vdb6d9b451b818ccc9a449383f2f0c450) {if ($vdb6d9b451b818ccc9a449383f2f0c450->getCount() === 0) {return $vdb6d9b451b818ccc9a449383f2f0c450;}foreach ($this->getMapper()->getRelationSchemaList() as $v2617c9384e4bb1af369e034ffd4490c9 => $vc9550d5fad73447fc24ba47f95d1c6b7) {$this->buildRelationForCollection($vdb6d9b451b818ccc9a449383f2f0c450, $v2617c9384e4bb1af369e034ffd4490c9, $vc9550d5fad73447fc24ba47f95d1c6b7);}return $vdb6d9b451b818ccc9a449383f2f0c450;}public function buildAttributesListForMany(array $v8e4a156539e5e358472044b3e46a1fa1, array $v3c8f981e1c2c882508f219cdbd2032e4) {$v2c6eb8b452b2d4aeef2c89598b09f5f5 = $this->getAttributeMutator();foreach ($v3c8f981e1c2c882508f219cdbd2032e4 as $v6a992d5529f459a44fee58c733255e86 => $v6dd047148d685270458ecc44ee128a4d) {if (!$v8e4a156539e5e358472044b3e46a1fa1[$v6a992d5529f459a44fee58c733255e86] || !$v8e4a156539e5e358472044b3e46a1fa1[$v6a992d5529f459a44fee58c733255e86] instanceof iEntity) {throw new \ErrorException('Incorrect arguments given');}$vf5e638cc78dd325906c1298a0c21fb6b = $v8e4a156539e5e358472044b3e46a1fa1[$v6a992d5529f459a44fee58c733255e86];$v2c6eb8b452b2d4aeef2c89598b09f5f5->mutateList($vf5e638cc78dd325906c1298a0c21fb6b, $v6dd047148d685270458ecc44ee128a4d);}return $v8e4a156539e5e358472044b3e46a1fa1;}public function buildOneRelation(iEntity $vf5e638cc78dd325906c1298a0c21fb6b, $v2617c9384e4bb1af369e034ffd4490c9) {$vc9550d5fad73447fc24ba47f95d1c6b7 = $this->getMapper()->getRelationSchema($v2617c9384e4bb1af369e034ffd4490c9);return $this->buildRelation($vf5e638cc78dd325906c1298a0c21fb6b, $v2617c9384e4bb1af369e034ffd4490c9, $vc9550d5fad73447fc24ba47f95d1c6b7);}public function buildOneAttribute(iEntity $vf5e638cc78dd325906c1298a0c21fb6b, $vd2eb444e35c0a71f0a85df8194acb5b6, $v2063c1608d6e0baf80249c42e2be5804) {return $this->getAttributeMutator()    ->mutate($vf5e638cc78dd325906c1298a0c21fb6b, $vd2eb444e35c0a71f0a85df8194acb5b6, $v2063c1608d6e0baf80249c42e2be5804);}public function buildOneRelationForCollection(iCollection $vdb6d9b451b818ccc9a449383f2f0c450, $v2617c9384e4bb1af369e034ffd4490c9) {if ($vdb6d9b451b818ccc9a449383f2f0c450->getCount() === 0) {return $vdb6d9b451b818ccc9a449383f2f0c450;}$vc9550d5fad73447fc24ba47f95d1c6b7 = $this->getMapper()->getRelationSchema($v2617c9384e4bb1af369e034ffd4490c9);return $this->buildRelationForCollection($vdb6d9b451b818ccc9a449383f2f0c450, $v2617c9384e4bb1af369e034ffd4490c9, $vc9550d5fad73447fc24ba47f95d1c6b7);}public function buildRelationListForCollection(iCollection $vdb6d9b451b818ccc9a449383f2f0c450, array $v8f860260e98c7b73cb53d4d3eba7f7f8) {if ($vdb6d9b451b818ccc9a449383f2f0c450->getCount() === 0) {return $vdb6d9b451b818ccc9a449383f2f0c450;}foreach ($v8f860260e98c7b73cb53d4d3eba7f7f8 as $v2617c9384e4bb1af369e034ffd4490c9) {$this->buildOneRelationForCollection($vdb6d9b451b818ccc9a449383f2f0c450, $v2617c9384e4bb1af369e034ffd4490c9);}return $vdb6d9b451b818ccc9a449383f2f0c450;}protected function buildRelationForCollection(iCollection $vdb6d9b451b818ccc9a449383f2f0c450, $v2617c9384e4bb1af369e034ffd4490c9,  array $vc9550d5fad73447fc24ba47f95d1c6b7) {list($vbb1df230a5150b8ac17121321b3b514c, $v0f096338b64a1d1b348b86df38313c01, $v599dcce2998a6b40b1e38e8c6006cb0a) = $vc9550d5fad73447fc24ba47f95d1c6b7;$v5a2576254d428ddc22a03fac145c8749 = $vdb6d9b451b818ccc9a449383f2f0c450->extractField($vbb1df230a5150b8ac17121321b3b514c);$vaaabf0d39951f3e6c3e8a7911df524c2 = $this->getServiceContainer()->get($v0f096338b64a1d1b348b86df38313c01);$v40f3468cd695958c102d657febf859cc = new \ReflectionClass($vdb6d9b451b818ccc9a449383f2f0c450->getFirst());$v2e7600cad71dd506a69b4b817ce3bfa1 = $this->getReferredIdField($v40f3468cd695958c102d657febf859cc);$vb6276ef330616bdbebda986ca9abe267 = $this->getRelationMutator();$v4209ae65645472477d5389fe6ba7c0fa = $this->getAttributeAccessor();$ve6498ce498a90ba6ffb84132a321ea00 = [    mb_convert_case($v40f3468cd695958c102d657febf859cc->getShortName(), MB_CASE_LOWER)   ];switch ($v599dcce2998a6b40b1e38e8c6006cb0a) {case iMapper::ONE_ID_TO_ONE: {if ($vaaabf0d39951f3e6c3e8a7911df524c2 instanceof iFacade) {$vcbe6e1cbe2875d245903c7675a98bcae = $vaaabf0d39951f3e6c3e8a7911df524c2->getCollectionByIdList($v5a2576254d428ddc22a03fac145c8749);$vaaabf0d39951f3e6c3e8a7911df524c2->loadRelations($vcbe6e1cbe2875d245903c7675a98bcae, $ve6498ce498a90ba6ffb84132a321ea00);$v421d14d5ca33b2914b4a28a0a86692c0 = $vcbe6e1cbe2875d245903c7675a98bcae->getList();}else {$v421d14d5ca33b2914b4a28a0a86692c0 = $vaaabf0d39951f3e6c3e8a7911df524c2->getList($v5a2576254d428ddc22a03fac145c8749);}foreach ($vdb6d9b451b818ccc9a449383f2f0c450 as $vf5e638cc78dd325906c1298a0c21fb6b) {foreach ($v421d14d5ca33b2914b4a28a0a86692c0 as $ve54debd65d8142e7785275aab411fd8f) {if ($v4209ae65645472477d5389fe6ba7c0fa->accessOne($vf5e638cc78dd325906c1298a0c21fb6b, $vbb1df230a5150b8ac17121321b3b514c) != $ve54debd65d8142e7785275aab411fd8f->getId()) {continue;}$vb6276ef330616bdbebda986ca9abe267->mutate($vf5e638cc78dd325906c1298a0c21fb6b, $v2617c9384e4bb1af369e034ffd4490c9, $ve54debd65d8142e7785275aab411fd8f);}}break;}case iMapper::ONE_ID_TO_COLLECTION: {$vcbe6e1cbe2875d245903c7675a98bcae = $vaaabf0d39951f3e6c3e8a7911df524c2->getCollectionByValueList($v2e7600cad71dd506a69b4b817ce3bfa1, $v5a2576254d428ddc22a03fac145c8749);if ($vaaabf0d39951f3e6c3e8a7911df524c2 instanceof iFacade) {$vaaabf0d39951f3e6c3e8a7911df524c2->loadRelations($vcbe6e1cbe2875d245903c7675a98bcae, $ve6498ce498a90ba6ffb84132a321ea00);}foreach ($vdb6d9b451b818ccc9a449383f2f0c450 as $vf5e638cc78dd325906c1298a0c21fb6b) {$v01710f5d1472c400f7e9f4d858037663 = $vcbe6e1cbe2875d245903c7675a98bcae->copy()->filter([       $v2e7600cad71dd506a69b4b817ce3bfa1 => [        iCollection::COMPARE_TYPE_EQUALS => $vf5e638cc78dd325906c1298a0c21fb6b->getId()       ]      ]);$vb6276ef330616bdbebda986ca9abe267->mutate($vf5e638cc78dd325906c1298a0c21fb6b, $v2617c9384e4bb1af369e034ffd4490c9, $v01710f5d1472c400f7e9f4d858037663);}break;}case iMapper::ONE_ENTITY_TO_COLLECTION: {$vea9f6aca279138c58f705c8d4cb4b8ce = sprintf('getCollectionBy%sCollection', $v40f3468cd695958c102d657febf859cc->getShortName());$vcbe6e1cbe2875d245903c7675a98bcae = $vaaabf0d39951f3e6c3e8a7911df524c2->$vea9f6aca279138c58f705c8d4cb4b8ce($vdb6d9b451b818ccc9a449383f2f0c450);if ($vaaabf0d39951f3e6c3e8a7911df524c2 instanceof iFacade) {$vaaabf0d39951f3e6c3e8a7911df524c2->loadRelations($vcbe6e1cbe2875d245903c7675a98bcae, $ve6498ce498a90ba6ffb84132a321ea00);}foreach ($vdb6d9b451b818ccc9a449383f2f0c450 as $vf5e638cc78dd325906c1298a0c21fb6b) {$v01710f5d1472c400f7e9f4d858037663 = $vcbe6e1cbe2875d245903c7675a98bcae->copy()->filter([       $vbb1df230a5150b8ac17121321b3b514c => [        iCollection::COMPARE_TYPE_EQUALS => $v4209ae65645472477d5389fe6ba7c0fa->accessOne($vf5e638cc78dd325906c1298a0c21fb6b, $vbb1df230a5150b8ac17121321b3b514c)       ]      ]);$vb6276ef330616bdbebda986ca9abe267->mutate($vf5e638cc78dd325906c1298a0c21fb6b, $v2617c9384e4bb1af369e034ffd4490c9, $v01710f5d1472c400f7e9f4d858037663);}}}return $vdb6d9b451b818ccc9a449383f2f0c450;}private function getReferredIdField(\ReflectionClass $v40f3468cd695958c102d657febf859cc) {$vaa63ebf40be9280b0fab9e5ff10d473a = mb_convert_case($v40f3468cd695958c102d657febf859cc->getShortName(), MB_CASE_LOWER);return sprintf('%s_id', $vaa63ebf40be9280b0fab9e5ff10d473a);}protected function buildRelation(iEntity $vf5e638cc78dd325906c1298a0c21fb6b, $v2617c9384e4bb1af369e034ffd4490c9, array $vc9550d5fad73447fc24ba47f95d1c6b7) {list($vbb1df230a5150b8ac17121321b3b514c, $v0f096338b64a1d1b348b86df38313c01, $v599dcce2998a6b40b1e38e8c6006cb0a) = $vc9550d5fad73447fc24ba47f95d1c6b7;$vb80bb7740288fda1f201890375a60c8f = $this->getAttributeAccessor()    ->accessOne($vf5e638cc78dd325906c1298a0c21fb6b, $vbb1df230a5150b8ac17121321b3b514c);$ve54debd65d8142e7785275aab411fd8f = $this->getDependency($vb80bb7740288fda1f201890375a60c8f, $v0f096338b64a1d1b348b86df38313c01, $v599dcce2998a6b40b1e38e8c6006cb0a, $vf5e638cc78dd325906c1298a0c21fb6b);if ($ve54debd65d8142e7785275aab411fd8f === null) {return $vf5e638cc78dd325906c1298a0c21fb6b;}return $this->getRelationMutator()    ->mutate($vf5e638cc78dd325906c1298a0c21fb6b, $v2617c9384e4bb1af369e034ffd4490c9, $ve54debd65d8142e7785275aab411fd8f);}protected function getDependency($vb80bb7740288fda1f201890375a60c8f, $v0f096338b64a1d1b348b86df38313c01, $v599dcce2998a6b40b1e38e8c6006cb0a, iEntity $vf5e638cc78dd325906c1298a0c21fb6b) {$ve54debd65d8142e7785275aab411fd8f = null;$vaaabf0d39951f3e6c3e8a7911df524c2 = $this->getServiceContainer()->get($v0f096338b64a1d1b348b86df38313c01);$v40f3468cd695958c102d657febf859cc = new \ReflectionClass($vf5e638cc78dd325906c1298a0c21fb6b);$v2e7600cad71dd506a69b4b817ce3bfa1 = $this->getReferredIdField($v40f3468cd695958c102d657febf859cc);switch ($v599dcce2998a6b40b1e38e8c6006cb0a) {case iMapper::ONE_ID_TO_ONE: {$ve54debd65d8142e7785275aab411fd8f = $vaaabf0d39951f3e6c3e8a7911df524c2->get($vb80bb7740288fda1f201890375a60c8f);break;}case iMapper::ONE_ID_TO_COLLECTION: {$ve54debd65d8142e7785275aab411fd8f = $vaaabf0d39951f3e6c3e8a7911df524c2->getCollectionBy($v2e7600cad71dd506a69b4b817ce3bfa1, $vb80bb7740288fda1f201890375a60c8f);break;}case iMapper::ONE_ENTITY_TO_COLLECTION: {$vea9f6aca279138c58f705c8d4cb4b8ce = sprintf('getCollectionBy%s', $v40f3468cd695958c102d657febf859cc->getShortName());$ve54debd65d8142e7785275aab411fd8f = $vaaabf0d39951f3e6c3e8a7911df524c2->$vea9f6aca279138c58f705c8d4cb4b8ce($vf5e638cc78dd325906c1298a0c21fb6b);break;}}return $ve54debd65d8142e7785275aab411fd8f;}protected function setServiceContainer(\iServiceContainer $v5f0b6ebc4bea10285ba2b8a6ce78b863) {$this->serviceContainer = $v5f0b6ebc4bea10285ba2b8a6ce78b863;return $this;}protected function getServiceContainer() {return $this->serviceContainer;}}