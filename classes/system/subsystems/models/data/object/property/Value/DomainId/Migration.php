<?php
 namespace UmiCms\System\Data\Object\Property\Value\DomainId;use UmiCms\System\Data\Object\Property\Value\iMigration;use UmiCms\System\Data\Object\Property\Value\Migration as AbstractMigration;class Migration extends AbstractMigration implements iMigration {public function migrate(\iUmiObjectProperty $v1a8db4c996d8ed8289da5f957879ab94, $v99ac724d387523f1349bf0bdeef6eb44) {return $this->moveValues($v1a8db4c996d8ed8289da5f957879ab94, $v99ac724d387523f1349bf0bdeef6eb44, $v1a8db4c996d8ed8289da5f957879ab94->getDataType());}public function rollback(\iUmiObjectProperty $v1a8db4c996d8ed8289da5f957879ab94, $v99ac724d387523f1349bf0bdeef6eb44) {return $this->moveValues($v1a8db4c996d8ed8289da5f957879ab94, $v1a8db4c996d8ed8289da5f957879ab94->getDataType(), $v99ac724d387523f1349bf0bdeef6eb44);}protected function moveValues(\iUmiObjectProperty $v1a8db4c996d8ed8289da5f957879ab94, $vc78df1026a28909113fcc1b186b06635, $vba54548af18809208473a13abffc7d78) {$v4717d53ebfdfea8477f780ec66151dcb = $this->getConnection();$v1ddcb92ade31c8fbd370001f9b29a7d9 = 'Migrate property value "%s" from "%s" to "%s"';$v78e731027d8fd50ed642340b7c9a63b3 = sprintf($v1ddcb92ade31c8fbd370001f9b29a7d9, $v1a8db4c996d8ed8289da5f957879ab94->getName(), $vc78df1026a28909113fcc1b186b06635, $vba54548af18809208473a13abffc7d78);$v4717d53ebfdfea8477f780ec66151dcb->startTransaction($v78e731027d8fd50ed642340b7c9a63b3);try {$vc9550d5fad73447fc24ba47f95d1c6b7 = $this->getSchema();$v625625b1f489b315f41731195503e54e = $vc9550d5fad73447fc24ba47f95d1c6b7->getDomainIdTable();$v4ebc27e9a8db8aa688796e687f4909a9 = $vc9550d5fad73447fc24ba47f95d1c6b7->getDefaultTable();$v3dff5790af2c99b97b4b297f2f9d3bba = $this->getColumnByDataType($vc78df1026a28909113fcc1b186b06635);$v2c09040764eb08bb79cd85132469c697 = $this->getColumnByDataType($vba54548af18809208473a13abffc7d78);$va3ea25e2c9b7f4638e04e3495ec2aa7b = ($v3dff5790af2c99b97b4b297f2f9d3bba === 'domain_id') ? $v625625b1f489b315f41731195503e54e : $v4ebc27e9a8db8aa688796e687f4909a9;$v5ca4a04647f4f60bb3e88f2fe4bce1b3 = ($va3ea25e2c9b7f4638e04e3495ec2aa7b === $v625625b1f489b315f41731195503e54e) ? $v4ebc27e9a8db8aa688796e687f4909a9 : $v625625b1f489b315f41731195503e54e;$this->deleteInconsistentRows($v1a8db4c996d8ed8289da5f957879ab94, $va3ea25e2c9b7f4638e04e3495ec2aa7b, $v3dff5790af2c99b97b4b297f2f9d3bba);$this->moveRowsToTarget($v1a8db4c996d8ed8289da5f957879ab94, $va3ea25e2c9b7f4638e04e3495ec2aa7b, $v3dff5790af2c99b97b4b297f2f9d3bba, $v5ca4a04647f4f60bb3e88f2fe4bce1b3, $v2c09040764eb08bb79cd85132469c697);$this->deleteSourceRows($v1a8db4c996d8ed8289da5f957879ab94, $va3ea25e2c9b7f4638e04e3495ec2aa7b);}catch (\databaseException $v42552b1f133f9f8eb406d4f306ea9fd1) {$v4717d53ebfdfea8477f780ec66151dcb->rollbackTransaction();throw $v42552b1f133f9f8eb406d4f306ea9fd1;}$v4717d53ebfdfea8477f780ec66151dcb->commitTransaction();return $this;}private function deleteInconsistentRows(\iUmiObjectProperty $v1a8db4c996d8ed8289da5f957879ab94, $va3ea25e2c9b7f4638e04e3495ec2aa7b, $v3dff5790af2c99b97b4b297f2f9d3bba) {$v16b2b26000987faccb260b9d39df1269 = $v1a8db4c996d8ed8289da5f957879ab94->getObjectId();$v945100186b119048837b9859c2c46410 = $v1a8db4c996d8ed8289da5f957879ab94->getFieldId();$v26549ba3ca6f190ace0b2fa7c9b6b049 = <<<SQL
DELETE FROM `$va3ea25e2c9b7f4638e04e3495ec2aa7b` WHERE `obj_id` = $v16b2b26000987faccb260b9d39df1269 AND `field_id` = $v945100186b119048837b9859c2c46410  
AND `$v3dff5790af2c99b97b4b297f2f9d3bba` NOT IN (SELECT `id` FROM `cms3_domains`)
SQL;   $this->getConnection()    ->query($v26549ba3ca6f190ace0b2fa7c9b6b049);return $this;}}