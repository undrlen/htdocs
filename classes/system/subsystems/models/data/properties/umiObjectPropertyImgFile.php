<?php
 use UmiCms\Service;class umiObjectPropertyImgFile extends umiObjectProperty {const SINGLE_IMAGE_ORDER = 1;protected function loadValue() {$v0fea6a13c52b4d4725368f24b045ca84 = $this->getPropData();if (isset($v0fea6a13c52b4d4725368f24b045ca84['img_val']) && is_array($v0fea6a13c52b4d4725368f24b045ca84['img_val'])) {return $this->getFromCache($v0fea6a13c52b4d4725368f24b045ca84['img_val']);}$v80071f37861c360a27b7327e132c911a = $this->getTableName();$v16b2b26000987faccb260b9d39df1269 = (int) $this->getObjectId();$v945100186b119048837b9859c2c46410 = (int) $this->getFieldId();$vef5714e0519bfaa645cdff7d28843b70 = <<<SQL
SELECT `id`, `src`, `alt`, `title`, `ord`
FROM `$v80071f37861c360a27b7327e132c911a`
WHERE `obj_id` = $v16b2b26000987faccb260b9d39df1269 AND `field_id` = $v945100186b119048837b9859c2c46410;
SQL;   $result = $this->getConnection()    ->queryResult($vef5714e0519bfaa645cdff7d28843b70)    ->setFetchType(IQueryResult::FETCH_ASSOC);$v72bc6e7707131edcbe44c867e3bc83e1 = [];foreach ($result as $vf1965a857bc285d26fe22023aa5ab50d) {$v72bc6e7707131edcbe44c867e3bc83e1[] = $this->mapImage($vf1965a857bc285d26fe22023aa5ab50d);}return $this->filterBrokenImages($v72bc6e7707131edcbe44c867e3bc83e1);}protected function getFromCache(array $v0fea6a13c52b4d4725368f24b045ca84) {$v72bc6e7707131edcbe44c867e3bc83e1 = [];foreach ($v0fea6a13c52b4d4725368f24b045ca84 as $vf1965a857bc285d26fe22023aa5ab50d) {$v72bc6e7707131edcbe44c867e3bc83e1[] = $this->mapImage($vf1965a857bc285d26fe22023aa5ab50d);}return $this->filterBrokenImages($v72bc6e7707131edcbe44c867e3bc83e1);}protected function mapImage(array $vf1965a857bc285d26fe22023aa5ab50d) {$v25d902c24283ab8cfbac54dfa101ad31 = self::unescapeFilePath($vf1965a857bc285d26fe22023aa5ab50d['src']);$v78805a221a988e79ef3f42d7c5bfd418 = new umiImageFile($v25d902c24283ab8cfbac54dfa101ad31);$v78805a221a988e79ef3f42d7c5bfd418->setId($vf1965a857bc285d26fe22023aa5ab50d['id']);$v78805a221a988e79ef3f42d7c5bfd418->setAlt($vf1965a857bc285d26fe22023aa5ab50d['alt']);$v78805a221a988e79ef3f42d7c5bfd418->setTitle($vf1965a857bc285d26fe22023aa5ab50d['title']);$v78805a221a988e79ef3f42d7c5bfd418->setOrder($vf1965a857bc285d26fe22023aa5ab50d['ord']);return $v78805a221a988e79ef3f42d7c5bfd418;}protected function filterBrokenImages(array $v72bc6e7707131edcbe44c867e3bc83e1) {$v9eb34ba60945c28231943f199eb4aacc = Service::Request()->isAdmin();return array_filter($v72bc6e7707131edcbe44c867e3bc83e1, function($v78805a221a988e79ef3f42d7c5bfd418) use($v9eb34ba60945c28231943f199eb4aacc) {return !$v78805a221a988e79ef3f42d7c5bfd418->getIsBroken() || $v9eb34ba60945c28231943f199eb4aacc;});}protected function saveValue() {$this->deleteCurrentRows();if (!is_array($this->value)) {return;}$v2063c1608d6e0baf80249c42e2be5804 = getFirstValue($this->value);$v2063c1608d6e0baf80249c42e2be5804 = ($v2063c1608d6e0baf80249c42e2be5804 instanceof iUmiFile) ? $v2063c1608d6e0baf80249c42e2be5804 : new umiImageFile($v2063c1608d6e0baf80249c42e2be5804);if ($v2063c1608d6e0baf80249c42e2be5804->getIsBroken()) {return;}$v80071f37861c360a27b7327e132c911a = $this->getTableName();$v16b2b26000987faccb260b9d39df1269 = (int) $this->getObjectId();$v945100186b119048837b9859c2c46410 = (int) $this->getFieldId();$v4717d53ebfdfea8477f780ec66151dcb = $this->getConnection();$v25d902c24283ab8cfbac54dfa101ad31 = $v4717d53ebfdfea8477f780ec66151dcb->escape('.' . $v2063c1608d6e0baf80249c42e2be5804->getFilePath(true));$v34823136d0dd91d0f5d22db740f7679c = $v4717d53ebfdfea8477f780ec66151dcb->escape($v2063c1608d6e0baf80249c42e2be5804->getAlt());$vd5d3db1765287eef77d7927cc956f50a = $v4717d53ebfdfea8477f780ec66151dcb->escape($v2063c1608d6e0baf80249c42e2be5804->getTitle());$v70a17ffa722a3985b86d30b034ad06d7 = (int) $v2063c1608d6e0baf80249c42e2be5804->getOrder() ?: self::SINGLE_IMAGE_ORDER;$v1b1cc7f086b3f074da452bc3129981eb = <<<SQL
INSERT INTO `$v80071f37861c360a27b7327e132c911a` (`obj_id`, `field_id`, `src`, `alt`, `title`, `ord`) VALUES
($v16b2b26000987faccb260b9d39df1269, $v945100186b119048837b9859c2c46410, '$v25d902c24283ab8cfbac54dfa101ad31', '$v34823136d0dd91d0f5d22db740f7679c', '$vd5d3db1765287eef77d7927cc956f50a', $v70a17ffa722a3985b86d30b034ad06d7)
SQL;   $v4717d53ebfdfea8477f780ec66151dcb->query($v1b1cc7f086b3f074da452bc3129981eb);}protected function isNeedToSave(array $v7f7cfde5ec586119b48911a2c75851e5) {$v0382b9fd9ef50b6a335f35e0aaaebf99 = $this->value;$v7f7cfde5ec586119b48911a2c75851e5 = array_filter(    $v7f7cfde5ec586119b48911a2c75851e5,    function ($v2063c1608d6e0baf80249c42e2be5804) {$v47826cacc65c665212b821e6ff80b9b0 = ($v2063c1608d6e0baf80249c42e2be5804 instanceof iUmiImageFile) ? $v2063c1608d6e0baf80249c42e2be5804->getFilePath() : (string) $v2063c1608d6e0baf80249c42e2be5804;return @is_file($v47826cacc65c665212b821e6ff80b9b0);});switch (true) {case empty($v0382b9fd9ef50b6a335f35e0aaaebf99) && empty($v7f7cfde5ec586119b48911a2c75851e5) : {return false;}case empty($v0382b9fd9ef50b6a335f35e0aaaebf99) && !empty($v7f7cfde5ec586119b48911a2c75851e5) : {return true;}case !empty($v0382b9fd9ef50b6a335f35e0aaaebf99) && empty($v7f7cfde5ec586119b48911a2c75851e5) : {return true;}default : {$v0382b9fd9ef50b6a335f35e0aaaebf99 = array_shift($v0382b9fd9ef50b6a335f35e0aaaebf99);$v46cd4eff50a3aca89f0fbc7ea6a79453 = ($v0382b9fd9ef50b6a335f35e0aaaebf99 instanceof iUmiImageFile) ? $v0382b9fd9ef50b6a335f35e0aaaebf99->getFilePath() : (string) $v0382b9fd9ef50b6a335f35e0aaaebf99;$v7f7cfde5ec586119b48911a2c75851e5 = array_shift($v7f7cfde5ec586119b48911a2c75851e5);$v6ec0ebef1a9161a9cf0692a37adc35a4 = ($v7f7cfde5ec586119b48911a2c75851e5 instanceof iUmiImageFile) ? $v7f7cfde5ec586119b48911a2c75851e5->getFilePath() : (string) $v7f7cfde5ec586119b48911a2c75851e5;if ($v46cd4eff50a3aca89f0fbc7ea6a79453 !== $v6ec0ebef1a9161a9cf0692a37adc35a4) {return true;}$v9f062b5a9c0d7de3dd341f50d6fadfc2 = ($v0382b9fd9ef50b6a335f35e0aaaebf99 instanceof iUmiImageFile) ? $v0382b9fd9ef50b6a335f35e0aaaebf99->getAlt() : '';$va80f28700bb29825fd45312e72577699 = ($v7f7cfde5ec586119b48911a2c75851e5 instanceof iUmiImageFile) ? $v7f7cfde5ec586119b48911a2c75851e5->getAlt() : '';if ($v9f062b5a9c0d7de3dd341f50d6fadfc2 !== $va80f28700bb29825fd45312e72577699) {return true;}$vacec7876297562395554eaeb14aa72b6 = ($v0382b9fd9ef50b6a335f35e0aaaebf99 instanceof iUmiImageFile) ? $v0382b9fd9ef50b6a335f35e0aaaebf99->getTitle() : '';$vc6563b01794c2db18d25db125062ca3c = ($v7f7cfde5ec586119b48911a2c75851e5 instanceof iUmiImageFile) ? $v7f7cfde5ec586119b48911a2c75851e5->getTitle() : '';if ($vacec7876297562395554eaeb14aa72b6 !== $vc6563b01794c2db18d25db125062ca3c) {return true;}$vda52dc58234939a9767a953411494d91 = ($v0382b9fd9ef50b6a335f35e0aaaebf99 instanceof iUmiImageFile) ? $v0382b9fd9ef50b6a335f35e0aaaebf99->getOrder() : self::SINGLE_IMAGE_ORDER;$v222d832a88151b8e377c276045e794e3 = ($v7f7cfde5ec586119b48911a2c75851e5 instanceof iUmiImageFile) ? $v7f7cfde5ec586119b48911a2c75851e5->getOrder() : self::SINGLE_IMAGE_ORDER;return $vda52dc58234939a9767a953411494d91 !== $v222d832a88151b8e377c276045e794e3;}}}}