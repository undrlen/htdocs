<?php
 use UmiCms\Service;use UmiCms\System\Data\Object\Property\Value\Table\iSchema;abstract class umiObjectProperty extends umiEntinty implements iUmiObjectProperty {public $store_type = 'property';public static $USE_FORCE_OBJECTS_CREATION = false;public static $IGNORE_FILTER_INPUT_STRING = false;public static $IGNORE_FILTER_OUTPUT_STRING = false;public static $USE_TRANSACTIONS = true;public static $IGNORE_CACHE = false;protected $object_id;protected $field_id;protected $value;protected static $dataCache = [];protected static $dataCacheOrder = [];const DEFAULT_OBJECT_PROPS_CACHE_LIMIT = 200;public function __construct($vb80bb7740288fda1f201890375a60c8f, $vf1965a857bc285d26fe22023aa5ab50d = false) {$args = func_get_args();$v16b2b26000987faccb260b9d39df1269 = array_shift($args);if (!is_numeric($v16b2b26000987faccb260b9d39df1269)) {throw new Exception('Object id expected for creating property');}$v945100186b119048837b9859c2c46410 = array_shift($args);if (!is_numeric($v945100186b119048837b9859c2c46410)) {throw new Exception('Field id expected for creating property');}$this->object_id = (int) $v16b2b26000987faccb260b9d39df1269;$this->field_id = (int) $v945100186b119048837b9859c2c46410;$this->setId($v16b2b26000987faccb260b9d39df1269);}public function getId() {return $this->id . '.' . $this->field_id;}public function getValue(array $v21ffce5b8a6cc8cc6a41448dd69623c9 = null) {if ($this->value === null) {$this->value = $this->loadValue();}if ($this->getIsMultiple()) {$v2063c1608d6e0baf80249c42e2be5804 = $this->value;}else {if (umiCount($this->value) > 0) {list($v2063c1608d6e0baf80249c42e2be5804) = $this->value;}else {$v2063c1608d6e0baf80249c42e2be5804 = null;}}if ($v21ffce5b8a6cc8cc6a41448dd69623c9 !== null) {$v2063c1608d6e0baf80249c42e2be5804 = $this->applyParams($v2063c1608d6e0baf80249c42e2be5804, $v21ffce5b8a6cc8cc6a41448dd69623c9);}$v06e3d36fa30cea095545139854ad1fb9 = $this->getField();$v6b1a57fa235477758817df3c91158006 = $v06e3d36fa30cea095545139854ad1fb9->getRestrictionId();if ($v6b1a57fa235477758817df3c91158006) {$v3dadfaeb46ec74762b37de11fea7605c = baseRestriction::get($v6b1a57fa235477758817df3c91158006);if ($v3dadfaeb46ec74762b37de11fea7605c instanceof iNormalizeOutRestriction) {$v2063c1608d6e0baf80249c42e2be5804 = $v3dadfaeb46ec74762b37de11fea7605c->normalizeOut($v2063c1608d6e0baf80249c42e2be5804, $this->object_id);}}return $v2063c1608d6e0baf80249c42e2be5804;}public function getName() {return $this->getField()->getName();}public function getTitle() {return $this->getField()->getTitle();}public function setValue($v2063c1608d6e0baf80249c42e2be5804) {if ($this->value === null) {$this->value = $this->loadValue();}$v2063c1608d6e0baf80249c42e2be5804 = $this->validateValue($v2063c1608d6e0baf80249c42e2be5804);if (!is_array($v2063c1608d6e0baf80249c42e2be5804)) {$v2063c1608d6e0baf80249c42e2be5804 = [$v2063c1608d6e0baf80249c42e2be5804];}foreach ($v2063c1608d6e0baf80249c42e2be5804 as &$v9e3669d19b675bd57058fd4664205d2a) {if (is_string($v9e3669d19b675bd57058fd4664205d2a)) {$v9e3669d19b675bd57058fd4664205d2a = preg_replace('/([\x01-\x08]|[\x0B-\x0C]|[\x0E-\x1F])/', '', $v9e3669d19b675bd57058fd4664205d2a);}}$v17f71d965fe9589ddbd11caf7182243e = $this->getDataType();if ($v17f71d965fe9589ddbd11caf7182243e === 'date') {foreach ($v2063c1608d6e0baf80249c42e2be5804 as $v8dcd0fced6cad049fa9d12a0e56b5bb6 => $ve0c750ab2ba65ff988478860712c5ff2) {if (!($ve0c750ab2ba65ff988478860712c5ff2 instanceof umiDate)) {$v2063c1608d6e0baf80249c42e2be5804[$v8dcd0fced6cad049fa9d12a0e56b5bb6] = new umiDate((int) $ve0c750ab2ba65ff988478860712c5ff2);}}}$v2a6ec060f8194ecf0837452ce184acc2 = $this->isNeedToSave($v2063c1608d6e0baf80249c42e2be5804);if ($v2a6ec060f8194ecf0837452ce184acc2) {$this->value = $v2063c1608d6e0baf80249c42e2be5804;$this->setIsUpdated();}return true;}public function resetValue() {$this->value = [];$this->setIsUpdated();}public static function disableTransactionMode() {self::$USE_TRANSACTIONS = false;}public static function enableTransactionMode() {self::$USE_TRANSACTIONS = true;}public static function isTransactionModeEnabled() {return (bool) self::$USE_TRANSACTIONS;}public function getIsMultiple() {return $this->getFieldType()->getIsMultiple();}public function getIsUnsigned() {return $this->getFieldType()->getIsUnsigned();}public function getDataType() {return $this->getFieldType()->getDataType();}public function getIsLocked() {return $this->getField()->getIsLocked();}public function getIsInheritable() {return $this->getField()->getIsInheritable();}public function getIsVisible() {return $this->getField()->getIsVisible();}public static function filterInputString($vb45cffe084dd3d20d928bee85e7b0f21) {$vb45cffe084dd3d20d928bee85e7b0f21 = parent::filterInputString($vb45cffe084dd3d20d928bee85e7b0f21);$v9eb34ba60945c28231943f199eb4aacc = Service::Request()->isAdmin();$vef35deceebfc10b02a221d7a746feae9 = umiObjectProperty::$IGNORE_FILTER_INPUT_STRING;if (isset($_SERVER['DOCUMENT_ROOT']) && !$v9eb34ba60945c28231943f199eb4aacc && !$vef35deceebfc10b02a221d7a746feae9 && !isCronMode()) {$vb45cffe084dd3d20d928bee85e7b0f21 = str_replace(['&#037;', '&#37;'], '%', $vb45cffe084dd3d20d928bee85e7b0f21);$vb45cffe084dd3d20d928bee85e7b0f21 = htmlspecialchars(htmlspecialchars_decode($vb45cffe084dd3d20d928bee85e7b0f21), ENT_NOQUOTES);$vb45cffe084dd3d20d928bee85e7b0f21 = preg_replace('/([^\\\])\"/', '$1\"', $vb45cffe084dd3d20d928bee85e7b0f21);$vb45cffe084dd3d20d928bee85e7b0f21 = str_replace('%', '&#37;', $vb45cffe084dd3d20d928bee85e7b0f21);}return $vb45cffe084dd3d20d928bee85e7b0f21;}public function refresh() {$this->value = null;$this->loadValue();return $this;}protected function loadInfo($vf1965a857bc285d26fe22023aa5ab50d = false) {}protected function getTableName() {return Service::ObjectPropertyValueTableSchema()    ->getTable($this);}protected function save() {if ($this->value === null) {return false;}$v4717d53ebfdfea8477f780ec66151dcb = $this->getConnection();$v7524586d162135fb1ccdf771d21e7c09 = $this->isTransactionModeEnabled();$v16b2b26000987faccb260b9d39df1269 = $this->getObjectId();if ($v7524586d162135fb1ccdf771d21e7c09) {$v4717d53ebfdfea8477f780ec66151dcb->startTransaction("Saving property for object #$v16b2b26000987faccb260b9d39df1269");}try {$result = $this->saveValue();}catch (Exception $ve1671797c52e15f763380b45e841ec32) {if ($v7524586d162135fb1ccdf771d21e7c09) {$v4717d53ebfdfea8477f780ec66151dcb->rollbackTransaction();}throw $ve1671797c52e15f763380b45e841ec32;}if ($v7524586d162135fb1ccdf771d21e7c09) {$v4717d53ebfdfea8477f780ec66151dcb->commitTransaction();}self::unloadPropData($v16b2b26000987faccb260b9d39df1269);$vbc672e617dd087139133735b48db07b1 = umiPropertiesHelper::getInstance();$vbc672e617dd087139133735b48db07b1->resetPropertyCache($v16b2b26000987faccb260b9d39df1269, $this->getName());return $result;}abstract protected function saveValue();abstract protected function loadValue();abstract protected function isNeedToSave(array $v7f7cfde5ec586119b48911a2c75851e5);protected function getPropData() {$v945100186b119048837b9859c2c46410 = $this->getFieldId();$v16b2b26000987faccb260b9d39df1269 = $this->getObjectId();$v0fea6a13c52b4d4725368f24b045ca84 = &umiObjectProperty::$dataCache;if (isset($v0fea6a13c52b4d4725368f24b045ca84[$v16b2b26000987faccb260b9d39df1269])) {if (isset($v0fea6a13c52b4d4725368f24b045ca84[$v16b2b26000987faccb260b9d39df1269][$v945100186b119048837b9859c2c46410])) {return $v0fea6a13c52b4d4725368f24b045ca84[$v16b2b26000987faccb260b9d39df1269][$v945100186b119048837b9859c2c46410];}return [     'int_val' => [],     'varchar_val' => [],     'text_val' => [],     'rel_val' => [],     'tree_val' => [],     'float_val' => [],     'img_val' => []    ];}if (self::loadPropsData([$v16b2b26000987faccb260b9d39df1269])) {return $this->getPropData();}return [];}protected function validateValue($v2063c1608d6e0baf80249c42e2be5804) {$v06e3d36fa30cea095545139854ad1fb9 = $this->getField();if (!$v06e3d36fa30cea095545139854ad1fb9 instanceof iUmiField) {return $v2063c1608d6e0baf80249c42e2be5804;}if (($v2063c1608d6e0baf80249c42e2be5804 === null || $v2063c1608d6e0baf80249c42e2be5804 === false || $v2063c1608d6e0baf80249c42e2be5804 === '') && $v06e3d36fa30cea095545139854ad1fb9->getIsRequired()) {throw new valueRequiredException(getLabel('error-value-required', null, $this->getTitle()));}if ($v2063c1608d6e0baf80249c42e2be5804 && $v6b1a57fa235477758817df3c91158006 = $v06e3d36fa30cea095545139854ad1fb9->getRestrictionId()) {$v3dadfaeb46ec74762b37de11fea7605c = baseRestriction::get($v6b1a57fa235477758817df3c91158006);if ($v3dadfaeb46ec74762b37de11fea7605c instanceof baseRestriction) {if ($v3dadfaeb46ec74762b37de11fea7605c instanceof iNormalizeInRestriction) {$v2063c1608d6e0baf80249c42e2be5804 = $v3dadfaeb46ec74762b37de11fea7605c->normalizeIn($v2063c1608d6e0baf80249c42e2be5804, $this->object_id);}if ($v3dadfaeb46ec74762b37de11fea7605c->validate($v2063c1608d6e0baf80249c42e2be5804, $this->object_id) === false) {throw new wrongValueException(getLabel($v3dadfaeb46ec74762b37de11fea7605c->getErrorMessage(), null, $this->getTitle()));}}}return $v2063c1608d6e0baf80249c42e2be5804;}public static function loadPropsData(array $v9602dd5efeb5e02a7e5f213e91c017a7, $vda80b9ab86c2d00b85de0cf003cb3e6e = false) {if (isEmptyArray($v9602dd5efeb5e02a7e5f213e91c017a7)) {return false;}$v9602dd5efeb5e02a7e5f213e91c017a7 = array_map('intval', $v9602dd5efeb5e02a7e5f213e91c017a7);$v0fea6a13c52b4d4725368f24b045ca84 = &umiObjectProperty::$dataCache;$v9602dd5efeb5e02a7e5f213e91c017a7 = array_filter($v9602dd5efeb5e02a7e5f213e91c017a7, function($vb80bb7740288fda1f201890375a60c8f) use ($v0fea6a13c52b4d4725368f24b045ca84) {return !isset($v0fea6a13c52b4d4725368f24b045ca84[$vb80bb7740288fda1f201890375a60c8f]);});if (isEmptyArray($v9602dd5efeb5e02a7e5f213e91c017a7)) {return false;}self::clearOverflowObjectPropsCache();foreach ($v9602dd5efeb5e02a7e5f213e91c017a7 as $vb80bb7740288fda1f201890375a60c8f) {$v0fea6a13c52b4d4725368f24b045ca84[$vb80bb7740288fda1f201890375a60c8f] = [];umiObjectProperty::$dataCacheOrder[] = $vb80bb7740288fda1f201890375a60c8f;}self::loadCommonFieldValues($v9602dd5efeb5e02a7e5f213e91c017a7);self::loadImageFieldValues($v9602dd5efeb5e02a7e5f213e91c017a7);return true;}private static function loadCommonFieldValues(array $v9602dd5efeb5e02a7e5f213e91c017a7) {$v80071f37861c360a27b7327e132c911a = Service::ObjectPropertyValueTableSchema()    ->getDefaultTable();$vb807d5694562a41b516a8ba69af0dda4 = implode(',', $v9602dd5efeb5e02a7e5f213e91c017a7);$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT `obj_id`, `field_id`, `int_val`, `varchar_val`, `text_val`, `rel_val`, `tree_val`, `float_val` 
FROM `$v80071f37861c360a27b7327e132c911a` 
WHERE `obj_id` IN ($vb807d5694562a41b516a8ba69af0dda4)
SQL;   $result = ConnectionPool::getInstance()    ->getConnection()    ->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a)    ->setFetchType(IQueryResult::FETCH_ASSOC);$v0fea6a13c52b4d4725368f24b045ca84 = &umiObjectProperty::$dataCache;foreach ($result as $vf1965a857bc285d26fe22023aa5ab50d) {$v0fea6a13c52b4d4725368f24b045ca84[$vf1965a857bc285d26fe22023aa5ab50d['obj_id']][$vf1965a857bc285d26fe22023aa5ab50d['field_id']]['int_val'][] = $vf1965a857bc285d26fe22023aa5ab50d['int_val'];$v0fea6a13c52b4d4725368f24b045ca84[$vf1965a857bc285d26fe22023aa5ab50d['obj_id']][$vf1965a857bc285d26fe22023aa5ab50d['field_id']]['varchar_val'][] = $vf1965a857bc285d26fe22023aa5ab50d['varchar_val'];$v0fea6a13c52b4d4725368f24b045ca84[$vf1965a857bc285d26fe22023aa5ab50d['obj_id']][$vf1965a857bc285d26fe22023aa5ab50d['field_id']]['text_val'][] = $vf1965a857bc285d26fe22023aa5ab50d['text_val'];$v0fea6a13c52b4d4725368f24b045ca84[$vf1965a857bc285d26fe22023aa5ab50d['obj_id']][$vf1965a857bc285d26fe22023aa5ab50d['field_id']]['rel_val'][] = $vf1965a857bc285d26fe22023aa5ab50d['rel_val'];$v0fea6a13c52b4d4725368f24b045ca84[$vf1965a857bc285d26fe22023aa5ab50d['obj_id']][$vf1965a857bc285d26fe22023aa5ab50d['field_id']]['tree_val'][] = $vf1965a857bc285d26fe22023aa5ab50d['tree_val'];$v0fea6a13c52b4d4725368f24b045ca84[$vf1965a857bc285d26fe22023aa5ab50d['obj_id']][$vf1965a857bc285d26fe22023aa5ab50d['field_id']]['float_val'][] = $vf1965a857bc285d26fe22023aa5ab50d['float_val'];}}private static function loadImageFieldValues(array $v9602dd5efeb5e02a7e5f213e91c017a7) {$v80071f37861c360a27b7327e132c911a = Service::ObjectPropertyValueTableSchema()    ->getImagesTable();$vb807d5694562a41b516a8ba69af0dda4 = implode(',', $v9602dd5efeb5e02a7e5f213e91c017a7);$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT `id`, `obj_id`, `field_id`, `src`, `alt`, `title`, `ord`
FROM `$v80071f37861c360a27b7327e132c911a` 
WHERE `obj_id` IN ($vb807d5694562a41b516a8ba69af0dda4)
SQL;   $result = ConnectionPool::getInstance()    ->getConnection()    ->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a)    ->setFetchType(IQueryResult::FETCH_ASSOC);$v0fea6a13c52b4d4725368f24b045ca84 = &umiObjectProperty::$dataCache;foreach ($result as $vf1965a857bc285d26fe22023aa5ab50d) {$v0fea6a13c52b4d4725368f24b045ca84[$vf1965a857bc285d26fe22023aa5ab50d['obj_id']][$vf1965a857bc285d26fe22023aa5ab50d['field_id']]['img_val'][] = [     'id' => $vf1965a857bc285d26fe22023aa5ab50d['id'],     'src' => $vf1965a857bc285d26fe22023aa5ab50d['src'],     'alt' => $vf1965a857bc285d26fe22023aa5ab50d['alt'],     'title' => $vf1965a857bc285d26fe22023aa5ab50d['title'],     'ord' => $vf1965a857bc285d26fe22023aa5ab50d['ord']    ];}}public static function unloadPropData($v16b2b26000987faccb260b9d39df1269) {if (!is_numeric($v16b2b26000987faccb260b9d39df1269)) {return false;}$v0fea6a13c52b4d4725368f24b045ca84 = &umiObjectProperty::$dataCache;if (isset($v0fea6a13c52b4d4725368f24b045ca84[$v16b2b26000987faccb260b9d39df1269])) {unset($v0fea6a13c52b4d4725368f24b045ca84[$v16b2b26000987faccb260b9d39df1269]);$v6a992d5529f459a44fee58c733255e86 = array_search($v16b2b26000987faccb260b9d39df1269, umiObjectProperty::$dataCacheOrder);if ($v6a992d5529f459a44fee58c733255e86) {unset(umiObjectProperty::$dataCacheOrder[$v6a992d5529f459a44fee58c733255e86]);}return true;}return false;}public static function getCachedPropData() {return umiObjectProperty::$dataCache;}public static function setCachedPropData(array $v8d777f385d3dfec8815d20f7496026dc) {umiObjectProperty::$dataCache = $v8d777f385d3dfec8815d20f7496026dc;foreach ($v8d777f385d3dfec8815d20f7496026dc as $vb80bb7740288fda1f201890375a60c8f => $v0fea6a13c52b4d4725368f24b045ca84) {umiObjectProperty::$dataCacheOrder[] = $vb80bb7740288fda1f201890375a60c8f;}}public function getObjectId() {return $this->object_id;}public function getFieldId() {return $this->field_id;}protected function deleteCurrentRows() {$v16b2b26000987faccb260b9d39df1269 = (int) $this->getObjectId();$v945100186b119048837b9859c2c46410 = (int) $this->getFieldId();$v80071f37861c360a27b7327e132c911a = $this->getTableName();$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
DELETE FROM `$v80071f37861c360a27b7327e132c911a` WHERE `obj_id` = $v16b2b26000987faccb260b9d39df1269 AND `field_id` = $v945100186b119048837b9859c2c46410;
SQL;   $this->getConnection()    ->query($vac5c74b64b4b8352ef2f181affb5ac2a);}protected function applyParams($vf09cc7ee3a9a93273f4b80601cafb00c, $v21ffce5b8a6cc8cc6a41448dd69623c9 = null) {return $vf09cc7ee3a9a93273f4b80601cafb00c;}protected function prepareRelationValue($v2063c1608d6e0baf80249c42e2be5804) {if (!$v2063c1608d6e0baf80249c42e2be5804) {return false;}$v69ae498121c2d8e63f20c7144a0246d7 = umiObjectsCollection::getInstance();$ve23ef6e93b070c8d28adc485c1f13b73 = self::$USE_FORCE_OBJECTS_CREATION;if ($v69ae498121c2d8e63f20c7144a0246d7->isUmiObject($v2063c1608d6e0baf80249c42e2be5804)) {return $v2063c1608d6e0baf80249c42e2be5804->getId();}$v06e3d36fa30cea095545139854ad1fb9 = $this->getField();if ($v06e3d36fa30cea095545139854ad1fb9->hasGuide()) {$v52eb29c6d8ea0d3a5bb3654f49bbd7c7 = $v06e3d36fa30cea095545139854ad1fb9->getGuideId();$va8cfde6331bd59eb2ac96f8911c4b666 = $v69ae498121c2d8e63f20c7144a0246d7->getObjectByName($v2063c1608d6e0baf80249c42e2be5804, $v52eb29c6d8ea0d3a5bb3654f49bbd7c7);if ($v69ae498121c2d8e63f20c7144a0246d7->isUmiObject($va8cfde6331bd59eb2ac96f8911c4b666)) {return $va8cfde6331bd59eb2ac96f8911c4b666->getId();}if ($v69ae498121c2d8e63f20c7144a0246d7->isExists($v2063c1608d6e0baf80249c42e2be5804) && !$ve23ef6e93b070c8d28adc485c1f13b73) {return (int) $v2063c1608d6e0baf80249c42e2be5804;}if (!$ve23ef6e93b070c8d28adc485c1f13b73) {$v599dcce2998a6b40b1e38e8c6006cb0a = umiObjectTypesCollection::getInstance()->getType($v52eb29c6d8ea0d3a5bb3654f49bbd7c7);if (!$v599dcce2998a6b40b1e38e8c6006cb0a->getIsGuidable() || !$v599dcce2998a6b40b1e38e8c6006cb0a->getIsPublic()) {return null;}}$vd304ba20e96d87411588eeabac850e34 = ulangStream::getI18n($v2063c1608d6e0baf80249c42e2be5804);$v2063c1608d6e0baf80249c42e2be5804 = $vd304ba20e96d87411588eeabac850e34 === null ? $v2063c1608d6e0baf80249c42e2be5804 : $vd304ba20e96d87411588eeabac850e34;$v399c32699000f9c132ed4c9c9dbba2a3 = $v69ae498121c2d8e63f20c7144a0246d7->addObject($v2063c1608d6e0baf80249c42e2be5804, $v52eb29c6d8ea0d3a5bb3654f49bbd7c7);if ($v399c32699000f9c132ed4c9c9dbba2a3 > 0) {return $v399c32699000f9c132ed4c9c9dbba2a3;}throw new coreException("Can't create guide item");}return null;}protected function getConnection() {return Service::ConnectionPool()    ->getConnection();}public static function getProperty($v16b2b26000987faccb260b9d39df1269, $v945100186b119048837b9859c2c46410) {return Service::ObjectPropertyFactory()    ->create($v16b2b26000987faccb260b9d39df1269, $v945100186b119048837b9859c2c46410);}public function getField() {$v06e3d36fa30cea095545139854ad1fb9 = umiFieldsCollection::getInstance()    ->getField($this->field_id);if (!$v06e3d36fa30cea095545139854ad1fb9 instanceof iUmiField) {throw new Exception(sprintf('Cannot get umiField by "%s"', $this->field_id));}return $v06e3d36fa30cea095545139854ad1fb9;}private static function getObjectPropsCacheSizeLimit() {$v030677b151cf6ab257789bd7a664e687 = mainConfiguration::getInstance();$vfada2fc0d7e46588169022f1e93e1f8a = (int) $v030677b151cf6ab257789bd7a664e687->get('kernel', 'objects-props-cash-size');if ($vfada2fc0d7e46588169022f1e93e1f8a > self::DEFAULT_OBJECT_PROPS_CACHE_LIMIT) {return (int) $vfada2fc0d7e46588169022f1e93e1f8a;}return self::DEFAULT_OBJECT_PROPS_CACHE_LIMIT;}private static function clearOverflowObjectPropsCache() {$v0fea6a13c52b4d4725368f24b045ca84 = &umiObjectProperty::$dataCache;$v19d1bfcb72927341ee1477132d6a7a61 = count($v0fea6a13c52b4d4725368f24b045ca84);$v57c3dbe65cbc8d65f1dfb92da371161a = self::getObjectPropsCacheSizeLimit();if ($v19d1bfcb72927341ee1477132d6a7a61 <= $v57c3dbe65cbc8d65f1dfb92da371161a) {return true;}$vbf74d4eb33380b4925991fc902dcbcfc = $v19d1bfcb72927341ee1477132d6a7a61 - $v57c3dbe65cbc8d65f1dfb92da371161a;for ($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $vbf74d4eb33380b4925991fc902dcbcfc;$v865c0c0b4ab0e063e5caa3387c1a8741++ ) {$vb80bb7740288fda1f201890375a60c8f = array_shift(umiObjectProperty::$dataCacheOrder);if ($vb80bb7740288fda1f201890375a60c8f !== null) {self::unloadPropData($vb80bb7740288fda1f201890375a60c8f);}}return true;}protected function getFieldType() {$ve2aeb4e882d60b1eb4b7c8cd97986a28 = $this->getField()    ->getFieldTypeId();$v833750ac635fcc57dc33ecafe365f9a7 = umiFieldTypesCollection::getInstance()    ->getFieldType($ve2aeb4e882d60b1eb4b7c8cd97986a28);if (!$v833750ac635fcc57dc33ecafe365f9a7 instanceof iUmiFieldType) {throw new Exception(sprintf('Cannot get umiFieldType by "%s"', $ve2aeb4e882d60b1eb4b7c8cd97986a28));}return $v833750ac635fcc57dc33ecafe365f9a7;}public static function filterOutputString($vb45cffe084dd3d20d928bee85e7b0f21) {return $vb45cffe084dd3d20d928bee85e7b0f21;}public static function filterCDATA($vb45cffe084dd3d20d928bee85e7b0f21) {return $vb45cffe084dd3d20d928bee85e7b0f21;}public function getObject() {$va8cfde6331bd59eb2ac96f8911c4b666 = umiObjectsCollection::getInstance()    ->getObject($this->object_id);if (!$va8cfde6331bd59eb2ac96f8911c4b666 instanceof iUmiObject) {throw new Exception(sprintf('Cannot get umiObject by "%s"', $this->object_id));}return $va8cfde6331bd59eb2ac96f8911c4b666;}protected static function unescapeFilePath($v6a2a431fe8b621037ea949531c28551d) {return str_replace("\\\\", '/', $v6a2a431fe8b621037ea949531c28551d);}public static function objectsByValue(   $v0f728ec6147eaec54f5f45e37bce8ddd,   $v2ef4385ee1f18f02679161fef2b094d9 = null,   $v95fc2db4375309c569794b723adc3972 = false,   $vf80384e7987156531edaa3afd549957d = true,   $v8ef57923ab3049b18fb75541ff476ff7 = null  ) {$v30a7d3f52b5af853f2a7bba352210a34 = [];if (!($v2ef4385ee1f18f02679161fef2b094d9 === null || is_array($v2ef4385ee1f18f02679161fef2b094d9) || (int) $v2ef4385ee1f18f02679161fef2b094d9 === -1 || (string) $v2ef4385ee1f18f02679161fef2b094d9 === 'all' ||    (string) $v2ef4385ee1f18f02679161fef2b094d9 == 'Все')) {$v2ef4385ee1f18f02679161fef2b094d9 = [$v2ef4385ee1f18f02679161fef2b094d9];}$v9effabcdaed14aab9cb00acddfa00fc9 = null;if ($v95fc2db4375309c569794b723adc3972) {if ($v8ef57923ab3049b18fb75541ff476ff7 === null) {$v9effabcdaed14aab9cb00acddfa00fc9 = [Service::DomainDetector()->detectId()];}elseif ((int) $v8ef57923ab3049b18fb75541ff476ff7 === -1 || (string) $v8ef57923ab3049b18fb75541ff476ff7 === 'all' || (string) $v8ef57923ab3049b18fb75541ff476ff7 == 'Все') {$v9effabcdaed14aab9cb00acddfa00fc9 = [];}elseif (is_array($v8ef57923ab3049b18fb75541ff476ff7)) {$v9effabcdaed14aab9cb00acddfa00fc9 = array_map('intval', $v8ef57923ab3049b18fb75541ff476ff7);}else {$v9effabcdaed14aab9cb00acddfa00fc9 = [(int) $v8ef57923ab3049b18fb75541ff476ff7];}}$v06e3d36fa30cea095545139854ad1fb9 = umiFieldsCollection::getInstance()->getField($v0f728ec6147eaec54f5f45e37bce8ddd);if ($v06e3d36fa30cea095545139854ad1fb9 instanceof iUmiField) {$v5fd6df40d7c4dd7f503475344d8c145c = $v06e3d36fa30cea095545139854ad1fb9->getFieldType()->getDataType();$v8ae9391858dfdc11dbd8f15cf9b04a26 = umiFieldType::getDataTypeDB($v5fd6df40d7c4dd7f503475344d8c145c);}else {throw new coreException("Field #{$v0f728ec6147eaec54f5f45e37bce8ddd} not found");}$v6301cee35ea764a1e241978f93f01069 = umiObjectTypesCollection::getInstance()->getTypeIdByFieldId($v0f728ec6147eaec54f5f45e37bce8ddd);$v80071f37861c360a27b7327e132c911a = umiBranch::getBranchedTableByTypeId($v6301cee35ea764a1e241978f93f01069);$v01b41e749613a642fc384ed8af3245fc = "{$v80071f37861c360a27b7327e132c911a} `o`";if ($v95fc2db4375309c569794b723adc3972) {$v01b41e749613a642fc384ed8af3245fc .= ', cms3_hierarchy `h`';}if ($v95fc2db4375309c569794b723adc3972) {$v7dd0d06edf4c4299ce1a5978eb469fd8 = 'h.id';}else {$v7dd0d06edf4c4299ce1a5978eb469fd8 = 'o.obj_id';}$vc3a74cf64b6ccb62fa49a21123cbc72f = ($v95fc2db4375309c569794b723adc3972 ? ' AND h.obj_id = o.obj_id AND h.is_active=1 AND h.is_deleted=0' : '');if ($v95fc2db4375309c569794b723adc3972 && is_array($v9effabcdaed14aab9cb00acddfa00fc9) && umiCount($v9effabcdaed14aab9cb00acddfa00fc9)) {$vc3a74cf64b6ccb62fa49a21123cbc72f .= " AND h.domain_id IN ('" . implode("', '", $v9effabcdaed14aab9cb00acddfa00fc9) . "')";}$v86f6d00b1c7dbb44f4cd5edf49c29aa0 = '';if (!((int) $v2ef4385ee1f18f02679161fef2b094d9 === -1 || (string) $v2ef4385ee1f18f02679161fef2b094d9 === 'all' || (string) $v2ef4385ee1f18f02679161fef2b094d9 === 'Âñå')) {$v86f6d00b1c7dbb44f4cd5edf49c29aa0 =     " AND o.{$v8ae9391858dfdc11dbd8f15cf9b04a26} " .     ($v2ef4385ee1f18f02679161fef2b094d9 === null ? 'IS NULL' : "IN ('" . implode("', '", $v2ef4385ee1f18f02679161fef2b094d9) . "')");}if ($vf80384e7987156531edaa3afd549957d) {$vf3e7552257b4e44beacffb073506f43d =     'SELECT o.' . $v8ae9391858dfdc11dbd8f15cf9b04a26 . ' as `value`, COUNT(' . $v7dd0d06edf4c4299ce1a5978eb469fd8 . ') as `items` FROM ' . $v01b41e749613a642fc384ed8af3245fc .     ' WHERE o.field_id = ' . $v0f728ec6147eaec54f5f45e37bce8ddd . $v86f6d00b1c7dbb44f4cd5edf49c29aa0 . $vc3a74cf64b6ccb62fa49a21123cbc72f . ' GROUP BY o.' . $v8ae9391858dfdc11dbd8f15cf9b04a26 .     ' ORDER BY `items`';}else {$vf3e7552257b4e44beacffb073506f43d = 'SELECT DISTINCT ' . $v7dd0d06edf4c4299ce1a5978eb469fd8 . ' as `item` FROM ' . $v01b41e749613a642fc384ed8af3245fc . ' WHERE o.field_id = ' .     $v0f728ec6147eaec54f5f45e37bce8ddd .     $v86f6d00b1c7dbb44f4cd5edf49c29aa0 . $vc3a74cf64b6ccb62fa49a21123cbc72f;}$ve7d010371cfd5717d3d0b7d8e4c87803 = [];$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$v98291d7af1e21c41194125137e4f90ec = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vf3e7552257b4e44beacffb073506f43d);if ($v4717d53ebfdfea8477f780ec66151dcb->errorOccurred()) {throw new coreException(     'Error executing db query (errno ' . $v4717d53ebfdfea8477f780ec66151dcb->errorNumber() . ', error ' .     $v4717d53ebfdfea8477f780ec66151dcb->errorDescription($vf3e7552257b4e44beacffb073506f43d) . ')'    );}$v98291d7af1e21c41194125137e4f90ec->setFetchType(IQueryResult::FETCH_ASSOC);foreach ($v98291d7af1e21c41194125137e4f90ec as $v7b93a31f8c7688c32c5a551b0e4937ee) {$ve7d010371cfd5717d3d0b7d8e4c87803[] = $v7b93a31f8c7688c32c5a551b0e4937ee;}if ($vf80384e7987156531edaa3afd549957d) {$v30a7d3f52b5af853f2a7bba352210a34['values'] = [];$vae886317ab0305e3e6a1638659ea03fa = 0;$v663ccf380acaf3f549f1612654dc109d = 0;foreach ($ve7d010371cfd5717d3d0b7d8e4c87803 as $vabd12a9143f26fa85e562e69c01c48db) {$v97023380f9705264978115e6ce880ca5 = (int) $vabd12a9143f26fa85e562e69c01c48db['items'];$v30a7d3f52b5af853f2a7bba352210a34['values'][] = [      'value' => $vabd12a9143f26fa85e562e69c01c48db['value'],      'cnt' => $v97023380f9705264978115e6ce880ca5     ];if ($v97023380f9705264978115e6ce880ca5 > $vae886317ab0305e3e6a1638659ea03fa) {$vae886317ab0305e3e6a1638659ea03fa = $v97023380f9705264978115e6ce880ca5;}$v663ccf380acaf3f549f1612654dc109d += $v97023380f9705264978115e6ce880ca5;}$v30a7d3f52b5af853f2a7bba352210a34['max'] = $vae886317ab0305e3e6a1638659ea03fa;$v30a7d3f52b5af853f2a7bba352210a34['sum'] = $v663ccf380acaf3f549f1612654dc109d;}else {foreach ($ve7d010371cfd5717d3d0b7d8e4c87803 as $vabd12a9143f26fa85e562e69c01c48db) {$v30a7d3f52b5af853f2a7bba352210a34[] = $vabd12a9143f26fa85e562e69c01c48db['item'];}}return $v30a7d3f52b5af853f2a7bba352210a34;}}