<?php
 use UmiCms\Service;class FilterQueriesMaker {protected $tableName;protected $entityType;protected $allFilteredFields;protected $filters = [];protected $parentsIds = [];protected $typeIds = [];protected $langIds = [];protected $domainIds = [];protected $ignoreVirtualCopies = false;protected $ignorePermissions;protected $filteredFieldsName = [];protected $limit;protected $offset;protected $filteredEntitiesCount = 0;protected $showAllValuesInRangedFields = false;protected $showSelectedValues = true;protected $updateSelectedFilters = true;protected $selectedFilters = [];public function __construct(FilterIndexGenerator $v65d5d52bf9570e92eb36239377a3618c) {$this->tableName = $v65d5d52bf9570e92eb36239377a3618c->getTableName();$this->entityType = $v65d5d52bf9570e92eb36239377a3618c->getEntitiesType();$this->allFilteredFields = $v65d5d52bf9570e92eb36239377a3618c->getFilteredFields();$this->ignorePermissions = (bool) mainConfiguration::getInstance()    ->get('kernel', 'ignore-permissions-in-filter');}public function setParentIds(array $v952915df58ec9bb4591e820dc1f3b9c8) {$this->parentsIds = array_map('intval', $v952915df58ec9bb4591e820dc1f3b9c8);}public function setTypeIds(array $v9a62e3947dc2b94af4417a8390e58cc3) {$this->typeIds = array_map('intval', $v9a62e3947dc2b94af4417a8390e58cc3);}public function setLangIds(array $v116f28135fae5e979e381e4d66222936) {$this->langIds = array_map('intval', $v116f28135fae5e979e381e4d66222936);}public function setDomainIds(array $v926a85278ca49b9c4de5ca08a420fa6d) {$this->domainIds = array_map('intval', $v926a85278ca49b9c4de5ca08a420fa6d);}public function ignoreVirtualCopies() {$this->ignoreVirtualCopies = true;}public function setIgnorePermissionsStatus($v89b2757f1a8f76ef8aee7511b5d4b154) {$this->ignorePermissions = (bool) $v89b2757f1a8f76ef8aee7511b5d4b154;}public function setFilteredFieldsNames(array $v3e493c5722a065647be862cca7ce2539) {$vcb0d2169dd0b022addb0b6b38f0016ba = $this->getAllFilteredFields();foreach ($v3e493c5722a065647be862cca7ce2539 as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {if (!isset($vcb0d2169dd0b022addb0b6b38f0016ba[$v2063c1608d6e0baf80249c42e2be5804])) {unset($v3e493c5722a065647be862cca7ce2539[$v3c6e0b8a9c15224a8228b9a98ca1531d]);}}$this->filteredFieldsName = $v3e493c5722a065647be862cca7ce2539;}public function setLimit($vaa9f73eea60a006820d0f8768bc8a3fc) {if (!is_numeric($vaa9f73eea60a006820d0f8768bc8a3fc)) {throw new publicAdminException(__METHOD__ . ': correct limit expected,' . $vaa9f73eea60a006820d0f8768bc8a3fc . ' given');}$this->limit = (int) $vaa9f73eea60a006820d0f8768bc8a3fc;}public function setOffset($v7a86c157ee9713c34fbd7a1ee40f0c5a) {if (!is_numeric($v7a86c157ee9713c34fbd7a1ee40f0c5a)) {throw new publicAdminException(__METHOD__ . ': correct offset expected,' . $v7a86c157ee9713c34fbd7a1ee40f0c5a . ' given');}$this->offset = (int) $v7a86c157ee9713c34fbd7a1ee40f0c5a;}public function setShowAllValuesInRangedFields() {$this->showAllValuesInRangedFields = true;}public function isPermissionsIgnored() {return $this->ignorePermissions;}public function parseFilters() {$vcb0d2169dd0b022addb0b6b38f0016ba = $this->getAllFilteredFields();$v2c9885d2b0c7e26971f60a90f33cf718 = getRequest('filter');$v4119639092e62c55ea8be348e4d9260d = new umiEventPoint('parse_filter');$v4119639092e62c55ea8be348e4d9260d->setMode('before');$v4119639092e62c55ea8be348e4d9260d->addRef('raw_filter', $v2c9885d2b0c7e26971f60a90f33cf718);$v4119639092e62c55ea8be348e4d9260d->setParam('queries_maker', $this);$v4119639092e62c55ea8be348e4d9260d->call();if (!$v2c9885d2b0c7e26971f60a90f33cf718 || !is_array($v2c9885d2b0c7e26971f60a90f33cf718)) {return $this->setFilters([]);}$vd565bdeda21f6bf84abb9c5c426a90ee = $this->isNeedToShowSelectedValues();foreach ($v2c9885d2b0c7e26971f60a90f33cf718 as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {if (!isset($vcb0d2169dd0b022addb0b6b38f0016ba[$v3c6e0b8a9c15224a8228b9a98ca1531d])) {unset($v2c9885d2b0c7e26971f60a90f33cf718[$v3c6e0b8a9c15224a8228b9a98ca1531d]);continue;}$v06e3d36fa30cea095545139854ad1fb9 = $vcb0d2169dd0b022addb0b6b38f0016ba[$v3c6e0b8a9c15224a8228b9a98ca1531d];if ($v06e3d36fa30cea095545139854ad1fb9->getDataType() == 'date') {foreach ($v2063c1608d6e0baf80249c42e2be5804 as $v599dcce2998a6b40b1e38e8c6006cb0a => $v5fc732311905cb27e82d67f4f6511f7f) {if (!is_numeric($v5fc732311905cb27e82d67f4f6511f7f) && is_string($v5fc732311905cb27e82d67f4f6511f7f)) {$v2063c1608d6e0baf80249c42e2be5804[$v599dcce2998a6b40b1e38e8c6006cb0a] = strtotime($v5fc732311905cb27e82d67f4f6511f7f);}}}$v3f9178c25b78ed8bed19091bcb62e266 = $this->getCondition($v06e3d36fa30cea095545139854ad1fb9, $v3c6e0b8a9c15224a8228b9a98ca1531d, $v2063c1608d6e0baf80249c42e2be5804);if ($v3f9178c25b78ed8bed19091bcb62e266 === null) {unset($v2c9885d2b0c7e26971f60a90f33cf718[$v3c6e0b8a9c15224a8228b9a98ca1531d]);}else {$v2c9885d2b0c7e26971f60a90f33cf718[$v3c6e0b8a9c15224a8228b9a98ca1531d] = $v3f9178c25b78ed8bed19091bcb62e266;}if (!$vd565bdeda21f6bf84abb9c5c426a90ee) {continue;}if (is_array($v2063c1608d6e0baf80249c42e2be5804)) {$v2063c1608d6e0baf80249c42e2be5804 = array_map('htmlspecialchars', $v2063c1608d6e0baf80249c42e2be5804);}else {$v2063c1608d6e0baf80249c42e2be5804 = [htmlspecialchars($v2063c1608d6e0baf80249c42e2be5804)];}$this->pushSelectedFilterValue($v3c6e0b8a9c15224a8228b9a98ca1531d, $v2063c1608d6e0baf80249c42e2be5804);}$v4119639092e62c55ea8be348e4d9260d->setMode('after');$v4119639092e62c55ea8be348e4d9260d->addRef('processed_filter', $v2c9885d2b0c7e26971f60a90f33cf718);$v4119639092e62c55ea8be348e4d9260d->call();return $this->setFilters($v2c9885d2b0c7e26971f60a90f33cf718);}public function getFilters() {return $this->filters;}public function getFiltersFieldsNames() {return array_keys($this->filters);}public function getFilteredEntitiesCount() {return $this->filteredEntitiesCount;}public function disableShowingSelectedValues() {$this->showSelectedValues = false;}public function disableUpdatingSelectedFilters() {$this->updateSelectedFilters = false;}public function getFilteredEntitiesIds() {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$v80071f37861c360a27b7327e132c911a = $this->getTableName();$vd175d682dd9e479811ed48f5a5f061d7 = $this->getSystemConditions();$v924d7b099db2c9e8b66d56e45d9c3786 = $this->getFiltersConditions();$v8f53e270b543a664fdce8a920ffce753 = $this->getGroupConditions();$v02675f202828e843412ca811591139ae = $this->getLimitCondition();$v8849be6b58ca94d5d1975d5b3abc2aa3 = $this->getJoinsConditions();$v47427449220fad7aa90cf12daf246178 = 'WHERE';if ($vd175d682dd9e479811ed48f5a5f061d7 == '' && $v924d7b099db2c9e8b66d56e45d9c3786 == '') {$v47427449220fad7aa90cf12daf246178 = '';}if ($v924d7b099db2c9e8b66d56e45d9c3786 !== '' && $vd175d682dd9e479811ed48f5a5f061d7 !== '') {$vd175d682dd9e479811ed48f5a5f061d7 = $vd175d682dd9e479811ed48f5a5f061d7 . ' AND ';}$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT `id` FROM `$v80071f37861c360a27b7327e132c911a` $v8849be6b58ca94d5d1975d5b3abc2aa3 $v47427449220fad7aa90cf12daf246178
$vd175d682dd9e479811ed48f5a5f061d7 $v924d7b099db2c9e8b66d56e45d9c3786 $v8f53e270b543a664fdce8a920ffce753 $v02675f202828e843412ca811591139ae ORDER BY `id`;
SQL;   try {$result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);}catch (databaseException $ve1671797c52e15f763380b45e841ec32) {throw new publicAdminException(     __METHOD__ . ': MySQL exception has occurred:' . $ve1671797c52e15f763380b45e841ec32->getCode() . ' ' . $ve1671797c52e15f763380b45e841ec32->getMessage()    );}$result->setFetchType(IQueryResult::FETCH_ASSOC);if ($result->length() == 0) {return [];}$vbc7bcf50e98208c19609ce29620020ab = [];foreach ($result as $vf1965a857bc285d26fe22023aa5ab50d) {$vbc7bcf50e98208c19609ce29620020ab[] = $vf1965a857bc285d26fe22023aa5ab50d['id'];}return $vbc7bcf50e98208c19609ce29620020ab;}public function getFiltersData() {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$v80071f37861c360a27b7327e132c911a = $this->getTableName();$vd175d682dd9e479811ed48f5a5f061d7 = $this->getSystemConditions();$v924d7b099db2c9e8b66d56e45d9c3786 = $this->getFiltersConditions();$v8849be6b58ca94d5d1975d5b3abc2aa3 = $this->getJoinsConditions();$vd9cf5fa9cba44a0482650cbc672b0497 = $this->getSelectConditions();$v8f53e270b543a664fdce8a920ffce753 = $this->getGroupConditions();if ($v924d7b099db2c9e8b66d56e45d9c3786 !== '' && $vd175d682dd9e479811ed48f5a5f061d7 !== '') {$vd175d682dd9e479811ed48f5a5f061d7 = $vd175d682dd9e479811ed48f5a5f061d7 . ' AND ';}$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT DISTINCT $vd9cf5fa9cba44a0482650cbc672b0497 FROM `$v80071f37861c360a27b7327e132c911a` $v8849be6b58ca94d5d1975d5b3abc2aa3
WHERE $vd175d682dd9e479811ed48f5a5f061d7 $v924d7b099db2c9e8b66d56e45d9c3786 $v8f53e270b543a664fdce8a920ffce753
SQL;   try {$result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);}catch (databaseException $ve1671797c52e15f763380b45e841ec32) {throw new publicAdminException(     __METHOD__ . ': MySQL exception has occurred:' . $ve1671797c52e15f763380b45e841ec32->getCode() . ' ' . $ve1671797c52e15f763380b45e841ec32->getMessage()    );}$result->setFetchType(IQueryResult::FETCH_ASSOC);if ($result->length() == 0) {return [];}$v0898eeed21a2fa1960a65abb15beb246 = [];foreach ($result as $vf1965a857bc285d26fe22023aa5ab50d) {$v0898eeed21a2fa1960a65abb15beb246[] = $vf1965a857bc285d26fe22023aa5ab50d;}return $this->prepareFilterData($v0898eeed21a2fa1960a65abb15beb246);}protected function getCondition(iUmiField $v06e3d36fa30cea095545139854ad1fb9, $va3c15e26be16c2bf327e40a137d3aed7, $v24b86e853ae3f6cdeaa0f580056a545c) {switch ($v06e3d36fa30cea095545139854ad1fb9->getDataType()) {case 'string':    case 'color':    case 'password': {return $this->getMultiplyCondition($v24b86e853ae3f6cdeaa0f580056a545c, $va3c15e26be16c2bf327e40a137d3aed7);}case 'date':    case 'int':    case 'price':    case 'float':    case 'link_to_object_type':    case 'counter': {return $this->getNumericCondition($v24b86e853ae3f6cdeaa0f580056a545c, $va3c15e26be16c2bf327e40a137d3aed7);}case 'boolean':    case 'file':    case 'img_file':    case 'swf_file':    case 'multiple_image':    case 'video_file': {return $this->getBooleanCondition($v24b86e853ae3f6cdeaa0f580056a545c, $va3c15e26be16c2bf327e40a137d3aed7);}case 'optioned':    case 'tags':    case 'symlink': {return $this->getMultiplyCondition($v24b86e853ae3f6cdeaa0f580056a545c, $va3c15e26be16c2bf327e40a137d3aed7, true);}case 'text':    case 'wysiwyg': {return $this->getMultiplyCondition($v24b86e853ae3f6cdeaa0f580056a545c, $va3c15e26be16c2bf327e40a137d3aed7, true);}case 'relation': {$v833750ac635fcc57dc33ecafe365f9a7 = $v06e3d36fa30cea095545139854ad1fb9->getFieldType();if ($v833750ac635fcc57dc33ecafe365f9a7->getIsMultiple()) {return $this->getMultiplyCondition($v24b86e853ae3f6cdeaa0f580056a545c, $va3c15e26be16c2bf327e40a137d3aed7, true);}return $this->getMultiplyCondition($v24b86e853ae3f6cdeaa0f580056a545c, $va3c15e26be16c2bf327e40a137d3aed7);}default: {throw new publicAdminException(__METHOD__ . ': unsupported field type: ' . $v06e3d36fa30cea095545139854ad1fb9->getDataType());}}}protected function getNumericCondition($v2063c1608d6e0baf80249c42e2be5804, $v1afd32818d1c9525f82aff4c09efd254) {if (is_numeric($v2063c1608d6e0baf80249c42e2be5804)) {return "`$v1afd32818d1c9525f82aff4c09efd254` = $v2063c1608d6e0baf80249c42e2be5804";}if (is_array($v2063c1608d6e0baf80249c42e2be5804) && umiCount($v2063c1608d6e0baf80249c42e2be5804) <= 2) {switch (true) {case isset($v2063c1608d6e0baf80249c42e2be5804['from']) && isset($v2063c1608d6e0baf80249c42e2be5804['to']): {$vd98a07f84921b24ee30f86fd8cd85c3c = $v2063c1608d6e0baf80249c42e2be5804['from'];$v01b6e20344b68835c5ed1ddedf20d531 = $v2063c1608d6e0baf80249c42e2be5804['to'];if (is_numeric($vd98a07f84921b24ee30f86fd8cd85c3c) && is_numeric($v01b6e20344b68835c5ed1ddedf20d531)) {return " (`$v1afd32818d1c9525f82aff4c09efd254` BETWEEN $vd98a07f84921b24ee30f86fd8cd85c3c AND $v01b6e20344b68835c5ed1ddedf20d531)";}break;}case isset($v2063c1608d6e0baf80249c42e2be5804['from']): {$vd98a07f84921b24ee30f86fd8cd85c3c = $v2063c1608d6e0baf80249c42e2be5804['from'];if (is_numeric($vd98a07f84921b24ee30f86fd8cd85c3c)) {return " `$v1afd32818d1c9525f82aff4c09efd254` >= $vd98a07f84921b24ee30f86fd8cd85c3c ";}break;}case isset($v2063c1608d6e0baf80249c42e2be5804['to']): {$v01b6e20344b68835c5ed1ddedf20d531 = $v2063c1608d6e0baf80249c42e2be5804['to'];if (is_numeric($v01b6e20344b68835c5ed1ddedf20d531)) {return " `$v1afd32818d1c9525f82aff4c09efd254` <= $v01b6e20344b68835c5ed1ddedf20d531 ";}break;}}}return null;}protected function getStringCondition($v2063c1608d6e0baf80249c42e2be5804, $v1afd32818d1c9525f82aff4c09efd254, $vf0c89d95c0eaa9fa62a3f81063889984 = false) {if (!is_string($v2063c1608d6e0baf80249c42e2be5804) || $v2063c1608d6e0baf80249c42e2be5804 == '') {return null;}$v2063c1608d6e0baf80249c42e2be5804 = $this->prepareString($v2063c1608d6e0baf80249c42e2be5804, $vf0c89d95c0eaa9fa62a3f81063889984);return $vf0c89d95c0eaa9fa62a3f81063889984 ? " `$v1afd32818d1c9525f82aff4c09efd254` LIKE $v2063c1608d6e0baf80249c42e2be5804 " : " `$v1afd32818d1c9525f82aff4c09efd254` = $v2063c1608d6e0baf80249c42e2be5804 ";}protected function getBooleanCondition($v2063c1608d6e0baf80249c42e2be5804, $v1afd32818d1c9525f82aff4c09efd254) {if (!is_numeric($v2063c1608d6e0baf80249c42e2be5804)) {return null;}$v2063c1608d6e0baf80249c42e2be5804 = (int) ((bool) $v2063c1608d6e0baf80249c42e2be5804);return " `$v1afd32818d1c9525f82aff4c09efd254` = $v2063c1608d6e0baf80249c42e2be5804 ";}protected function getMultiplyCondition($v2063c1608d6e0baf80249c42e2be5804, $v1afd32818d1c9525f82aff4c09efd254, $vf0c89d95c0eaa9fa62a3f81063889984 = false) {if (is_string($v2063c1608d6e0baf80249c42e2be5804)) {return $this->getStringCondition($v2063c1608d6e0baf80249c42e2be5804, $v1afd32818d1c9525f82aff4c09efd254, $vf0c89d95c0eaa9fa62a3f81063889984);}if (!is_array($v2063c1608d6e0baf80249c42e2be5804)) {return null;}if (umiCount($v2063c1608d6e0baf80249c42e2be5804) === 1) {return $this->getStringCondition(array_pop($v2063c1608d6e0baf80249c42e2be5804), $v1afd32818d1c9525f82aff4c09efd254, $vf0c89d95c0eaa9fa62a3f81063889984);}$v993fcb1e163e40a45771f626d3ea0f0f = [];foreach ($v2063c1608d6e0baf80249c42e2be5804 as $vef3e30e070f70244fd6578d88a6b77ac) {$v18954730b6cb534e313dfcce081dc7fd = $this->getStringCondition($vef3e30e070f70244fd6578d88a6b77ac, $v1afd32818d1c9525f82aff4c09efd254, $vf0c89d95c0eaa9fa62a3f81063889984);if ($v18954730b6cb534e313dfcce081dc7fd !== null) {$v993fcb1e163e40a45771f626d3ea0f0f[] = $v18954730b6cb534e313dfcce081dc7fd;}}if (umiCount($v993fcb1e163e40a45771f626d3ea0f0f) === 0) {return null;}return '(' . implode(' OR ', $v993fcb1e163e40a45771f626d3ea0f0f) . ')';}protected function prepareString($vb45cffe084dd3d20d928bee85e7b0f21, $vf0c89d95c0eaa9fa62a3f81063889984 = false) {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$vb45cffe084dd3d20d928bee85e7b0f21 = urldecode($vb45cffe084dd3d20d928bee85e7b0f21);$vb45cffe084dd3d20d928bee85e7b0f21 = $v4717d53ebfdfea8477f780ec66151dcb->escape($vb45cffe084dd3d20d928bee85e7b0f21);$v528d3a0db57c788c744aed5a2ee9f5c8 = $vf0c89d95c0eaa9fa62a3f81063889984 ? '%' : '';$va0f0bc95016c862498bbad29d1f4d9d4 = FilterIndexGenerator::MULTIPLE_VALUE_SEPARATOR;$vb45cffe084dd3d20d928bee85e7b0f21 = $vf0c89d95c0eaa9fa62a3f81063889984 ? sprintf('%s%s%s', $va0f0bc95016c862498bbad29d1f4d9d4, $vb45cffe084dd3d20d928bee85e7b0f21, $va0f0bc95016c862498bbad29d1f4d9d4) : $vb45cffe084dd3d20d928bee85e7b0f21;return "'" . $v528d3a0db57c788c744aed5a2ee9f5c8 . $vb45cffe084dd3d20d928bee85e7b0f21 . $v528d3a0db57c788c744aed5a2ee9f5c8 . "'";}protected function prepareFilterData(array $v0898eeed21a2fa1960a65abb15beb246) {$v0eeb4b546166c5d0fb2149d510244b21 = [];$v3b28b423d321e61b423e2a2412bb53ca = [];$v58252db2fbdee27df7d9a74fb29f7b11 = [];$vcb0d2169dd0b022addb0b6b38f0016ba = $this->getAllFilteredFields();foreach ($vcb0d2169dd0b022addb0b6b38f0016ba as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v06e3d36fa30cea095545139854ad1fb9) {$v833750ac635fcc57dc33ecafe365f9a7 = $v06e3d36fa30cea095545139854ad1fb9->getFieldType();$v3b28b423d321e61b423e2a2412bb53ca[$v3c6e0b8a9c15224a8228b9a98ca1531d] = [     'field' => $v06e3d36fa30cea095545139854ad1fb9,     'fieldType' => $v833750ac635fcc57dc33ecafe365f9a7,     'dataType' => $v06e3d36fa30cea095545139854ad1fb9->getDataType(),     'isMultiple' => $v833750ac635fcc57dc33ecafe365f9a7->getIsMultiple(),    ];}foreach ($v0898eeed21a2fa1960a65abb15beb246 as $vdd8086e8cfd7708cd20d06bf319817dc) {foreach ($vdd8086e8cfd7708cd20d06bf319817dc as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {if ($v2063c1608d6e0baf80249c42e2be5804 === null) {continue;}if ($v3c6e0b8a9c15224a8228b9a98ca1531d === 'id') {$v58252db2fbdee27df7d9a74fb29f7b11[] = $v2063c1608d6e0baf80249c42e2be5804;continue;}if (!$v3b28b423d321e61b423e2a2412bb53ca[$v3c6e0b8a9c15224a8228b9a98ca1531d]['isMultiple']) {$v0eeb4b546166c5d0fb2149d510244b21[$v3c6e0b8a9c15224a8228b9a98ca1531d]['values'][] = $v2063c1608d6e0baf80249c42e2be5804;continue;}$v2063c1608d6e0baf80249c42e2be5804 = trim($v2063c1608d6e0baf80249c42e2be5804, FilterIndexGenerator::MULTIPLE_VALUE_SEPARATOR);$v20332367d80fa59bc3fc5c7acc4a501f = explode(FilterIndexGenerator::MULTIPLE_VALUE_SEPARATOR, $v2063c1608d6e0baf80249c42e2be5804);if (isset($v0eeb4b546166c5d0fb2149d510244b21[$v3c6e0b8a9c15224a8228b9a98ca1531d]['values']) && is_array($v0eeb4b546166c5d0fb2149d510244b21[$v3c6e0b8a9c15224a8228b9a98ca1531d]['values'])) {foreach ($v20332367d80fa59bc3fc5c7acc4a501f as $v7f7cfde5ec586119b48911a2c75851e5) {$v0eeb4b546166c5d0fb2149d510244b21[$v3c6e0b8a9c15224a8228b9a98ca1531d]['values'][] = $v7f7cfde5ec586119b48911a2c75851e5;}}else {$v0eeb4b546166c5d0fb2149d510244b21[$v3c6e0b8a9c15224a8228b9a98ca1531d]['values'] = $v20332367d80fa59bc3fc5c7acc4a501f;}}}$v58252db2fbdee27df7d9a74fb29f7b11 = array_unique($v58252db2fbdee27df7d9a74fb29f7b11);$v8e76877250d07b0cbf8c8dd4699b8aa5 = umiCount($v58252db2fbdee27df7d9a74fb29f7b11);$this->setFilteredEntitiesCount($v8e76877250d07b0cbf8c8dd4699b8aa5);$v22750a19c39ac6008ef2affa6d449c09 = $this->getRangedFieldsTypes();$v69b577cb11e4243e416873adad585fd9 = $this->isNeedToShowAllRangedValues();$v75773b0e87aea642e17b883ff278127f = $this->isNeedToShowSelectedValues();$vaa4cb6509304fc954ae3c630df83f0cd = $this->getSelectedFilters();foreach ($v0eeb4b546166c5d0fb2149d510244b21 as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {if (is_array($v2063c1608d6e0baf80249c42e2be5804['values'])) {$v0eeb4b546166c5d0fb2149d510244b21[$v3c6e0b8a9c15224a8228b9a98ca1531d]['values'] = array_unique($v2063c1608d6e0baf80249c42e2be5804['values']);}$v28c82e1b82e0ddcad94a830aed43ee36 = $v3b28b423d321e61b423e2a2412bb53ca[$v3c6e0b8a9c15224a8228b9a98ca1531d]['field'];if (umiCount($v0eeb4b546166c5d0fb2149d510244b21[$v3c6e0b8a9c15224a8228b9a98ca1531d]['values']) > 1 &&     in_array($v3b28b423d321e61b423e2a2412bb53ca[$v3c6e0b8a9c15224a8228b9a98ca1531d]['dataType'], $v22750a19c39ac6008ef2affa6d449c09)) {$vf09cc7ee3a9a93273f4b80601cafb00c = $v0eeb4b546166c5d0fb2149d510244b21[$v3c6e0b8a9c15224a8228b9a98ca1531d]['values'];if (!$v69b577cb11e4243e416873adad585fd9) {unset($v0eeb4b546166c5d0fb2149d510244b21[$v3c6e0b8a9c15224a8228b9a98ca1531d]['values']);}sort($vf09cc7ee3a9a93273f4b80601cafb00c);$v0eeb4b546166c5d0fb2149d510244b21[$v3c6e0b8a9c15224a8228b9a98ca1531d]['values']['min'] = array_shift($vf09cc7ee3a9a93273f4b80601cafb00c);$v0eeb4b546166c5d0fb2149d510244b21[$v3c6e0b8a9c15224a8228b9a98ca1531d]['values']['max'] = array_pop($vf09cc7ee3a9a93273f4b80601cafb00c);}if ($v75773b0e87aea642e17b883ff278127f && isset($vaa4cb6509304fc954ae3c630df83f0cd[$v3c6e0b8a9c15224a8228b9a98ca1531d])) {$v0eeb4b546166c5d0fb2149d510244b21[$v3c6e0b8a9c15224a8228b9a98ca1531d]['selected'] = $vaa4cb6509304fc954ae3c630df83f0cd[$v3c6e0b8a9c15224a8228b9a98ca1531d];}$v0eeb4b546166c5d0fb2149d510244b21[$v3c6e0b8a9c15224a8228b9a98ca1531d]['field'] = $v28c82e1b82e0ddcad94a830aed43ee36;$v0eeb4b546166c5d0fb2149d510244b21[$v3c6e0b8a9c15224a8228b9a98ca1531d]['type'] = $v3b28b423d321e61b423e2a2412bb53ca[$v3c6e0b8a9c15224a8228b9a98ca1531d]['fieldType'];}return $v0eeb4b546166c5d0fb2149d510244b21;}protected function getRangedFieldsTypes() {return ['date', 'int', 'price', 'float', 'counter'];}protected function getSelectConditions() {$v3e493c5722a065647be862cca7ce2539 = $this->getFilteredFieldsNames();if (umiCount($v3e493c5722a065647be862cca7ce2539) == 0) {throw new publicAdminException(__METHOD__ . ': filtering fields expected');}if ($this->isNeedToUpdateSelectedFilters()) {$vaa4cb6509304fc954ae3c630df83f0cd = $this->getFiltersFieldsNames();$v3e493c5722a065647be862cca7ce2539 = array_diff($v3e493c5722a065647be862cca7ce2539, $vaa4cb6509304fc954ae3c630df83f0cd);}$vf45cd799ee7fedda45c39216c6b53540 = '`id`';if (umiCount($v3e493c5722a065647be862cca7ce2539) > 0) {$vf45cd799ee7fedda45c39216c6b53540 .= ', `' . implode('`, `', $v3e493c5722a065647be862cca7ce2539) . '`';}return $vf45cd799ee7fedda45c39216c6b53540;}protected function getGroupConditions() {if ($this->getEntityType() == 'pages' && $this->isVirtualCopiesIgnored()) {return 'GROUP BY `obj_id`';}return '';}protected function getLimitCondition() {$vaa9f73eea60a006820d0f8768bc8a3fc = $this->getLimit();$v7a86c157ee9713c34fbd7a1ee40f0c5a = $this->getOffset();switch (true) {case $vaa9f73eea60a006820d0f8768bc8a3fc !== null && $v7a86c157ee9713c34fbd7a1ee40f0c5a !== null: {return "LIMIT $v7a86c157ee9713c34fbd7a1ee40f0c5a, $vaa9f73eea60a006820d0f8768bc8a3fc";}case $vaa9f73eea60a006820d0f8768bc8a3fc !== null: {return "LIMIT 0, $vaa9f73eea60a006820d0f8768bc8a3fc";}default: {return '';}}}protected function getSystemConditions() {$vb5b399ec1fcfe753f58dbafa197efdc1 = [];if ($this->getEntityType() == 'pages') {$v952915df58ec9bb4591e820dc1f3b9c8 = $this->getParentIds();if (umiCount($v952915df58ec9bb4591e820dc1f3b9c8) > 0) {$vb5b399ec1fcfe753f58dbafa197efdc1[] = '`parent_id` in (' . implode(', ', $v952915df58ec9bb4591e820dc1f3b9c8) . ')';}$v9a62e3947dc2b94af4417a8390e58cc3 = $this->getTypeIds();if (umiCount($v9a62e3947dc2b94af4417a8390e58cc3) > 0) {$vb5b399ec1fcfe753f58dbafa197efdc1[] = '`type_id` in (' . implode(', ', $v9a62e3947dc2b94af4417a8390e58cc3) . ')';}$v116f28135fae5e979e381e4d66222936 = $this->getLangIds();if (umiCount($v116f28135fae5e979e381e4d66222936) > 0) {$vb5b399ec1fcfe753f58dbafa197efdc1[] = '`lang_id` in (' . implode(', ', $v116f28135fae5e979e381e4d66222936) . ')';}$v926a85278ca49b9c4de5ca08a420fa6d = $this->getDomainIds();if (umiCount($v926a85278ca49b9c4de5ca08a420fa6d) > 0) {$vb5b399ec1fcfe753f58dbafa197efdc1[] = '`domain_id` in (' . implode(', ', $v926a85278ca49b9c4de5ca08a420fa6d) . ')';}$v8099792fd4366fa502a73a71e89b148c = $this->getPermissionsCondition();if (!$v8099792fd4366fa502a73a71e89b148c == '') {$vb5b399ec1fcfe753f58dbafa197efdc1[] = $v8099792fd4366fa502a73a71e89b148c;}}else {$v9a62e3947dc2b94af4417a8390e58cc3 = $this->getTypeIds();if (umiCount($v9a62e3947dc2b94af4417a8390e58cc3) > 0) {$vb5b399ec1fcfe753f58dbafa197efdc1[] = '`type_id` in (' . implode(', ', $v9a62e3947dc2b94af4417a8390e58cc3) . ')';}}if (umiCount($vb5b399ec1fcfe753f58dbafa197efdc1) > 0) {return implode(' AND ', $vb5b399ec1fcfe753f58dbafa197efdc1);}return '';}protected function getJoinsConditions() {if ($this->isPermissionsIgnored()) {return '';}$permissions = permissionsCollection::getInstance();$v8e44f0089b076e18a718eb9ca3d94674 = Service::Auth()->getUserId();if ($permissions->isSv($v8e44f0089b076e18a718eb9ca3d94674)) {return '';}$v80071f37861c360a27b7327e132c911a = $this->getTableName();return "LEFT JOIN `cms3_permissions` as cp on $v80071f37861c360a27b7327e132c911a.id = cp.rel_id";}protected function getPermissionsCondition() {if ($this->isPermissionsIgnored()) {return '';}$permissions = permissionsCollection::getInstance();$v8e44f0089b076e18a718eb9ca3d94674 = Service::Auth()->getUserId();if ($permissions->isSv($v8e44f0089b076e18a718eb9ca3d94674)) {return '';}return $permissions->makeSqlWhere($v8e44f0089b076e18a718eb9ca3d94674);}protected function getFilteredFieldsNames() {return $this->filteredFieldsName;}protected function getParentIds() {return $this->parentsIds;}protected function getTypeIds() {return $this->typeIds;}protected function getLangIds() {return $this->langIds;}protected function getDomainIds() {return $this->domainIds;}protected function isVirtualCopiesIgnored() {return $this->ignoreVirtualCopies;}protected function isNeedToShowAllRangedValues() {return $this->showAllValuesInRangedFields;}protected function getAllFilteredFields() {return $this->allFilteredFields;}protected function getFiltersConditions() {$v2c9885d2b0c7e26971f60a90f33cf718 = $this->filters;if (umiCount($v2c9885d2b0c7e26971f60a90f33cf718) > 0 && $this->isNeedToUpdateSelectedFilters()) {return implode(' AND ', $v2c9885d2b0c7e26971f60a90f33cf718);}return '';}protected function setFilters(array $v2c9885d2b0c7e26971f60a90f33cf718) {$this->filters = $v2c9885d2b0c7e26971f60a90f33cf718;return true;}protected function getEntityType() {return $this->entityType;}protected function getTableName() {return $this->tableName;}protected function getLimit() {return $this->limit;}protected function getOffset() {return $this->offset;}protected function setFilteredEntitiesCount($ve2942a04780e223b215eb8b663cf5353) {$this->filteredEntitiesCount = (int) $ve2942a04780e223b215eb8b663cf5353;}protected function isNeedToShowSelectedValues() {return $this->showSelectedValues;}protected function isNeedToUpdateSelectedFilters() {return $this->updateSelectedFilters;}protected function getSelectedFilters() {return $this->selectedFilters;}protected function pushSelectedFilterValue($v972bf3f05d14ffbdb817bef60638ff00, $v319e2726bcc98302437312a8ebfe9deb) {$this->selectedFilters[$v972bf3f05d14ffbdb817bef60638ff00] = $v319e2726bcc98302437312a8ebfe9deb;}protected function getFilterOptionsConditions() {return '';}}