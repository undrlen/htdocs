<?php
 use UmiCms\Service;class langsCollection implements iLangsCollection {private $connection;private $domainCollection;private $languageList = [];public function __construct(IConnection $v4717d53ebfdfea8477f780ec66151dcb, iDomainsCollection $v0d771fa031fb27561ed207afa6cf9983) {$this->connection = $v4717d53ebfdfea8477f780ec66151dcb;$this->domainCollection = $v0d771fa031fb27561ed207afa6cf9983;}public function addLang($v851f5ac9941d720844d143ed9cfcf60a, $vd5d3db1765287eef77d7927cc956f50a, $ve558e63f3083922542d8745224a66eea = false) {$vb80bb7740288fda1f201890375a60c8f = $this->getLangId($v851f5ac9941d720844d143ed9cfcf60a);if ($vb80bb7740288fda1f201890375a60c8f) {throw new coreException("Lang #{$v851f5ac9941d720844d143ed9cfcf60a} already exist.");}$v4717d53ebfdfea8477f780ec66151dcb = $this->getConnection();$v4717d53ebfdfea8477f780ec66151dcb->startTransaction("Create lang {$v851f5ac9941d720844d143ed9cfcf60a}");try {$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO `cms3_langs` VALUES(null, '%s', '%s', %d)";$vac5c74b64b4b8352ef2f181affb5ac2a = sprintf($vac5c74b64b4b8352ef2f181affb5ac2a, $v851f5ac9941d720844d143ed9cfcf60a, $vd5d3db1765287eef77d7927cc956f50a, (int) $ve558e63f3083922542d8745224a66eea);$v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);$vb80bb7740288fda1f201890375a60c8f = $v4717d53ebfdfea8477f780ec66151dcb->insertId();$v8512ae7d57b1396273f76fe6ed341a23 = new lang($vb80bb7740288fda1f201890375a60c8f);$v8512ae7d57b1396273f76fe6ed341a23->setPrefix($v851f5ac9941d720844d143ed9cfcf60a);$v8512ae7d57b1396273f76fe6ed341a23->setTitle($vd5d3db1765287eef77d7927cc956f50a);$v8512ae7d57b1396273f76fe6ed341a23->setIsDefault($ve558e63f3083922542d8745224a66eea);$v8512ae7d57b1396273f76fe6ed341a23->commit();}catch (Exception $ve1671797c52e15f763380b45e841ec32) {$v4717d53ebfdfea8477f780ec66151dcb->rollbackTransaction();throw $ve1671797c52e15f763380b45e841ec32;}$v4717d53ebfdfea8477f780ec66151dcb->commitTransaction();$this->setLanguage($v8512ae7d57b1396273f76fe6ed341a23);if ($ve558e63f3083922542d8745224a66eea) {$this->setDefault($vb80bb7740288fda1f201890375a60c8f);}return $vb80bb7740288fda1f201890375a60c8f;}public function delLang($vb80bb7740288fda1f201890375a60c8f) {if (!$this->isExists($vb80bb7740288fda1f201890375a60c8f)) {throw new coreException("Language #{$vb80bb7740288fda1f201890375a60c8f} doesn't exist.");}$v8512ae7d57b1396273f76fe6ed341a23 = $this->getLang($vb80bb7740288fda1f201890375a60c8f);$v4717d53ebfdfea8477f780ec66151dcb = $this->getConnection();$v817f7de13f58df29b13a9570082097da = (int) $vb80bb7740288fda1f201890375a60c8f;$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM `cms3_langs` WHERE `id` = $v817f7de13f58df29b13a9570082097da";$v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);$this->unsetLanguage($v8512ae7d57b1396273f76fe6ed341a23);unset($v8512ae7d57b1396273f76fe6ed341a23);return true;}public function getLang($vb80bb7740288fda1f201890375a60c8f) {return $this->isExists($vb80bb7740288fda1f201890375a60c8f) ? $this->getList()[$vb80bb7740288fda1f201890375a60c8f] : false;}public function getDefaultLang() {foreach ($this->getList() as $v8512ae7d57b1396273f76fe6ed341a23) {if ($v8512ae7d57b1396273f76fe6ed341a23->getIsDefault()) {return $v8512ae7d57b1396273f76fe6ed341a23;}}return false;}public function setDefault($vb80bb7740288fda1f201890375a60c8f) {if (!$this->isExists($vb80bb7740288fda1f201890375a60c8f)) {throw new coreException("Language #{$vb80bb7740288fda1f201890375a60c8f} doesn't exist.");}$v4717d53ebfdfea8477f780ec66151dcb = $this->getConnection();$v4717d53ebfdfea8477f780ec66151dcb->startTransaction("Set default lang #{$vb80bb7740288fda1f201890375a60c8f}");try {$v9345e1d755cd2cf690ee1c97c666429a = $this->getDefaultLang();if ($v9345e1d755cd2cf690ee1c97c666429a instanceof iLang) {$v9345e1d755cd2cf690ee1c97c666429a->setIsDefault(false);$v9345e1d755cd2cf690ee1c97c666429a->commit();}$vb32400602669936c57a927faac14cd54 = $this->getLang($vb80bb7740288fda1f201890375a60c8f);$vb32400602669936c57a927faac14cd54->setIsDefault(true);$vb32400602669936c57a927faac14cd54->commit();}catch (Exception $ve1671797c52e15f763380b45e841ec32) {$v4717d53ebfdfea8477f780ec66151dcb->rollbackTransaction();throw $ve1671797c52e15f763380b45e841ec32;}$v4717d53ebfdfea8477f780ec66151dcb->commitTransaction();return true;}public function getLangId($v851f5ac9941d720844d143ed9cfcf60a) {foreach ($this->getList() as $v8512ae7d57b1396273f76fe6ed341a23) {if ($v8512ae7d57b1396273f76fe6ed341a23->getPrefix() == $v851f5ac9941d720844d143ed9cfcf60a) {return $v8512ae7d57b1396273f76fe6ed341a23->getId();}}return false;}public function getList() {if (empty($this->languageList)) {$this->loadLanguageList();}return $this->languageList;}public function isExists($vb80bb7740288fda1f201890375a60c8f) {if (!is_string($vb80bb7740288fda1f201890375a60c8f) && !is_int($vb80bb7740288fda1f201890375a60c8f)) {return false;}return array_key_exists($vb80bb7740288fda1f201890375a60c8f, $this->getList());}public function getLanguageIdByUrl($v572d4e421e5e6b9bc11d815e8a027112) {$v0d771fa031fb27561ed207afa6cf9983 = $this->getDomainCollection();$v72ee76c5c29383b7c9f9225c1fa4d10b = $v0d771fa031fb27561ed207afa6cf9983->getDomainIdByUrl($v572d4e421e5e6b9bc11d815e8a027112);$vad5f82e879a9c5d6b5b442eb37e50551 = $v0d771fa031fb27561ed207afa6cf9983->getDomain($v72ee76c5c29383b7c9f9225c1fa4d10b);if (!$vad5f82e879a9c5d6b5b442eb37e50551 instanceof iDomain) {return false;}if (!preg_match('/^https?:\/\/[^\/]*[\/]([^\/]*)/', $v572d4e421e5e6b9bc11d815e8a027112, $v9c28d32df234037773be184dbdafc274)) {return $vad5f82e879a9c5d6b5b442eb37e50551->getDefaultLangId();}$v851f5ac9941d720844d143ed9cfcf60a = $v9c28d32df234037773be184dbdafc274[1];$v4e2f2d03349410f1759417dfc99321b1 = $this->getLangId($v851f5ac9941d720844d143ed9cfcf60a);if (is_numeric($v4e2f2d03349410f1759417dfc99321b1)) {return $v4e2f2d03349410f1759417dfc99321b1;}return $vad5f82e879a9c5d6b5b442eb37e50551->getDefaultLangId();}public function clearCache() {$vf3e334d42863e8250c7d03efefbfd387 = $this->getList();foreach ($vf3e334d42863e8250c7d03efefbfd387 as $v8512ae7d57b1396273f76fe6ed341a23) {$this->unsetLanguage($v8512ae7d57b1396273f76fe6ed341a23);unset($vf3e334d42863e8250c7d03efefbfd387);}unset($vf3e334d42863e8250c7d03efefbfd387);}private function unsetLanguage(iLang $v8512ae7d57b1396273f76fe6ed341a23) {unset($this->languageList[$v8512ae7d57b1396273f76fe6ed341a23->getId()]);return $this;}private function setLanguage(iLang $v8512ae7d57b1396273f76fe6ed341a23) {$this->languageList[$v8512ae7d57b1396273f76fe6ed341a23->getId()] = $v8512ae7d57b1396273f76fe6ed341a23;return $this;}private function loadLanguageList() {$vac5c74b64b4b8352ef2f181affb5ac2a = 'SELECT `id`, `prefix`, `is_default`, `title` FROM `cms3_langs`';$result = $this->getConnection()    ->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);$result->setFetchType(IQueryResult::FETCH_ROW);foreach ($result as $vf1965a857bc285d26fe22023aa5ab50d) {try {$v8512ae7d57b1396273f76fe6ed341a23 = new lang($vf1965a857bc285d26fe22023aa5ab50d[0], $vf1965a857bc285d26fe22023aa5ab50d);}catch (privateException $ve1671797c52e15f763380b45e841ec32) {$ve1671797c52e15f763380b45e841ec32->unregister();continue;}if ($v8512ae7d57b1396273f76fe6ed341a23 instanceof iLang) {$this->setLanguage($v8512ae7d57b1396273f76fe6ed341a23);}}return true;}private function getConnection() {return $this->connection;}private function getDomainCollection() {return $this->domainCollection;}public function getAssocArray() {$v9b207167e5381c47682c6b4f58a623fb = [];foreach ($this->getList() as $v7572559ca86e781ba8fe8073a0b725c6) {$v9b207167e5381c47682c6b4f58a623fb[$v7572559ca86e781ba8fe8073a0b725c6->getId()] = $v7572559ca86e781ba8fe8073a0b725c6->getTitle();}return $v9b207167e5381c47682c6b4f58a623fb;}public static function getInstance($v4a8a08f09d37b73795649038408b5f33 = null) {return Service::LanguageCollection();}}