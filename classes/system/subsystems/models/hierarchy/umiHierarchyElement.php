<?php
 use UmiCms\Service;class umiHierarchyElement extends umiEntinty implements iUmiHierarchyElement {const INSTANCE_ATTRIBUTE_COUNT = 21;private $rel;private $alt_name;private $ord;private $object_id;private $type_id;private $domain_id;private $lang_id;private $tpl_id;private $is_deleted = false;private $is_active = true;private $is_visible = true;private $is_default = false;private $update_time;private $fields;protected $store_type = 'element';public function getIsDeleted() {return $this->is_deleted;}public function getIsActive() {return $this->is_active;}public function getIsVisible() {return $this->is_visible;}public function getLangId() {return $this->lang_id;}public function getDomainId() {return $this->domain_id;}public function getTplId() {return $this->tpl_id;}public function getTypeId() {return $this->type_id;}public function getUpdateTime() {return $this->update_time;}public function getOrd() {return $this->ord;}public function getAltName() {return $this->alt_name;}public function getIsDefault() {return $this->is_default;}public function hasVirtualCopy() {$v16b2b26000987faccb260b9d39df1269 = (int) $this->getObjectId();$v1b1cc7f086b3f074da452bc3129981eb = <<<SQL
SELECT `id` FROM `cms3_hierarchy` WHERE `obj_id` = $v16b2b26000987faccb260b9d39df1269 LIMIT 0, 2
SQL;   $v26d59e24afcb9c11f03ffe8392b68734 = ConnectionPool::getInstance()    ->getConnection()    ->queryResult($v1b1cc7f086b3f074da452bc3129981eb);return ($v26d59e24afcb9c11f03ffe8392b68734->length() > 1);}public function isOriginal() {$v16b2b26000987faccb260b9d39df1269 = (int) $this->getObjectId();$v1b1cc7f086b3f074da452bc3129981eb = <<<SQL
SELECT `id` FROM `cms3_hierarchy` WHERE `obj_id` = $v16b2b26000987faccb260b9d39df1269 LIMIT 0, 1
SQL;   try {$v26d59e24afcb9c11f03ffe8392b68734 = ConnectionPool::getInstance()     ->getConnection()     ->queryResult($v1b1cc7f086b3f074da452bc3129981eb)     ->setFetchType(IQueryResult::FETCH_ASSOC);}catch (databaseException $v42552b1f133f9f8eb406d4f306ea9fd1) {umiExceptionHandler::report($v42552b1f133f9f8eb406d4f306ea9fd1);return false;}if ($v26d59e24afcb9c11f03ffe8392b68734->length() === 0) {return false;}$vd2cd19e9fe2b1f9f760f03afdea4dc8c = $v26d59e24afcb9c11f03ffe8392b68734->fetch();$vba6788b52ca9f2b945381a726d654773 = array_shift($vd2cd19e9fe2b1f9f760f03afdea4dc8c);return ($vba6788b52ca9f2b945381a726d654773 == $this->getId());}public function getObject() {$va8cfde6331bd59eb2ac96f8911c4b666 = umiObjectsCollection::getInstance()    ->getObject($this->object_id);if (!$va8cfde6331bd59eb2ac96f8911c4b666 instanceof iUmiObject) {throw new coreException(sprintf('Cannot load iUmiObject by id "%s"', $this->object_id));}return $va8cfde6331bd59eb2ac96f8911c4b666;}public function getParentId() {return $this->rel;}public function getName() {return $this->getObject()    ->getName();}public function setName($vb068931cc450442b63f5b3d276ea4297) {if ($this->getName() != $vb068931cc450442b63f5b3d276ea4297) {$this->getObject()     ->setName($vb068931cc450442b63f5b3d276ea4297);$this->setIsUpdated();}}public function getValue($v46b9e6004c49d9cc040029c197cab278, $v21ffce5b8a6cc8cc6a41448dd69623c9 = null, $vbd354405a20aa635025421c9edb5d41d = false) {return $this->getObject()    ->getValue($v46b9e6004c49d9cc040029c197cab278, $v21ffce5b8a6cc8cc6a41448dd69623c9);}public function setValue($v46b9e6004c49d9cc040029c197cab278, $vafd40dce490ea113be83c89ca7f3052d) {$va1969d66c26cd779e70033deeb84cbb7 = $this->getObject()    ->setValue($v46b9e6004c49d9cc040029c197cab278, $vafd40dce490ea113be83c89ca7f3052d);if ($va1969d66c26cd779e70033deeb84cbb7) {$this->setIsUpdated();}return $va1969d66c26cd779e70033deeb84cbb7;}public function loadFields() {$vd05b6ed7d2345020440df396d6da7f73 = $this->fields = umiTypesHelper::getInstance()    ->getFieldsByObjectTypeIds($this->getObjectTypeId());$this->fields = $vd05b6ed7d2345020440df396d6da7f73[$this->getObjectTypeId()];}public function setIsVisible($v19fad0416b4b101ab72faccf4c323024 = true) {$v19fad0416b4b101ab72faccf4c323024 = (bool) $v19fad0416b4b101ab72faccf4c323024;if ($this->getIsVisible() !== $v19fad0416b4b101ab72faccf4c323024) {$this->is_visible = $v19fad0416b4b101ab72faccf4c323024;$this->setIsUpdated();}}public function setIsActive($v367e854225a0810977297b3bedb2f309 = true) {$v367e854225a0810977297b3bedb2f309 = (bool) $v367e854225a0810977297b3bedb2f309;if ($this->getIsActive() !== $v367e854225a0810977297b3bedb2f309) {$this->is_active = $v367e854225a0810977297b3bedb2f309;$this->setIsUpdated();}}public function setDeleted($va18b1057c4327b9cc46abc9fcf952bd8 = true) {$va18b1057c4327b9cc46abc9fcf952bd8 = (bool) $va18b1057c4327b9cc46abc9fcf952bd8;if ($this->getIsDeleted() !== $va18b1057c4327b9cc46abc9fcf952bd8) {$this->is_deleted = $va18b1057c4327b9cc46abc9fcf952bd8;$this->setIsUpdated();}}public function setTypeId($v5f694956811487225d15e973ca38fbab) {$v5f694956811487225d15e973ca38fbab = (int) $v5f694956811487225d15e973ca38fbab;if ($this->getTypeId() !== $v5f694956811487225d15e973ca38fbab) {$this->type_id = $v5f694956811487225d15e973ca38fbab;$this->setIsUpdated();}}public function setLangId($vf585b7f018bb4ced15a03683a733e50b) {$vf585b7f018bb4ced15a03683a733e50b = (int) $vf585b7f018bb4ced15a03683a733e50b;if ($this->getLangId() !== $vf585b7f018bb4ced15a03683a733e50b) {$this->lang_id = $vf585b7f018bb4ced15a03683a733e50b;$this->setIsUpdated();}}public function setTplId($v3200a31fc05da4e9d5a0465c36822e2f) {$v3200a31fc05da4e9d5a0465c36822e2f = (int) $v3200a31fc05da4e9d5a0465c36822e2f;if ($this->getTplId() !== $v3200a31fc05da4e9d5a0465c36822e2f) {$this->tpl_id = (int) $v3200a31fc05da4e9d5a0465c36822e2f;$this->setIsUpdated();}}public function setDomainId($v72ee76c5c29383b7c9f9225c1fa4d10b) {$v72ee76c5c29383b7c9f9225c1fa4d10b = (int) $v72ee76c5c29383b7c9f9225c1fa4d10b;if ($this->getDomainId() !== $v72ee76c5c29383b7c9f9225c1fa4d10b) {$this->domain_id = $v72ee76c5c29383b7c9f9225c1fa4d10b;$this->setIsUpdated();}$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$v268184c12df027f536154d099d497b31 = $vb81ca7c0ccaa77e7aa91936ab0070695->getChildrenTree($this->getId());foreach ($v268184c12df027f536154d099d497b31 as $vf36263a38d7de5cdaa953c1e2b2f79b5 => $v1a13105b7e4eb5fb2e7c9515ac06aa48) {$v1b7d5726533ab525a8760351e9b5e415 = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($vf36263a38d7de5cdaa953c1e2b2f79b5, true, true);$v1b7d5726533ab525a8760351e9b5e415->setDomainId($v72ee76c5c29383b7c9f9225c1fa4d10b);$v1b7d5726533ab525a8760351e9b5e415->commit();$vb81ca7c0ccaa77e7aa91936ab0070695->unloadElement($vf36263a38d7de5cdaa953c1e2b2f79b5);unset($v1b7d5726533ab525a8760351e9b5e415);}}public function setUpdateTime($v5fa40b2485d1096a170d2d7ecd0f7030 = 0) {$v5fa40b2485d1096a170d2d7ecd0f7030 = (int) $v5fa40b2485d1096a170d2d7ecd0f7030;if ($v5fa40b2485d1096a170d2d7ecd0f7030 == 0) {$v5fa40b2485d1096a170d2d7ecd0f7030 = umiHierarchy::getTimeStamp();}if ($this->getUpdateTime() !== $v5fa40b2485d1096a170d2d7ecd0f7030) {$this->update_time = $v5fa40b2485d1096a170d2d7ecd0f7030;parent::setIsUpdated();}}public function setOrd($v8bef1cc20ada3bef55fdf132cb2a1cb9) {$v8bef1cc20ada3bef55fdf132cb2a1cb9 = (int) $v8bef1cc20ada3bef55fdf132cb2a1cb9;if ($this->getOrd() !== $v8bef1cc20ada3bef55fdf132cb2a1cb9) {$this->ord = $v8bef1cc20ada3bef55fdf132cb2a1cb9;$this->setIsUpdated();}}public function setRel($vbfa030fe63bacd523dd70a76cfaed98a) {$vbfa030fe63bacd523dd70a76cfaed98a = (int) $vbfa030fe63bacd523dd70a76cfaed98a;if ($vbfa030fe63bacd523dd70a76cfaed98a == $this->getId()) {throw new coreException('Page cannot be parent for itself');}if ($this->getParentId() !== $vbfa030fe63bacd523dd70a76cfaed98a) {$this->rel = $vbfa030fe63bacd523dd70a76cfaed98a;$this->setIsUpdated();}}public function setObject(iUmiObject $va8cfde6331bd59eb2ac96f8911c4b666, $v8d7904c906bcc57446882b94f0afe0bd = true) {if ($this->getObjectId() != $va8cfde6331bd59eb2ac96f8911c4b666->getId()) {$this->object_id = $va8cfde6331bd59eb2ac96f8911c4b666->getId();$this->setIsUpdated();if ($v8d7904c906bcc57446882b94f0afe0bd) {$va8cfde6331bd59eb2ac96f8911c4b666->setIsUpdated();}}}public function setAltName($v7987798a8b7ddbdbe3460ad69a08f0c1, $v9081405e153955c7c08554c483e264cb = true) {if (!$v7987798a8b7ddbdbe3460ad69a08f0c1) {$v7987798a8b7ddbdbe3460ad69a08f0c1 = $this->getName();}if ($v9081405e153955c7c08554c483e264cb) {$v7987798a8b7ddbdbe3460ad69a08f0c1 = umiHierarchy::convertAltName($v7987798a8b7ddbdbe3460ad69a08f0c1);$v7987798a8b7ddbdbe3460ad69a08f0c1 = $v7987798a8b7ddbdbe3460ad69a08f0c1 ?: '_';}$vca9fa76d1e7fce7793cb4cecd4d2fc4e = $this->getRightAltName(    umiObjectProperty::filterInputString($v7987798a8b7ddbdbe3460ad69a08f0c1)   );$v6b1981a1f2a1d3498d54e22553eeb789 = $vca9fa76d1e7fce7793cb4cecd4d2fc4e ?: $v7987798a8b7ddbdbe3460ad69a08f0c1;if ($this->getAltName() !== $v6b1981a1f2a1d3498d54e22553eeb789) {$this->alt_name = $v6b1981a1f2a1d3498d54e22553eeb789;$this->setIsUpdated();}}public function __destruct() {$v16b2b26000987faccb260b9d39df1269 = $this->object_id;parent::__destruct();umiObjectsCollection::getInstance()->unloadObject($v16b2b26000987faccb260b9d39df1269);}private function getRightAltName($v0330da281541887f65b0a60066351c91, $vfccb78546bde0a967286ecf4577bc3d3 = false) {return umiHierarchy::getInstance()->getRightAltName($v0330da281541887f65b0a60066351c91, $this, $vfccb78546bde0a967286ecf4577bc3d3);}public function setIsDefault($ve558e63f3083922542d8745224a66eea = true) {$ve558e63f3083922542d8745224a66eea = (bool) $ve558e63f3083922542d8745224a66eea;if ($this->getIsDefault() !== $ve558e63f3083922542d8745224a66eea) {$this->is_default = (bool) $ve558e63f3083922542d8745224a66eea;$this->setIsUpdated();$v475d6424dac268bb5fffd0235530c333 = umiHierarchy::getInstance();$v475d6424dac268bb5fffd0235530c333->clearDefaultElementCache();}}public function getFieldId($v972bf3f05d14ffbdb817bef60638ff00) {return $this->getObject()    ->getType()    ->getFieldId($v972bf3f05d14ffbdb817bef60638ff00);}protected function loadInfo($v8d777f385d3dfec8815d20f7496026dc = false) {if (!is_array($v8d777f385d3dfec8815d20f7496026dc) || count($v8d777f385d3dfec8815d20f7496026dc) !== self::INSTANCE_ATTRIBUTE_COUNT) {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$v817f7de13f58df29b13a9570082097da = (int) $this->getId();$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT
	h.rel,
	h.type_id,
	h.lang_id,
	h.domain_id,
	h.tpl_id,
	h.obj_id,
	h.ord,
	h.alt_name,
	h.is_active,
	h.is_visible,
	h.is_deleted,
	h.updatetime,
	h.is_default,
	o.name,
	o.type_id,
	o.is_locked,
	o.owner_id,
	o.guid,
	t.guid,
	o.updatetime,
	o.ord
FROM cms3_hierarchy h, cms3_objects o, cms3_object_types t
WHERE 
	h.id = $v817f7de13f58df29b13a9570082097da 
	AND o.id = h.obj_id
	AND o.type_id = t.id
LIMIT 0,1
SQL;    $result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);$result->setFetchType(IQueryResult::FETCH_ROW);$v8d777f385d3dfec8815d20f7496026dc = $result->fetch();}if (!is_array($v8d777f385d3dfec8815d20f7496026dc) || count($v8d777f385d3dfec8815d20f7496026dc) !== self::INSTANCE_ATTRIBUTE_COUNT) {return false;}list(    $vbfa030fe63bacd523dd70a76cfaed98a, $v5f694956811487225d15e973ca38fbab, $vf585b7f018bb4ced15a03683a733e50b, $v72ee76c5c29383b7c9f9225c1fa4d10b, $vdfae309a35c166d21d4a1ab377b78a47, $v16b2b26000987faccb260b9d39df1269, $v8bef1cc20ada3bef55fdf132cb2a1cb9, $v0330da281541887f65b0a60066351c91, $vc76a5e84e4bdee527e274ea30c680d79, $v46cf0e59759c9b7f1112ca4b174343ef, $vda602f0b162fccbf6b150cfcfc7a7379,    $v5fa40b2485d1096a170d2d7ecd0f7030, $vc21f969b5f03d33d43e04f8f136e7682, $v127fdefda02f069baf5af8860c31bc93, $v6301cee35ea764a1e241978f93f01069, $v3f106aead087812af5aaf0ffec9b458f, $v76fe92e3de5a854283f2bfede82400e7, $vf1145bab6f93ef4a95d0a8a863a46f09,    $v2aa3b95fffa7fee478c11e57e2c53047, $v1bc3680ca983c728dbc31a661623b6fe, $v09113d1a8fd780628aa368a2ec0723bb    ) = $v8d777f385d3dfec8815d20f7496026dc;$this->rel = (int) $vbfa030fe63bacd523dd70a76cfaed98a;$this->type_id = (int) $v5f694956811487225d15e973ca38fbab;$this->lang_id = (int) $vf585b7f018bb4ced15a03683a733e50b;$this->domain_id = (int) $v72ee76c5c29383b7c9f9225c1fa4d10b;$this->tpl_id = (int) $vdfae309a35c166d21d4a1ab377b78a47;$this->object_id = (int) $v16b2b26000987faccb260b9d39df1269;$this->ord = (int) $v8bef1cc20ada3bef55fdf132cb2a1cb9;$this->alt_name = $v0330da281541887f65b0a60066351c91;$this->is_active = (bool) $vc76a5e84e4bdee527e274ea30c680d79;$this->is_visible = (bool) $v46cf0e59759c9b7f1112ca4b174343ef;$this->is_deleted = (bool) $vda602f0b162fccbf6b150cfcfc7a7379;$this->is_default = (bool) $vc21f969b5f03d33d43e04f8f136e7682;$this->update_time = (int) $v5fa40b2485d1096a170d2d7ecd0f7030 ?: umiHierarchy::getTimeStamp();$vce1741ea0c2fa1c5affe8bab61458cc4 = [    $v127fdefda02f069baf5af8860c31bc93,    $v6301cee35ea764a1e241978f93f01069,    $v3f106aead087812af5aaf0ffec9b458f,    $v76fe92e3de5a854283f2bfede82400e7,    $vf1145bab6f93ef4a95d0a8a863a46f09,    $v2aa3b95fffa7fee478c11e57e2c53047,    $v1bc3680ca983c728dbc31a661623b6fe,    $v09113d1a8fd780628aa368a2ec0723bb   ];umiObjectsCollection::getInstance()    ->getObject($v16b2b26000987faccb260b9d39df1269, $vce1741ea0c2fa1c5affe8bab61458cc4);return true;}protected function save() {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()    ->getConnection();$va6eb4816205178e88dad66a16a19ff45 = (int) $this->getId();$vbfa030fe63bacd523dd70a76cfaed98a = (int) $this->getParentId();$v5f694956811487225d15e973ca38fbab = (int) $this->getTypeId();$v694b5b6b5536d28285396c8ce7c268bc = (int) $this->getLangId();$v72ee76c5c29383b7c9f9225c1fa4d10b = (int) $this->getDomainId();try {$v3200a31fc05da4e9d5a0465c36822e2f = (int) $this->ensureTemplate()->getId();}catch (coreException $v42552b1f133f9f8eb406d4f306ea9fd1) {$v3200a31fc05da4e9d5a0465c36822e2f = 'NULL';}$v16b2b26000987faccb260b9d39df1269 = (int) $this->getObjectId();$v8bef1cc20ada3bef55fdf132cb2a1cb9 = (int) $this->getOrd();$v0330da281541887f65b0a60066351c91 = $v4717d53ebfdfea8477f780ec66151dcb->escape($this->getAltName());$v367e854225a0810977297b3bedb2f309 = (int) $this->getIsActive();$v19fad0416b4b101ab72faccf4c323024 = (int) $this->getIsVisible();$va18b1057c4327b9cc46abc9fcf952bd8 = (int) $this->getIsDeleted();$v5fa40b2485d1096a170d2d7ecd0f7030 = (int) $this->getUpdateTime();$ve558e63f3083922542d8745224a66eea = (int) $this->getIsDefault();$v4717d53ebfdfea8477f780ec66151dcb->startTransaction("Updating page with id $va6eb4816205178e88dad66a16a19ff45");try {if ($ve558e63f3083922542d8745224a66eea) {$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
UPDATE
	`cms3_hierarchy`
SET
	`is_default` = '0'
WHERE
	`is_default` = '1'
AND
	`lang_id` = $v694b5b6b5536d28285396c8ce7c268bc
AND
	`domain_id` = $v72ee76c5c29383b7c9f9225c1fa4d10b
SQL;     $v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);}$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
UPDATE
	`cms3_hierarchy`
SET
	`rel` = $vbfa030fe63bacd523dd70a76cfaed98a, `type_id` = $v5f694956811487225d15e973ca38fbab, `lang_id` = $v694b5b6b5536d28285396c8ce7c268bc, `domain_id` = $v72ee76c5c29383b7c9f9225c1fa4d10b,
	`tpl_id` = $v3200a31fc05da4e9d5a0465c36822e2f, `obj_id` = $v16b2b26000987faccb260b9d39df1269, `ord` = $v8bef1cc20ada3bef55fdf132cb2a1cb9, `alt_name` = '$v0330da281541887f65b0a60066351c91',
	`is_active` = $v367e854225a0810977297b3bedb2f309, `is_visible` = $v19fad0416b4b101ab72faccf4c323024, `is_deleted` = $va18b1057c4327b9cc46abc9fcf952bd8,
	`updatetime` = $v5fa40b2485d1096a170d2d7ecd0f7030, `is_default` = $ve558e63f3083922542d8745224a66eea
WHERE
	`id` = $va6eb4816205178e88dad66a16a19ff45
SQL;    $v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);}catch (databaseException $ve1671797c52e15f763380b45e841ec32) {$v4717d53ebfdfea8477f780ec66151dcb->rollbackTransaction();throw $ve1671797c52e15f763380b45e841ec32;}$v4717d53ebfdfea8477f780ec66151dcb->commitTransaction();if (defined('PAGES_AUTO_INDEX') && PAGES_AUTO_INDEX) {searchModel::getInstance()     ->processPage($this);}if (!umiHierarchy::$ignoreSiteMap) {Service::SiteMapUpdater()     ->update($this);}try {$this->updateYML();}catch (Exception $ve1671797c52e15f763380b45e841ec32) {}return true;}private function ensureTemplate() {$v3200a31fc05da4e9d5a0465c36822e2f = $this->getTplId();$v694b5b6b5536d28285396c8ce7c268bc = $this->getLangId();$v72ee76c5c29383b7c9f9225c1fa4d10b = $this->getDomainId();$v65ac1f4cfaa18bd14546f2c5a7d2ad80 = templatesCollection::getInstance();if ($v65ac1f4cfaa18bd14546f2c5a7d2ad80->isExistsForSite($v3200a31fc05da4e9d5a0465c36822e2f, $v72ee76c5c29383b7c9f9225c1fa4d10b, $v694b5b6b5536d28285396c8ce7c268bc)) {return $v65ac1f4cfaa18bd14546f2c5a7d2ad80->getTemplate($v3200a31fc05da4e9d5a0465c36822e2f);}$vc21f969b5f03d33d43e04f8f136e7682 = $v65ac1f4cfaa18bd14546f2c5a7d2ad80->getDefaultTemplate($v72ee76c5c29383b7c9f9225c1fa4d10b, $v694b5b6b5536d28285396c8ce7c268bc);if (!$vc21f969b5f03d33d43e04f8f136e7682 instanceof iTemplate) {throw new coreException('Cannot get default template');}$this->setTplId($vc21f969b5f03d33d43e04f8f136e7682->getId());return $vc21f969b5f03d33d43e04f8f136e7682;}public function updateYML() {$v100664c6e2c0333b19a729f2f3ddb7dd = SYS_TEMP_PATH . '/yml/';$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$v6942e8fa62b3cc9d93881a58210e2fd7 = umiHierarchyTypesCollection::getInstance();$v8c028488715d341980c5985fd02bfa1e = $v6942e8fa62b3cc9d93881a58210e2fd7->getTypeByName('catalog', 'object');$v3e78669aa9a1bfe336037e3d77a22705 = $v6942e8fa62b3cc9d93881a58210e2fd7->getTypeByName('catalog', 'category');if (!$v8c028488715d341980c5985fd02bfa1e || !$v3e78669aa9a1bfe336037e3d77a22705) {return false;}if ($this->getHierarchyType()->getId() == $v3e78669aa9a1bfe336037e3d77a22705->getId()) {$this->checkYMLinclude();if (!$this->is_active || $this->is_deleted) {$v397c47bd29ed2de23a264b3de9d0aeaf = $vb81ca7c0ccaa77e7aa91936ab0070695->getChildrenList($this->getId(), false);foreach ($v397c47bd29ed2de23a264b3de9d0aeaf as $vf4f40123eb510dd3290125b38f4eb898) {$v0f635d0e0f3874fff8b581c132e6c7a7 = $v100664c6e2c0333b19a729f2f3ddb7dd . $vf4f40123eb510dd3290125b38f4eb898 . '.txt';if (file_exists($v0f635d0e0f3874fff8b581c132e6c7a7)) {unlink($v0f635d0e0f3874fff8b581c132e6c7a7);}}}return true;}if ($this->getHierarchyType()->getId() != $v8c028488715d341980c5985fd02bfa1e->getId()) {return false;}if (!is_dir($v100664c6e2c0333b19a729f2f3ddb7dd)) {mkdir($v100664c6e2c0333b19a729f2f3ddb7dd, 0777, true);}$v0f635d0e0f3874fff8b581c132e6c7a7 = $v100664c6e2c0333b19a729f2f3ddb7dd . "{$this->id}.txt";if (file_exists($v0f635d0e0f3874fff8b581c132e6c7a7)) {unlink($v0f635d0e0f3874fff8b581c132e6c7a7);}if ($this->is_active && !$this->is_deleted) {$v9c28d32df234037773be184dbdafc274 = $this->checkYMLinclude();if (!umiCount($v9c28d32df234037773be184dbdafc274)) {return false;}$vbfa030fe63bacd523dd70a76cfaed98a = $this->getParentId();$vd0e45878043844ffc41aac437e86b602 = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($vbfa030fe63bacd523dd70a76cfaed98a, true, true);if ($vd0e45878043844ffc41aac437e86b602 instanceof iUmiHierarchyElement) {if ($vd0e45878043844ffc41aac437e86b602->getHierarchyType()->getId() != $v3e78669aa9a1bfe336037e3d77a22705->getId()) {$vbfa030fe63bacd523dd70a76cfaed98a = false;$vc68ad910ed49ac65f21f1bf2c5dbf912 = $vb81ca7c0ccaa77e7aa91936ab0070695->getAllParents($this->id, true, true);for ($v865c0c0b4ab0e063e5caa3387c1a8741 = umiCount($vc68ad910ed49ac65f21f1bf2c5dbf912) - 1;$v865c0c0b4ab0e063e5caa3387c1a8741 >= 0;$v865c0c0b4ab0e063e5caa3387c1a8741--) {$veb26d1e3d9eea8920caf827a786b187f = $vc68ad910ed49ac65f21f1bf2c5dbf912[$v865c0c0b4ab0e063e5caa3387c1a8741];$v0b7a661d35d52d96b26b9f3f3bd32aab = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($veb26d1e3d9eea8920caf827a786b187f, true);if ($v0b7a661d35d52d96b26b9f3f3bd32aab instanceof iUmiHierarchyElement &&        $v0b7a661d35d52d96b26b9f3f3bd32aab->getHierarchyType()->getId() == $v3e78669aa9a1bfe336037e3d77a22705->getId()) {$vbfa030fe63bacd523dd70a76cfaed98a = $veb26d1e3d9eea8920caf827a786b187f;break;}}}}if (!$vbfa030fe63bacd523dd70a76cfaed98a) {throw new publicAdminException(getLabel('error-update-yml'));}$ved780287e302ec3b9fd3c5e78771919f = new xmlExporter('yml');$ved780287e302ec3b9fd3c5e78771919f->addElements([$this->id]);$ved780287e302ec3b9fd3c5e78771919f->setIgnoreRelations();$vbbd738a112791dd1d0cb6bd0d61d878f = $ved780287e302ec3b9fd3c5e78771919f->execute();$vd0c75bac742760cf71fd76cd75d0c02a = CURRENT_WORKING_DIR . '/xsl/export/YML.xsl';if (!is_file($vd0c75bac742760cf71fd76cd75d0c02a)) {throw new publicException("Can't load exporter {$vd0c75bac742760cf71fd76cd75d0c02a}");}$v9a09b4dfda82e3e665e31092d1c3ec8d = new DOMDocument('1.0', 'utf-8');$v9a09b4dfda82e3e665e31092d1c3ec8d->formatOutput = XML_FORMAT_OUTPUT;$v9a09b4dfda82e3e665e31092d1c3ec8d->loadXML($vbbd738a112791dd1d0cb6bd0d61d878f->saveXML());$v640eac53ad75db5c49a9ec86390d8530 = umiTemplater::create('XSLT', $vd0c75bac742760cf71fd76cd75d0c02a);$result = $v640eac53ad75db5c49a9ec86390d8530->parse($v9a09b4dfda82e3e665e31092d1c3ec8d);$vdd988cfd769c9f7fbd795a0f5da8e751 = new DOMDocument();$vdd988cfd769c9f7fbd795a0f5da8e751->loadXML($result);$vb2bf18e206cf9b5eb2d632030acb16cc = $vdd988cfd769c9f7fbd795a0f5da8e751->getElementsByTagName('offer');if ($vb2bf18e206cf9b5eb2d632030acb16cc->length) {$v9a0364b9e99bb480dd25e1f0284c8555 = '';foreach ($vb2bf18e206cf9b5eb2d632030acb16cc as $vd60db28d94d538bbb249dcc7f2273ab1) {$vc4ef352f74e502ef5e7bc98e6f4e493d = $vd60db28d94d538bbb249dcc7f2273ab1->getElementsByTagName('categoryId')->item(0);if ($vc4ef352f74e502ef5e7bc98e6f4e493d) {$vc4ef352f74e502ef5e7bc98e6f4e493d->nodeValue = $vbfa030fe63bacd523dd70a76cfaed98a;}if (function_exists('mb_convert_encoding')) {$v9a0364b9e99bb480dd25e1f0284c8555 .= mb_convert_encoding($vdd988cfd769c9f7fbd795a0f5da8e751->saveXML($vd60db28d94d538bbb249dcc7f2273ab1), 'CP1251', 'UTF-8');}else {$v9a0364b9e99bb480dd25e1f0284c8555 .= iconv('UTF-8', 'CP1251//IGNORE', $vdd988cfd769c9f7fbd795a0f5da8e751->saveXML($vd60db28d94d538bbb249dcc7f2273ab1));}}file_put_contents($v0f635d0e0f3874fff8b581c132e6c7a7, $v9a0364b9e99bb480dd25e1f0284c8555);}$v7f24d9fc4140045241b3f97bcf36bf03 = $vdd988cfd769c9f7fbd795a0f5da8e751->getElementsByTagName('currencies')->item(0);$v09c2a312ca0311b5e24340fe8f827077 = iconv('UTF-8', 'CP1251//IGNORE', $vdd988cfd769c9f7fbd795a0f5da8e751->saveXML($v7f24d9fc4140045241b3f97bcf36bf03));file_put_contents($v100664c6e2c0333b19a729f2f3ddb7dd . 'currencies', $v09c2a312ca0311b5e24340fe8f827077);$vdaeed474badc5873f59f5c1933dfa304 = $vdd988cfd769c9f7fbd795a0f5da8e751->getElementsByTagName('name')->item(0);$vb068931cc450442b63f5b3d276ea4297 = $vdaeed474badc5873f59f5c1933dfa304->nodeValue;$v93c731f1c3a84ef05cd54d044c379eaa = $vdd988cfd769c9f7fbd795a0f5da8e751->getElementsByTagName('company')->item(0);$vdb486e4cdf8b2048591e59f683319c4c = $v93c731f1c3a84ef05cd54d044c379eaa->nodeValue;if (is_array($v9c28d32df234037773be184dbdafc274)) {$v068ee263b9951356e828019683f53948 = Service::DomainCollection();foreach ($v9c28d32df234037773be184dbdafc274 as $v013b012140e3049c2436475764dfba3c) {$vad5f82e879a9c5d6b5b442eb37e50551 = $v068ee263b9951356e828019683f53948->getDomain($this->getDomainId());file_put_contents($v100664c6e2c0333b19a729f2f3ddb7dd . 'shop' . $v013b012140e3049c2436475764dfba3c,       '<name>' . iconv('UTF-8', 'CP1251//IGNORE', $vb068931cc450442b63f5b3d276ea4297) . '</name><company>' .       iconv('UTF-8', 'CP1251', $vdb486e4cdf8b2048591e59f683319c4c) . '</company><url>' . $vad5f82e879a9c5d6b5b442eb37e50551->getUrl() . '</url>'      );}}}}protected function checkYMLinclude() {$v100664c6e2c0333b19a729f2f3ddb7dd = SYS_TEMP_PATH . '/yml/';if (!is_dir($v100664c6e2c0333b19a729f2f3ddb7dd)) {return false;}$v736007832d2167baaae763fd3a3f3cf1 = dir($v100664c6e2c0333b19a729f2f3ddb7dd);$v9c28d32df234037773be184dbdafc274 = [];$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$vc68ad910ed49ac65f21f1bf2c5dbf912 = $vb81ca7c0ccaa77e7aa91936ab0070695->getAllParents($this->id, true, true);while (($v8c7dd922ad47494fc02c388e12c00eac = $v736007832d2167baaae763fd3a3f3cf1->read()) !== false) {if (mb_strpos($v8c7dd922ad47494fc02c388e12c00eac, 'cat')) {$v013b012140e3049c2436475764dfba3c = trim($v8c7dd922ad47494fc02c388e12c00eac, 'cat');$vc2413b3d6b0162ee66c1ee1a90828706 = [];if (file_exists($v100664c6e2c0333b19a729f2f3ddb7dd . $v013b012140e3049c2436475764dfba3c . 'excluded')) {$vc2413b3d6b0162ee66c1ee1a90828706 = unserialize(file_get_contents($v100664c6e2c0333b19a729f2f3ddb7dd . $v013b012140e3049c2436475764dfba3c . 'excluded'));}if (umiCount(array_intersect($vc2413b3d6b0162ee66c1ee1a90828706, $vc68ad910ed49ac65f21f1bf2c5dbf912))) {continue;}$v3b79c910c0feb17f4f4462e3decfb786 = unserialize(file_get_contents($v100664c6e2c0333b19a729f2f3ddb7dd . $v8c7dd922ad47494fc02c388e12c00eac));$vc97e47c7f15ca0e987851078d2318eed = unserialize(file_get_contents($v100664c6e2c0333b19a729f2f3ddb7dd . $v013b012140e3049c2436475764dfba3c . 'el'));$vea228c391b72961cc1370e2d66442d86 = array_keys(array_intersect($vc68ad910ed49ac65f21f1bf2c5dbf912, $v3b79c910c0feb17f4f4462e3decfb786));$vb0b5ccb4a195a07fd3eed14affb8695f = [];if (file_exists($v100664c6e2c0333b19a729f2f3ddb7dd . 'categories' . $v013b012140e3049c2436475764dfba3c)) {$vb0b5ccb4a195a07fd3eed14affb8695f = unserialize(file_get_contents($v100664c6e2c0333b19a729f2f3ddb7dd . 'categories' . $v013b012140e3049c2436475764dfba3c));}if (umiCount($vea228c391b72961cc1370e2d66442d86)) {$vca890278cc5a293ee13dde5e16512d0f = $vea228c391b72961cc1370e2d66442d86[0];if ($vc68ad910ed49ac65f21f1bf2c5dbf912[$vca890278cc5a293ee13dde5e16512d0f] == $this->getId() && $this->getHierarchyType()->getMethod() == 'object') {if (isset($vc68ad910ed49ac65f21f1bf2c5dbf912[$vca890278cc5a293ee13dde5e16512d0f - 1])) {$vca890278cc5a293ee13dde5e16512d0f--;}}for ($v865c0c0b4ab0e063e5caa3387c1a8741 = $vca890278cc5a293ee13dde5e16512d0f, $v2817f701d5e1a1181e657251363295fd = umiCount($vc68ad910ed49ac65f21f1bf2c5dbf912);$v865c0c0b4ab0e063e5caa3387c1a8741 < $v2817f701d5e1a1181e657251363295fd;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$vbfa030fe63bacd523dd70a76cfaed98a = $vc68ad910ed49ac65f21f1bf2c5dbf912[$v865c0c0b4ab0e063e5caa3387c1a8741];$vd0e45878043844ffc41aac437e86b602 = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($vbfa030fe63bacd523dd70a76cfaed98a);if (!$vd0e45878043844ffc41aac437e86b602 instanceof iUmiHierarchyElement) {continue;}if (!$vd0e45878043844ffc41aac437e86b602->getIsActive() || $vd0e45878043844ffc41aac437e86b602->getIsDeleted()) {if ($this->getHierarchyType()->getMethod() == 'object') {return $v9c28d32df234037773be184dbdafc274;}}if ($vd0e45878043844ffc41aac437e86b602->getHierarchyType()->getMethod() != 'category') {continue;}if ($vd0e45878043844ffc41aac437e86b602->getIsActive() && !$vd0e45878043844ffc41aac437e86b602->getIsDeleted()) {$vffffe4247e7557c58cc7eb95ff95104e = $vd0e45878043844ffc41aac437e86b602->getName();$vffffe4247e7557c58cc7eb95ff95104e = iconv('UTF-8', 'CP1251//IGNORE', $vffffe4247e7557c58cc7eb95ff95104e);$vffffe4247e7557c58cc7eb95ff95104e = strtr($vffffe4247e7557c58cc7eb95ff95104e, ['&' => '&amp;', '<' => '&lt;', '>' => '&gt;']);$v8daec67a558a7355db08d90eeadf7af7 = $vd0e45878043844ffc41aac437e86b602->getParentId();if ($v8daec67a558a7355db08d90eeadf7af7 && isset($vb0b5ccb4a195a07fd3eed14affb8695f[$v8daec67a558a7355db08d90eeadf7af7])) {$vb0b5ccb4a195a07fd3eed14affb8695f[$vbfa030fe63bacd523dd70a76cfaed98a] =          '<category id="' . $vbfa030fe63bacd523dd70a76cfaed98a . '" parentId="' . $v8daec67a558a7355db08d90eeadf7af7 . '">' . $vffffe4247e7557c58cc7eb95ff95104e .          '</category>';}else {$vb0b5ccb4a195a07fd3eed14affb8695f[$vbfa030fe63bacd523dd70a76cfaed98a] = '<category id="' . $vbfa030fe63bacd523dd70a76cfaed98a . '">' . $vffffe4247e7557c58cc7eb95ff95104e . '</category>';}}else {if (isset($vb0b5ccb4a195a07fd3eed14affb8695f[$vbfa030fe63bacd523dd70a76cfaed98a])) {unset($vb0b5ccb4a195a07fd3eed14affb8695f[$vbfa030fe63bacd523dd70a76cfaed98a]);}}}if (!in_array($this->id, $vc97e47c7f15ca0e987851078d2318eed) && $this->getHierarchyType()->getMethod() == 'object') {$vc97e47c7f15ca0e987851078d2318eed[] = $this->id;file_put_contents($v100664c6e2c0333b19a729f2f3ddb7dd . $v013b012140e3049c2436475764dfba3c . 'el', serialize($vc97e47c7f15ca0e987851078d2318eed));}$v9c28d32df234037773be184dbdafc274[] = $v013b012140e3049c2436475764dfba3c;}elseif ($this->getHierarchyType()->getMethod() == 'category' &&      (!$this->getIsActive() || $this->getIsDeleted())) {$vadce578d04ed03c31f6ac59451fcf8e4 = $vb81ca7c0ccaa77e7aa91936ab0070695->getChildrenList($this->getId(), false);$vea228c391b72961cc1370e2d66442d86 = array_intersect($vadce578d04ed03c31f6ac59451fcf8e4, $v3b79c910c0feb17f4f4462e3decfb786);if (umiCount($vea228c391b72961cc1370e2d66442d86)) {foreach ($vadce578d04ed03c31f6ac59451fcf8e4 as $v3c6e0b8a9c15224a8228b9a98ca1531d => $vf4f40123eb510dd3290125b38f4eb898) {if (isset($vb0b5ccb4a195a07fd3eed14affb8695f[$vf4f40123eb510dd3290125b38f4eb898])) {unset($vb0b5ccb4a195a07fd3eed14affb8695f[$vf4f40123eb510dd3290125b38f4eb898]);}}}}else {$v3c6e0b8a9c15224a8228b9a98ca1531d = array_search($this->id, $vc97e47c7f15ca0e987851078d2318eed);if ($v3c6e0b8a9c15224a8228b9a98ca1531d && $this->getHierarchyType()->getMethod() == 'object') {unset($vc97e47c7f15ca0e987851078d2318eed[$v3c6e0b8a9c15224a8228b9a98ca1531d]);sort($vc97e47c7f15ca0e987851078d2318eed);file_put_contents($v100664c6e2c0333b19a729f2f3ddb7dd . $v013b012140e3049c2436475764dfba3c . 'el', serialize($vc97e47c7f15ca0e987851078d2318eed));}}file_put_contents($v100664c6e2c0333b19a729f2f3ddb7dd . 'categories' . $v013b012140e3049c2436475764dfba3c, serialize($vb0b5ccb4a195a07fd3eed14affb8695f));}}$v736007832d2167baaae763fd3a3f3cf1->close();return $v9c28d32df234037773be184dbdafc274;}public function updateSiteMap($v1edc461b852cf05942fd5293f0e3541d = false) {$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$vb80bb7740288fda1f201890375a60c8f = (int) $this->id;$v878ec3cebea5b2c1ee4c0becdb00d3d3 = Service::SiteMapUpdater();if (!$v1edc461b852cf05942fd5293f0e3541d) {$v268184c12df027f536154d099d497b31 = $vb81ca7c0ccaa77e7aa91936ab0070695->getChildrenTree($vb80bb7740288fda1f201890375a60c8f, true, true, 1);if (is_array($v268184c12df027f536154d099d497b31)) {foreach ($v268184c12df027f536154d099d497b31 as $vf4f40123eb510dd3290125b38f4eb898 => $v2063c1608d6e0baf80249c42e2be5804) {$v1b7d5726533ab525a8760351e9b5e415 = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($vf4f40123eb510dd3290125b38f4eb898);if ($v1b7d5726533ab525a8760351e9b5e415 instanceof iUmiHierarchyElement) {$v878ec3cebea5b2c1ee4c0becdb00d3d3->update($v1b7d5726533ab525a8760351e9b5e415);}}}}$v878ec3cebea5b2c1ee4c0becdb00d3d3->update($this);}public function setIsUpdated($v8de61324edc43f3acb1b73da3c63e89e = true) {parent::setIsUpdated($v8de61324edc43f3acb1b73da3c63e89e);if ($v8de61324edc43f3acb1b73da3c63e89e === false) {return $this;}$this->update_time = time();$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$vb81ca7c0ccaa77e7aa91936ab0070695->addUpdatedElementId($this->getId());$vbfa030fe63bacd523dd70a76cfaed98a = $this->getParentId();if ($vbfa030fe63bacd523dd70a76cfaed98a) {$vb81ca7c0ccaa77e7aa91936ab0070695->addUpdatedElementId($vbfa030fe63bacd523dd70a76cfaed98a);}}public function commit() {try {$this->getObject()     ->commit();}catch (coreException $v42552b1f133f9f8eb406d4f306ea9fd1) {umiExceptionHandler::report($v42552b1f133f9f8eb406d4f306ea9fd1);}parent::commit();}public function getObjectTypeId() {return $this->getObject()    ->getTypeId();}public function getHierarchyType() {return umiHierarchyTypesCollection::getInstance()    ->getType($this->type_id);}public function getObjectId() {return $this->object_id;}protected function getType() {return umiHierarchyTypesCollection::getInstance()    ->getType($this->getTypeId());}public function getModule() {return $this->getType()->getName();}public function getMethod() {return $this->getType()->getExt();}public function delete() {umiHierarchy::getInstance()->delElement($this->id);}public function __get($v51746fc9cfaaf892e94c2d56d7508b37) {switch ($v51746fc9cfaaf892e94c2d56d7508b37) {case 'id':     return $this->id;case 'objectId':     return $this->object_id;case 'name':     return $this->getName();case 'altName':     return $this->getAltName();case 'isActive':     return $this->getIsActive();case 'isVisible':     return $this->getIsVisible();case 'isDeleted':     return $this->getIsDeleted();case 'xlink':     return 'upage://' . $this->id;case 'link': {$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();return $vb81ca7c0ccaa77e7aa91936ab0070695->getPathById($this->id);}default:     return $this->getValue($v51746fc9cfaaf892e94c2d56d7508b37);}}public function __isset($v23a5b8ab834cb5140fa6665622eb6417) {switch ($v23a5b8ab834cb5140fa6665622eb6417) {case 'id':    case 'objectId':    case 'name':    case 'altName':    case 'isActive':    case 'isVisible':    case 'isDeleted':    case 'xlink':    case 'link': {return true;}default : {return is_numeric($this->getFieldId($v23a5b8ab834cb5140fa6665622eb6417));}}}public function __set($v51746fc9cfaaf892e94c2d56d7508b37, $v2063c1608d6e0baf80249c42e2be5804) {switch ($v51746fc9cfaaf892e94c2d56d7508b37) {case 'id':     throw new coreException('Object id could not be changed');case 'name':     return $this->setName($v2063c1608d6e0baf80249c42e2be5804);case 'altName':     return $this->setAltName($v2063c1608d6e0baf80249c42e2be5804);case 'isActive':     return $this->setIsActive($v2063c1608d6e0baf80249c42e2be5804);case 'isVisible':     return $this->setIsVisible($v2063c1608d6e0baf80249c42e2be5804);case 'isDeleted':     return $this->setIsDeleted($v2063c1608d6e0baf80249c42e2be5804);default:     return $this->setValue($v51746fc9cfaaf892e94c2d56d7508b37, $v2063c1608d6e0baf80249c42e2be5804);}}public function setIsDeleted($va18b1057c4327b9cc46abc9fcf952bd8 = false) {$this->setDeleted($va18b1057c4327b9cc46abc9fcf952bd8);}public function getIsBroken() {return false;}public function getRel() {return $this->rel;}}