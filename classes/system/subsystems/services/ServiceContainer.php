<?php
 class ServiceContainer implements iServiceContainer {private $rules;private $parameters;private $services = [];public function __construct(array $va4f86f7bfc24194b276c22e0ef158197 = [], array $v166e64f6c3677d0c513901242a3e702d = []) {$this->rules = $va4f86f7bfc24194b276c22e0ef158197;$this->parameters = $v166e64f6c3677d0c513901242a3e702d;}public function get($vb068931cc450442b63f5b3d276ea4297) {$this->validateServiceName($vb068931cc450442b63f5b3d276ea4297);if (isset($this->services[$vb068931cc450442b63f5b3d276ea4297])) {return $this->services[$vb068931cc450442b63f5b3d276ea4297];}$vaaabf0d39951f3e6c3e8a7911df524c2 = $this->createService($vb068931cc450442b63f5b3d276ea4297);$this->set($vb068931cc450442b63f5b3d276ea4297, $vaaabf0d39951f3e6c3e8a7911df524c2);return $this->services[$vb068931cc450442b63f5b3d276ea4297];}public function getNew($vb068931cc450442b63f5b3d276ea4297) {$this->validateServiceName($vb068931cc450442b63f5b3d276ea4297);$vaaabf0d39951f3e6c3e8a7911df524c2 = $this->createService($vb068931cc450442b63f5b3d276ea4297);if (!isset($this->services[$vb068931cc450442b63f5b3d276ea4297])) {$this->set($vb068931cc450442b63f5b3d276ea4297, $vaaabf0d39951f3e6c3e8a7911df524c2);}return $vaaabf0d39951f3e6c3e8a7911df524c2;}public function set($vb068931cc450442b63f5b3d276ea4297, $vaaabf0d39951f3e6c3e8a7911df524c2) {if (!is_object($vaaabf0d39951f3e6c3e8a7911df524c2)) {throw new Exception('Wrong service given');}$this->services[$vb068931cc450442b63f5b3d276ea4297] = $vaaabf0d39951f3e6c3e8a7911df524c2;return $this;}public function hasRules($vb068931cc450442b63f5b3d276ea4297) {return isset($this->rules[$vb068931cc450442b63f5b3d276ea4297]);}public function addRules(array $va4f86f7bfc24194b276c22e0ef158197) {foreach ($va4f86f7bfc24194b276c22e0ef158197 as $v0f096338b64a1d1b348b86df38313c01 => $vacf7b106d73622c457e44fc6e193c5e7) {if (!$this->hasRules($v0f096338b64a1d1b348b86df38313c01)) {$this->rules[$v0f096338b64a1d1b348b86df38313c01] = $vacf7b106d73622c457e44fc6e193c5e7;}}}public function addParameters(array $v21ffce5b8a6cc8cc6a41448dd69623c9) {foreach ($v21ffce5b8a6cc8cc6a41448dd69623c9 as $vb068931cc450442b63f5b3d276ea4297 => $v2063c1608d6e0baf80249c42e2be5804) {if (!$this->hasParameter($vb068931cc450442b63f5b3d276ea4297)) {$this->parameters[$vb068931cc450442b63f5b3d276ea4297] = $v2063c1608d6e0baf80249c42e2be5804;}}}public function hasParameter($vb068931cc450442b63f5b3d276ea4297) {try {$this->getParameter($vb068931cc450442b63f5b3d276ea4297);}catch (Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {return false;}return true;}public function initService($vb068931cc450442b63f5b3d276ea4297, $vaaabf0d39951f3e6c3e8a7911df524c2) {if (!$this->hasRules($vb068931cc450442b63f5b3d276ea4297)) {throw new Exception('Service rules not found: ' . $vb068931cc450442b63f5b3d276ea4297);}$v1043bfc77febe75fafec0c4309faccf1 = &$this->rules[$vb068931cc450442b63f5b3d276ea4297];if (!is_array($v1043bfc77febe75fafec0c4309faccf1) || !isset($v1043bfc77febe75fafec0c4309faccf1['calls'])) {throw new Exception($vb068931cc450442b63f5b3d276ea4297 . ' service entry must be an array containing a \'calls\' key');}if (isset($v1043bfc77febe75fafec0c4309faccf1['lock']) && $v1043bfc77febe75fafec0c4309faccf1['lock']) {throw new Exception($vb068931cc450442b63f5b3d276ea4297 . ' contains circular reference');}$v1043bfc77febe75fafec0c4309faccf1['lock'] = true;$this->initializeService($vaaabf0d39951f3e6c3e8a7911df524c2, $vb068931cc450442b63f5b3d276ea4297, $v1043bfc77febe75fafec0c4309faccf1['calls']);$v1043bfc77febe75fafec0c4309faccf1['lock'] = false;return $vaaabf0d39951f3e6c3e8a7911df524c2;}private function validateServiceName($vb068931cc450442b63f5b3d276ea4297) {if (!is_string($vb068931cc450442b63f5b3d276ea4297) || $vb068931cc450442b63f5b3d276ea4297 === '') {throw new Exception('Wrong service name given');}}private function getParameter($vb068931cc450442b63f5b3d276ea4297) {$v25d7186fe598a394919623186ca325e2 = explode('.', $vb068931cc450442b63f5b3d276ea4297);$v5c18ef72771564b7f43c497dc507aeab = $this->parameters;while (($v94a08da1fecbb6e8b46990538c7b50b2 = array_shift($v25d7186fe598a394919623186ca325e2)) !== null) {if (!isset($v5c18ef72771564b7f43c497dc507aeab[$v94a08da1fecbb6e8b46990538c7b50b2])) {throw new Exception('Parameter not found: ' . $vb068931cc450442b63f5b3d276ea4297);}$v5c18ef72771564b7f43c497dc507aeab = $v5c18ef72771564b7f43c497dc507aeab[$v94a08da1fecbb6e8b46990538c7b50b2];}return $v5c18ef72771564b7f43c497dc507aeab;}private function createService($vb068931cc450442b63f5b3d276ea4297) {if (!$this->hasRules($vb068931cc450442b63f5b3d276ea4297)) {throw new Exception('Service rules not found: ' . $vb068931cc450442b63f5b3d276ea4297);}$v1043bfc77febe75fafec0c4309faccf1 = &$this->rules[$vb068931cc450442b63f5b3d276ea4297];if (!is_array($v1043bfc77febe75fafec0c4309faccf1) || !isset($v1043bfc77febe75fafec0c4309faccf1['class'])) {throw new Exception($vb068931cc450442b63f5b3d276ea4297 . ' service entry must be an array containing a \'class\' key');}if (!class_exists($v1043bfc77febe75fafec0c4309faccf1['class'])) {throw new Exception($vb068931cc450442b63f5b3d276ea4297 . ' service class does not exist: ' . $v1043bfc77febe75fafec0c4309faccf1['class']);}if (isset($v1043bfc77febe75fafec0c4309faccf1['lock']) && $v1043bfc77febe75fafec0c4309faccf1['lock']) {throw new Exception($vb068931cc450442b63f5b3d276ea4297 . ' contains circular reference');}$v1043bfc77febe75fafec0c4309faccf1['lock'] = true;$vdbc11caa5bda99f77e6fb4dabd882e7d = isset($v1043bfc77febe75fafec0c4309faccf1['arguments']) ? $this->resolveArguments($v1043bfc77febe75fafec0c4309faccf1['arguments']) : [];$v607f7936d76c07c593f6942f4e88d28e = new ReflectionClass($v1043bfc77febe75fafec0c4309faccf1['class']);$vad63a35ea2ac8a42233e5ac6cb325d34 = $v607f7936d76c07c593f6942f4e88d28e->getInterfaces();if (isset($vad63a35ea2ac8a42233e5ac6cb325d34['iSingleton'])) {$vaaabf0d39951f3e6c3e8a7911df524c2 = $v1043bfc77febe75fafec0c4309faccf1['class']::getInstance();}else {$vaaabf0d39951f3e6c3e8a7911df524c2 = $v607f7936d76c07c593f6942f4e88d28e->newInstanceArgs($vdbc11caa5bda99f77e6fb4dabd882e7d);}if (isset($v1043bfc77febe75fafec0c4309faccf1['calls'])) {$this->initializeService($vaaabf0d39951f3e6c3e8a7911df524c2, $vb068931cc450442b63f5b3d276ea4297, $v1043bfc77febe75fafec0c4309faccf1['calls']);}$v1043bfc77febe75fafec0c4309faccf1['lock'] = false;return $vaaabf0d39951f3e6c3e8a7911df524c2;}private function resolveArguments(array $v04830cca77c25c4f0a86dce1bf5e3451) {$vdbc11caa5bda99f77e6fb4dabd882e7d = [];foreach ($v04830cca77c25c4f0a86dce1bf5e3451 as $v30618b3b44fa316257d07e387759fae5) {if ($v30618b3b44fa316257d07e387759fae5 instanceof ServiceReference) {$vb068931cc450442b63f5b3d276ea4297 = $v30618b3b44fa316257d07e387759fae5->getName();$vdbc11caa5bda99f77e6fb4dabd882e7d[] = $this->get($vb068931cc450442b63f5b3d276ea4297);}elseif ($v30618b3b44fa316257d07e387759fae5 instanceof ParameterReference) {$vb068931cc450442b63f5b3d276ea4297 = $v30618b3b44fa316257d07e387759fae5->getName();$vdbc11caa5bda99f77e6fb4dabd882e7d[] = $this->getParameter($vb068931cc450442b63f5b3d276ea4297);}elseif ($v30618b3b44fa316257d07e387759fae5 instanceof InstantiableReference) {$vb068931cc450442b63f5b3d276ea4297 = $v30618b3b44fa316257d07e387759fae5->getName();$vdbc11caa5bda99f77e6fb4dabd882e7d[] = new $vb068931cc450442b63f5b3d276ea4297();}elseif ($v30618b3b44fa316257d07e387759fae5 instanceof ServiceContainerReference) {$vdbc11caa5bda99f77e6fb4dabd882e7d[] = $this;}else {$vdbc11caa5bda99f77e6fb4dabd882e7d[] = $v30618b3b44fa316257d07e387759fae5;}}return $vdbc11caa5bda99f77e6fb4dabd882e7d;}private function initializeService($vaaabf0d39951f3e6c3e8a7911df524c2, $vb068931cc450442b63f5b3d276ea4297, array $v25ad180d7fa6311f13a3bd42dd0ff326) {foreach ($v25ad180d7fa6311f13a3bd42dd0ff326 as $v5386b5fbcc0ee8527052318378abd085) {if (!is_array($v5386b5fbcc0ee8527052318378abd085) || !isset($v5386b5fbcc0ee8527052318378abd085['method'])) {throw new Exception($vb068931cc450442b63f5b3d276ea4297 . ' service calls must be arrays containing a \'method\' key');}if (!is_callable([$vaaabf0d39951f3e6c3e8a7911df524c2, $v5386b5fbcc0ee8527052318378abd085['method']])) {throw new Exception(      $vb068931cc450442b63f5b3d276ea4297 . ' service asks for call to uncallable method: ' . $v5386b5fbcc0ee8527052318378abd085['method']     );}$vdbc11caa5bda99f77e6fb4dabd882e7d = isset($v5386b5fbcc0ee8527052318378abd085['arguments'])     ? $this->resolveArguments($v5386b5fbcc0ee8527052318378abd085['arguments'])     : [];call_user_func_array([$vaaabf0d39951f3e6c3e8a7911df524c2, $v5386b5fbcc0ee8527052318378abd085['method']], $vdbc11caa5bda99f77e6fb4dabd882e7d);}}}