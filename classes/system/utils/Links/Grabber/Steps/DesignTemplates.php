<?php
 namespace UmiCms\Classes\System\Utils\Links\Grabber\Steps;class DesignTemplates extends Step implements  \iUmiTemplatesInjector,  \iUmiDirectoriesInjector {use \tUmiTemplatesInjector;use \tUmiDirectoriesInjector;private $currentTemplateId;private $templatesIds;const STEP_NAME = 'DesignTemplates';const TEMPLATES_KEY = 'templates';const CURRENT_KEY = 'current';public function getName() {return self::STEP_NAME;}public function getStartStateStructure() {$vfed36e93a0509e20f2dc96cbbd85b678 = $this->getTemplatesCollection()    ->getFullTemplatesList();$va6e96ff1e4af23335daaaa65b80dbeca = [];$ve859d8e48e675fb76aba1dd044172367 = null;foreach ($vfed36e93a0509e20f2dc96cbbd85b678 as $v66f6181bcb4cff4cd38fbc804a036db6) {if ($ve859d8e48e675fb76aba1dd044172367 === null) {$ve859d8e48e675fb76aba1dd044172367 = (int) $v66f6181bcb4cff4cd38fbc804a036db6->getId();}$va6e96ff1e4af23335daaaa65b80dbeca[] = $v66f6181bcb4cff4cd38fbc804a036db6->getId();}return [    self::TEMPLATES_KEY => $va6e96ff1e4af23335daaaa65b80dbeca,    self::CURRENT_KEY => $ve859d8e48e675fb76aba1dd044172367,    self::COMPLETE_KEY => false,   ];}public function setState(array $v9ed39e2ea931586b6a985a6942ef573e) {if (!isset($v9ed39e2ea931586b6a985a6942ef573e[self::TEMPLATES_KEY])) {throw new \wrongParamException('Cant detect templates ids');}$va6e96ff1e4af23335daaaa65b80dbeca = $v9ed39e2ea931586b6a985a6942ef573e[self::TEMPLATES_KEY];if (!isset($v9ed39e2ea931586b6a985a6942ef573e[self::CURRENT_KEY])) {throw new \wrongParamException('Cant detect current template id');}$v95ca2d829d03ecbda8a57275e55b1787 = $v9ed39e2ea931586b6a985a6942ef573e[self::CURRENT_KEY];if (!isset($v9ed39e2ea931586b6a985a6942ef573e[self::COMPLETE_KEY])) {throw new \wrongParamException('Cant detect complete status');}$vf94c28463eca606eda684e34af8244cf = $v9ed39e2ea931586b6a985a6942ef573e[self::COMPLETE_KEY];$this->setTemplatesIds($va6e96ff1e4af23335daaaa65b80dbeca)    ->setCurrentTemplateId($v95ca2d829d03ecbda8a57275e55b1787)    ->setCompleteStatus($vf94c28463eca606eda684e34af8244cf);return $this;}public function grab() {if ($this->isComplete()) {return $this;}$va0f97308110b5ffc40d784efae2257bb = $this->getCurrentTemplate();$v77113f6ce6b51aee6c58f000e62d8313 = $va0f97308110b5ffc40d784efae2257bb->getTemplatesDirectory();$vfd9a2d836ebd59f945d05de0c63bf276 = $va0f97308110b5ffc40d784efae2257bb->getFileExtension();$vade383da64b79c74e785c56779503c10 = get_class($this->getDirectoriesHandler());$v88aa45dc30dd92e28e5e040815abf5c4 = new $vade383da64b79c74e785c56779503c10($v77113f6ce6b51aee6c58f000e62d8313);$ve7e0129a72818fbd2bb193f6e7b243df = 1;$v63c4cae64dbea0068bf01d380cccc41b = '';$v04a2f334c469697483bd84873997767b = true;$v9c75b2fee55607145912c0e5c0991b8a = $v88aa45dc30dd92e28e5e040815abf5c4->getAllFiles($ve7e0129a72818fbd2bb193f6e7b243df, $v63c4cae64dbea0068bf01d380cccc41b, $v04a2f334c469697483bd84873997767b);$v45d4ec6ae8fbeb3634ff034b10ae848a = [];foreach ($v9c75b2fee55607145912c0e5c0991b8a as $v47826cacc65c665212b821e6ff80b9b0 => $v5b063e275d506f65ebf1b02d926f19a4) {if (!preg_match("/\.$vfd9a2d836ebd59f945d05de0c63bf276$/", $v5b063e275d506f65ebf1b02d926f19a4)) {continue;}$v0333a2bd4a6440b31d249df558b2b2c7 = (string) file_get_contents($v47826cacc65c665212b821e6ff80b9b0);$v45d4ec6ae8fbeb3634ff034b10ae848a[$v47826cacc65c665212b821e6ff80b9b0] = $this->getLinksFromHtmlText($v0333a2bd4a6440b31d249df558b2b2c7);}$this->setResult($v45d4ec6ae8fbeb3634ff034b10ae848a);$this->switchToNextTemplate();return $this;}public function getState() {return [    self::TEMPLATES_KEY => (array) $this->getTemplatesIds(),    self::CURRENT_KEY => (int) $this->getCurrentTemplateId(),    self::COMPLETE_KEY => (bool) $this->isComplete(),   ];}private function switchToNextTemplate() {$va0f97308110b5ffc40d784efae2257bb = $this->getCurrentTemplate();$v95ca2d829d03ecbda8a57275e55b1787 = $va0f97308110b5ffc40d784efae2257bb->getId();$va6e96ff1e4af23335daaaa65b80dbeca = $this->getTemplatesIds();$v90170fdc3da7b2c3f27f7606e3293602 = false;$vb83aa5b63c0850793fce0cd38e1067d1 = null;foreach ($va6e96ff1e4af23335daaaa65b80dbeca as $v3200a31fc05da4e9d5a0465c36822e2f) {if ($v95ca2d829d03ecbda8a57275e55b1787 == $v3200a31fc05da4e9d5a0465c36822e2f) {$v90170fdc3da7b2c3f27f7606e3293602 = true;continue;}if ($v90170fdc3da7b2c3f27f7606e3293602) {$vb83aa5b63c0850793fce0cd38e1067d1 = $v3200a31fc05da4e9d5a0465c36822e2f;break;}}if (is_numeric($vb83aa5b63c0850793fce0cd38e1067d1)) {return $this->setCurrentTemplateId($vb83aa5b63c0850793fce0cd38e1067d1);}return $this->setCompleteStatus(true);}private function setTemplatesIds($va6e96ff1e4af23335daaaa65b80dbeca) {if (!is_array($va6e96ff1e4af23335daaaa65b80dbeca) || umiCount($va6e96ff1e4af23335daaaa65b80dbeca) == 0) {throw new \wrongParamException('Wrong templates ids given');}$this->templatesIds = $va6e96ff1e4af23335daaaa65b80dbeca;return $this;}private function getTemplatesIds() {if ($this->templatesIds === null) {throw new \wrongParamException('You should set templates ids first');}return $this->templatesIds;}private function setCurrentTemplateId($v95ca2d829d03ecbda8a57275e55b1787) {if (!is_numeric($v95ca2d829d03ecbda8a57275e55b1787)) {throw new \wrongParamException('Wrong current template given');}$this->currentTemplateId = $v95ca2d829d03ecbda8a57275e55b1787;return $this;}private function getCurrentTemplateId() {if ($this->currentTemplateId === null) {throw new \wrongParamException('You should set current template id first');}return $this->currentTemplateId;}private function getCurrentTemplate() {$v95ca2d829d03ecbda8a57275e55b1787 = $this->getCurrentTemplateId();$v66f6181bcb4cff4cd38fbc804a036db6 = $this->getTemplatesCollection()    ->getTemplate($v95ca2d829d03ecbda8a57275e55b1787);if (!$v66f6181bcb4cff4cd38fbc804a036db6 instanceof \iTemplate) {throw new \ExpectTemplateException('Cant get current template');}return $v66f6181bcb4cff4cd38fbc804a036db6;}}