<?php
 namespace UmiCms\Classes\System\Utils\QuickExchange\Csv;use UmiCms\Classes\System\Utils\QuickExchange\Source\iDetector as SourceDetector;use UmiCms\System\Request\iFacade as iRequest;class Exporter implements iExporter {private $sourceDetector;private $request;public function __construct(SourceDetector $vc4c19d7c35dd75d985c1f4ace5d40c80, iRequest $v10573b873d2fa5a365d558a45e328e47) {$this->sourceDetector = $vc4c19d7c35dd75d985c1f4ace5d40c80;$this->request = $v10573b873d2fa5a365d558a45e328e47;}public function export(\selector $v1b1cc7f086b3f074da452bc3129981eb, $v84bea1f0fd2ce16f7e562a9f06ef03d3) {$ved780287e302ec3b9fd3c5e78771919f = $this->createExporter($v1b1cc7f086b3f074da452bc3129981eb, $v84bea1f0fd2ce16f7e562a9f06ef03d3);$v8e4a156539e5e358472044b3e46a1fa1 = $ved780287e302ec3b9fd3c5e78771919f->isStarted() ? [] : $this->getQueryResult($v1b1cc7f086b3f074da452bc3129981eb);$ved780287e302ec3b9fd3c5e78771919f->export($v8e4a156539e5e358472044b3e46a1fa1, []);return $ved780287e302ec3b9fd3c5e78771919f->getIsCompleted();}private function getQueryResult(\selector $v1b1cc7f086b3f074da452bc3129981eb) {$v1b1cc7f086b3f074da452bc3129981eb->limit(0,0);$v1b1cc7f086b3f074da452bc3129981eb->option('return', 'id');$v5a2576254d428ddc22a03fac145c8749 = [];foreach ($this->getRelatedEntityIdList() as $v560da780ab2710242d0f227f71ebf6ca) {$v5a2576254d428ddc22a03fac145c8749[$v560da780ab2710242d0f227f71ebf6ca] = $v560da780ab2710242d0f227f71ebf6ca;}foreach ($v1b1cc7f086b3f074da452bc3129981eb->result() as $vdd8086e8cfd7708cd20d06bf319817dc) {$vb1b26d9d245655a2cf8422f066203b2a = $vdd8086e8cfd7708cd20d06bf319817dc['id'];$v5a2576254d428ddc22a03fac145c8749[$vb1b26d9d245655a2cf8422f066203b2a] = $vb1b26d9d245655a2cf8422f066203b2a;}return $v5a2576254d428ddc22a03fac145c8749;}private function getRelatedEntityIdList() {return (array) $this->getRequest()    ->Get()    ->get('rel');}private function createExporter(\selector $v1b1cc7f086b3f074da452bc3129981eb, $v84bea1f0fd2ce16f7e562a9f06ef03d3) {$ved780287e302ec3b9fd3c5e78771919f = \umiExporter::get($this->getExporterPrefix($v1b1cc7f086b3f074da452bc3129981eb));$v7c95caafbd5e4b5db3977617a0498de6 = $this->getSourceDetector()    ->detectForExport();$ved780287e302ec3b9fd3c5e78771919f->setSourceName($v7c95caafbd5e4b5db3977617a0498de6);$ved780287e302ec3b9fd3c5e78771919f->setFileName($v7c95caafbd5e4b5db3977617a0498de6);$ved780287e302ec3b9fd3c5e78771919f->setFieldNameWhiteList($this->getUsedFieldList());$ved780287e302ec3b9fd3c5e78771919f->setEncoding($v84bea1f0fd2ce16f7e562a9f06ef03d3);return $ved780287e302ec3b9fd3c5e78771919f;}private function getExporterPrefix(\selector $v1b1cc7f086b3f074da452bc3129981eb) {return ($v1b1cc7f086b3f074da452bc3129981eb->__get('mode') == 'pages') ? 'QuickCsvPage' : 'QuickCsvObject';}private function getUsedFieldList() {return (array) $this->getRequest()    ->Get()    ->get('used-fields');}private function getSourceDetector() {return $this->sourceDetector;}private function getRequest() {return $this->request;}}