<?php
 namespace UmiCms\Classes\System\Utils\QuickExchange\Csv;use UmiCms\Classes\System\Entities\File\iFactory as FileFactory;use UmiCms\Classes\System\Utils\QuickExchange\Source\iDetector as SourceDetector;use UmiCms\System\Request\iFacade as iRequest;use UmiCms\System\Session\iSession;class Importer implements iImporter {private $sourceDetector;private $request;private $fileFactory;private $configuration;private $session;const DEFAULT_LIMIT = 25;public function __construct(   SourceDetector $vc4c19d7c35dd75d985c1f4ace5d40c80,   iRequest $v10573b873d2fa5a365d558a45e328e47,   FileFactory $ve9d2ea3c13cc8f3b974ffbe8695cba02,   \iConfiguration $vccd1066343c95877b75b79d47c36bebe,   iSession $v21d6f40cfb511982e4424e0e250a9557  ) {$this->sourceDetector = $vc4c19d7c35dd75d985c1f4ace5d40c80;$this->request = $v10573b873d2fa5a365d558a45e328e47;$this->fileFactory = $ve9d2ea3c13cc8f3b974ffbe8695cba02;$this->configuration = $vccd1066343c95877b75b79d47c36bebe;$this->session = $v21d6f40cfb511982e4424e0e250a9557;}public function import(\selector $v1b1cc7f086b3f074da452bc3129981eb, $v84bea1f0fd2ce16f7e562a9f06ef03d3) {$v8c7dd922ad47494fc02c388e12c00eac = $this->getFile();if ($v8c7dd922ad47494fc02c388e12c00eac->getIsBroken()) {throw new \publicAdminException('Import file is broken');}$ved8430dc53fe9c99911b7c85e45aa6a2 = $this->createSplitter($v1b1cc7f086b3f074da452bc3129981eb, $v84bea1f0fd2ce16f7e562a9f06ef03d3);$v21d6f40cfb511982e4424e0e250a9557 = $this->getSession();$va52becdecbc3875386642ad9624ade65 = $this->getOffsetIndex();$ved8430dc53fe9c99911b7c85e45aa6a2->load($v8c7dd922ad47494fc02c388e12c00eac->getFilePath(), $this->getLimit(), $v21d6f40cfb511982e4424e0e250a9557->get($va52becdecbc3875386642ad9624ade65));$vbbd738a112791dd1d0cb6bd0d61d878f = $ved8430dc53fe9c99911b7c85e45aa6a2->translate($ved8430dc53fe9c99911b7c85e45aa6a2->getDocument());$v1bc49dba86c5074c5266c6d38c301a46 = $this->createImporter($v1b1cc7f086b3f074da452bc3129981eb, $ved8430dc53fe9c99911b7c85e45aa6a2);$v1bc49dba86c5074c5266c6d38c301a46->loadXmlString($vbbd738a112791dd1d0cb6bd0d61d878f);$v1bc49dba86c5074c5266c6d38c301a46->execute();if ($ved8430dc53fe9c99911b7c85e45aa6a2->getIsComplete()) {$v21d6f40cfb511982e4424e0e250a9557->del($va52becdecbc3875386642ad9624ade65);$v8c7dd922ad47494fc02c388e12c00eac->delete();}else {$v21d6f40cfb511982e4424e0e250a9557->set($va52becdecbc3875386642ad9624ade65, $ved8430dc53fe9c99911b7c85e45aa6a2->getOffset());}return $ved8430dc53fe9c99911b7c85e45aa6a2->getIsComplete();}private function createSplitter(\selector $v1b1cc7f086b3f074da452bc3129981eb, $v84bea1f0fd2ce16f7e562a9f06ef03d3) {$ved8430dc53fe9c99911b7c85e45aa6a2 = \umiImportSplitter::get($this->getSplitterPrefix($v1b1cc7f086b3f074da452bc3129981eb));$v7c95caafbd5e4b5db3977617a0498de6 = $this->getSourceDetector()    ->detectForImport();$ved8430dc53fe9c99911b7c85e45aa6a2->setSourceName($v7c95caafbd5e4b5db3977617a0498de6);$ved8430dc53fe9c99911b7c85e45aa6a2->setEncoding($v84bea1f0fd2ce16f7e562a9f06ef03d3);return $ved8430dc53fe9c99911b7c85e45aa6a2;}private function createImporter(\selector $v1b1cc7f086b3f074da452bc3129981eb, \iUmiImportSplitter $ved8430dc53fe9c99911b7c85e45aa6a2) {$v1bc49dba86c5074c5266c6d38c301a46 = new \xmlImporter();$vbfa030fe63bacd523dd70a76cfaed98a = $this->getParentId($v1b1cc7f086b3f074da452bc3129981eb);if ($vbfa030fe63bacd523dd70a76cfaed98a) {$v1bc49dba86c5074c5266c6d38c301a46->setDestinationElement($vbfa030fe63bacd523dd70a76cfaed98a);}$v1bc49dba86c5074c5266c6d38c301a46->setIgnoreParentGroups($ved8430dc53fe9c99911b7c85e45aa6a2->getIgnoreParentGroups());$v1bc49dba86c5074c5266c6d38c301a46->setAutoGuideCreation($ved8430dc53fe9c99911b7c85e45aa6a2->getAutoGuideCreation());$v1bc49dba86c5074c5266c6d38c301a46->setRenameFiles($ved8430dc53fe9c99911b7c85e45aa6a2->getRenameFiles());return $v1bc49dba86c5074c5266c6d38c301a46;}private function getSplitterPrefix(\selector $v1b1cc7f086b3f074da452bc3129981eb) {return ($v1b1cc7f086b3f074da452bc3129981eb->__get('mode') == 'pages') ? 'QuickCsvPage' : 'QuickCsvObject';}private function getFile() {$vd6fe1d0be6347b8ef2427fa629c04485 = $this->getRequest()    ->Post()    ->get('file');return $this->getFileFactory()    ->createSecure(sprintf('.%s', $vd6fe1d0be6347b8ef2427fa629c04485));}private function getOffsetIndex() {$v7c95caafbd5e4b5db3977617a0498de6 = $this->getSourceDetector()    ->detectForImport();return sprintf('import_offset_%s', $v7c95caafbd5e4b5db3977617a0498de6);}private function getLimit() {return $this->getConfiguration()    ->get('modules', 'exchange.splitter.limit') ?: self::DEFAULT_LIMIT;}private function getParentId(\selector $v1b1cc7f086b3f074da452bc3129981eb) {if (is_array($v1b1cc7f086b3f074da452bc3129981eb->__get('hierarchy')) && umiCount($v1b1cc7f086b3f074da452bc3129981eb->__get('hierarchy')) > 0) {return $v1b1cc7f086b3f074da452bc3129981eb->__get('hierarchy')[0]->elementId;}return null;}private function getSourceDetector() {return $this->sourceDetector;}private function getRequest() {return $this->request;}private function getFileFactory() {return $this->fileFactory;}private function getConfiguration() {return $this->configuration;}private function getSession() {return $this->session;}}