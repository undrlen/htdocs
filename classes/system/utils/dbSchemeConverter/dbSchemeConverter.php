<?php
 use UmiCms\Service;class dbSchemeConverter {const DEFAULT_ITERATION_LIMIT = 10000;private $connection;private $destinationFile = false;private $sourceFile = false;private $mode = false;private $completed = false;private $state = [];private $inParts = false;private $limit;private $converterLog = [];private $stateDirectoryPath;public function __construct(IConnection $v4717d53ebfdfea8477f780ec66151dcb) {$this->connection = $v4717d53ebfdfea8477f780ec66151dcb;}public function setStateDirectoryPath($vd6fe1d0be6347b8ef2427fa629c04485) {if (!is_string($vd6fe1d0be6347b8ef2427fa629c04485) || !is_dir($vd6fe1d0be6347b8ef2427fa629c04485)) {throw new publicAdminException('Incorrect state directory path given');}$this->stateDirectoryPath = $vd6fe1d0be6347b8ef2427fa629c04485;}public function setDestinationFile($vd6fe1d0be6347b8ef2427fa629c04485) {$this->destinationFile = $vd6fe1d0be6347b8ef2427fa629c04485;}public function setSourceFile($vd6fe1d0be6347b8ef2427fa629c04485) {$this->sourceFile = $vd6fe1d0be6347b8ef2427fa629c04485;}public function setMode($v15d61712450a686a7f365adf4fef581f = false, $v04ac3ec752774373fb54a91eed1e234a = false, $vaa9f73eea60a006820d0f8768bc8a3fc = 1000) {$this->mode = $v15d61712450a686a7f365adf4fef581f;$this->inParts = $v04ac3ec752774373fb54a91eed1e234a;$this->setIterationLimit((int) $vaa9f73eea60a006820d0f8768bc8a3fc);}private function setIterationLimit($vaa9f73eea60a006820d0f8768bc8a3fc) {$v3f48301f2668ec4eec370518ddcffe63 = mainConfiguration::getInstance();$vd2773eb11eaca15bdd5bb361665862c2 = (int) $v3f48301f2668ec4eec370518ddcffe63->get('updates', 'db-scheme-converter-iteration-limit');if ($vd2773eb11eaca15bdd5bb361665862c2 > 0) {$this->limit = $vd2773eb11eaca15bdd5bb361665862c2;return;}if ($vaa9f73eea60a006820d0f8768bc8a3fc > 0) {$this->limit = $vaa9f73eea60a006820d0f8768bc8a3fc;return;}$this->limit = self::DEFAULT_ITERATION_LIMIT;}public function run() {$this->converterLog = [];switch ($this->mode) {case 'save': {if (!$this->destinationFile) {throw new coreException('Please set destination file name');}$this->saveXmlToFile();return true;}case 'restore': {$this->getState();$this->restoreDataBase();$this->saveState();return $this->completed;}default: {throw new coreException("Don't know what to do. Please set any appropriate mode.");}}}public function getConverterLog() {return $this->converterLog;}protected function writeLog($v78e731027d8fd50ed642340b7c9a63b3) {if (defined('UMICMS_CLI_MODE') && UMICMS_CLI_MODE) {Service::Response()     ->getCliBuffer()     ->push($v78e731027d8fd50ed642340b7c9a63b3 . PHP_EOL);}else {$this->converterLog[] = $v78e731027d8fd50ed642340b7c9a63b3;}}protected function reportError($vcb5e100e5a9a3e7f6d1fd97512215282) {if (defined('UMICMS_CLI_MODE') && UMICMS_CLI_MODE) {Service::Response()     ->getCliBuffer()     ->push($vcb5e100e5a9a3e7f6d1fd97512215282 . PHP_EOL);}else {$this->converterLog[] = $vcb5e100e5a9a3e7f6d1fd97512215282;}}protected function getState() {if (!$this->inParts) {return;}if (!$this->sourceFile || !$this->destinationFile) {throw new coreException('Please set destination and source file name');}$v478086edd955cf7a4886b6727192db6d = $this->getStateDirectoryPath();if (file_exists($v478086edd955cf7a4886b6727192db6d . '/updates/' . md5($this->destinationFile))) {$this->state = unserialize(     file_get_contents($v478086edd955cf7a4886b6727192db6d . '/updates/' . md5($this->destinationFile))    );return;}$vdac681f343395a626d61c242bc234b54 = new DOMDocument();if (!$vdac681f343395a626d61c242bc234b54->load($this->sourceFile)) {throw new coreException("Can't load xml: " . $this->sourceFile);}$this->state = [];$v966d7944778235504560d811fddd4788 = $vdac681f343395a626d61c242bc234b54->getElementsByTagName('table');foreach ($v966d7944778235504560d811fddd4788 as $ve49a5d4bbdb9fdff0af4ece2f3eaec67) {$this->state[$ve49a5d4bbdb9fdff0af4ece2f3eaec67->getAttribute('name')] = [];}}protected function saveState() {if (!$this->inParts) {return;}$v478086edd955cf7a4886b6727192db6d = $this->getStateDirectoryPath();if ($this->completed && file_exists($v478086edd955cf7a4886b6727192db6d . '/updates/' . md5($this->destinationFile))) {$vf40e2de5922369ad6c2f4923bc460901 = unlink($v478086edd955cf7a4886b6727192db6d . '/updates/' . md5($this->destinationFile));if (!$vf40e2de5922369ad6c2f4923bc460901) {throw new coreException('Cannot delete state');}}else {$ve31caf1bc1b8b681b94b6aa60524f53c = file_put_contents(     $v478086edd955cf7a4886b6727192db6d . '/updates/' . md5($this->destinationFile),     serialize($this->state)    );if (!$ve31caf1bc1b8b681b94b6aa60524f53c) {throw new coreException('Cannot save state');}}}private function dumpToXml() {$vdd988cfd769c9f7fbd795a0f5da8e751 = new DOMDocument('1.0', 'utf-8');$vdd988cfd769c9f7fbd795a0f5da8e751->formatOutput = XML_FORMAT_OUTPUT;$vf9b47c173ce144c4a2941b18f85f1657 = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('tables', '');$vdd988cfd769c9f7fbd795a0f5da8e751->appendChild($vf9b47c173ce144c4a2941b18f85f1657);$v9ab2ec7ea4a2041306f7bdf150fcd453 = $this->connection->queryResult('SHOW TABLES');foreach ($v9ab2ec7ea4a2041306f7bdf150fcd453 as $vaab9e1de16f38176f86d7a92ba337a8d) {$result = $this->connection->queryResult("SHOW CREATE TABLE `{$vaab9e1de16f38176f86d7a92ba337a8d[0]}`");foreach ($result as $vf1965a857bc285d26fe22023aa5ab50d) {$v8aa521021a9a89250be765eadd3ed752 = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('table', '');$vf9b47c173ce144c4a2941b18f85f1657->appendChild($v8aa521021a9a89250be765eadd3ed752);$vc29a0c0bef824ee1691bc91da9b60bb7 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('name');$v8aa521021a9a89250be765eadd3ed752->appendChild($vc29a0c0bef824ee1691bc91da9b60bb7);$v7affb12a524a065ba5ff47dc80e5bd68 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$vaab9e1de16f38176f86d7a92ba337a8d[0]}");$vc29a0c0bef824ee1691bc91da9b60bb7->appendChild($v7affb12a524a065ba5ff47dc80e5bd68);if (preg_match('/DEFAULT\s+CHARSET=([^\s]+)/is', $vf1965a857bc285d26fe22023aa5ab50d[1], $vdbd153490a1c3720a970a611afc4371c)) {if (isset($vdbd153490a1c3720a970a611afc4371c[1])) {$vc599f22132934e4b3d154f1cfd56cb2e = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('charset');$v8aa521021a9a89250be765eadd3ed752->appendChild($vc599f22132934e4b3d154f1cfd56cb2e);$ve5d0962eff92f38b2e72c53d669e3626 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$vdbd153490a1c3720a970a611afc4371c[1]}");$vc599f22132934e4b3d154f1cfd56cb2e->appendChild($ve5d0962eff92f38b2e72c53d669e3626);}}if (preg_match('/ENGINE=([^\s]+)/is', $vf1965a857bc285d26fe22023aa5ab50d[1], $vad1943a9fd6d3d7ee1e6af41a5b0d3e7)) {if (isset($vad1943a9fd6d3d7ee1e6af41a5b0d3e7[1])) {$v8f7e1a71bc5f9dce800cee376eb7ce23 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('engine');$v8aa521021a9a89250be765eadd3ed752->appendChild($v8f7e1a71bc5f9dce800cee376eb7ce23);$vf7c4490f8f7e88649bad5b724644eb93 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$vad1943a9fd6d3d7ee1e6af41a5b0d3e7[1]}");$v8f7e1a71bc5f9dce800cee376eb7ce23->appendChild($vf7c4490f8f7e88649bad5b724644eb93);}}$vf1965a857bc285d26fe22023aa5ab50d[1] = preg_replace("/\)\s+ENGINE=(.*)/is", '', $vf1965a857bc285d26fe22023aa5ab50d[1]);$vf1965a857bc285d26fe22023aa5ab50d[1] = preg_replace(      "/CREATE\s+TABLE\s+`(.*)`\s+\(/i",      '',      $vf1965a857bc285d26fe22023aa5ab50d[1]     );preg_match("/(CONSTRAINT\s.*)/is", $vf1965a857bc285d26fe22023aa5ab50d[1], $vd178923285d63e9968956a0a4758267e);if (isset($vd178923285d63e9968956a0a4758267e[1])) {$v7d0eebcb8f63adb4c1f9fc3daf46885f = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('constraints', '');$v8aa521021a9a89250be765eadd3ed752->appendChild($v7d0eebcb8f63adb4c1f9fc3daf46885f);$vd178923285d63e9968956a0a4758267e = explode(',', $vd178923285d63e9968956a0a4758267e[1]);foreach ($vd178923285d63e9968956a0a4758267e as $v3677ab7adaf00725e9fdbaed503a94e3) {$v46bd73f579ba23905e73677fb1afec2c = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('constraint', '');$v7d0eebcb8f63adb4c1f9fc3daf46885f->appendChild($v46bd73f579ba23905e73677fb1afec2c);preg_match("/`([a-zA-Z0-9?_\s+])+`/", $v3677ab7adaf00725e9fdbaed503a94e3, $v9c28d32df234037773be184dbdafc274);preg_match('/`(.*)`/', $v9c28d32df234037773be184dbdafc274[0], $vb068931cc450442b63f5b3d276ea4297);$vb068931cc450442b63f5b3d276ea4297[1] = str_replace('?', ' ', $vb068931cc450442b63f5b3d276ea4297[1]);preg_match("/FOREIGN\s+KEY\s+\(`([a-zA-Z0-9_])+`\)/i", $v3677ab7adaf00725e9fdbaed503a94e3, $v9c28d32df234037773be184dbdafc274);preg_match('/`(.*)`/', $v9c28d32df234037773be184dbdafc274[0], $vbb29c5595c5076e1231e67c7f2bc85b6);preg_match("/REFERENCES\s+`(.*)`\s+\(/i", $v3677ab7adaf00725e9fdbaed503a94e3, $v20459cc30c07816a23805604d092f22f);preg_match("/REFERENCES\s+`.*`\s+\(`(.*)`/i", $v3677ab7adaf00725e9fdbaed503a94e3, $v7b2ea0625e2a6f14b0ed8a13a38924c2);$vc29a0c0bef824ee1691bc91da9b60bb7 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('name');$v46bd73f579ba23905e73677fb1afec2c->appendChild($vc29a0c0bef824ee1691bc91da9b60bb7);$v7affb12a524a065ba5ff47dc80e5bd68 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$vb068931cc450442b63f5b3d276ea4297[1]}");$vc29a0c0bef824ee1691bc91da9b60bb7->appendChild($v7affb12a524a065ba5ff47dc80e5bd68);$v31c42d0e732b08c885b76fa37cc7acc2 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('field');$v46bd73f579ba23905e73677fb1afec2c->appendChild($v31c42d0e732b08c885b76fa37cc7acc2);$v57e27ca74c5e54c344c5894320e56241 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$vbb29c5595c5076e1231e67c7f2bc85b6[1]}");$v31c42d0e732b08c885b76fa37cc7acc2->appendChild($v57e27ca74c5e54c344c5894320e56241);$v85e9ab7d2846f57c5c27469b16454468 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('ref-table');$v46bd73f579ba23905e73677fb1afec2c->appendChild($v85e9ab7d2846f57c5c27469b16454468);$v3268af892d00bd0f74f5675fa61d7298 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$v20459cc30c07816a23805604d092f22f[1]}");$v85e9ab7d2846f57c5c27469b16454468->appendChild($v3268af892d00bd0f74f5675fa61d7298);$vde54f046021e5f497123ada7f65836fe = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('ref-field');$v46bd73f579ba23905e73677fb1afec2c->appendChild($vde54f046021e5f497123ada7f65836fe);$v8f7acac5fa7d14c769bef005b6b04e08 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$v7b2ea0625e2a6f14b0ed8a13a38924c2[1]}");$vde54f046021e5f497123ada7f65836fe->appendChild($v8f7acac5fa7d14c769bef005b6b04e08);preg_match("/ON\s+DELETE\s+(CASCADE|SET\s+NULL)/i", $v3677ab7adaf00725e9fdbaed503a94e3, $vbcc17da57901a31e4cc3fba8876be8f6);if (isset($vbcc17da57901a31e4cc3fba8876be8f6[1])) {$v616fe4faff6079442b75ec8afcec4788 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('on-delete');$v46bd73f579ba23905e73677fb1afec2c->appendChild($v616fe4faff6079442b75ec8afcec4788);$ve5c8f996bbf2cc2318bbbb265eb6d1a5 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$vbcc17da57901a31e4cc3fba8876be8f6[1]}");$v616fe4faff6079442b75ec8afcec4788->appendChild($ve5c8f996bbf2cc2318bbbb265eb6d1a5);}preg_match("/ON\s+UPDATE\s+(CASCADE|SET\s+NULL)/i", $v3677ab7adaf00725e9fdbaed503a94e3, $vaf9d6dce8d058cbfb5da8f0f05e7ab4e);if (isset($vaf9d6dce8d058cbfb5da8f0f05e7ab4e[1])) {$vf42ef5beec1cbb8c8993f53acb6f63b0 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('on-update');$v46bd73f579ba23905e73677fb1afec2c->appendChild($vf42ef5beec1cbb8c8993f53acb6f63b0);$v9fff4607129f87c27db1e0506cf87db1 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$vaf9d6dce8d058cbfb5da8f0f05e7ab4e[1]}");$vf42ef5beec1cbb8c8993f53acb6f63b0->appendChild($v9fff4607129f87c27db1e0506cf87db1);}}$vf1965a857bc285d26fe22023aa5ab50d[1] = preg_replace("/(CONSTRAINT\s.*)/is", '', $vf1965a857bc285d26fe22023aa5ab50d[1]);}preg_match("/PRIMARY\s+KEY\s+\(`(.*)`\)/i", $vf1965a857bc285d26fe22023aa5ab50d[1], $v570346d3ab4c94d612d87e2b4c11fa19);if (isset($v570346d3ab4c94d612d87e2b4c11fa19[1])) {$vf1965a857bc285d26fe22023aa5ab50d[1] = preg_replace("/PRIMARY\s+KEY\s+\(`.*`\)/i", '', $vf1965a857bc285d26fe22023aa5ab50d[1]);}preg_match("/UNIQUE\s+KEY\s+(.*)\)/i", $vf1965a857bc285d26fe22023aa5ab50d[1], $v3529589900c75126818a69e896e8d0fb);if (isset($v3529589900c75126818a69e896e8d0fb[1])) {$vf1965a857bc285d26fe22023aa5ab50d[1] = preg_replace("/UNIQUE\s+KEY\s+.*\)/i", '', $vf1965a857bc285d26fe22023aa5ab50d[1]);}preg_match("/(KEY\s.*)/is", $vf1965a857bc285d26fe22023aa5ab50d[1], $v14f802e1fba977727845e8872c1743a7);if (isset($v570346d3ab4c94d612d87e2b4c11fa19[1]) || isset($v14f802e1fba977727845e8872c1743a7[1]) || isset($v3529589900c75126818a69e896e8d0fb[1])) {$v0615948ca3f33523852fba208a218e40 = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('indexes', '');$v8aa521021a9a89250be765eadd3ed752->appendChild($v0615948ca3f33523852fba208a218e40);}if (isset($v570346d3ab4c94d612d87e2b4c11fa19[1])) {$v36b319e553f48e7ceec4152b1b6a03eb = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('index', '');$v0615948ca3f33523852fba208a218e40->appendChild($v36b319e553f48e7ceec4152b1b6a03eb);$vd84f86942f3b468c7a94ffd29f1692c5 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('type');$v36b319e553f48e7ceec4152b1b6a03eb->appendChild($vd84f86942f3b468c7a94ffd29f1692c5);$vd715cd65fa587a300e46c7cf192bb431 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode('PRIMARY');$vd84f86942f3b468c7a94ffd29f1692c5->appendChild($vd715cd65fa587a300e46c7cf192bb431);$v3519c0cc6f934f2bb6eb86822b2e861a = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('field', "{$v570346d3ab4c94d612d87e2b4c11fa19[1]}");$v36b319e553f48e7ceec4152b1b6a03eb->appendChild($v3519c0cc6f934f2bb6eb86822b2e861a);}if (isset($v3529589900c75126818a69e896e8d0fb[1])) {$v36b319e553f48e7ceec4152b1b6a03eb = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('index', '');$v0615948ca3f33523852fba208a218e40->appendChild($v36b319e553f48e7ceec4152b1b6a03eb);$vd84f86942f3b468c7a94ffd29f1692c5 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('type');$v36b319e553f48e7ceec4152b1b6a03eb->appendChild($vd84f86942f3b468c7a94ffd29f1692c5);$vd715cd65fa587a300e46c7cf192bb431 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode('UNIQUE');$vd84f86942f3b468c7a94ffd29f1692c5->appendChild($vd715cd65fa587a300e46c7cf192bb431);preg_match("/`(.*)`\s+\(/", $v3529589900c75126818a69e896e8d0fb[1], $vb068931cc450442b63f5b3d276ea4297);$vc29a0c0bef824ee1691bc91da9b60bb7 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('name');$v36b319e553f48e7ceec4152b1b6a03eb->appendChild($vc29a0c0bef824ee1691bc91da9b60bb7);$v7affb12a524a065ba5ff47dc80e5bd68 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$vb068931cc450442b63f5b3d276ea4297[1]}");$vc29a0c0bef824ee1691bc91da9b60bb7->appendChild($v7affb12a524a065ba5ff47dc80e5bd68);preg_match("/\((.*)/", $v3529589900c75126818a69e896e8d0fb[1], $v9c28d32df234037773be184dbdafc274);$vd05b6ed7d2345020440df396d6da7f73 = explode(',', $v9c28d32df234037773be184dbdafc274[1]);foreach ($vd05b6ed7d2345020440df396d6da7f73 as $v06e3d36fa30cea095545139854ad1fb9) {preg_match("/\((\d+)\)/", $v06e3d36fa30cea095545139854ad1fb9, $v2fa47f7c65fec19cc163b195725e3844);preg_match('/`(.*)`/', $v06e3d36fa30cea095545139854ad1fb9, $v972bf3f05d14ffbdb817bef60638ff00);$v3519c0cc6f934f2bb6eb86822b2e861a = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('field', "{$v972bf3f05d14ffbdb817bef60638ff00[1]}");$v36b319e553f48e7ceec4152b1b6a03eb->appendChild($v3519c0cc6f934f2bb6eb86822b2e861a);if (isset($v2fa47f7c65fec19cc163b195725e3844[1])) {$vc4c577e2cfb01bdf7f46b8aed811e349 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('length');$v3519c0cc6f934f2bb6eb86822b2e861a->appendChild($vc4c577e2cfb01bdf7f46b8aed811e349);$vbe3826963325fafe464b3893b63399e1 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$v2fa47f7c65fec19cc163b195725e3844[1]}");$vc4c577e2cfb01bdf7f46b8aed811e349->appendChild($vbe3826963325fafe464b3893b63399e1);}}}if (isset($v14f802e1fba977727845e8872c1743a7[1])) {$v14f802e1fba977727845e8872c1743a7[1] = preg_replace("/`\),/", '` ),', $v14f802e1fba977727845e8872c1743a7[1]);$v14f802e1fba977727845e8872c1743a7[1] = preg_replace("/\)\),/", ') ),', $v14f802e1fba977727845e8872c1743a7[1]);$v14f802e1fba977727845e8872c1743a7 = preg_split("/\s+\),/", $v14f802e1fba977727845e8872c1743a7[1]);foreach ($v14f802e1fba977727845e8872c1743a7 as $v3c6e0b8a9c15224a8228b9a98ca1531d) {$v3c6e0b8a9c15224a8228b9a98ca1531d = trim($v3c6e0b8a9c15224a8228b9a98ca1531d);if ($v3c6e0b8a9c15224a8228b9a98ca1531d !== '') {preg_match("/`(.*)`\s+\(/", $v3c6e0b8a9c15224a8228b9a98ca1531d, $vb068931cc450442b63f5b3d276ea4297);$v36b319e553f48e7ceec4152b1b6a03eb = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('index', '');$v0615948ca3f33523852fba208a218e40->appendChild($v36b319e553f48e7ceec4152b1b6a03eb);$vc29a0c0bef824ee1691bc91da9b60bb7 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('name');$v36b319e553f48e7ceec4152b1b6a03eb->appendChild($vc29a0c0bef824ee1691bc91da9b60bb7);$v7affb12a524a065ba5ff47dc80e5bd68 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$vb068931cc450442b63f5b3d276ea4297[1]}");$vc29a0c0bef824ee1691bc91da9b60bb7->appendChild($v7affb12a524a065ba5ff47dc80e5bd68);preg_match("/\((.*)/", $v3c6e0b8a9c15224a8228b9a98ca1531d, $v9c28d32df234037773be184dbdafc274);$vd05b6ed7d2345020440df396d6da7f73 = explode(',', $v9c28d32df234037773be184dbdafc274[1]);foreach ($vd05b6ed7d2345020440df396d6da7f73 as $v06e3d36fa30cea095545139854ad1fb9) {preg_match("/\((\d+)\)/", $v06e3d36fa30cea095545139854ad1fb9, $v2fa47f7c65fec19cc163b195725e3844);preg_match('/`(.*)`/', $v06e3d36fa30cea095545139854ad1fb9, $v972bf3f05d14ffbdb817bef60638ff00);$v3519c0cc6f934f2bb6eb86822b2e861a = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('field', "{$v972bf3f05d14ffbdb817bef60638ff00[1]}");$v36b319e553f48e7ceec4152b1b6a03eb->appendChild($v3519c0cc6f934f2bb6eb86822b2e861a);if (isset($v2fa47f7c65fec19cc163b195725e3844[1])) {$vc4c577e2cfb01bdf7f46b8aed811e349 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('length');$v3519c0cc6f934f2bb6eb86822b2e861a->appendChild($vc4c577e2cfb01bdf7f46b8aed811e349);$vbe3826963325fafe464b3893b63399e1 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$v2fa47f7c65fec19cc163b195725e3844[1]}");$vc4c577e2cfb01bdf7f46b8aed811e349->appendChild($vbe3826963325fafe464b3893b63399e1);}}}}$vf1965a857bc285d26fe22023aa5ab50d[1] = preg_replace("/(KEY\s.*)/is", '', $vf1965a857bc285d26fe22023aa5ab50d[1]);}$vf25666ec7d1e534a13f641251310e226 = preg_split('/\n/', $vf1965a857bc285d26fe22023aa5ab50d[1]);$v55110d7377696363c7b1992850a3102a = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('fields', '');$v8aa521021a9a89250be765eadd3ed752->appendChild($v55110d7377696363c7b1992850a3102a);foreach ($vf25666ec7d1e534a13f641251310e226 as $v06e3d36fa30cea095545139854ad1fb9) {$v06e3d36fa30cea095545139854ad1fb9 = preg_replace('/,$/s', '', $v06e3d36fa30cea095545139854ad1fb9);$v06e3d36fa30cea095545139854ad1fb9 = trim($v06e3d36fa30cea095545139854ad1fb9);if (mb_strlen($v06e3d36fa30cea095545139854ad1fb9) > 1) {$v3519c0cc6f934f2bb6eb86822b2e861a = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('field');$v55110d7377696363c7b1992850a3102a->appendChild($v3519c0cc6f934f2bb6eb86822b2e861a);preg_match("/COMMENT\s+'(.*)'/i", $v06e3d36fa30cea095545139854ad1fb9, $v06d4cd63bde972fc66a0aed41d2f5c51);if (isset($v06d4cd63bde972fc66a0aed41d2f5c51[1])) {$v333d4e8e00d9533b1a986b85cb68a2d7 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('comment');$v3519c0cc6f934f2bb6eb86822b2e861a->appendChild($v333d4e8e00d9533b1a986b85cb68a2d7);$vb420ab913b515a67edf91b99b23fcd94 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$v06d4cd63bde972fc66a0aed41d2f5c51[1]}");$v333d4e8e00d9533b1a986b85cb68a2d7->appendChild($vb420ab913b515a67edf91b99b23fcd94);$v06e3d36fa30cea095545139854ad1fb9 = preg_replace("/COMMENT\s+'.*'/i", '', $v06e3d36fa30cea095545139854ad1fb9);}preg_match(        "/\s+(BINARY|UNSIGNED\s+ZEROFILL|UNSIGNED|on\s+update\s+CURRENT_TIMESTAMP)/i",        $v06e3d36fa30cea095545139854ad1fb9,        $vd2eb444e35c0a71f0a85df8194acb5b6       );if (isset($vd2eb444e35c0a71f0a85df8194acb5b6[1])) {$va900d2a490d6314ab0fa284c0afd20af = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('attributes');$v3519c0cc6f934f2bb6eb86822b2e861a->appendChild($va900d2a490d6314ab0fa284c0afd20af);$v1c9856f244f76695dac6f3e6a08761c4 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$vd2eb444e35c0a71f0a85df8194acb5b6[1]}");$va900d2a490d6314ab0fa284c0afd20af->appendChild($v1c9856f244f76695dac6f3e6a08761c4);$v06e3d36fa30cea095545139854ad1fb9 = preg_replace(         "/\s+BINARY|\s+UNSIGNED\s+ZEROFILL|\s+UNSIGNED|\s+on\s+update\s+CURRENT_TIMESTAMP/i",         '',         $v06e3d36fa30cea095545139854ad1fb9        );}preg_match("/\s+(NOT\s+NULL)/i", $v06e3d36fa30cea095545139854ad1fb9, $v78a62b57a46b05718f1fc38e9be60223);if (isset($v78a62b57a46b05718f1fc38e9be60223[1])) {$v6093c18a542b533deabe01279f68a9ff = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('not-null');$v3519c0cc6f934f2bb6eb86822b2e861a->appendChild($v6093c18a542b533deabe01279f68a9ff);$v6b853dfb19bee3eef67c33b658dd0753 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode('1');$v6093c18a542b533deabe01279f68a9ff->appendChild($v6b853dfb19bee3eef67c33b658dd0753);$v06e3d36fa30cea095545139854ad1fb9 = preg_replace("/\s+NOT\s+NULL/i", '', $v06e3d36fa30cea095545139854ad1fb9);}preg_match("/\s+(AUTO_INCREMENT)/i", $v06e3d36fa30cea095545139854ad1fb9, $v8c36426826ccf38cedc202042ef32a38);if (isset($v8c36426826ccf38cedc202042ef32a38[1])) {$v464f947c2cd3d7fcab84ba97b1eddaab = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('increment');$v3519c0cc6f934f2bb6eb86822b2e861a->appendChild($v464f947c2cd3d7fcab84ba97b1eddaab);$v548e43f2cdf2f615fd675c94c140a2ce = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode('1');$v464f947c2cd3d7fcab84ba97b1eddaab->appendChild($v548e43f2cdf2f615fd675c94c140a2ce);$v06e3d36fa30cea095545139854ad1fb9 = preg_replace("/\s+AUTO_INCREMENT/i", '', $v06e3d36fa30cea095545139854ad1fb9);}preg_match("/\s+DEFAULT\s+(.*)/i", $v06e3d36fa30cea095545139854ad1fb9, $vc21f969b5f03d33d43e04f8f136e7682);if (isset($vc21f969b5f03d33d43e04f8f136e7682[1])) {preg_match("/'(.*)'/", $vc21f969b5f03d33d43e04f8f136e7682[1], $ve3cc92c14a5e6dd1a7d94b6ff634d7fc);if (isset($ve3cc92c14a5e6dd1a7d94b6ff634d7fc[1])) {$vc21f969b5f03d33d43e04f8f136e7682[1] = $ve3cc92c14a5e6dd1a7d94b6ff634d7fc[1];}$v06ef98e04ec8d66e6046a23cbac99a68 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('default');$v3519c0cc6f934f2bb6eb86822b2e861a->appendChild($v06ef98e04ec8d66e6046a23cbac99a68);$v0db17aa1d80e20064fe42736b1c76de8 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$vc21f969b5f03d33d43e04f8f136e7682[1]}");$v06ef98e04ec8d66e6046a23cbac99a68->appendChild($v0db17aa1d80e20064fe42736b1c76de8);$v06e3d36fa30cea095545139854ad1fb9 = preg_replace("/\s+DEFAULT\s+.*/i", '', $v06e3d36fa30cea095545139854ad1fb9);}preg_match('/`(.*)`/', $v06e3d36fa30cea095545139854ad1fb9, $vb068931cc450442b63f5b3d276ea4297);if (isset($vb068931cc450442b63f5b3d276ea4297[1])) {$vc29a0c0bef824ee1691bc91da9b60bb7 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('name');$v3519c0cc6f934f2bb6eb86822b2e861a->appendChild($vc29a0c0bef824ee1691bc91da9b60bb7);$v7affb12a524a065ba5ff47dc80e5bd68 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$vb068931cc450442b63f5b3d276ea4297[1]}");$vc29a0c0bef824ee1691bc91da9b60bb7->appendChild($v7affb12a524a065ba5ff47dc80e5bd68);$v06e3d36fa30cea095545139854ad1fb9 = preg_replace('/`.*`/', '', $v06e3d36fa30cea095545139854ad1fb9);}preg_match("/\((\d+|\d+,\d+)\)/", $v06e3d36fa30cea095545139854ad1fb9, $vf7bd60b75b29d79b660a2859395c1a24);if (isset($vf7bd60b75b29d79b660a2859395c1a24[1])) {$v9f0786fd7358950c74f2ecec9958a608 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('size');$v3519c0cc6f934f2bb6eb86822b2e861a->appendChild($v9f0786fd7358950c74f2ecec9958a608);$v6f4cf5076b722f9563e0fa6dbcff3018 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$vf7bd60b75b29d79b660a2859395c1a24[1]}");$v9f0786fd7358950c74f2ecec9958a608->appendChild($v6f4cf5076b722f9563e0fa6dbcff3018);$v06e3d36fa30cea095545139854ad1fb9 = preg_replace("/\({$vf7bd60b75b29d79b660a2859395c1a24[1]}\)/", '', $v06e3d36fa30cea095545139854ad1fb9);}preg_match("/\((.*)\)/", $v06e3d36fa30cea095545139854ad1fb9, $vf7bd60b75b29d79b660a2859395c1a24);if (isset($vf7bd60b75b29d79b660a2859395c1a24[1])) {$v93da65a9fd0004d9477aeac024e08e15 = preg_replace("/'/", '', $vf7bd60b75b29d79b660a2859395c1a24[1]);$v93da65a9fd0004d9477aeac024e08e15 = explode(',', $v93da65a9fd0004d9477aeac024e08e15);foreach ($v93da65a9fd0004d9477aeac024e08e15 as $vef3e30e070f70244fd6578d88a6b77ac) {$v3854490910df9108058de2c5c98b8b13 = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement('option', $vef3e30e070f70244fd6578d88a6b77ac);$v3519c0cc6f934f2bb6eb86822b2e861a->appendChild($v3854490910df9108058de2c5c98b8b13);}$v06e3d36fa30cea095545139854ad1fb9 = preg_replace("/\((.*)\)/", '', $v06e3d36fa30cea095545139854ad1fb9);}$v06e3d36fa30cea095545139854ad1fb9 = preg_replace('/,/', '', $v06e3d36fa30cea095545139854ad1fb9);$v06e3d36fa30cea095545139854ad1fb9 = trim($v06e3d36fa30cea095545139854ad1fb9);if ($v06e3d36fa30cea095545139854ad1fb9) {$vd84f86942f3b468c7a94ffd29f1692c5 = $vdd988cfd769c9f7fbd795a0f5da8e751->createAttribute('type');$v3519c0cc6f934f2bb6eb86822b2e861a->appendChild($vd84f86942f3b468c7a94ffd29f1692c5);$vd715cd65fa587a300e46c7cf192bb431 = $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode("{$v06e3d36fa30cea095545139854ad1fb9}");$vd84f86942f3b468c7a94ffd29f1692c5->appendChild($vd715cd65fa587a300e46c7cf192bb431);}}}}}return $vdd988cfd769c9f7fbd795a0f5da8e751->saveXML($vdd988cfd769c9f7fbd795a0f5da8e751->documentElement, DOM_LOAD_OPTIONS);}public function saveXmlToFile() {if (!file_put_contents($this->destinationFile, $this->dumpToXml())) {throw new coreException('Cannot create new xml file ' . $this->destinationFile);}}public function restoreShowCreateTable($v80071f37861c360a27b7327e132c911a) {$v9a09b4dfda82e3e665e31092d1c3ec8d = new DOMDocument();if (!$v9a09b4dfda82e3e665e31092d1c3ec8d->load($this->sourceFile)) {throw new coreException("Can't load xml: " . $this->sourceFile);}$v3d788fa62d7c185a1bee4c9147ee1091 = new DOMXPath($v9a09b4dfda82e3e665e31092d1c3ec8d);$vaab9e1de16f38176f86d7a92ba337a8d = $v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']")->item(0);$v6b463f2cc2f409da62a14ee5fe4b816a = "CREATE TABLE `{$v80071f37861c360a27b7327e132c911a}` (\n";$vc7ec484aa0cc70ef637682bd6e5bfe2e = $vaab9e1de16f38176f86d7a92ba337a8d->getElementsByTagName('fields');if (is_object($vc7ec484aa0cc70ef637682bd6e5bfe2e->item(0))) {$v69fe4aec8073954bf273e3113edd24cf = $vc7ec484aa0cc70ef637682bd6e5bfe2e->item(0)->getElementsByTagName('field');foreach ($v69fe4aec8073954bf273e3113edd24cf as $v06e3d36fa30cea095545139854ad1fb9) {$v6b463f2cc2f409da62a14ee5fe4b816a .= "\t";$v972bf3f05d14ffbdb817bef60638ff00 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('name');if ($v972bf3f05d14ffbdb817bef60638ff00) {$v6b463f2cc2f409da62a14ee5fe4b816a .= "`{$v972bf3f05d14ffbdb817bef60638ff00}`";}$v833750ac635fcc57dc33ecafe365f9a7 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('type');if ($v833750ac635fcc57dc33ecafe365f9a7) {$v6b463f2cc2f409da62a14ee5fe4b816a .= " {$v833750ac635fcc57dc33ecafe365f9a7}";}$v59ebf8e686724f0cf779fb2a9ecf59c2 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('size');if ($v59ebf8e686724f0cf779fb2a9ecf59c2) {$v6b463f2cc2f409da62a14ee5fe4b816a .= "({$v59ebf8e686724f0cf779fb2a9ecf59c2})";}if ($v06e3d36fa30cea095545139854ad1fb9->getElementsByTagName('option')->length) {$v93da65a9fd0004d9477aeac024e08e15 = $v06e3d36fa30cea095545139854ad1fb9->getElementsByTagName('option');$v2216ff1f4b7cff0a68acab5c55100e4f = '';$v865c0c0b4ab0e063e5caa3387c1a8741 = 1;foreach ($v93da65a9fd0004d9477aeac024e08e15 as $vef3e30e070f70244fd6578d88a6b77ac) {if ($v865c0c0b4ab0e063e5caa3387c1a8741 == $v93da65a9fd0004d9477aeac024e08e15->length) {$v2216ff1f4b7cff0a68acab5c55100e4f .= "'{$vef3e30e070f70244fd6578d88a6b77ac->nodeValue}'";}else {$v2216ff1f4b7cff0a68acab5c55100e4f .= "'{$vef3e30e070f70244fd6578d88a6b77ac->nodeValue}',";}$v865c0c0b4ab0e063e5caa3387c1a8741++;}$v6b463f2cc2f409da62a14ee5fe4b816a .= "({$v2216ff1f4b7cff0a68acab5c55100e4f})";}$v33045d9ddb408d27dbcbc3ca53d5583e = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('attributes');if ($v33045d9ddb408d27dbcbc3ca53d5583e) {$v6b463f2cc2f409da62a14ee5fe4b816a .= " {$v33045d9ddb408d27dbcbc3ca53d5583e}";}$v1f662954e1ee120a4aab8716234e109a = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('not-null');if ($v1f662954e1ee120a4aab8716234e109a) {$v6b463f2cc2f409da62a14ee5fe4b816a .= ' NOT NULL';}if ($v06e3d36fa30cea095545139854ad1fb9->hasAttribute('default')) {$vb40b5e5897a4cdfa5bb06346fa44deb3 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('default');if ($vb40b5e5897a4cdfa5bb06346fa44deb3 != 'NULL') {$vb40b5e5897a4cdfa5bb06346fa44deb3 = "'{$vb40b5e5897a4cdfa5bb06346fa44deb3}'";}$v6b463f2cc2f409da62a14ee5fe4b816a .= " DEFAULT {$vb40b5e5897a4cdfa5bb06346fa44deb3}";}if ($v06e3d36fa30cea095545139854ad1fb9->getAttribute('increment')) {$v6b463f2cc2f409da62a14ee5fe4b816a .= ' AUTO_INCREMENT';}$vf23104cd881ba30152c4981a93d80185 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('comment');if ($vf23104cd881ba30152c4981a93d80185) {$v6b463f2cc2f409da62a14ee5fe4b816a .= " COMMENT '{$vf23104cd881ba30152c4981a93d80185}'";}$v6b463f2cc2f409da62a14ee5fe4b816a .= ",\n";}}$v7e41f53a3c84926d1d7995de56944c27 = $vaab9e1de16f38176f86d7a92ba337a8d->getElementsByTagName('indexes');if (is_object($v7e41f53a3c84926d1d7995de56944c27->item(0))) {$v0ddb9f30e5f4b84581595009098297a7 = $v7e41f53a3c84926d1d7995de56944c27->item(0)->getElementsByTagName('index');foreach ($v0ddb9f30e5f4b84581595009098297a7 as $v6a992d5529f459a44fee58c733255e86) {$v6b463f2cc2f409da62a14ee5fe4b816a .= "\t";$va83af96ce0bc256deeb3ce660dcebacc = $v6a992d5529f459a44fee58c733255e86->getAttribute('type');if ($va83af96ce0bc256deeb3ce660dcebacc) {$v6b463f2cc2f409da62a14ee5fe4b816a .= "{$va83af96ce0bc256deeb3ce660dcebacc} ";}$v6b463f2cc2f409da62a14ee5fe4b816a .= 'KEY';$v14374754c27bc1eef6a7e737213600e3 = $v6a992d5529f459a44fee58c733255e86->getAttribute('name');if ($v14374754c27bc1eef6a7e737213600e3) {$v6b463f2cc2f409da62a14ee5fe4b816a .= " `{$v14374754c27bc1eef6a7e737213600e3}`";}if ($v6a992d5529f459a44fee58c733255e86->getElementsByTagName('field')->length) {$v69fe4aec8073954bf273e3113edd24cf = $v6a992d5529f459a44fee58c733255e86->getElementsByTagName('field');$v339cc492c232e5b3a1242dcbf6240e04 = '';$v865c0c0b4ab0e063e5caa3387c1a8741 = 1;foreach ($v69fe4aec8073954bf273e3113edd24cf as $v06e3d36fa30cea095545139854ad1fb9) {$v319e2726bcc98302437312a8ebfe9deb = "`{$v06e3d36fa30cea095545139854ad1fb9->nodeValue}`";$v0f1a6fa1e9e0963e1ac389661ba0b603 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('length');if ($v0f1a6fa1e9e0963e1ac389661ba0b603) {$v319e2726bcc98302437312a8ebfe9deb .= "({$v0f1a6fa1e9e0963e1ac389661ba0b603})";}if ($v865c0c0b4ab0e063e5caa3387c1a8741 == $v69fe4aec8073954bf273e3113edd24cf->length) {$v339cc492c232e5b3a1242dcbf6240e04 .= $v319e2726bcc98302437312a8ebfe9deb;}else {$v339cc492c232e5b3a1242dcbf6240e04 .= "{$v319e2726bcc98302437312a8ebfe9deb},";}$v865c0c0b4ab0e063e5caa3387c1a8741++;}$v6b463f2cc2f409da62a14ee5fe4b816a .= " ({$v339cc492c232e5b3a1242dcbf6240e04})";}$v6b463f2cc2f409da62a14ee5fe4b816a .= ",\n";}}$vedc2dd68d1be92a82a9d8362bbae0895 = $vaab9e1de16f38176f86d7a92ba337a8d->getElementsByTagName('constraints');if (is_object($vedc2dd68d1be92a82a9d8362bbae0895->item(0))) {$v581c24a0b50b73b594671e436e10cf27 = $vedc2dd68d1be92a82a9d8362bbae0895->item(0)->getElementsByTagName('constraint');foreach ($v581c24a0b50b73b594671e436e10cf27 as $v3677ab7adaf00725e9fdbaed503a94e3) {$v6b463f2cc2f409da62a14ee5fe4b816a .= "\tCONSTRAINT";$v4d5fdbc896088855bd8a568b5ffd9abb = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('name');if ($v4d5fdbc896088855bd8a568b5ffd9abb) {$v6b463f2cc2f409da62a14ee5fe4b816a .= " `{$v4d5fdbc896088855bd8a568b5ffd9abb}`";}$vfd40c91ee81d59fccbcab8644500e3e4 = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('field');if ($vfd40c91ee81d59fccbcab8644500e3e4) {$v6b463f2cc2f409da62a14ee5fe4b816a .= " FOREIGN KEY (`{$vfd40c91ee81d59fccbcab8644500e3e4}`)";}$v9b992b703884cf36b8cad1966fe086f9 = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('ref-table');if ($v9b992b703884cf36b8cad1966fe086f9) {$v6b463f2cc2f409da62a14ee5fe4b816a .= " REFERENCES `{$v9b992b703884cf36b8cad1966fe086f9}`";}$v1aaf3ab1a76a2b4e7a6bf784293cc4df = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('ref-field');if ($v1aaf3ab1a76a2b4e7a6bf784293cc4df) {$v6b463f2cc2f409da62a14ee5fe4b816a .= " (`{$v1aaf3ab1a76a2b4e7a6bf784293cc4df}`)";}$v269738db81007d986968bb0e3e20768b = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('on-delete');if ($v269738db81007d986968bb0e3e20768b) {$v6b463f2cc2f409da62a14ee5fe4b816a .= " ON DELETE {$v269738db81007d986968bb0e3e20768b}";}$v844db8803d63e7e046c30d82b772d410 = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('on-update');if ($v844db8803d63e7e046c30d82b772d410) {$v6b463f2cc2f409da62a14ee5fe4b816a .= " ON UPDATE {$v844db8803d63e7e046c30d82b772d410}";}$v6b463f2cc2f409da62a14ee5fe4b816a .= ",\n";}}$v6b463f2cc2f409da62a14ee5fe4b816a = preg_replace('/,$/s', '', $v6b463f2cc2f409da62a14ee5fe4b816a);$v0499bf152a9954b9cf9981fd078eb0b8 = $vaab9e1de16f38176f86d7a92ba337a8d->getAttribute('engine');if ($v0499bf152a9954b9cf9981fd078eb0b8) {$v6b463f2cc2f409da62a14ee5fe4b816a .= ") ENGINE={$v0499bf152a9954b9cf9981fd078eb0b8}";}$vd5cbc6798435d4fe67a443679b239dd6 = $vaab9e1de16f38176f86d7a92ba337a8d->getAttribute('charset');if ($vd5cbc6798435d4fe67a443679b239dd6) {$v6b463f2cc2f409da62a14ee5fe4b816a .= " DEFAULT CHARSET={$vd5cbc6798435d4fe67a443679b239dd6}";}$v6b463f2cc2f409da62a14ee5fe4b816a .= "\n";return $v6b463f2cc2f409da62a14ee5fe4b816a;}private function createDataBaseTable($v80071f37861c360a27b7327e132c911a) {$v6b463f2cc2f409da62a14ee5fe4b816a = $this->restoreShowCreateTable($v80071f37861c360a27b7327e132c911a);$v260ca9dd8a4577fc00b7bd5810298076 = true;try {$this->connection->queryResult($v6b463f2cc2f409da62a14ee5fe4b816a);}catch (Exception $ve1671797c52e15f763380b45e841ec32) {$this->reportError($ve1671797c52e15f763380b45e841ec32->getMessage());$v260ca9dd8a4577fc00b7bd5810298076 = false;}if ($v260ca9dd8a4577fc00b7bd5810298076) {$this->writeLog("Data base table {$v80071f37861c360a27b7327e132c911a} has been created");}}private function changeTableEngine($v80071f37861c360a27b7327e132c911a, $v0499bf152a9954b9cf9981fd078eb0b8) {$v260ca9dd8a4577fc00b7bd5810298076 = true;try {$this->connection->queryResult("ALTER TABLE `{$v80071f37861c360a27b7327e132c911a}` ENGINE={$v0499bf152a9954b9cf9981fd078eb0b8}");}catch (Exception $ve1671797c52e15f763380b45e841ec32) {$this->reportError($ve1671797c52e15f763380b45e841ec32->getMessage());$v260ca9dd8a4577fc00b7bd5810298076 = false;}if ($v260ca9dd8a4577fc00b7bd5810298076) {$this->writeLog("Data base table ({$v80071f37861c360a27b7327e132c911a}) engine has been changed");}}private function changeTableCharset($v80071f37861c360a27b7327e132c911a, $vd5cbc6798435d4fe67a443679b239dd6) {$v260ca9dd8a4577fc00b7bd5810298076 = true;try {$this->connection->queryResult("ALTER TABLE `{$v80071f37861c360a27b7327e132c911a}` DEFAULT CHARACTER SET {$vd5cbc6798435d4fe67a443679b239dd6}");}catch (Exception $ve1671797c52e15f763380b45e841ec32) {$this->reportError($ve1671797c52e15f763380b45e841ec32->getMessage());$v260ca9dd8a4577fc00b7bd5810298076 = false;}if ($v260ca9dd8a4577fc00b7bd5810298076) {$this->writeLog("Data base table ({$v80071f37861c360a27b7327e132c911a}) character set has been changed");}$v9a09b4dfda82e3e665e31092d1c3ec8d = new DOMDocument();if (!$v9a09b4dfda82e3e665e31092d1c3ec8d->load($this->sourceFile)) {throw new coreException("Can't load xml: " . $this->sourceFile);}$v3d788fa62d7c185a1bee4c9147ee1091 = new DOMXPath($v9a09b4dfda82e3e665e31092d1c3ec8d);$vaab9e1de16f38176f86d7a92ba337a8d = $v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']")->item(0);$vc7ec484aa0cc70ef637682bd6e5bfe2e = $vaab9e1de16f38176f86d7a92ba337a8d->getElementsByTagName('fields');if (is_object($vc7ec484aa0cc70ef637682bd6e5bfe2e->item(0))) {$v69fe4aec8073954bf273e3113edd24cf = $vc7ec484aa0cc70ef637682bd6e5bfe2e->item(0)->getElementsByTagName('field');foreach ($v69fe4aec8073954bf273e3113edd24cf as $v06e3d36fa30cea095545139854ad1fb9) {$v972bf3f05d14ffbdb817bef60638ff00 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('name');if ($v972bf3f05d14ffbdb817bef60638ff00) {$this->createTableField($v80071f37861c360a27b7327e132c911a, $v972bf3f05d14ffbdb817bef60638ff00, 'modify');}}}}private function createTableField($v80071f37861c360a27b7327e132c911a, $v972bf3f05d14ffbdb817bef60638ff00, $veca07335a33c5aeb5e1bc7c98b4b9d80) {$v9a09b4dfda82e3e665e31092d1c3ec8d = new DOMDocument();if (!$v9a09b4dfda82e3e665e31092d1c3ec8d->load($this->sourceFile)) {throw new coreException("Can't load xml: " . $this->sourceFile);}$v3d788fa62d7c185a1bee4c9147ee1091 = new DOMXPath($v9a09b4dfda82e3e665e31092d1c3ec8d);if (!$v06e3d36fa30cea095545139854ad1fb9 = $v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}']")->item(0)) {throw new coreException("Cannot change {$v80071f37861c360a27b7327e132c911a}.{$v972bf3f05d14ffbdb817bef60638ff00}");}if ($veca07335a33c5aeb5e1bc7c98b4b9d80 == 'add') {$ve32bc0b0e4d21d624198a196f73a0d72 = "ALTER TABLE `{$v80071f37861c360a27b7327e132c911a}` ADD ";}else {$ve32bc0b0e4d21d624198a196f73a0d72 = "ALTER TABLE `{$v80071f37861c360a27b7327e132c911a}` MODIFY ";}$ve32bc0b0e4d21d624198a196f73a0d72 .= "`{$v972bf3f05d14ffbdb817bef60638ff00}`";$v833750ac635fcc57dc33ecafe365f9a7 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('type');if ($v833750ac635fcc57dc33ecafe365f9a7) {$ve32bc0b0e4d21d624198a196f73a0d72 .= " {$v833750ac635fcc57dc33ecafe365f9a7}";}$v59ebf8e686724f0cf779fb2a9ecf59c2 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('size');if ($v59ebf8e686724f0cf779fb2a9ecf59c2) {$ve32bc0b0e4d21d624198a196f73a0d72 .= "({$v59ebf8e686724f0cf779fb2a9ecf59c2})";}if ($v06e3d36fa30cea095545139854ad1fb9->getElementsByTagName('option')->length) {$v93da65a9fd0004d9477aeac024e08e15 = $v06e3d36fa30cea095545139854ad1fb9->getElementsByTagName('option');$v2216ff1f4b7cff0a68acab5c55100e4f = '';$v865c0c0b4ab0e063e5caa3387c1a8741 = 1;foreach ($v93da65a9fd0004d9477aeac024e08e15 as $vef3e30e070f70244fd6578d88a6b77ac) {if ($v865c0c0b4ab0e063e5caa3387c1a8741 == $v93da65a9fd0004d9477aeac024e08e15->length) {$v2216ff1f4b7cff0a68acab5c55100e4f .= "'{$vef3e30e070f70244fd6578d88a6b77ac->nodeValue}'";}else {$v2216ff1f4b7cff0a68acab5c55100e4f .= "'{$vef3e30e070f70244fd6578d88a6b77ac->nodeValue}',";}$v865c0c0b4ab0e063e5caa3387c1a8741++;}$ve32bc0b0e4d21d624198a196f73a0d72 .= "({$v2216ff1f4b7cff0a68acab5c55100e4f})";}$v33045d9ddb408d27dbcbc3ca53d5583e = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('attributes');if ($v33045d9ddb408d27dbcbc3ca53d5583e) {$ve32bc0b0e4d21d624198a196f73a0d72 .= " {$v33045d9ddb408d27dbcbc3ca53d5583e}";}$v1f662954e1ee120a4aab8716234e109a = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('not-null');if ($v1f662954e1ee120a4aab8716234e109a) {$ve32bc0b0e4d21d624198a196f73a0d72 .= ' NOT NULL';}if ($v06e3d36fa30cea095545139854ad1fb9->hasAttribute('default')) {$vb40b5e5897a4cdfa5bb06346fa44deb3 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('default');if ($vb40b5e5897a4cdfa5bb06346fa44deb3 != 'NULL') {$vb40b5e5897a4cdfa5bb06346fa44deb3 = "'{$vb40b5e5897a4cdfa5bb06346fa44deb3}'";}$ve32bc0b0e4d21d624198a196f73a0d72 .= " DEFAULT {$vb40b5e5897a4cdfa5bb06346fa44deb3}";}if ($v06e3d36fa30cea095545139854ad1fb9->getAttribute('increment')) {$ve32bc0b0e4d21d624198a196f73a0d72 .= ' AUTO_INCREMENT';}$vf23104cd881ba30152c4981a93d80185 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('comment');if ($vf23104cd881ba30152c4981a93d80185) {$ve32bc0b0e4d21d624198a196f73a0d72 .= " COMMENT '{$vf23104cd881ba30152c4981a93d80185}'";}$v260ca9dd8a4577fc00b7bd5810298076 = true;try {$this->connection->queryResult($ve32bc0b0e4d21d624198a196f73a0d72);}catch (Exception $ve1671797c52e15f763380b45e841ec32) {$this->reportError($ve1671797c52e15f763380b45e841ec32->getMessage());$v260ca9dd8a4577fc00b7bd5810298076 = false;}if ($v260ca9dd8a4577fc00b7bd5810298076) {if ($veca07335a33c5aeb5e1bc7c98b4b9d80 == 'add') {$this->writeLog("Data base table ({$v80071f37861c360a27b7327e132c911a}) field ({$v972bf3f05d14ffbdb817bef60638ff00}) has been created");}else {$this->writeLog("Data base table ({$v80071f37861c360a27b7327e132c911a}) field ({$v972bf3f05d14ffbdb817bef60638ff00}) has been changed");}}}private function dropIndex($v80071f37861c360a27b7327e132c911a, $v14374754c27bc1eef6a7e737213600e3) {$v260ca9dd8a4577fc00b7bd5810298076 = true;try {$this->connection->queryResult("ALTER TABLE `{$v80071f37861c360a27b7327e132c911a}` DROP INDEX `{$v14374754c27bc1eef6a7e737213600e3}`");}catch (Exception $ve1671797c52e15f763380b45e841ec32) {$this->reportError($ve1671797c52e15f763380b45e841ec32->getMessage());$v260ca9dd8a4577fc00b7bd5810298076 = false;}if ($v260ca9dd8a4577fc00b7bd5810298076) {$this->writeLog("Data base table ({$v80071f37861c360a27b7327e132c911a}) index ({$v14374754c27bc1eef6a7e737213600e3}) has been dropped");}}private function createTableIndex($v80071f37861c360a27b7327e132c911a, $v14374754c27bc1eef6a7e737213600e3, $veca07335a33c5aeb5e1bc7c98b4b9d80) {$v9a09b4dfda82e3e665e31092d1c3ec8d = new DOMDocument();if (!$v9a09b4dfda82e3e665e31092d1c3ec8d->load($this->sourceFile)) {throw new coreException("Can't load xml: " . $this->sourceFile);}$v3d788fa62d7c185a1bee4c9147ee1091 = new DOMXPath($v9a09b4dfda82e3e665e31092d1c3ec8d);if (!$v6a992d5529f459a44fee58c733255e86 = $v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/indexes/index[@name='{$v14374754c27bc1eef6a7e737213600e3}']")->item(0)) {throw new coreException("Cannot change index {$v14374754c27bc1eef6a7e737213600e3} in table {$v80071f37861c360a27b7327e132c911a}");}$v54ab67a5a309953d86da71541c0723c0 = "ALTER TABLE `{$v80071f37861c360a27b7327e132c911a}` ADD ";$va83af96ce0bc256deeb3ce660dcebacc = $v6a992d5529f459a44fee58c733255e86->getAttribute('type');if ($va83af96ce0bc256deeb3ce660dcebacc) {if ($va83af96ce0bc256deeb3ce660dcebacc == 'UNIQUE') {$v54ab67a5a309953d86da71541c0723c0 .= 'UNIQUE';}}else {$v54ab67a5a309953d86da71541c0723c0 .= 'INDEX';}if ($v14374754c27bc1eef6a7e737213600e3) {$v54ab67a5a309953d86da71541c0723c0 .= " `{$v14374754c27bc1eef6a7e737213600e3}`";}if ($v6a992d5529f459a44fee58c733255e86->getElementsByTagName('field')->length) {$v69fe4aec8073954bf273e3113edd24cf = $v6a992d5529f459a44fee58c733255e86->getElementsByTagName('field');$v339cc492c232e5b3a1242dcbf6240e04 = '';$v865c0c0b4ab0e063e5caa3387c1a8741 = 1;foreach ($v69fe4aec8073954bf273e3113edd24cf as $v06e3d36fa30cea095545139854ad1fb9) {$v319e2726bcc98302437312a8ebfe9deb = "`{$v06e3d36fa30cea095545139854ad1fb9->nodeValue}`";$v0f1a6fa1e9e0963e1ac389661ba0b603 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('length');if ($v0f1a6fa1e9e0963e1ac389661ba0b603) {$v319e2726bcc98302437312a8ebfe9deb .= "({$v0f1a6fa1e9e0963e1ac389661ba0b603})";}if ($v865c0c0b4ab0e063e5caa3387c1a8741 == $v69fe4aec8073954bf273e3113edd24cf->length) {$v339cc492c232e5b3a1242dcbf6240e04 .= $v319e2726bcc98302437312a8ebfe9deb;}else {$v339cc492c232e5b3a1242dcbf6240e04 .= "{$v319e2726bcc98302437312a8ebfe9deb},";}$v865c0c0b4ab0e063e5caa3387c1a8741++;}$v54ab67a5a309953d86da71541c0723c0 .= " ({$v339cc492c232e5b3a1242dcbf6240e04})";}if ($veca07335a33c5aeb5e1bc7c98b4b9d80 == 'modify') {if ($v6a992d5529f459a44fee58c733255e86->getElementsByTagName('field')->length) {$v69fe4aec8073954bf273e3113edd24cf = $v6a992d5529f459a44fee58c733255e86->getElementsByTagName('field');foreach ($v69fe4aec8073954bf273e3113edd24cf as $v06e3d36fa30cea095545139854ad1fb9) {$v319e2726bcc98302437312a8ebfe9deb = $v06e3d36fa30cea095545139854ad1fb9->nodeValue;$v3677ab7adaf00725e9fdbaed503a94e3 =       $v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@field='{$v319e2726bcc98302437312a8ebfe9deb}']")->item(0);if ($v3677ab7adaf00725e9fdbaed503a94e3) {$v4d5fdbc896088855bd8a568b5ffd9abb = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('name');if ($v4d5fdbc896088855bd8a568b5ffd9abb) {try {$this->connection->queryResult("ALTER TABLE `{$v80071f37861c360a27b7327e132c911a}` DROP FOREIGN KEY `{$v4d5fdbc896088855bd8a568b5ffd9abb}`");}catch (databaseException $v42552b1f133f9f8eb406d4f306ea9fd1) {}}}}}$this->connection->queryResult("ALTER TABLE `{$v80071f37861c360a27b7327e132c911a}` DROP INDEX `{$v14374754c27bc1eef6a7e737213600e3}`");$v260ca9dd8a4577fc00b7bd5810298076 = true;try {$this->connection->queryResult($v54ab67a5a309953d86da71541c0723c0);}catch (Exception $ve1671797c52e15f763380b45e841ec32) {$this->reportError($ve1671797c52e15f763380b45e841ec32->getMessage());$v260ca9dd8a4577fc00b7bd5810298076 = false;}if ($v260ca9dd8a4577fc00b7bd5810298076) {$this->writeLog("Data base table ({$v80071f37861c360a27b7327e132c911a}) index ({$v14374754c27bc1eef6a7e737213600e3}) has been changed");}if ($v6a992d5529f459a44fee58c733255e86->getElementsByTagName('field')->length) {$v69fe4aec8073954bf273e3113edd24cf = $v6a992d5529f459a44fee58c733255e86->getElementsByTagName('field');foreach ($v69fe4aec8073954bf273e3113edd24cf as $v06e3d36fa30cea095545139854ad1fb9) {$v319e2726bcc98302437312a8ebfe9deb = $v06e3d36fa30cea095545139854ad1fb9->nodeValue;$v3677ab7adaf00725e9fdbaed503a94e3 =       $v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@field='{$v319e2726bcc98302437312a8ebfe9deb}']")->item(0);if ($v3677ab7adaf00725e9fdbaed503a94e3) {$v4d5fdbc896088855bd8a568b5ffd9abb = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('name');if ($v4d5fdbc896088855bd8a568b5ffd9abb) {$this->createTableConstraint($v80071f37861c360a27b7327e132c911a, $v4d5fdbc896088855bd8a568b5ffd9abb, 'add');}}}}}else {$v260ca9dd8a4577fc00b7bd5810298076 = true;try {$this->connection->queryResult($v54ab67a5a309953d86da71541c0723c0);}catch (Exception $ve1671797c52e15f763380b45e841ec32) {$this->reportError($ve1671797c52e15f763380b45e841ec32->getMessage());$v260ca9dd8a4577fc00b7bd5810298076 = false;}if ($v260ca9dd8a4577fc00b7bd5810298076) {$this->writeLog("Data base table ({$v80071f37861c360a27b7327e132c911a}) index ({$v14374754c27bc1eef6a7e737213600e3}) has been created");}}}private function createTableConstraint($v80071f37861c360a27b7327e132c911a, $v4d5fdbc896088855bd8a568b5ffd9abb, $veca07335a33c5aeb5e1bc7c98b4b9d80) {$v9a09b4dfda82e3e665e31092d1c3ec8d = new DOMDocument();if (!$v9a09b4dfda82e3e665e31092d1c3ec8d->load($this->sourceFile)) {throw new coreException("Can't load xml: " . $this->sourceFile);}$v3d788fa62d7c185a1bee4c9147ee1091 = new DOMXPath($v9a09b4dfda82e3e665e31092d1c3ec8d);if (!$v3677ab7adaf00725e9fdbaed503a94e3 =    $v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@name='{$v4d5fdbc896088855bd8a568b5ffd9abb}']")->item(0)) {throw new coreException("Cannot change constraint {$v4d5fdbc896088855bd8a568b5ffd9abb} in table {$v80071f37861c360a27b7327e132c911a}");}if ($veca07335a33c5aeb5e1bc7c98b4b9d80 == 'modify') {try {$this->connection->queryResult("ALTER TABLE `{$v80071f37861c360a27b7327e132c911a}` DROP FOREIGN KEY `{$v4d5fdbc896088855bd8a568b5ffd9abb}`");}catch (databaseException $v42552b1f133f9f8eb406d4f306ea9fd1) {}}$v0480ae49c25d260515a7ddff4de63231 = "ALTER TABLE `{$v80071f37861c360a27b7327e132c911a}` ADD CONSTRAINT";$v0480ae49c25d260515a7ddff4de63231 .= " `{$v4d5fdbc896088855bd8a568b5ffd9abb}`";$vfd40c91ee81d59fccbcab8644500e3e4 = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('field');if ($vfd40c91ee81d59fccbcab8644500e3e4) {$v0480ae49c25d260515a7ddff4de63231 .= " FOREIGN KEY (`{$vfd40c91ee81d59fccbcab8644500e3e4}`)";}$v9b992b703884cf36b8cad1966fe086f9 = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('ref-table');if ($v9b992b703884cf36b8cad1966fe086f9) {$v0480ae49c25d260515a7ddff4de63231 .= " REFERENCES `{$v9b992b703884cf36b8cad1966fe086f9}`";}$v1aaf3ab1a76a2b4e7a6bf784293cc4df = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('ref-field');if ($v1aaf3ab1a76a2b4e7a6bf784293cc4df) {$v0480ae49c25d260515a7ddff4de63231 .= " (`{$v1aaf3ab1a76a2b4e7a6bf784293cc4df}`)";}$v269738db81007d986968bb0e3e20768b = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('on-delete');if ($v269738db81007d986968bb0e3e20768b) {$v0480ae49c25d260515a7ddff4de63231 .= " ON DELETE {$v269738db81007d986968bb0e3e20768b}";}$v844db8803d63e7e046c30d82b772d410 = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('on-update');if ($v844db8803d63e7e046c30d82b772d410) {$v0480ae49c25d260515a7ddff4de63231 .= " ON UPDATE {$v844db8803d63e7e046c30d82b772d410}";}$v260ca9dd8a4577fc00b7bd5810298076 = true;try {$this->connection->queryResult($v0480ae49c25d260515a7ddff4de63231);}catch (Exception $ve1671797c52e15f763380b45e841ec32) {$this->reportError($ve1671797c52e15f763380b45e841ec32->getMessage());$v260ca9dd8a4577fc00b7bd5810298076 = false;}if ($v260ca9dd8a4577fc00b7bd5810298076) {if ($veca07335a33c5aeb5e1bc7c98b4b9d80 == 'add') {$this->writeLog("Data base table ({$v80071f37861c360a27b7327e132c911a}) constraint ({$v4d5fdbc896088855bd8a568b5ffd9abb}) has been created");}else {$this->writeLog("Data base table ({$v80071f37861c360a27b7327e132c911a}) constraint ({$v4d5fdbc896088855bd8a568b5ffd9abb}) has been changed");}}if ($v269738db81007d986968bb0e3e20768b) {if ($v269738db81007d986968bb0e3e20768b == 'SET NULL') {$vac5c74b64b4b8352ef2f181affb5ac2a = <<<END
					UPDATE `{$v80071f37861c360a27b7327e132c911a}`
					SET {$vfd40c91ee81d59fccbcab8644500e3e4} = null
					WHERE {$vfd40c91ee81d59fccbcab8644500e3e4} NOT IN (
						SELECT {$v1aaf3ab1a76a2b4e7a6bf784293cc4df}
						FROM {$v9b992b703884cf36b8cad1966fe086f9}
					)
END;    }if ($v269738db81007d986968bb0e3e20768b == 'CASCADE') {$vac5c74b64b4b8352ef2f181affb5ac2a = <<<END
					DELETE FROM `{$v80071f37861c360a27b7327e132c911a}`
					WHERE {$vfd40c91ee81d59fccbcab8644500e3e4} NOT IN (
						SELECT {$v1aaf3ab1a76a2b4e7a6bf784293cc4df}
						FROM {$v9b992b703884cf36b8cad1966fe086f9}
					)
END;    }$this->connection->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);}}public function restoreDataBase() {$vdac681f343395a626d61c242bc234b54 = new DOMDocument();if (!$vdac681f343395a626d61c242bc234b54->load($this->sourceFile)) {throw new coreException("Can't load xml: " . $this->sourceFile);}$v719ad8631f632a1d7d6ef89cbac6ad69 = new DOMDocument();if (!$v719ad8631f632a1d7d6ef89cbac6ad69->load($this->destinationFile)) {throw new coreException("Can't load xml: " . $this->destinationFile);}$va040e23a50a670640b52a1f4b02f5b1c = new DOMXPath($v719ad8631f632a1d7d6ef89cbac6ad69);$vc9de3a74b6560521b099da860eea7def = new DOMXPath($vdac681f343395a626d61c242bc234b54);$v966d7944778235504560d811fddd4788 = $vdac681f343395a626d61c242bc234b54->getElementsByTagName('table');foreach ($v966d7944778235504560d811fddd4788 as $ve49a5d4bbdb9fdff0af4ece2f3eaec67) {$v80071f37861c360a27b7327e132c911a = $ve49a5d4bbdb9fdff0af4ece2f3eaec67->getAttribute('name');if ($this->inParts && isset($this->state[$v80071f37861c360a27b7327e132c911a]['complete']) && $this->state[$v80071f37861c360a27b7327e132c911a]['complete']) {continue;}$this->connection->queryResult('SET foreign_key_checks = 0');$this->writeLog("Start checking table {$v80071f37861c360a27b7327e132c911a}");if (!$va040e23a50a670640b52a1f4b02f5b1c->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']")->length) {$this->createDataBaseTable($v80071f37861c360a27b7327e132c911a);}else {$v770c639e20ac2f19c5ae0da373080e25 = $this->connection->queryResult("SELECT count(*) FROM `{$v80071f37861c360a27b7327e132c911a}`");$v770c639e20ac2f19c5ae0da373080e25->setFetchType(IQueryResult::FETCH_ROW);$va516bbcfe024488c3bc26c21e7c2ae6b = 0;if ($v770c639e20ac2f19c5ae0da373080e25->length() > 0) {$v54851b009c5c647ca3e77cc517b8c76c = $v770c639e20ac2f19c5ae0da373080e25->fetch();$va516bbcfe024488c3bc26c21e7c2ae6b = array_shift($v54851b009c5c647ca3e77cc517b8c76c);}if ($va516bbcfe024488c3bc26c21e7c2ae6b > 10000) {$v6ae39f7819d3b799bf81a86b76525767 = $this->checkTableRestore($v80071f37861c360a27b7327e132c911a);if ($this->inParts) {end($this->state);$this->completed = ((key($this->state) == $v80071f37861c360a27b7327e132c911a) && $v6ae39f7819d3b799bf81a86b76525767);return $this->completed;}continue;}$v0499bf152a9954b9cf9981fd078eb0b8 = $ve49a5d4bbdb9fdff0af4ece2f3eaec67->getAttribute('engine');if (!$va040e23a50a670640b52a1f4b02f5b1c->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}' and @engine='{$v0499bf152a9954b9cf9981fd078eb0b8}']")->item(0)) {$this->changeTableEngine($v80071f37861c360a27b7327e132c911a, $v0499bf152a9954b9cf9981fd078eb0b8);}$vd5cbc6798435d4fe67a443679b239dd6 = $ve49a5d4bbdb9fdff0af4ece2f3eaec67->getAttribute('charset');if (!$va040e23a50a670640b52a1f4b02f5b1c->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}' and @charset='{$vd5cbc6798435d4fe67a443679b239dd6}']")->item(0)) {$this->changeTableCharset($v80071f37861c360a27b7327e132c911a, $vd5cbc6798435d4fe67a443679b239dd6);}$vc7ec484aa0cc70ef637682bd6e5bfe2e = $ve49a5d4bbdb9fdff0af4ece2f3eaec67->getElementsByTagName('fields');if (is_object($vc7ec484aa0cc70ef637682bd6e5bfe2e->item(0))) {$v69fe4aec8073954bf273e3113edd24cf = $vc7ec484aa0cc70ef637682bd6e5bfe2e->item(0)->getElementsByTagName('field');$v2d67516257efbfcad40584989efe8855 = $ve49a5d4bbdb9fdff0af4ece2f3eaec67->getElementsByTagName('indexes');if (is_object($v2d67516257efbfcad40584989efe8855->item(0))) {$v19f4f7555bff5bdba89329810cd71981 = $v2d67516257efbfcad40584989efe8855->item(0)->getElementsByTagName('index');foreach ($v19f4f7555bff5bdba89329810cd71981 as $v6a992d5529f459a44fee58c733255e86) {if ($v6a992d5529f459a44fee58c733255e86->getAttribute('type') == 'PRIMARY') {$v24945aa5fabc80446599d7760348d114 = $v6a992d5529f459a44fee58c733255e86->getElementsByTagName('field')->item(0)->nodeValue;if ($v24945aa5fabc80446599d7760348d114) {$v356e7a3012b22d8aa996dca45ccddbb1 =           $va040e23a50a670640b52a1f4b02f5b1c->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/indexes/index[@type='PRIMARY']/field")->item(0);if ($v356e7a3012b22d8aa996dca45ccddbb1) {$vb5cf8e26a05f5b35fcd36ef010257265 = $v356e7a3012b22d8aa996dca45ccddbb1->nodeValue;if ($v24945aa5fabc80446599d7760348d114 != $vb5cf8e26a05f5b35fcd36ef010257265) {$v46cf21563f12adae91fceb7f7e8aa3ed = $va040e23a50a670640b52a1f4b02f5b1c->query(             "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name = '{$vb5cf8e26a05f5b35fcd36ef010257265}' and @increment='1']"            )->item(0);if ($v46cf21563f12adae91fceb7f7e8aa3ed) {$this->createTableField($v80071f37861c360a27b7327e132c911a, $vb5cf8e26a05f5b35fcd36ef010257265, 'modify');}$v581c24a0b50b73b594671e436e10cf27 = $va040e23a50a670640b52a1f4b02f5b1c->query(             "//table/constraints/constraint[@ref-table='{$v80071f37861c360a27b7327e132c911a}' and @ref-field='{$vb5cf8e26a05f5b35fcd36ef010257265}']"            );if ($v581c24a0b50b73b594671e436e10cf27) {foreach ($v581c24a0b50b73b594671e436e10cf27 as $v3677ab7adaf00725e9fdbaed503a94e3) {$v4d5fdbc896088855bd8a568b5ffd9abb = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('name');$vefc6d526040cc303278e28b1d806cebe =               $v3677ab7adaf00725e9fdbaed503a94e3->parentNode->parentNode->getAttribute('name');try {$this->connection->queryResult(                "ALTER TABLE `{$vefc6d526040cc303278e28b1d806cebe}` DROP FOREIGN KEY `{$v4d5fdbc896088855bd8a568b5ffd9abb}`"               );}catch (databaseException $v42552b1f133f9f8eb406d4f306ea9fd1) {}}}$this->connection->queryResult("ALTER TABLE `{$v80071f37861c360a27b7327e132c911a}` DROP PRIMARY KEY");$this->connection->queryResult(             "ALTER TABLE `{$v80071f37861c360a27b7327e132c911a}` ADD PRIMARY KEY ({$v24945aa5fabc80446599d7760348d114})"            );}}else {$this->connection->queryResult(            "ALTER TABLE `{$v80071f37861c360a27b7327e132c911a}` ADD PRIMARY KEY ({$v24945aa5fabc80446599d7760348d114})"           );}}}}}foreach ($v69fe4aec8073954bf273e3113edd24cf as $v06e3d36fa30cea095545139854ad1fb9) {$v972bf3f05d14ffbdb817bef60638ff00 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('name');if (!$v972bf3f05d14ffbdb817bef60638ff00) {continue;}if (!$va040e23a50a670640b52a1f4b02f5b1c->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}']")->length) {$this->createTableField($v80071f37861c360a27b7327e132c911a, $v972bf3f05d14ffbdb817bef60638ff00, 'add');continue;}$v833750ac635fcc57dc33ecafe365f9a7 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('type');if ($v833750ac635fcc57dc33ecafe365f9a7) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(         "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}' and @type='{$v833750ac635fcc57dc33ecafe365f9a7}']"        )->length) {$this->createTableField($v80071f37861c360a27b7327e132c911a, $v972bf3f05d14ffbdb817bef60638ff00, 'modify');}}$v59ebf8e686724f0cf779fb2a9ecf59c2 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('size');if ($v59ebf8e686724f0cf779fb2a9ecf59c2) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(         "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}' and @size='{$v59ebf8e686724f0cf779fb2a9ecf59c2}']"        )->length) {$this->createTableField($v80071f37861c360a27b7327e132c911a, $v972bf3f05d14ffbdb817bef60638ff00, 'modify');}}if ($v06e3d36fa30cea095545139854ad1fb9->getElementsByTagName('option')->length) {$v93da65a9fd0004d9477aeac024e08e15 = $v06e3d36fa30cea095545139854ad1fb9->getElementsByTagName('option');foreach ($v93da65a9fd0004d9477aeac024e08e15 as $vef3e30e070f70244fd6578d88a6b77ac) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(          "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}'][option ='{$vef3e30e070f70244fd6578d88a6b77ac->nodeValue}']"         )->length) {$this->createTableField($v80071f37861c360a27b7327e132c911a, $v972bf3f05d14ffbdb817bef60638ff00, 'modify');}}}$v33045d9ddb408d27dbcbc3ca53d5583e = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('attributes');if ($v33045d9ddb408d27dbcbc3ca53d5583e) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(         "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}' and @attributes='{$v33045d9ddb408d27dbcbc3ca53d5583e}']"        )->length) {$this->createTableField($v80071f37861c360a27b7327e132c911a, $v972bf3f05d14ffbdb817bef60638ff00, 'modify');}}$v1f662954e1ee120a4aab8716234e109a = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('not-null');if ($v1f662954e1ee120a4aab8716234e109a) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(         "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}' and @not-null='{$v1f662954e1ee120a4aab8716234e109a}']"        )->length) {$this->createTableField($v80071f37861c360a27b7327e132c911a, $v972bf3f05d14ffbdb817bef60638ff00, 'modify');}}if ($v06e3d36fa30cea095545139854ad1fb9->hasAttribute('default')) {$vb40b5e5897a4cdfa5bb06346fa44deb3 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('default');if (!$va040e23a50a670640b52a1f4b02f5b1c->query(         "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}' and @default='{$vb40b5e5897a4cdfa5bb06346fa44deb3}']"        )->length) {$this->createTableField($v80071f37861c360a27b7327e132c911a, $v972bf3f05d14ffbdb817bef60638ff00, 'modify');}}$vdb70917e4a5b25354aed4db9dadb0afc = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('increment');if ($vdb70917e4a5b25354aed4db9dadb0afc) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(         "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}' and @increment='{$vdb70917e4a5b25354aed4db9dadb0afc}']"        )->length) {$this->createTableField($v80071f37861c360a27b7327e132c911a, $v972bf3f05d14ffbdb817bef60638ff00, 'modify');}}$vf23104cd881ba30152c4981a93d80185 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('comment');if ($vf23104cd881ba30152c4981a93d80185) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(         "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}' and @comment='{$vf23104cd881ba30152c4981a93d80185}']"        )->length) {$this->createTableField($v80071f37861c360a27b7327e132c911a, $v972bf3f05d14ffbdb817bef60638ff00, 'modify');}}}}$v2d67516257efbfcad40584989efe8855 = $ve49a5d4bbdb9fdff0af4ece2f3eaec67->getElementsByTagName('indexes');$v52affc459d0108fbb6588df5ef889343 = $va040e23a50a670640b52a1f4b02f5b1c->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}' and @charset='{$vd5cbc6798435d4fe67a443679b239dd6}']/indexes");if (is_object($v2d67516257efbfcad40584989efe8855->item(0))) {$v19f4f7555bff5bdba89329810cd71981 = $v2d67516257efbfcad40584989efe8855->item(0)->getElementsByTagName('index');foreach ($v19f4f7555bff5bdba89329810cd71981 as $v6a992d5529f459a44fee58c733255e86) {$v14374754c27bc1eef6a7e737213600e3 = $v6a992d5529f459a44fee58c733255e86->getAttribute('name');if ($v14374754c27bc1eef6a7e737213600e3) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/indexes/index[@name='{$v14374754c27bc1eef6a7e737213600e3}']")->length) {$this->createTableIndex($v80071f37861c360a27b7327e132c911a, $v14374754c27bc1eef6a7e737213600e3, 'add');continue;}$va83af96ce0bc256deeb3ce660dcebacc = $v6a992d5529f459a44fee58c733255e86->getAttribute('type');if ($va83af96ce0bc256deeb3ce660dcebacc) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(          "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/indexes/index[@name='{$v14374754c27bc1eef6a7e737213600e3}' and @type='{$va83af96ce0bc256deeb3ce660dcebacc}']"         )->length) {$this->createTableIndex($v80071f37861c360a27b7327e132c911a, $v14374754c27bc1eef6a7e737213600e3, 'modify');}}if ($v6a992d5529f459a44fee58c733255e86->getElementsByTagName('field')->length) {$v69fe4aec8073954bf273e3113edd24cf = $v6a992d5529f459a44fee58c733255e86->getElementsByTagName('field');foreach ($v69fe4aec8073954bf273e3113edd24cf as $v06e3d36fa30cea095545139854ad1fb9) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(           "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/indexes/index[@name='{$v14374754c27bc1eef6a7e737213600e3}'][field = '{$v06e3d36fa30cea095545139854ad1fb9->nodeValue}']"          )->length) {$this->createTableIndex($v80071f37861c360a27b7327e132c911a, $v14374754c27bc1eef6a7e737213600e3, 'modify');continue;}$v0f1a6fa1e9e0963e1ac389661ba0b603 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('length');if ($v0f1a6fa1e9e0963e1ac389661ba0b603) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(            "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/indexes/index[@name='{$v14374754c27bc1eef6a7e737213600e3}'][field[@length='{$v0f1a6fa1e9e0963e1ac389661ba0b603}'] ='{$v06e3d36fa30cea095545139854ad1fb9->nodeValue}']"           )->length) {$this->createTableIndex($v80071f37861c360a27b7327e132c911a, $v14374754c27bc1eef6a7e737213600e3, 'modify');}}}}}}}if (is_object($v52affc459d0108fbb6588df5ef889343->item(0))) {$vdc1a8627d84adb17cf530cd43a9e8991 = $v52affc459d0108fbb6588df5ef889343->item(0)->getElementsByTagName('index');foreach ($vdc1a8627d84adb17cf530cd43a9e8991 as $v6a992d5529f459a44fee58c733255e86) {$v14374754c27bc1eef6a7e737213600e3 = $v6a992d5529f459a44fee58c733255e86->getAttribute('name');if (!$v14374754c27bc1eef6a7e737213600e3) {continue;}$ve8f2f3cfe81eb1728b3364fcfdb4aee0 = $vc9de3a74b6560521b099da860eea7def->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}' and @charset='{$vd5cbc6798435d4fe67a443679b239dd6}']/indexes/index[@name = '{$v14374754c27bc1eef6a7e737213600e3}']");if ($ve8f2f3cfe81eb1728b3364fcfdb4aee0->length > 0) {continue;}$this->dropIndex($v80071f37861c360a27b7327e132c911a, $v14374754c27bc1eef6a7e737213600e3);}}$vedc2dd68d1be92a82a9d8362bbae0895 = $ve49a5d4bbdb9fdff0af4ece2f3eaec67->getElementsByTagName('constraints');if (is_object($vedc2dd68d1be92a82a9d8362bbae0895->item(0))) {$v581c24a0b50b73b594671e436e10cf27 = $vedc2dd68d1be92a82a9d8362bbae0895->item(0)->getElementsByTagName('constraint');foreach ($v581c24a0b50b73b594671e436e10cf27 as $v3677ab7adaf00725e9fdbaed503a94e3) {$v4d5fdbc896088855bd8a568b5ffd9abb = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('name');if ($v4d5fdbc896088855bd8a568b5ffd9abb) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@name='{$v4d5fdbc896088855bd8a568b5ffd9abb}']")         ->item(0)) {$this->createTableConstraint($v80071f37861c360a27b7327e132c911a, $v4d5fdbc896088855bd8a568b5ffd9abb, 'add');continue;}$vfd40c91ee81d59fccbcab8644500e3e4 = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('field');if ($vfd40c91ee81d59fccbcab8644500e3e4) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(          "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@name='{$v4d5fdbc896088855bd8a568b5ffd9abb}' and @field='{$vfd40c91ee81d59fccbcab8644500e3e4}']"         )->item(0)) {$this->createTableConstraint($v80071f37861c360a27b7327e132c911a, $v4d5fdbc896088855bd8a568b5ffd9abb, 'modify');}}$v9b992b703884cf36b8cad1966fe086f9 = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('ref-table');if ($v9b992b703884cf36b8cad1966fe086f9) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(          "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@name='{$v4d5fdbc896088855bd8a568b5ffd9abb}' and @ref-table='{$v9b992b703884cf36b8cad1966fe086f9}']"         )->item(0)) {$this->createTableConstraint($v80071f37861c360a27b7327e132c911a, $v4d5fdbc896088855bd8a568b5ffd9abb, 'modify');}}$v1aaf3ab1a76a2b4e7a6bf784293cc4df = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('ref-field');if ($v1aaf3ab1a76a2b4e7a6bf784293cc4df) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(          "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@name='{$v4d5fdbc896088855bd8a568b5ffd9abb}' and @ref-field='{$v1aaf3ab1a76a2b4e7a6bf784293cc4df}']"         )->item(0)) {$this->createTableConstraint($v80071f37861c360a27b7327e132c911a, $v4d5fdbc896088855bd8a568b5ffd9abb, 'modify');}}$v269738db81007d986968bb0e3e20768b = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('on-delete');if ($v269738db81007d986968bb0e3e20768b) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(          "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@name='{$v4d5fdbc896088855bd8a568b5ffd9abb}' and @on-delete='{$v269738db81007d986968bb0e3e20768b}']"         )->item(0)) {$this->createTableConstraint($v80071f37861c360a27b7327e132c911a, $v4d5fdbc896088855bd8a568b5ffd9abb, 'modify');}}$v844db8803d63e7e046c30d82b772d410 = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('on-update');if ($v844db8803d63e7e046c30d82b772d410) {if (!$va040e23a50a670640b52a1f4b02f5b1c->query(          "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@name='{$v4d5fdbc896088855bd8a568b5ffd9abb}' and @on-update='{$v844db8803d63e7e046c30d82b772d410}']"         )->item(0)) {$this->createTableConstraint($v80071f37861c360a27b7327e132c911a, $v4d5fdbc896088855bd8a568b5ffd9abb, 'modify');}}}}}}$this->connection->queryResult('SET foreign_key_checks = 1');if ($this->inParts) {$this->state[$v80071f37861c360a27b7327e132c911a]['complete'] = true;end($this->state);$this->completed = (key($this->state) == $v80071f37861c360a27b7327e132c911a);return $this->completed;}}}protected function prepareTable($v80071f37861c360a27b7327e132c911a) {if ($this->inParts) {if (isset($this->state[$v80071f37861c360a27b7327e132c911a]['info'])) {return $this->state[$v80071f37861c360a27b7327e132c911a]['info'];}}$v9a09b4dfda82e3e665e31092d1c3ec8d = new DOMDocument();$v9a09b4dfda82e3e665e31092d1c3ec8d->load($this->sourceFile);$v3d788fa62d7c185a1bee4c9147ee1091 = new DOMXPath($v9a09b4dfda82e3e665e31092d1c3ec8d);$vaa9c62903e6c715017ac9e17affc86c8 = $this->restoreShowCreateTable($v80071f37861c360a27b7327e132c911a);$v6bc414d01b568a956ec80b9451c47dd2 = $v80071f37861c360a27b7327e132c911a . '_temp';while (true) {$v260ca9dd8a4577fc00b7bd5810298076 = false;try {$this->connection->queryResult("SHOW CREATE TABLE `{$v6bc414d01b568a956ec80b9451c47dd2}`");}catch (Exception $ve1671797c52e15f763380b45e841ec32) {$v260ca9dd8a4577fc00b7bd5810298076 = true;}if (!$v260ca9dd8a4577fc00b7bd5810298076) {$result = $this->connection->queryResult("SHOW CREATE TABLE `{$v6bc414d01b568a956ec80b9451c47dd2}`");foreach ($result as $vf1965a857bc285d26fe22023aa5ab50d) {$v05b32caf5bda74d902a7d17bcd503c4d = str_replace($v6bc414d01b568a956ec80b9451c47dd2, $v80071f37861c360a27b7327e132c911a, $vf1965a857bc285d26fe22023aa5ab50d[1]);$v05b32caf5bda74d902a7d17bcd503c4d = preg_replace("/\s/", '', $v05b32caf5bda74d902a7d17bcd503c4d);$v2b0e19a624ce9c16fe44c27f349421f3 = preg_replace("/\s/", '', $vaa9c62903e6c715017ac9e17affc86c8);if (stripos($v2b0e19a624ce9c16fe44c27f349421f3, $v05b32caf5bda74d902a7d17bcd503c4d) !== false) {$this->connection->query("DROP TABLE `{$v6bc414d01b568a956ec80b9451c47dd2}`");$v260ca9dd8a4577fc00b7bd5810298076 = true;}}}if ($v260ca9dd8a4577fc00b7bd5810298076) {break;}$v6bc414d01b568a956ec80b9451c47dd2 .= '1';}if ($v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint")->length) {$v581c24a0b50b73b594671e436e10cf27 = $v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint");foreach ($v581c24a0b50b73b594671e436e10cf27 as $v3677ab7adaf00725e9fdbaed503a94e3) {$v4d5fdbc896088855bd8a568b5ffd9abb = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('name');try {$this->connection->query("ALTER TABLE `{$v80071f37861c360a27b7327e132c911a}` DROP FOREIGN KEY `{$v4d5fdbc896088855bd8a568b5ffd9abb}`");}catch (databaseException $v42552b1f133f9f8eb406d4f306ea9fd1) {}$v269738db81007d986968bb0e3e20768b = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('on-delete');if ($v269738db81007d986968bb0e3e20768b) {$vfd40c91ee81d59fccbcab8644500e3e4 = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('field');$v9b992b703884cf36b8cad1966fe086f9 = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('ref-table');$v1aaf3ab1a76a2b4e7a6bf784293cc4df = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('ref-field');if ($v269738db81007d986968bb0e3e20768b == 'SET NULL') {$vac5c74b64b4b8352ef2f181affb5ac2a = <<<END
							UPDATE `{$v80071f37861c360a27b7327e132c911a}`
							SET {$vfd40c91ee81d59fccbcab8644500e3e4} = null
							WHERE {$vfd40c91ee81d59fccbcab8644500e3e4} NOT IN (
								SELECT {$v1aaf3ab1a76a2b4e7a6bf784293cc4df}
								FROM {$v9b992b703884cf36b8cad1966fe086f9}
							)
END;      }if ($v269738db81007d986968bb0e3e20768b == 'CASCADE') {$vac5c74b64b4b8352ef2f181affb5ac2a = <<<END
							DELETE FROM `{$v80071f37861c360a27b7327e132c911a}`
							WHERE {$vfd40c91ee81d59fccbcab8644500e3e4} NOT IN (
								SELECT {$v1aaf3ab1a76a2b4e7a6bf784293cc4df}
								FROM {$v9b992b703884cf36b8cad1966fe086f9}
							)
END;      }try {$this->connection->query($vac5c74b64b4b8352ef2f181affb5ac2a);}catch (Exception $ve1671797c52e15f763380b45e841ec32) {}}}}$vaa9c62903e6c715017ac9e17affc86c8 = str_replace("CREATE TABLE `{$v80071f37861c360a27b7327e132c911a}`", "CREATE TABLE `{$v6bc414d01b568a956ec80b9451c47dd2}`", $vaa9c62903e6c715017ac9e17affc86c8);$this->connection->query($vaa9c62903e6c715017ac9e17affc86c8);$v770c639e20ac2f19c5ae0da373080e25 = $this->connection->queryResult("SELECT count(*) FROM `{$v80071f37861c360a27b7327e132c911a}`");$v770c639e20ac2f19c5ae0da373080e25->setFetchType(IQueryResult::FETCH_ROW);$va516bbcfe024488c3bc26c21e7c2ae6b = 0;if ($v770c639e20ac2f19c5ae0da373080e25->length() > 0) {$v54851b009c5c647ca3e77cc517b8c76c = $v770c639e20ac2f19c5ae0da373080e25->fetch();$va516bbcfe024488c3bc26c21e7c2ae6b = array_shift($v54851b009c5c647ca3e77cc517b8c76c);}$vcaf9b6b99962bf5c2264824231d7a40c = [    'temp_table' => $v6bc414d01b568a956ec80b9451c47dd2,    'count_rows' => $va516bbcfe024488c3bc26c21e7c2ae6b,   ];if ($this->inParts) {$this->state[$v80071f37861c360a27b7327e132c911a]['info'] = $vcaf9b6b99962bf5c2264824231d7a40c;}return $vcaf9b6b99962bf5c2264824231d7a40c;}protected function restoreTableInParts($v80071f37861c360a27b7327e132c911a) {$vcaf9b6b99962bf5c2264824231d7a40c = $this->prepareTable($v80071f37861c360a27b7327e132c911a);$v6bc414d01b568a956ec80b9451c47dd2 = $vcaf9b6b99962bf5c2264824231d7a40c['temp_table'];$va516bbcfe024488c3bc26c21e7c2ae6b = $vcaf9b6b99962bf5c2264824231d7a40c['count_rows'];$vd05b6ed7d2345020440df396d6da7f73 = $this->getNecessaryFields($v80071f37861c360a27b7327e132c911a);$vd05b6ed7d2345020440df396d6da7f73 = implode(', ', $vd05b6ed7d2345020440df396d6da7f73);if ($this->inParts) {$v7a86c157ee9713c34fbd7a1ee40f0c5a = isset($this->state[$v80071f37861c360a27b7327e132c911a]['info']['offset'])     ? $this->state[$v80071f37861c360a27b7327e132c911a]['info']['offset']     : 0;$this->connection->query(     "INSERT INTO `{$v6bc414d01b568a956ec80b9451c47dd2}` ({$vd05b6ed7d2345020440df396d6da7f73}) (SELECT {$vd05b6ed7d2345020440df396d6da7f73} FROM {$v80071f37861c360a27b7327e132c911a} LIMIT {$this->limit} OFFSET {$v7a86c157ee9713c34fbd7a1ee40f0c5a})"    );}else {$v2764ca9d34e90313978d044f27ae433b = ceil($va516bbcfe024488c3bc26c21e7c2ae6b / $this->limit);for ($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v2764ca9d34e90313978d044f27ae433b;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$v7a86c157ee9713c34fbd7a1ee40f0c5a = $v865c0c0b4ab0e063e5caa3387c1a8741 * $this->limit;$this->connection->query(      "INSERT INTO `{$v6bc414d01b568a956ec80b9451c47dd2}` ({$vd05b6ed7d2345020440df396d6da7f73}) (SELECT {$vd05b6ed7d2345020440df396d6da7f73} FROM {$v80071f37861c360a27b7327e132c911a} LIMIT {$this->limit} OFFSET {$v7a86c157ee9713c34fbd7a1ee40f0c5a})"     );}}$vaf8c17bb4a72f8d0cc8191d9519f34a6 = $this->connection->affectedRows();$vad8a8576a4307920be1bb16930b4ec0a = $this->connection->queryResult("SELECT count(*) FROM `{$v6bc414d01b568a956ec80b9451c47dd2}`");$vad8a8576a4307920be1bb16930b4ec0a->setFetchType(IQueryResult::FETCH_ROW);$v7815232913d5ca8d9b04c4bdb8f72c24 = 0;if ($vad8a8576a4307920be1bb16930b4ec0a->length() > 0) {$v54851b009c5c647ca3e77cc517b8c76c = $vad8a8576a4307920be1bb16930b4ec0a->fetch();$v7815232913d5ca8d9b04c4bdb8f72c24 = array_shift($v54851b009c5c647ca3e77cc517b8c76c);}if ($va516bbcfe024488c3bc26c21e7c2ae6b == $v7815232913d5ca8d9b04c4bdb8f72c24 || $vaf8c17bb4a72f8d0cc8191d9519f34a6 === 0) {$this->connection->query("DROP TABLE `{$v80071f37861c360a27b7327e132c911a}`");$this->connection->query("RENAME TABLE `{$v6bc414d01b568a956ec80b9451c47dd2}` TO `{$v80071f37861c360a27b7327e132c911a}`");$this->writeLog("Data base table ({$v80071f37861c360a27b7327e132c911a}) structure has been updated");if ($this->inParts) {$this->state[$v80071f37861c360a27b7327e132c911a]['complete'] = true;}return true;}if ($this->inParts) {$this->state[$v80071f37861c360a27b7327e132c911a]['info']['offset'] = $v7a86c157ee9713c34fbd7a1ee40f0c5a + $this->limit;$this->writeLog(     "{$v7815232913d5ca8d9b04c4bdb8f72c24}({$va516bbcfe024488c3bc26c21e7c2ae6b}) rows have been updated in table `({$v80071f37861c360a27b7327e132c911a})`, {$vaf8c17bb4a72f8d0cc8191d9519f34a6} rows has been processed in this session"    );}else {$this->reportError(getLabel('label-errors-13059') . $v80071f37861c360a27b7327e132c911a . '/');}return false;}protected function checkTableRestore($v80071f37861c360a27b7327e132c911a) {if ($this->inParts && isset($this->state[$v80071f37861c360a27b7327e132c911a]['info'])) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}$vdac681f343395a626d61c242bc234b54 = new DOMDocument();if (!$vdac681f343395a626d61c242bc234b54->load($this->sourceFile)) {throw new coreException("Can't load xml: " . $this->sourceFile);}$v719ad8631f632a1d7d6ef89cbac6ad69 = new DOMDocument();if (!$v719ad8631f632a1d7d6ef89cbac6ad69->load($this->destinationFile)) {throw new coreException("Can't load xml: " . $this->destinationFile);}$v3d788fa62d7c185a1bee4c9147ee1091 = new DOMXPath($v719ad8631f632a1d7d6ef89cbac6ad69);$v966d7944778235504560d811fddd4788 = $vdac681f343395a626d61c242bc234b54->getElementsByTagName('table');foreach ($v966d7944778235504560d811fddd4788 as $ve49a5d4bbdb9fdff0af4ece2f3eaec67) {if ($ve49a5d4bbdb9fdff0af4ece2f3eaec67->getAttribute('name') == $v80071f37861c360a27b7327e132c911a) {$vaab9e1de16f38176f86d7a92ba337a8d = $ve49a5d4bbdb9fdff0af4ece2f3eaec67;break;}}$vc7ec484aa0cc70ef637682bd6e5bfe2e = $vaab9e1de16f38176f86d7a92ba337a8d->getElementsByTagName('fields');if (is_object($vc7ec484aa0cc70ef637682bd6e5bfe2e->item(0))) {$v69fe4aec8073954bf273e3113edd24cf = $vc7ec484aa0cc70ef637682bd6e5bfe2e->item(0)->getElementsByTagName('field');foreach ($v69fe4aec8073954bf273e3113edd24cf as $v06e3d36fa30cea095545139854ad1fb9) {$v972bf3f05d14ffbdb817bef60638ff00 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('name');if (!$v972bf3f05d14ffbdb817bef60638ff00) {continue;}if (!$v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}']")->length) {$this->createTableField($v80071f37861c360a27b7327e132c911a, $v972bf3f05d14ffbdb817bef60638ff00, 'add');continue;}$v833750ac635fcc57dc33ecafe365f9a7 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('type');if ($v833750ac635fcc57dc33ecafe365f9a7) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(       "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}' and @type='{$v833750ac635fcc57dc33ecafe365f9a7}']"      )->length) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}$v59ebf8e686724f0cf779fb2a9ecf59c2 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('size');if ($v59ebf8e686724f0cf779fb2a9ecf59c2) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(       "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}' and @size='{$v59ebf8e686724f0cf779fb2a9ecf59c2}']"      )->length) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}if ($v06e3d36fa30cea095545139854ad1fb9->getElementsByTagName('option')->length) {$v93da65a9fd0004d9477aeac024e08e15 = $v06e3d36fa30cea095545139854ad1fb9->getElementsByTagName('option');foreach ($v93da65a9fd0004d9477aeac024e08e15 as $vef3e30e070f70244fd6578d88a6b77ac) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(        "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}'][option ='{$vef3e30e070f70244fd6578d88a6b77ac->nodeValue}']"       )->length) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}}$v33045d9ddb408d27dbcbc3ca53d5583e = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('attributes');if ($v33045d9ddb408d27dbcbc3ca53d5583e) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(       "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}' and @attributes='{$v33045d9ddb408d27dbcbc3ca53d5583e}']"      )->length) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}$v1f662954e1ee120a4aab8716234e109a = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('not-null');if ($v1f662954e1ee120a4aab8716234e109a) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(       "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}' and @not-null='{$v1f662954e1ee120a4aab8716234e109a}']"      )->length) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}if ($v06e3d36fa30cea095545139854ad1fb9->hasAttribute('default')) {$vb40b5e5897a4cdfa5bb06346fa44deb3 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('default');if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(       "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}' and @default='{$vb40b5e5897a4cdfa5bb06346fa44deb3}']"      )->length) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}$vdb70917e4a5b25354aed4db9dadb0afc = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('increment');if ($vdb70917e4a5b25354aed4db9dadb0afc) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(       "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}' and @increment='{$vdb70917e4a5b25354aed4db9dadb0afc}']"      )->length) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}$vf23104cd881ba30152c4981a93d80185 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('comment');if ($vf23104cd881ba30152c4981a93d80185) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(       "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field[@name='{$v972bf3f05d14ffbdb817bef60638ff00}' and @comment='{$vf23104cd881ba30152c4981a93d80185}']"      )->length) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}}}$v7e41f53a3c84926d1d7995de56944c27 = $vaab9e1de16f38176f86d7a92ba337a8d->getElementsByTagName('indexes');if (is_object($v7e41f53a3c84926d1d7995de56944c27->item(0))) {$v0ddb9f30e5f4b84581595009098297a7 = $v7e41f53a3c84926d1d7995de56944c27->item(0)->getElementsByTagName('index');foreach ($v0ddb9f30e5f4b84581595009098297a7 as $v6a992d5529f459a44fee58c733255e86) {$v14374754c27bc1eef6a7e737213600e3 = $v6a992d5529f459a44fee58c733255e86->getAttribute('name');if ($v14374754c27bc1eef6a7e737213600e3) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/indexes/index[@name='{$v14374754c27bc1eef6a7e737213600e3}']")->length) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}$va83af96ce0bc256deeb3ce660dcebacc = $v6a992d5529f459a44fee58c733255e86->getAttribute('type');if ($va83af96ce0bc256deeb3ce660dcebacc) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(        "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/indexes/index[@name='{$v14374754c27bc1eef6a7e737213600e3}' and @type='{$va83af96ce0bc256deeb3ce660dcebacc}']"       )->length) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}if ($v6a992d5529f459a44fee58c733255e86->getElementsByTagName('field')->length) {$v69fe4aec8073954bf273e3113edd24cf = $v6a992d5529f459a44fee58c733255e86->getElementsByTagName('field');foreach ($v69fe4aec8073954bf273e3113edd24cf as $v06e3d36fa30cea095545139854ad1fb9) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(         "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/indexes/index[@name='{$v14374754c27bc1eef6a7e737213600e3}'][field = '{$v06e3d36fa30cea095545139854ad1fb9->nodeValue}']"        )->length) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}$v0f1a6fa1e9e0963e1ac389661ba0b603 = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('length');if ($v0f1a6fa1e9e0963e1ac389661ba0b603) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(          "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/indexes/index[@name='{$v14374754c27bc1eef6a7e737213600e3}'][field[@length='{$v0f1a6fa1e9e0963e1ac389661ba0b603}'] ='{$v06e3d36fa30cea095545139854ad1fb9->nodeValue}']"         )->length) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}}}}if ($v6a992d5529f459a44fee58c733255e86->getAttribute('type') == 'PRIMARY') {$v24945aa5fabc80446599d7760348d114 = $v6a992d5529f459a44fee58c733255e86->getElementsByTagName('field')->item(0)->nodeValue;if ($v24945aa5fabc80446599d7760348d114) {if ($v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/indexes/index[@type='PRIMARY']/field")->item(0)) {$vb5cf8e26a05f5b35fcd36ef010257265 =         $v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/indexes/index[@type='PRIMARY']/field")->item(          0         )->nodeValue;if ($v24945aa5fabc80446599d7760348d114 != $vb5cf8e26a05f5b35fcd36ef010257265) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}else {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}}}}$vedc2dd68d1be92a82a9d8362bbae0895 = $vaab9e1de16f38176f86d7a92ba337a8d->getElementsByTagName('constraints');if (is_object($vedc2dd68d1be92a82a9d8362bbae0895->item(0))) {$v581c24a0b50b73b594671e436e10cf27 = $vedc2dd68d1be92a82a9d8362bbae0895->item(0)->getElementsByTagName('constraint');foreach ($v581c24a0b50b73b594671e436e10cf27 as $v3677ab7adaf00725e9fdbaed503a94e3) {$v4d5fdbc896088855bd8a568b5ffd9abb = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('name');if (!$v4d5fdbc896088855bd8a568b5ffd9abb) {continue;}if (!$v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@name='{$v4d5fdbc896088855bd8a568b5ffd9abb}']")->item(0)) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}$vfd40c91ee81d59fccbcab8644500e3e4 = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('field');if ($vfd40c91ee81d59fccbcab8644500e3e4) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(       "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@name='{$v4d5fdbc896088855bd8a568b5ffd9abb}' and @field='{$vfd40c91ee81d59fccbcab8644500e3e4}']"      )->item(0)) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}$v9b992b703884cf36b8cad1966fe086f9 = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('ref-table');if ($v9b992b703884cf36b8cad1966fe086f9) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(       "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@name='{$v4d5fdbc896088855bd8a568b5ffd9abb}' and @ref-table='{$v9b992b703884cf36b8cad1966fe086f9}']"      )->item(0)) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}$v1aaf3ab1a76a2b4e7a6bf784293cc4df = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('ref-field');if ($v1aaf3ab1a76a2b4e7a6bf784293cc4df) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(       "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@name='{$v4d5fdbc896088855bd8a568b5ffd9abb}' and @ref-field='{$v1aaf3ab1a76a2b4e7a6bf784293cc4df}']"      )->item(0)) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}$v269738db81007d986968bb0e3e20768b = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('on-delete');if ($v269738db81007d986968bb0e3e20768b) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(       "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@name='{$v4d5fdbc896088855bd8a568b5ffd9abb}' and @on-delete='{$v269738db81007d986968bb0e3e20768b}']"      )->item(0)) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}$v844db8803d63e7e046c30d82b772d410 = $v3677ab7adaf00725e9fdbaed503a94e3->getAttribute('on-update');if ($v844db8803d63e7e046c30d82b772d410) {if (!$v3d788fa62d7c185a1bee4c9147ee1091->query(       "//table[@name='{$v80071f37861c360a27b7327e132c911a}']/constraints/constraint[@name='{$v4d5fdbc896088855bd8a568b5ffd9abb}' and @on-update='{$v844db8803d63e7e046c30d82b772d410}']"      )->item(0)) {return $this->restoreTableInParts($v80071f37861c360a27b7327e132c911a);}}}}$v0499bf152a9954b9cf9981fd078eb0b8 = $vaab9e1de16f38176f86d7a92ba337a8d->getAttribute('engine');if (!$v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}' and @engine='{$v0499bf152a9954b9cf9981fd078eb0b8}']")->item(0)) {$this->changeTableEngine($v80071f37861c360a27b7327e132c911a, $v0499bf152a9954b9cf9981fd078eb0b8);}$vd5cbc6798435d4fe67a443679b239dd6 = $vaab9e1de16f38176f86d7a92ba337a8d->getAttribute('charset');if (!$v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}' and @charset='{$vd5cbc6798435d4fe67a443679b239dd6}']")->item(0)) {$this->changeTableCharset($v80071f37861c360a27b7327e132c911a, $vd5cbc6798435d4fe67a443679b239dd6);}if ($this->inParts) {$this->state[$v80071f37861c360a27b7327e132c911a]['complete'] = true;}return true;}protected function getNecessaryFields($v80071f37861c360a27b7327e132c911a) {$vd05b6ed7d2345020440df396d6da7f73 = [];$v9a09b4dfda82e3e665e31092d1c3ec8d = new DOMDocument();if (!$v9a09b4dfda82e3e665e31092d1c3ec8d->load($this->destinationFile)) {throw new coreException("Can't load xml: " . $this->destinationFile);}$v3d788fa62d7c185a1bee4c9147ee1091 = new DOMXPath($v9a09b4dfda82e3e665e31092d1c3ec8d);$vf25666ec7d1e534a13f641251310e226 = $v3d788fa62d7c185a1bee4c9147ee1091->query("//table[@name='{$v80071f37861c360a27b7327e132c911a}']/fields/field");if ($vf25666ec7d1e534a13f641251310e226->length) {foreach ($vf25666ec7d1e534a13f641251310e226 as $v06e3d36fa30cea095545139854ad1fb9) {$vd05b6ed7d2345020440df396d6da7f73[] = $v06e3d36fa30cea095545139854ad1fb9->getAttribute('name');}}return $vd05b6ed7d2345020440df396d6da7f73;}private function getStateDirectoryPath() {if ($this->stateDirectoryPath !== null) {return $this->stateDirectoryPath;}return $this->stateDirectoryPath = SYS_TEMP_PATH;}}