<?php
 use UmiCms\Service;class imageMagickProcessor implements iImageProcessor {public function crop($vd78b68a69f88f543cde90ab00273c043, $vb28354b543375bfa94dabaeda722927f, $v811882fecd5c7618d7099ebbd39ea254, $veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81) {$v8c7dd922ad47494fc02c388e12c00eac = $this->getImagickByImagePath($vd78b68a69f88f543cde90ab00273c043);if (!$v8c7dd922ad47494fc02c388e12c00eac instanceof Imagick) {return false;}$v6579d3750a20fd902367b2302d5f4ff9 = $this->getImageProfileContent($v8c7dd922ad47494fc02c388e12c00eac, 'icc');if ($v8c7dd922ad47494fc02c388e12c00eac->cropImage($veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81, $v811882fecd5c7618d7099ebbd39ea254, $vb28354b543375bfa94dabaeda722927f)) {$v8c7dd922ad47494fc02c388e12c00eac->stripImage();$v8c7dd922ad47494fc02c388e12c00eac = $this->addImageProfile($v8c7dd922ad47494fc02c388e12c00eac, 'icc', $v6579d3750a20fd902367b2302d5f4ff9);$v8c7dd922ad47494fc02c388e12c00eac->setImageCompressionQuality(IMAGE_COMPRESSION_LEVEL);$v8c7dd922ad47494fc02c388e12c00eac->writeImage();$v8c7dd922ad47494fc02c388e12c00eac->destroy();}else {return false;}return true;}public function rotate($vd78b68a69f88f543cde90ab00273c043) {$v8c7dd922ad47494fc02c388e12c00eac = $this->getImagickByImagePath($vd78b68a69f88f543cde90ab00273c043);if (!$v8c7dd922ad47494fc02c388e12c00eac instanceof Imagick) {return false;}$v6579d3750a20fd902367b2302d5f4ff9 = $this->getImageProfileContent($v8c7dd922ad47494fc02c388e12c00eac, 'icc');if ($v8c7dd922ad47494fc02c388e12c00eac->rotateImage(new ImagickPixel('#ffffff'), 90)) {$v8c7dd922ad47494fc02c388e12c00eac->stripImage();$v8c7dd922ad47494fc02c388e12c00eac = $this->addImageProfile($v8c7dd922ad47494fc02c388e12c00eac, 'icc', $v6579d3750a20fd902367b2302d5f4ff9);$v8c7dd922ad47494fc02c388e12c00eac->setImageCompressionQuality(IMAGE_COMPRESSION_LEVEL);$v8c7dd922ad47494fc02c388e12c00eac->writeImage();$v8c7dd922ad47494fc02c388e12c00eac->destroy();}else {return false;}return true;}public function resize($vd78b68a69f88f543cde90ab00273c043, $veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81) {$v8c7dd922ad47494fc02c388e12c00eac = $this->getImagickByImagePath($vd78b68a69f88f543cde90ab00273c043);if (!$v8c7dd922ad47494fc02c388e12c00eac instanceof Imagick) {return false;}$v6579d3750a20fd902367b2302d5f4ff9 = $this->getImageProfileContent($v8c7dd922ad47494fc02c388e12c00eac, 'icc');if ($v8c7dd922ad47494fc02c388e12c00eac->resizeImage($veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81, Imagick::FILTER_LANCZOS, 1)) {$v8c7dd922ad47494fc02c388e12c00eac->setImagePage($veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81, 0, 0);$v8c7dd922ad47494fc02c388e12c00eac->stripImage();$v8c7dd922ad47494fc02c388e12c00eac = $this->addImageProfile($v8c7dd922ad47494fc02c388e12c00eac, 'icc', $v6579d3750a20fd902367b2302d5f4ff9);$v8c7dd922ad47494fc02c388e12c00eac->setImageCompressionQuality(IMAGE_COMPRESSION_LEVEL);$v8c7dd922ad47494fc02c388e12c00eac->writeImage();$v8c7dd922ad47494fc02c388e12c00eac->destroy();}else {return false;}return true;}public function optimize($vd78b68a69f88f543cde90ab00273c043, $vd66636b253cb346dbb6240e30def3618 = 75) {$v8c7dd922ad47494fc02c388e12c00eac = $this->getImagickByImagePath($vd78b68a69f88f543cde90ab00273c043);if (!$v8c7dd922ad47494fc02c388e12c00eac instanceof Imagick) {return false;}$v6579d3750a20fd902367b2302d5f4ff9 = $this->getImageProfileContent($v8c7dd922ad47494fc02c388e12c00eac, 'icc');$v6dad333c676844fe3b2a53fb6be02d3a = Service::ImageFactory()    ->create($vd78b68a69f88f543cde90ab00273c043)    ->getMimeType();switch ($v6dad333c676844fe3b2a53fb6be02d3a) {case 'image/png': {$vd66636b253cb346dbb6240e30def3618 = 100 - $vd66636b253cb346dbb6240e30def3618;$v8c7dd922ad47494fc02c388e12c00eac->resizeImage(      $v8c7dd922ad47494fc02c388e12c00eac->getImageWidth(),      $v8c7dd922ad47494fc02c388e12c00eac->getImageHeight(),      Imagick::FILTER_POINT,      $vd66636b253cb346dbb6240e30def3618     );break;}case 'image/svg+xml':    case 'image/gif': {$v8c7dd922ad47494fc02c388e12c00eac->destroy();return true;}default: {$v8c7dd922ad47494fc02c388e12c00eac->setImageCompression(getImageQualityLevel($vd66636b253cb346dbb6240e30def3618));}}$v8c7dd922ad47494fc02c388e12c00eac->stripImage();$v8c7dd922ad47494fc02c388e12c00eac = $this->addImageProfile($v8c7dd922ad47494fc02c388e12c00eac, 'icc', $v6579d3750a20fd902367b2302d5f4ff9);$v8c7dd922ad47494fc02c388e12c00eac->writeImage();$v8c7dd922ad47494fc02c388e12c00eac->destroy();return true;}public function info($vd78b68a69f88f543cde90ab00273c043) {$v8c7dd922ad47494fc02c388e12c00eac = $this->getImagickByImagePath($vd78b68a69f88f543cde90ab00273c043);if (!$v8c7dd922ad47494fc02c388e12c00eac instanceof Imagick) {return [     'mime' => '',     'height' => 0,     'width' => 0    ];}$vcaf9b6b99962bf5c2264824231d7a40c = [    'mime' => $v8c7dd922ad47494fc02c388e12c00eac->getImageMimeType(),    'height' => $v8c7dd922ad47494fc02c388e12c00eac->getImageHeight(),    'width' => $v8c7dd922ad47494fc02c388e12c00eac->getImageWidth()   ];$v8c7dd922ad47494fc02c388e12c00eac->destroy();return $vcaf9b6b99962bf5c2264824231d7a40c;}public function thumbnail($vd78b68a69f88f543cde90ab00273c043, $vf12105146129696d6a7e0ed521db2e48, $veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81, $vd66636b253cb346dbb6240e30def3618 = false) {$v8c7dd922ad47494fc02c388e12c00eac = $this->getImagickByImagePath($vd78b68a69f88f543cde90ab00273c043);if (!$v8c7dd922ad47494fc02c388e12c00eac instanceof Imagick) {return false;}$v6579d3750a20fd902367b2302d5f4ff9 = $this->getImageProfileContent($v8c7dd922ad47494fc02c388e12c00eac, 'icc');$v8c7dd922ad47494fc02c388e12c00eac->setBackgroundColor('rgb(255,255,255)');$v8c7dd922ad47494fc02c388e12c00eac->resizeImage($veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81, Imagick::FILTER_LANCZOS, 1);$v8c7dd922ad47494fc02c388e12c00eac->setImagePage($veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81, 0, 0);$v8c7dd922ad47494fc02c388e12c00eac->setImageCompressionQuality(getImageQualityLevel($vd66636b253cb346dbb6240e30def3618));$v8c7dd922ad47494fc02c388e12c00eac->stripImage();$v8c7dd922ad47494fc02c388e12c00eac = $this->addImageProfile($v8c7dd922ad47494fc02c388e12c00eac, 'icc', $v6579d3750a20fd902367b2302d5f4ff9);try {$v8c7dd922ad47494fc02c388e12c00eac->writeImage($vf12105146129696d6a7e0ed521db2e48);}catch (Exception $ve1671797c52e15f763380b45e841ec32) {throw new coreException(getLabel('label-errors-16008'));}$v8c7dd922ad47494fc02c388e12c00eac->destroy();return true;}public function cropThumbnail(   $vd78b68a69f88f543cde90ab00273c043,   $vb43c766cbc1365dca0ffcee38e46b613,   $veaae26a6fb20ed3ef54fb23bfa0b1fcc,   $vb435e227d5dd201e1768b2bcb2e0aa81,   $v3582bc318552a38b375ce235860d7df9,   $vc2264e26c88ee08954ab3927cc0128e7,   $v96dd26f2ebffec3ab76e2fc0fc37d93c,   $v7ae2059e529ca294dded254a201e5a25,   $vf711798e436a77f680a1070c008a2a66,   $vd66636b253cb346dbb6240e30def3618 = 75  ) {$v8c7dd922ad47494fc02c388e12c00eac = $this->getImagickByImagePath($vd78b68a69f88f543cde90ab00273c043);if (!$v8c7dd922ad47494fc02c388e12c00eac instanceof Imagick) {return false;}$v6579d3750a20fd902367b2302d5f4ff9 = $this->getImageProfileContent($v8c7dd922ad47494fc02c388e12c00eac, 'icc');$vd02a169f33469c888396a24dd9d9f1c6 = $v8c7dd922ad47494fc02c388e12c00eac->getImageMimeType();$v8c7dd922ad47494fc02c388e12c00eac->setGravity(Imagick::GRAVITY_CENTER);if (in_array($vd02a169f33469c888396a24dd9d9f1c6, ['image/png', 'image/gif'])) {$v8c7dd922ad47494fc02c388e12c00eac->setBackgroundColor(new ImagickPixel('transparent'));}$v8c7dd922ad47494fc02c388e12c00eac->cropImage($v3582bc318552a38b375ce235860d7df9, $vc2264e26c88ee08954ab3927cc0128e7, $v96dd26f2ebffec3ab76e2fc0fc37d93c, $v7ae2059e529ca294dded254a201e5a25);$v8c7dd922ad47494fc02c388e12c00eac->resizeImage($veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81, Imagick::FILTER_LANCZOS, 1);$v8c7dd922ad47494fc02c388e12c00eac->setImagePage($veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81, 0, 0);$v8c7dd922ad47494fc02c388e12c00eac->unsharpMaskImage(0.5, 0.5, 80, 3);$v8c7dd922ad47494fc02c388e12c00eac->setImageCompressionQuality(getImageQualityLevel($vd66636b253cb346dbb6240e30def3618));$v8c7dd922ad47494fc02c388e12c00eac->stripImage();$v8c7dd922ad47494fc02c388e12c00eac = $this->addImageProfile($v8c7dd922ad47494fc02c388e12c00eac, 'icc', $v6579d3750a20fd902367b2302d5f4ff9);try {$v8c7dd922ad47494fc02c388e12c00eac->writeImage($vb43c766cbc1365dca0ffcee38e46b613);}catch (Exception $ve1671797c52e15f763380b45e841ec32) {throw new coreException(getLabel('label-errors-16008'));}$v8c7dd922ad47494fc02c388e12c00eac->destroy();return true;}public function getLibType() {return 'imagick';}private function getImagickByImagePath($vd78b68a69f88f543cde90ab00273c043) {try {return new Imagick($vd78b68a69f88f543cde90ab00273c043);}catch (ImagickException $ve1671797c52e15f763380b45e841ec32) {return false;}}private function addImageProfile(Imagick $v8c7dd922ad47494fc02c388e12c00eac, $v68d8b2b234b0e3d0de6620b9ada9d991, $v9a0364b9e99bb480dd25e1f0284c8555) {if (!isEmptyString($v9a0364b9e99bb480dd25e1f0284c8555)) {$v8c7dd922ad47494fc02c388e12c00eac->setImageProfile($v68d8b2b234b0e3d0de6620b9ada9d991, $v9a0364b9e99bb480dd25e1f0284c8555);}return $v8c7dd922ad47494fc02c388e12c00eac;}private function getImageProfileContent(Imagick $v8c7dd922ad47494fc02c388e12c00eac, $v68d8b2b234b0e3d0de6620b9ada9d991) {$vd970728376beb137057865c63baa822f = $v8c7dd922ad47494fc02c388e12c00eac->getImageProfiles('*', true);return isset($vd970728376beb137057865c63baa822f[$v68d8b2b234b0e3d0de6620b9ada9d991]) ? $vd970728376beb137057865c63baa822f[$v68d8b2b234b0e3d0de6620b9ada9d991] : '';}}