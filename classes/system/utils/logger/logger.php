<?php
 class umiLogger implements iUmiLogger {protected $directory;protected $log = [];protected $isSaved = false;protected $startTime = false;protected $separateByIp = true;protected $fileName;protected $isGlobalVariablesPushed = false;public function __construct($v06f0066e65410a0a1c9f39991a3f3b01 = './logs/') {$this->runTimer();$v5f8f22b8cdbaeee8cf857673a9b6ba20 = new umiDirectory($v06f0066e65410a0a1c9f39991a3f3b01);$this->setDirectory($v5f8f22b8cdbaeee8cf857673a9b6ba20);$this->setFileName(date('Y-m-d_H_i_s'));}public function setFileName($v5b063e275d506f65ebf1b02d926f19a4) {if (!is_string($v5b063e275d506f65ebf1b02d926f19a4) || empty($v5b063e275d506f65ebf1b02d926f19a4)) {throw new Exception('File name expected');}$this->fileName = $v5b063e275d506f65ebf1b02d926f19a4;return $this;}public function push($v78e731027d8fd50ed642340b7c9a63b3, $va25bec4d6ac4fe3657375253cc832019 = true) {if (!is_string($v78e731027d8fd50ed642340b7c9a63b3) && !is_callable([$v78e731027d8fd50ed642340b7c9a63b3, '__toString'])) {throw new Exception('Incorrect log message given');}$this->log[] = $va25bec4d6ac4fe3657375253cc832019 ? $this->appendTimer($v78e731027d8fd50ed642340b7c9a63b3) : (string) $v78e731027d8fd50ed642340b7c9a63b3;return $this;}public function save() {$v5f8f22b8cdbaeee8cf857673a9b6ba20 = $this->isSeparatedByIp() ? $this->createDirectoryByIp() : $this->getDirectory();$v47826cacc65c665212b821e6ff80b9b0 = $v5f8f22b8cdbaeee8cf857673a9b6ba20->getPath() . '/' . $this->getFileName() . '.log';$this->setSaved();if (!file_put_contents($v47826cacc65c665212b821e6ff80b9b0, $this->get(), FILE_APPEND)) {throw new Exception("Can't save log in \"{$v47826cacc65c665212b821e6ff80b9b0}\"");}return $this->resetLog();}public function resetLog() {$this->log = [];return $this;}public function get() {return implode(PHP_EOL, $this->log);}public function getRaw() {return $this->log;}public function separateByIp($v327a6c4304ad5938eaf0efb6cc3e53dc = true) {$this->separateByIp = (bool) $v327a6c4304ad5938eaf0efb6cc3e53dc;return $this;}public function pushGlobalEnvironment() {if ($this->isGlobalVariablesPushed === false) {$this->collectGlobalEnvironment();$this->isGlobalVariablesPushed = true;}return $this;}public function log($v78e731027d8fd50ed642340b7c9a63b3, $va25bec4d6ac4fe3657375253cc832019 = true) {return $this->push($v78e731027d8fd50ed642340b7c9a63b3, $va25bec4d6ac4fe3657375253cc832019);}public function __destruct() {if (!$this->isSaved() && $this->getDirectory() instanceof iUmiDirectory && !empty($this->get())) {$this->save();}}protected function setDirectory(iUmiDirectory $v5f8f22b8cdbaeee8cf857673a9b6ba20) {if (!$v5f8f22b8cdbaeee8cf857673a9b6ba20->isExists()) {throw new Exception("Directory \"{$v5f8f22b8cdbaeee8cf857673a9b6ba20->getPath()}\" doesn't exist");}if (!$v5f8f22b8cdbaeee8cf857673a9b6ba20->isWritable()) {throw new Exception("Directory \"{$v5f8f22b8cdbaeee8cf857673a9b6ba20->getPath()}\" must be writable");}$this->directory = $v5f8f22b8cdbaeee8cf857673a9b6ba20;return $this;}protected function getDirectory() {return $this->directory;}protected function createDirectoryByIp() {$v06f0066e65410a0a1c9f39991a3f3b01 = $this->getDirectory()    ->getPath();$vb58521a2f4abb99ca64e2cf005a53b5d = $v06f0066e65410a0a1c9f39991a3f3b01 . '/' . getServer('REMOTE_ADDR');$vf35596be31d40176826fce6b837a9ddc = new umiDirectory($vb58521a2f4abb99ca64e2cf005a53b5d);if ($vf35596be31d40176826fce6b837a9ddc->isExists() && !$vf35596be31d40176826fce6b837a9ddc->isWritable()) {throw new Exception("Directory \"{$vb58521a2f4abb99ca64e2cf005a53b5d}\" must be writable");}$vf35596be31d40176826fce6b837a9ddc->requireFolder($vb58521a2f4abb99ca64e2cf005a53b5d);$vf35596be31d40176826fce6b837a9ddc->refresh();if (!$vf35596be31d40176826fce6b837a9ddc->isExists() || !$vf35596be31d40176826fce6b837a9ddc->isWritable()) {throw new Exception("Can't create directory \"{$vb58521a2f4abb99ca64e2cf005a53b5d}\"");}return $vf35596be31d40176826fce6b837a9ddc;}protected function collectGlobalEnvironment() {$this->collectArray('$_COOKIE', $_COOKIE)    ->collectArray('$_SESSION', isset($_SESSION) ? $_SESSION : [])    ->collectArray('$_POST', $_POST)    ->collectArray('$_GET', $_GET)    ->collectArray('$_FILES', $_FILES);if (function_exists('apache_request_headers')) {$this->collectArray('Request headers', apache_request_headers());}if (function_exists('apache_response_headers')) {$this->collectArray('Response headers', apache_response_headers());}return $this;}protected function collectArray($vb068931cc450442b63f5b3d276ea4297, $vf1f713c9e000f5d3f280adbd124df4f5) {if (!is_array($vf1f713c9e000f5d3f280adbd124df4f5) || empty($vf1f713c9e000f5d3f280adbd124df4f5)) {return $this;}$v6e2baaf3b97dbeef01c0043275f9a0e7 = "[{$vb068931cc450442b63f5b3d276ea4297}]" . PHP_EOL;foreach ($vf1f713c9e000f5d3f280adbd124df4f5 as $v6a992d5529f459a44fee58c733255e86 => $v2063c1608d6e0baf80249c42e2be5804) {$v6e2baaf3b97dbeef01c0043275f9a0e7 .= "\t[" . $v6a992d5529f459a44fee58c733255e86 . ']' . PHP_EOL . "\t" . '(' . gettype($v2063c1608d6e0baf80249c42e2be5804) . ') ';if (is_array($v2063c1608d6e0baf80249c42e2be5804)) {$v2063c1608d6e0baf80249c42e2be5804 = $this->serializeArray($v2063c1608d6e0baf80249c42e2be5804);}$v6e2baaf3b97dbeef01c0043275f9a0e7 .= $v2063c1608d6e0baf80249c42e2be5804 . PHP_EOL . PHP_EOL;}$va25bec4d6ac4fe3657375253cc832019 = false;$this->push($v6e2baaf3b97dbeef01c0043275f9a0e7, $va25bec4d6ac4fe3657375253cc832019);return $this;}protected function serializeArray($vf1f713c9e000f5d3f280adbd124df4f5) {$v4c0ea255f05cd18b70f5fa122d3cc78f = [];foreach ($vf1f713c9e000f5d3f280adbd124df4f5 as $v6a992d5529f459a44fee58c733255e86 => $v2063c1608d6e0baf80249c42e2be5804) {if (is_array($v2063c1608d6e0baf80249c42e2be5804)) {$v2063c1608d6e0baf80249c42e2be5804 = $this->serializeArray($v2063c1608d6e0baf80249c42e2be5804);}$v4c0ea255f05cd18b70f5fa122d3cc78f[] = "'$v6a992d5529f459a44fee58c733255e86' => '" . $v2063c1608d6e0baf80249c42e2be5804 . "'";}return '[' . implode(', ', $v4c0ea255f05cd18b70f5fa122d3cc78f) . ']';}protected function runTimer() {$this->startTime = microtime(true);return $this;}protected function getTimer() {$v07cc694b9b3fc636710fa08b6922c42b = microtime(true) - $this->getStartTime();return round($v07cc694b9b3fc636710fa08b6922c42b, 7);}protected function appendTimer($v78e731027d8fd50ed642340b7c9a63b3) {return '[' . sprintf('%1.7f', $this->getTimer()) . "]\t" . (string) $v78e731027d8fd50ed642340b7c9a63b3;}protected function isSaved() {return (bool) $this->isSaved;}protected function setSaved($v327a6c4304ad5938eaf0efb6cc3e53dc = true) {$this->isSaved = $v327a6c4304ad5938eaf0efb6cc3e53dc;return $this;}protected function getFileName() {return $this->fileName;}protected function isSeparatedByIp() {return (bool) $this->separateByIp;}protected function getStartTime() {return (float) $this->startTime;}public function pushGlobalEnviroment() {return $this->pushGlobalEnvironment();}}