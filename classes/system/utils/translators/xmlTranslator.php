<?php
 use UmiCms\Service;class xmlTranslator implements iXmlTranslator {public static $showHiddenFieldGroups = false;public static $showUnsecureFields = false;public static $keysCache = [];public static $translateCache = [];protected $domDocument = false;protected static $shortKeys = [   '@' => 'attribute',   '#' => 'node',   '+' => 'nodes',   '%' => 'xlink',   '*' => 'comment'  ];const ESCAPE_OPTION = 'escape-node-and-attribute-values';const DEEP_OPTION = 'serialize-related-entities';public function __construct(DOMDocument $vc2d66aafee5d0e58e7682dd3e7b5d7f6) {$this->domDocument = $vc2d66aafee5d0e58e7682dd3e7b5d7f6;}public function translateToXml(DOMElement $v173a1756d2d82394cb803161f70f9a38, $v56491f2e1c74898e18bb6e47d2425b19) {$v93da65a9fd0004d9477aeac024e08e15 = $this->getDefaultOptions();$this->chooseTranslator($v173a1756d2d82394cb803161f70f9a38, $v56491f2e1c74898e18bb6e47d2425b19, $v93da65a9fd0004d9477aeac024e08e15);}public function chooseTranslator(DOMElement $v173a1756d2d82394cb803161f70f9a38, $v56491f2e1c74898e18bb6e47d2425b19, $v93da65a9fd0004d9477aeac024e08e15 = []) {switch (gettype($v56491f2e1c74898e18bb6e47d2425b19)) {case 'array': {$this->translateArray($v173a1756d2d82394cb803161f70f9a38, $v56491f2e1c74898e18bb6e47d2425b19, $v93da65a9fd0004d9477aeac024e08e15);break;}case 'object': {if (!$v56491f2e1c74898e18bb6e47d2425b19 instanceof iUmiEntinty && !$v56491f2e1c74898e18bb6e47d2425b19 instanceof umiObjectProxy) {$v7c27535f88bae9519ceb14a8983c57ff = translatorWrapper::get($v56491f2e1c74898e18bb6e47d2425b19);foreach ($v93da65a9fd0004d9477aeac024e08e15 as $vb068931cc450442b63f5b3d276ea4297 => $v2063c1608d6e0baf80249c42e2be5804) {$v7c27535f88bae9519ceb14a8983c57ff->setOption($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804);}$this->chooseTranslator($v173a1756d2d82394cb803161f70f9a38, $v7c27535f88bae9519ceb14a8983c57ff->translate($v56491f2e1c74898e18bb6e47d2425b19), $v93da65a9fd0004d9477aeac024e08e15);break;}$v0fea6a13c52b4d4725368f24b045ca84 = &self::$translateCache;$v04e948c64340eb34f866e11ad7846204 = '';foreach ($v93da65a9fd0004d9477aeac024e08e15 as $vb068931cc450442b63f5b3d276ea4297 => $v2063c1608d6e0baf80249c42e2be5804) {$v2063c1608d6e0baf80249c42e2be5804 = is_array($v2063c1608d6e0baf80249c42e2be5804) ? implode('', $v2063c1608d6e0baf80249c42e2be5804) : $v2063c1608d6e0baf80249c42e2be5804;$v04e948c64340eb34f866e11ad7846204 .= $vb068931cc450442b63f5b3d276ea4297 . $v2063c1608d6e0baf80249c42e2be5804;}$v3c6e0b8a9c15224a8228b9a98ca1531d = get_class($v56491f2e1c74898e18bb6e47d2425b19) .      '#' . $v56491f2e1c74898e18bb6e47d2425b19->getId() .      '#' . md5($v04e948c64340eb34f866e11ad7846204) .      '#' . ((int) translatorWrapper::$showEmptyFields);if (!isset($v0fea6a13c52b4d4725368f24b045ca84[$v3c6e0b8a9c15224a8228b9a98ca1531d])) {$v7c27535f88bae9519ceb14a8983c57ff = translatorWrapper::get($v56491f2e1c74898e18bb6e47d2425b19);foreach ($v93da65a9fd0004d9477aeac024e08e15 as $vb068931cc450442b63f5b3d276ea4297 => $v2063c1608d6e0baf80249c42e2be5804) {$v7c27535f88bae9519ceb14a8983c57ff->setOption($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804);}$v0fea6a13c52b4d4725368f24b045ca84[$v3c6e0b8a9c15224a8228b9a98ca1531d] = $v7c27535f88bae9519ceb14a8983c57ff->translate($v56491f2e1c74898e18bb6e47d2425b19);}$this->chooseTranslator($v173a1756d2d82394cb803161f70f9a38, $v0fea6a13c52b4d4725368f24b045ca84[$v3c6e0b8a9c15224a8228b9a98ca1531d], $v93da65a9fd0004d9477aeac024e08e15);break;}default: {$this->translateBasic($v173a1756d2d82394cb803161f70f9a38, $v56491f2e1c74898e18bb6e47d2425b19, $v93da65a9fd0004d9477aeac024e08e15);break;}}}private function getDefaultOptions() {$v10573b873d2fa5a365d558a45e328e47 = Service::Request();return [    self::DEEP_OPTION => false,    self::ESCAPE_OPTION => $v10573b873d2fa5a365d558a45e328e47->isSite() && $v10573b873d2fa5a365d558a45e328e47->isXml()   ];}public static function isParseTPLMacrosesAllowed() {static $v22ee71e9dcc9ca12fc313c6e1ce3f806;if (is_bool($v22ee71e9dcc9ca12fc313c6e1ce3f806)) {return $v22ee71e9dcc9ca12fc313c6e1ce3f806;}$v22ee71e9dcc9ca12fc313c6e1ce3f806 = true;if (Service::Request()->isAdmin()) {$v22ee71e9dcc9ca12fc313c6e1ce3f806 = false;}elseif (defined('XML_MACROSES_DISABLE') && XML_MACROSES_DISABLE) {$v9cf41e5f460b6ae5505f9809fe9f5d37 = mainConfiguration::getInstance()     ->get('kernel', 'xml-macroses.allowed');$v22ee71e9dcc9ca12fc313c6e1ce3f806 = (is_array($v9cf41e5f460b6ae5505f9809fe9f5d37) && umiCount($v9cf41e5f460b6ae5505f9809fe9f5d37));}return $v22ee71e9dcc9ca12fc313c6e1ce3f806;}public static function getAllowedTplMacroses() {static $v0fea6a13c52b4d4725368f24b045ca84 = false;if ($v0fea6a13c52b4d4725368f24b045ca84 !== false) {return $v0fea6a13c52b4d4725368f24b045ca84;}if (defined('XML_MACROSES_DISABLE') && XML_MACROSES_DISABLE) {$v0fea6a13c52b4d4725368f24b045ca84 = mainConfiguration::getInstance()     ->get('kernel', 'xml-macroses.allowed');}else {$v0fea6a13c52b4d4725368f24b045ca84 = null;}return $v0fea6a13c52b4d4725368f24b045ca84;}public static function executeMacroses($v56491f2e1c74898e18bb6e47d2425b19, $vaf0bf69b4590545119c86ee0e59c088d = false, $v5d8603331b744a86bd36e07552225714 = false) {if (!self::isParseTPLMacrosesAllowed()) {return $v56491f2e1c74898e18bb6e47d2425b19;}if (!contains($v56491f2e1c74898e18bb6e47d2425b19, '%')) {return $v56491f2e1c74898e18bb6e47d2425b19;}$v81fa66e1de953609791315cc66bfb7af = umiTemplater::create('TPL');$v81fa66e1de953609791315cc66bfb7af->executeOnlyAllowedMacroses(self::getAllowedTplMacroses());$v81fa66e1de953609791315cc66bfb7af->setScope($vaf0bf69b4590545119c86ee0e59c088d, $v5d8603331b744a86bd36e07552225714);return $v81fa66e1de953609791315cc66bfb7af->parse([], $v56491f2e1c74898e18bb6e47d2425b19);}public static function getRealKey($v3c6e0b8a9c15224a8228b9a98ca1531d) {$vcbc4d655dc88f40f8f82857f231139d1 = &self::$keysCache;if (!isset($vcbc4d655dc88f40f8f82857f231139d1[$v3c6e0b8a9c15224a8228b9a98ca1531d])) {$vcbc4d655dc88f40f8f82857f231139d1[$v3c6e0b8a9c15224a8228b9a98ca1531d] = self::getKey($v3c6e0b8a9c15224a8228b9a98ca1531d);}list(, $vde0366a04f7345d0b277b28f9e86f357) = $vcbc4d655dc88f40f8f82857f231139d1[$v3c6e0b8a9c15224a8228b9a98ca1531d];return $vde0366a04f7345d0b277b28f9e86f357;}public static function getSubKey($v3c6e0b8a9c15224a8228b9a98ca1531d) {$vcbc4d655dc88f40f8f82857f231139d1 = &self::$keysCache;if (!isset($vcbc4d655dc88f40f8f82857f231139d1[$v3c6e0b8a9c15224a8228b9a98ca1531d])) {$vcbc4d655dc88f40f8f82857f231139d1[$v3c6e0b8a9c15224a8228b9a98ca1531d] = self::getKey($v3c6e0b8a9c15224a8228b9a98ca1531d);}list($v518d8dec3947df909fe6e4c9940f98a6,) = $vcbc4d655dc88f40f8f82857f231139d1[$v3c6e0b8a9c15224a8228b9a98ca1531d];return $v518d8dec3947df909fe6e4c9940f98a6;}public static function getKey($v3c6e0b8a9c15224a8228b9a98ca1531d) {if (isset(self::$shortKeys[$v3c6e0b8a9c15224a8228b9a98ca1531d[0]])) {return [     self::$shortKeys[$v3c6e0b8a9c15224a8228b9a98ca1531d[0]],     mb_substr($v3c6e0b8a9c15224a8228b9a98ca1531d, 1)    ];}$vce4aa9b53cf14dfadb1e861ca4e7af24 = ':';return mb_strpos($v3c6e0b8a9c15224a8228b9a98ca1531d, $vce4aa9b53cf14dfadb1e861ca4e7af24) ? explode($vce4aa9b53cf14dfadb1e861ca4e7af24, $v3c6e0b8a9c15224a8228b9a98ca1531d, 2) : [false, $v3c6e0b8a9c15224a8228b9a98ca1531d];}public static function clearCache() {self::$keysCache = [];self::$translateCache = [];}protected function translateBasic(DOMElement $v173a1756d2d82394cb803161f70f9a38, $v56491f2e1c74898e18bb6e47d2425b19, array $v93da65a9fd0004d9477aeac024e08e15) {$vdd988cfd769c9f7fbd795a0f5da8e751 = $this->domDocument;$v56491f2e1c74898e18bb6e47d2425b19 = self::executeMacroses($v56491f2e1c74898e18bb6e47d2425b19);$vfffa9dce4e615fb2d10f20f6ed2d4069 = isset($v93da65a9fd0004d9477aeac024e08e15[self::ESCAPE_OPTION]) ? $v93da65a9fd0004d9477aeac024e08e15[self::ESCAPE_OPTION] : false;$v8e2dcfd7e7e24b1ca76c1193f645902b = $vfffa9dce4e615fb2d10f20f6ed2d4069 ? $vdd988cfd769c9f7fbd795a0f5da8e751->createCDATASection($v56491f2e1c74898e18bb6e47d2425b19) : $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode($v56491f2e1c74898e18bb6e47d2425b19);$v173a1756d2d82394cb803161f70f9a38->appendChild($v8e2dcfd7e7e24b1ca76c1193f645902b);}protected function translateArray(DOMElement $v173a1756d2d82394cb803161f70f9a38, $v56491f2e1c74898e18bb6e47d2425b19, $v93da65a9fd0004d9477aeac024e08e15 = []) {$vcbc4d655dc88f40f8f82857f231139d1 = &self::$keysCache;$vdd988cfd769c9f7fbd795a0f5da8e751 = $this->domDocument;$vfffa9dce4e615fb2d10f20f6ed2d4069 = isset($v93da65a9fd0004d9477aeac024e08e15[self::ESCAPE_OPTION]) ? $v93da65a9fd0004d9477aeac024e08e15[self::ESCAPE_OPTION] : false;foreach ($v56491f2e1c74898e18bb6e47d2425b19 as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v3a6d0284e743dc4a9b86f97d6dd1a3bf) {if (!isset($vcbc4d655dc88f40f8f82857f231139d1[$v3c6e0b8a9c15224a8228b9a98ca1531d])) {$vcbc4d655dc88f40f8f82857f231139d1[$v3c6e0b8a9c15224a8228b9a98ca1531d] = self::getKey($v3c6e0b8a9c15224a8228b9a98ca1531d);}list($v518d8dec3947df909fe6e4c9940f98a6, $vde0366a04f7345d0b277b28f9e86f357) = $vcbc4d655dc88f40f8f82857f231139d1[$v3c6e0b8a9c15224a8228b9a98ca1531d];$v93da65a9fd0004d9477aeac024e08e15[self::DEEP_OPTION] = $v518d8dec3947df909fe6e4c9940f98a6 === 'full';switch ($v518d8dec3947df909fe6e4c9940f98a6) {case 'attr' :     case 'attribute' : {if ($v3a6d0284e743dc4a9b86f97d6dd1a3bf === '' || $v3a6d0284e743dc4a9b86f97d6dd1a3bf === null || is_array($v3a6d0284e743dc4a9b86f97d6dd1a3bf)) {break;}$v3a6d0284e743dc4a9b86f97d6dd1a3bf = $vfffa9dce4e615fb2d10f20f6ed2d4069 ? htmlspecialchars($v3a6d0284e743dc4a9b86f97d6dd1a3bf) : $v3a6d0284e743dc4a9b86f97d6dd1a3bf;$v173a1756d2d82394cb803161f70f9a38->setAttribute($vde0366a04f7345d0b277b28f9e86f357, $v3a6d0284e743dc4a9b86f97d6dd1a3bf);break;}case 'list' :     case 'nodes' : {if (is_array($v3a6d0284e743dc4a9b86f97d6dd1a3bf)) {foreach ($v3a6d0284e743dc4a9b86f97d6dd1a3bf as $vf19e92e810d08b6cf2d0265b779064d9) {$v8e2dcfd7e7e24b1ca76c1193f645902b = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement($vde0366a04f7345d0b277b28f9e86f357);$this->chooseTranslator($v8e2dcfd7e7e24b1ca76c1193f645902b, $vf19e92e810d08b6cf2d0265b779064d9, $v93da65a9fd0004d9477aeac024e08e15);$v173a1756d2d82394cb803161f70f9a38->appendChild($v8e2dcfd7e7e24b1ca76c1193f645902b);}}break;}case 'node' : {$v36c4536996ca5615dcf9911f068786dc = $vfffa9dce4e615fb2d10f20f6ed2d4069 ? $vdd988cfd769c9f7fbd795a0f5da8e751->createCDATASection($v3a6d0284e743dc4a9b86f97d6dd1a3bf) : $vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode($v3a6d0284e743dc4a9b86f97d6dd1a3bf);$v173a1756d2d82394cb803161f70f9a38->appendChild($v36c4536996ca5615dcf9911f068786dc);break;}case 'void' : {break;}case 'full' : {$v8e2dcfd7e7e24b1ca76c1193f645902b = $vde0366a04f7345d0b277b28f9e86f357 ? $vdd988cfd769c9f7fbd795a0f5da8e751->createElement($vde0366a04f7345d0b277b28f9e86f357) : $v173a1756d2d82394cb803161f70f9a38;$this->chooseTranslator($v8e2dcfd7e7e24b1ca76c1193f645902b, $v3a6d0284e743dc4a9b86f97d6dd1a3bf, $v93da65a9fd0004d9477aeac024e08e15);if ($vde0366a04f7345d0b277b28f9e86f357) {$v173a1756d2d82394cb803161f70f9a38->appendChild($v8e2dcfd7e7e24b1ca76c1193f645902b);}break;}case 'xml' : {$v3a6d0284e743dc4a9b86f97d6dd1a3bf = html_entity_decode($v3a6d0284e743dc4a9b86f97d6dd1a3bf, ENT_COMPAT, 'utf-8');$v3a6d0284e743dc4a9b86f97d6dd1a3bf = str_replace('&', '&amp;', $v3a6d0284e743dc4a9b86f97d6dd1a3bf);$v06d88f85e416d79c7ee808be0da9c4fe = @secure_load_simple_xml($v3a6d0284e743dc4a9b86f97d6dd1a3bf);if ($v06d88f85e416d79c7ee808be0da9c4fe !== false) {$va1451a52e82b7a6ab4f41584cfde96da = dom_import_simplexml($v06d88f85e416d79c7ee808be0da9c4fe);if ($va1451a52e82b7a6ab4f41584cfde96da) {$va1451a52e82b7a6ab4f41584cfde96da = $vdd988cfd769c9f7fbd795a0f5da8e751->importNode($va1451a52e82b7a6ab4f41584cfde96da, true);$v173a1756d2d82394cb803161f70f9a38->appendChild($va1451a52e82b7a6ab4f41584cfde96da);}}else {$v173a1756d2d82394cb803161f70f9a38->appendChild($vdd988cfd769c9f7fbd795a0f5da8e751->createTextNode($v3a6d0284e743dc4a9b86f97d6dd1a3bf));}break;}case 'xlink' : {$va0f0bc95016c862498bbad29d1f4d9d4 = ':';$v173a1756d2d82394cb803161f70f9a38->setAttribute('xlink' . $va0f0bc95016c862498bbad29d1f4d9d4 . $vde0366a04f7345d0b277b28f9e86f357, $v3a6d0284e743dc4a9b86f97d6dd1a3bf);break;}case 'comment' : {$v173a1756d2d82394cb803161f70f9a38->appendChild(new DOMComment(' ' . $v3a6d0284e743dc4a9b86f97d6dd1a3bf . ' '));break;}case 'subnodes' : {$va2ca03103f1121212b403d0aa1fa1585 = 'nodes';$va0f0bc95016c862498bbad29d1f4d9d4 = ':';$v9f1cf18509efa587955747cd6c177250 = 'item';$v9b207167e5381c47682c6b4f58a623fb = [       $vde0366a04f7345d0b277b28f9e86f357 => [        $va2ca03103f1121212b403d0aa1fa1585 . $va0f0bc95016c862498bbad29d1f4d9d4 . $v9f1cf18509efa587955747cd6c177250 => $v3a6d0284e743dc4a9b86f97d6dd1a3bf       ]      ];$v3a6d0284e743dc4a9b86f97d6dd1a3bf = $v9b207167e5381c47682c6b4f58a623fb;unset($v9b207167e5381c47682c6b4f58a623fb);}default: {if ($vde0366a04f7345d0b277b28f9e86f357 === 0) {$vb66743fe5aeb962e64866b7d18a6e38b = var_export($v56491f2e1c74898e18bb6e47d2425b19, true);throw new coreException("Can't translate to xml node with key {$v3c6e0b8a9c15224a8228b9a98ca1531d}, sub key {$v518d8dec3947df909fe6e4c9940f98a6}, real key {$vde0366a04f7345d0b277b28f9e86f357}, value {$v3a6d0284e743dc4a9b86f97d6dd1a3bf} and user data {$vb66743fe5aeb962e64866b7d18a6e38b}");}$v8e2dcfd7e7e24b1ca76c1193f645902b = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement($vde0366a04f7345d0b277b28f9e86f357);$this->chooseTranslator($v8e2dcfd7e7e24b1ca76c1193f645902b, $v3a6d0284e743dc4a9b86f97d6dd1a3bf, $v93da65a9fd0004d9477aeac024e08e15);$v173a1756d2d82394cb803161f70f9a38->appendChild($v8e2dcfd7e7e24b1ca76c1193f645902b);}}}}public static $socialNetworkMode = true;}