<?php
 class elFinderVolumeUmiLocalFileSystem extends elFinderVolumeLocalFileSystem {protected $driverId = 'umi';public function _save($v0666f0acdeed38d4cd9084ade1739498, $v28e3d688a3c077b887921cea3fb1dbc7, $vb068931cc450442b63f5b3d276ea4297, $v77ddcb5f19832f4145345889013ab3a4) {if (mb_strpos($v28e3d688a3c077b887921cea3fb1dbc7, USER_FILES_PATH) !== false || mb_strpos($v28e3d688a3c077b887921cea3fb1dbc7, USER_IMAGES_PATH) !== false) {$v7079797cf8751efb52c390933238e7a8 = getBytesFromString(mainConfiguration::getInstance()->get('system', 'quota-files-and-images'));if ($v7079797cf8751efb52c390933238e7a8 != 0) {$v27fe800121fd9e812c6905f3bc8937dd = getBusyDiskSize();if ($v27fe800121fd9e812c6905f3bc8937dd >= $v7079797cf8751efb52c390933238e7a8) {return $this->setError(getLabel('error-files_quota_exceeded'));}}}$v6ab8afa4b6f24d7ff0b766a0a92991ee = $this->ARGS['cmd'] === 'paste';$vb70592abe16f81487ae2dd701bccfb4b = $v6ab8afa4b6f24d7ff0b766a0a92991ee && empty($this->ARGS['cut']);$v13bc15b6648a4890d34de28ca9f48bf0 = $this->ARGS['cmd'] === 'upload';$v240a3357e321e7304433e84e746cc1e1 = $vb70592abe16f81487ae2dd701bccfb4b ? 'copy' : '';$vdfff0a7fa1a55c8c1a4966c19f6da452 = $v13bc15b6648a4890d34de28ca9f48bf0 ? 'upload' : $v240a3357e321e7304433e84e746cc1e1;$vc981ba9b125236385735528b5817ebf5 = method_exists($this, "_doSave_{$vdfff0a7fa1a55c8c1a4966c19f6da452}") ? "_doSave_{$vdfff0a7fa1a55c8c1a4966c19f6da452}" : '_doSave_unknown';$vd6fe1d0be6347b8ef2427fa629c04485 = $this->$vc981ba9b125236385735528b5817ebf5($v0666f0acdeed38d4cd9084ade1739498, $v28e3d688a3c077b887921cea3fb1dbc7, $vb068931cc450442b63f5b3d276ea4297);return $vd6fe1d0be6347b8ef2427fa629c04485;}protected function _checkArchivers() {return $this->options['archivers'] = $this->options['archive'] = [];}protected function _doSave_upload($v0666f0acdeed38d4cd9084ade1739498, $v28e3d688a3c077b887921cea3fb1dbc7, $vb068931cc450442b63f5b3d276ea4297) {$v109633366fd0d46d371ede589998abaa = getcwd();chdir(CURRENT_WORKING_DIR);$vf8e01efdb78603db73dcab7500cfa688 = 0;$v435ed7e9f07f740abf511a62c00eef6e = '.' . rtrim($v28e3d688a3c077b887921cea3fb1dbc7, "/\\") . DIRECTORY_SEPARATOR . $vb068931cc450442b63f5b3d276ea4297;if (isset($_FILES['upload'])) {foreach ($_FILES['upload']['name'] as $v865c0c0b4ab0e063e5caa3387c1a8741 => $v1cf7e4c33df66ca3d5459264ea9a5885) {if ($v1cf7e4c33df66ca3d5459264ea9a5885 == $vb068931cc450442b63f5b3d276ea4297) {$v435ed7e9f07f740abf511a62c00eef6e = $_FILES['upload']['tmp_name'][$v865c0c0b4ab0e063e5caa3387c1a8741];$vf8e01efdb78603db73dcab7500cfa688 = $v865c0c0b4ab0e063e5caa3387c1a8741;}}}$v8d777f385d3dfec8815d20f7496026dc = cmsController::getInstance()    ->getModule('data');$vbd17bd8c3eb88c8c353c22760b3e72bf = (int) filesize($v435ed7e9f07f740abf511a62c00eef6e);if (umiImageFile::getIsImage($vb068931cc450442b63f5b3d276ea4297)) {$ve6a7ab42343e8bc9131d89646abcb773 = $v8d777f385d3dfec8815d20f7496026dc->getAllowedMaxFileSize('img') * 1024 * 1024;if ($ve6a7ab42343e8bc9131d89646abcb773 > 0) {if ($ve6a7ab42343e8bc9131d89646abcb773 < $vbd17bd8c3eb88c8c353c22760b3e72bf) {chdir($v109633366fd0d46d371ede589998abaa);return $this->setError(getLabel('error-max_img_filesize') . ' ' . ($ve6a7ab42343e8bc9131d89646abcb773 / 1024 / 1024) . 'M');}}if (getRequest('water_mark')) {umiImageFile::setWatermarkOn();}$v8c7dd922ad47494fc02c388e12c00eac = umiImageFile::upload('upload', $vf8e01efdb78603db73dcab7500cfa688, $v28e3d688a3c077b887921cea3fb1dbc7);}else {$v566bbee0f961ad71b54c3c2fd36db053 = umiFile::getFileExtension($vb068931cc450442b63f5b3d276ea4297);if (!umiFile::isAllowedFileType($v566bbee0f961ad71b54c3c2fd36db053)) {return $this->setError(elFinder::ERROR_UPLOAD_FILE_MIME);}$v79001f389eb5f5185f6945430cb57be1 = $v8d777f385d3dfec8815d20f7496026dc->getAllowedMaxFileSize() * 1024 * 1024;if ($v79001f389eb5f5185f6945430cb57be1 > 0) {if ($v79001f389eb5f5185f6945430cb57be1 < $vbd17bd8c3eb88c8c353c22760b3e72bf) {chdir($v109633366fd0d46d371ede589998abaa);return $this->setError(getLabel('error-max_filesize') . ' ' . ($v79001f389eb5f5185f6945430cb57be1 / 1024 / 1024) . 'M');}}$v8c7dd922ad47494fc02c388e12c00eac = umiFile::upload('upload', $vf8e01efdb78603db73dcab7500cfa688, $v28e3d688a3c077b887921cea3fb1dbc7);}chdir($v109633366fd0d46d371ede589998abaa);if (!$v8c7dd922ad47494fc02c388e12c00eac instanceof iUmiFile || $v8c7dd922ad47494fc02c388e12c00eac->getIsBroken()) {return $this->setError(elFinder::ERROR_UPLOAD);}return CURRENT_WORKING_DIR . $v8c7dd922ad47494fc02c388e12c00eac->getFilePath(true);}protected function _doSave_copy($v0666f0acdeed38d4cd9084ade1739498, $v28e3d688a3c077b887921cea3fb1dbc7, $vb068931cc450442b63f5b3d276ea4297) {$vd6fe1d0be6347b8ef2427fa629c04485 = $v28e3d688a3c077b887921cea3fb1dbc7 . DIRECTORY_SEPARATOR . $vb068931cc450442b63f5b3d276ea4297;if (!($v42aefbae01d2dfd981f7da7d823d689e = @fopen($vd6fe1d0be6347b8ef2427fa629c04485, 'wb'))) {$this->setError(elFinder::ERROR_COPY);return false;}while (!feof($v0666f0acdeed38d4cd9084ade1739498)) {fwrite($v42aefbae01d2dfd981f7da7d823d689e, fread($v0666f0acdeed38d4cd9084ade1739498, 8192));}fclose($v42aefbae01d2dfd981f7da7d823d689e);@chmod($vd6fe1d0be6347b8ef2427fa629c04485, $this->options['fileMode']);clearstatcache();return $vd6fe1d0be6347b8ef2427fa629c04485;}protected function _doSave_unknown($v0666f0acdeed38d4cd9084ade1739498, $v28e3d688a3c077b887921cea3fb1dbc7, $vb068931cc450442b63f5b3d276ea4297) {return $this->setError(elFinder::ERROR_UNKNOWN_CMD);}protected function _abspath($vd6fe1d0be6347b8ef2427fa629c04485) {$vd6fe1d0be6347b8ef2427fa629c04485 = preg_replace('/(\.\.\/?)/i', '', $vd6fe1d0be6347b8ef2427fa629c04485);return ($vd6fe1d0be6347b8ef2427fa629c04485 == DIRECTORY_SEPARATOR) ? $this->root : $this->root . DIRECTORY_SEPARATOR . $vd6fe1d0be6347b8ef2427fa629c04485;}}